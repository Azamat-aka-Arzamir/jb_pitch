var Vr="0.8.2",E=Symbol(`typegpu:${Vr}:$internal`),Re=Symbol(`typegpu:${Vr}:$gpuValueOf`),st=Symbol(`typegpu:${Vr}:$getNameForward`),Ur=Symbol(`typegpu:${Vr}:$providing`),Xt=Symbol(`typegpu:${Vr}:$ownSnippet`),he=Symbol(`typegpu:${Vr}:$resolve`),ds=Symbol(`typegpu:${Vr}:$repr`);function Ge(e){return!!e?.[E]}var at={[E]:!0,type:"void",toString(){return"void"}},wp=["bool","f32","f16","i32","u32","u16","vec2f","vec2h","vec2i","vec2u","vec2<bool>","vec3f","vec3h","vec3i","vec3u","vec3<bool>","vec4f","vec4h","vec4i","vec4u","vec4<bool>","mat2x2f","mat3x3f","mat4x4f","struct","array","ptr","atomic","decorated","abstractInt","abstractFloat","void","texture_1d","texture_storage_1d","texture_2d","texture_storage_2d","texture_multisampled_2d","texture_depth_2d","texture_depth_multisampled_2d","texture_2d_array","texture_storage_2d_array","texture_depth_2d_array","texture_cube","texture_depth_cube","texture_cube_array","texture_depth_cube_array","texture_3d","texture_storage_3d","texture_external","sampler","sampler_comparison"];function Je(e){let t=e;return Ge(t)&&typeof t.kind=="string"&&t.kind.startsWith("vec")}function Ma(e){let t=e;return Ge(t)&&typeof t.type=="string"&&t.type.startsWith("vec2")}function za(e){let t=e;return Ge(t)&&typeof t.type=="string"&&t.type.startsWith("vec3")}function zl(e){let t=e;return Ge(t)&&typeof t.type=="string"&&t.type.startsWith("vec4")}function nr(e){return Ma(e)||za(e)||zl(e)}function Ln(e){let t=e;return Ge(t)&&typeof t.kind?.startsWith=="function"&&t.kind.startsWith("mat")}function El(e){return Ge(e)&&e?.type==="mat2x2f"}function Sl(e){return Ge(e)&&e?.type==="mat3x3f"}function xp(e){return Ge(e)&&e?.type==="mat4x4f"}function Rs(e){return El(e)||Sl(e)||xp(e)}function tu(e){return Je(e)&&["vec2f","vec3f","vec4f"].includes(e.kind)}function zt(e){return Ge(e)&&wp.includes(e?.type)}function Lt(e){return Ge(e)&&e?.type==="array"}function vt(e){return Ge(e)&&e?.type==="struct"}function Ir(e){return Ge(e)&&e?.type==="ptr"}function Bi(e){return Ge(e)&&e?.type==="atomic"}function uo(e){return Ge(e)&&e?.type==="@align"}function lo(e){return Ge(e)&&e?.type==="@size"}function Pl(e){return Ge(e)&&e?.type==="@location"}function vp(e){return Ge(e)&&e?.type==="@interpolate"}function co(e){return Ge(e)&&e?.type==="@builtin"}function Mn(e){return Ge(e)&&e?.type==="decorated"}function Ul(e){return Ge(e)&&e.type==="void"}function rr(e){let t=e?.type;return Ge(e)&&(t==="abstractInt"||t==="abstractFloat"||t==="f32"||t==="f16"||t==="i32"||t==="u32")}function ho(e){let t=e?.type;return Ge(e)&&(t==="f16"||t==="vec2h"||t==="vec3h"||t==="vec4h")}Object.assign(globalThis,{__TYPEGPU_AUTONAME__:(e,t)=>(Hi(e)&&Ge(e)&&!W(e)&&e.$name(t),e)});var Ea=globalThis;function Al(e){return!!e?.[st]}function W(e){return Al(e)?W(e[st]):Qi(e)?.name}function Ne(e,t){Al(e)&&Ne(e[st],t),bp(e,{name:t})}function Hi(e){return!!e?.$name}function Ss(e){return!!Qi(e)?.ast}function Qi(e){return Ea.__TYPEGPU_META__.get(e)}function bp(e,t){Ea.__TYPEGPU_META__??=new WeakMap;let n=Ea.__TYPEGPU_META__;n.set(e,{...n.get(e),...t})}var Il=["uint8","uint8x2","uint8x4","sint8","sint8x2","sint8x4","unorm8","unorm8x2","unorm8x4","snorm8","snorm8x2","snorm8x4","uint16","uint16x2","uint16x4","sint16","sint16x2","sint16x4","unorm16","unorm16x2","unorm16x4","snorm16","snorm16x2","snorm16x4","float16","float16x2","float16x4","float32","float32x2","float32x3","float32x4","uint32","uint32x2","uint32x3","uint32x4","sint32","sint32x2","sint32x3","sint32x4","unorm10-10-10-2","unorm8x4-bgra"],Tp={f32:"float32",vec2f:"float32x2",vec3f:"float32x3",vec4f:"float32x4",f16:"float16",vec2h:"float16x2",vec4h:"float16x4",u32:"uint32",vec2u:"uint32x2",vec3u:"uint32x3",vec4u:"uint32x4",i32:"sint32",vec2i:"sint32x2",vec3i:"sint32x3",vec4i:"sint32x4"};function fr(e){return e.type==="decorated"||e.type==="loose-decorated"?e.inner:e}var _p=["unstruct","disarray","loose-decorated",...Il];function fs(e){return Ge(e)&&_p.includes(e?.type)}function sr(e){return Ge(e)&&e?.type==="disarray"}function zn(e){return Ge(e)&&e?.type==="unstruct"}function En(e){return Ge(e)&&e?.type==="loose-decorated"}function Ps(e){return e.attribs?.find(uo)?.params[0]}function $p(e){return e.attribs?.find(lo)?.params[0]}function mr(e){return e.attribs?.find(Pl)?.params[0]}function Gr(e){return zt(e)||fs(e)}var kt={type:"unknown",toString(){return"unknown"}},nu=class{constructor(t,n,r){this.name=t,this.lhs=n,this.operator=r}},ru=class{constructor(t){this.matrix=t}},su=class{constructor(t){this.op=t,Ne(this,"consoleLog")}[E]=!0},Mp="Invariant failed";function Kn(e,t){if(!e)throw new Error(Mp)}var $s=class Sa extends Error{constructor(t,n){let r=n.map(s=>`- ${Ss(s)?`fn*:${W(s)}`:s}`);r.length>20&&(r=[...r.slice(0,11),"...",...r.slice(-10)]),super(`Resolution of the following tree failed:
${r.join(`
`)}: ${t&&typeof t=="object"&&"message"in t?t.message:t}`),this.cause=t,this.trace=n,Object.setPrototypeOf(this,Sa.prototype)}appendToTrace(t){let n=[t,...this.trace];return new Sa(this.cause,n)}},iu=class Pa extends Error{constructor(t,n){let r=n.map(s=>`- ${s}`);r.length>20&&(r=[...r.slice(0,11),"...",...r.slice(-10)]),super(`Execution of the following tree failed:
${r.join(`
`)}: ${t&&typeof t=="object"&&"message"in t?t.message:t}`),this.cause=t,this.trace=n,Object.setPrototypeOf(this,Pa.prototype)}appendToTrace(t){let n=[t,...this.trace];return new Pa(this.cause,n)}},zp=class Bl extends Error{constructor(t){super(`Missing value for '${t}'`),this.slot=t,Object.setPrototypeOf(this,Bl.prototype)}},Ep=class kl extends Error{constructor(t){super(`Buffer '${W(t)??"<unnamed>"}' is not bindable as a uniform. Use .$usage('uniform') to allow it.`),Object.setPrototypeOf(this,kl.prototype)}},Sp=class Ol extends Error{constructor(t,n){super(`The function '${t??"<unnamed>"}' is missing links to the following external values: ${n}.`),Object.setPrototypeOf(this,Ol.prototype)}},po=class Vl extends Error{constructor(t){super(`Missing bind groups for layouts: '${[...t].map(n=>W(n)??"<unnamed>").join(", ")}'. Please provide it using pipeline.with(bindGroup).(...)`),Object.setPrototypeOf(this,Vl.prototype)}},Gl=class Dl extends Error{constructor(t){super(`Missing vertex buffers for layouts: '${[...t].map(n=>W(n)??"<unnamed>").join(", ")}'. Please provide it using pipeline.with(layout, buffer).(...)`),Object.setPrototypeOf(this,Dl.prototype)}},au=class Rl extends Error{constructor(t){super(t),Object.setPrototypeOf(this,Rl.prototype)}},ou=class Nl extends Error{constructor(t){super(t),Object.setPrototypeOf(this,Nl.prototype)}},yn=class Fl extends Error{constructor(t){super(t),Object.setPrototypeOf(this,Fl.prototype)}};function Ua(e){return e?.resourceType==="slot"}function Aa(e){return e?.resourceType==="derived"}function Ia(e){return e?.[Ur]!==void 0}function Ki(e){return e?.resourceType==="accessor"}var Ll=class{constructor(t,n){this.value=t,this.dataType=n}};function fo(e){return e instanceof Ll}function di(e){return rr(e.dataType)}function B(e,t){return new Ll(e,fr(t))}var jl=class{type="normal"},Pp=class{type="codegen"},Up=class{constructor(e,t){this.buffers=e,this.vars=t}type="simulate"};function Yl(e){return!!e?.[he]}function mo(e){return e?.[Xt]}function Ap(e){return typeof e=="number"||typeof e=="boolean"||typeof e=="string"||Yl(e)||zt(e)||Ua(e)||Aa(e)||Ia(e)}function Ba(e){return!!e&&typeof e=="object"&&"getMappedRange"in e&&"mapAsync"in e}var $i=!1;function Ip(e){if($i)return e();try{return $i=!0,e()}finally{$i=!1}}function ki(){return $i}var ur;function Cl(e,t){if(Kn(ur===void 0||ur===e),ur===e)return t();ur=e;try{return t()}finally{ur=void 0}}function yr(){return ur}var ql=new jl;function Oi(){return ur?.mode??ql}function Bn(){return ur?.mode.type==="codegen"}function S(e,...t){let n=yr();function r(i){return fo(i)?n.resolve(i.value,i.dataType).value:i}let s="";for(let i=0;i<e.length;++i){s+=e[i];let p=t[i];Array.isArray(p)?s+=p.filter(y=>y!==void 0).map(r).join(", "):p&&(s+=r(p))}return s}function cs(e,t){throw new Error(`Failed to handle ${e} at ${t}`)}var yo={rank:Number.POSITIVE_INFINITY,action:"none"};function Vi(e,t){let n=fr(e),r=fr(t);if(n.type===r.type)return{rank:0,action:"none"};if(n.type==="abstractFloat"){if(r.type==="f32")return{rank:1,action:"none"};if(r.type==="f16")return{rank:2,action:"none"}}if(n.type==="abstractInt"){if(r.type==="i32")return{rank:3,action:"none"};if(r.type==="u32")return{rank:4,action:"none"};if(r.type==="abstractFloat")return{rank:5,action:"none"};if(r.type==="f32")return{rank:6,action:"none"};if(r.type==="f16")return{rank:7,action:"none"}}return nr(n)&&nr(r)?Vi(n.primitive,r.primitive):Rs(n)&&Rs(r)?{rank:0,action:"none"}:yo}function Bp(e,t){let n=fr(e),r=fr(t);if(n.type==="ptr"&&Vi(n.inner,r).rank<Number.POSITIVE_INFINITY)return{rank:0,action:"deref"};if(r.type==="ptr"&&Vi(n,r.inner).rank<Number.POSITIVE_INFINITY)return{rank:1,action:"ref"};let s={f32:0,f16:1,i32:2,u32:3,bool:4};if(n.type in s&&r.type in s){let i=n.type,p=r.type;if(i!==p){let y=s[i];return{rank:s[p]<y?10:20,action:"cast",targetType:r}}}if(n.type==="abstractFloat"){if(r.type==="u32")return{rank:2,action:"cast",targetType:r};if(r.type==="i32")return{rank:1,action:"cast",targetType:r}}return yo}function kp(e,t,n){let r=Vi(e,t);return r.rank<Number.POSITIVE_INFINITY?r:n?Bp(e,t):yo}function uu(e,t,n){let r;for(let i of t){let p=[],y=0;for(let v of e){let _=kp(v,i,n);if(y+=_.rank,_.rank===Number.POSITIVE_INFINITY)break;p.push(_)}y<(r?.sum??Number.POSITIVE_INFINITY)&&(r={type:i,details:p,sum:y})}if(!r)return;let s=r.details.map((i,p)=>({sourceIndex:p,action:i.action,...i.action==="cast"&&{targetType:i.targetType}}));return{targetType:r.type,actions:s,hasImplicitConversions:s.some(i=>i.action==="cast")}}function go(e,t){if(e.length===0)return;let n=[...new Set((t||e).map(fr))],r=uu(e,n,!1);if(r)return r;let s=uu(e,n,!0);if(s)return s}function Op(e,t,n){if(t.action==="none")return B(e.value,n);switch(t.action){case"ref":return B(S`&${e}`,n);case"deref":return B(S`*${e}`,n);case"cast":return n(e);default:cs(t.action,"applyActionToSnippet")}}function ct(e,t){if(e.some(r=>r.type==="unknown"))return;let n=go(e,t);if(n)return e.map(()=>n.targetType)}function Us(e,t,n=!0){let r=e.map(i=>i.dataType);if(r.some(i=>i.type==="unknown"))return;let s=go(r,t);if(s)return e.map((i,p)=>{let y=s.actions[p];return Kn(y),Op(i,y,s.targetType)})}function ka(e,t,n=!0){if(t===e.dataType)return B(e.value,t);if(e.dataType.type==="unknown")return B(S`${B(e.value,t)}`,t);let r=Us([e],[t],n);if(!r)throw new yn(`Cannot convert value of type '${e.dataType.type}' to type '${t.type}'`);return r[0]}function Vp(e,t){return Object.keys(e.propTypes).map(n=>{let r=t[n];if(!r)throw new Error(`Missing property ${n}`);let s=e.propTypes[n];return Us([r],[s])?.[0]??r})}function Gp(e){return typeof e!="string"&&mo(e)===void 0}function ce(e,t,n,r="keep"){let s=((...i)=>Bn()?t(...i):e(...i));return Ne(s,n),s.toString=()=>n,Object.defineProperty(s,E,{value:{jsImpl:e,gpuImpl:t,argConversionHint:r}}),s}var on=class extends Error{constructor(t){super(t),this.name=this.constructor.name}};function G(e){let t=(...r)=>{let{argTypes:s,returnType:i}=typeof e.signature=="function"?e.signature(...r.map(y=>y.dataType)):e.signature,p=r.map((y,v)=>ka(y,s[v],!e.ignoreImplicitCastWarning));if(p.every(y=>Gp(y.value))&&typeof e.normalImpl=="function")try{return B(e.normalImpl(...p.map(y=>y.value)),i)}catch(y){if(!(y instanceof on))throw y}return B(e.codegenImpl(...p),i)},n=((...r)=>{if(Bn())return t(...r);if(typeof e.normalImpl=="string")throw new on(e.normalImpl);return e.normalImpl(...r)});return Ne(n,e.name),n.toString=()=>e.name,Object.defineProperty(n,E,{value:{jsImpl:e.normalImpl,gpuImpl:t,argConversionHint:"keep"}}),n}var Js={[E]:!0,type:"abstractInt",toString(){return"abstractInt"}},Sn={[E]:!0,type:"abstractFloat",toString(){return"abstractFloat"}},Dp=G({name:"bool",signature:e=>({argTypes:e?[e]:[],returnType:ke}),normalImpl(e){return e===void 0?!1:typeof e=="boolean"?e:!!e},codegenImpl:e=>e.dataType.type==="bool"?S`${e}`:S`bool(${e})`}),ke=Object.assign(Dp,{type:"bool"}),Rp=G({name:"u32",signature:e=>({argTypes:e?[e]:[],returnType:J}),normalImpl(e){return e===void 0?0:typeof e=="boolean"?e?1:0:(e&4294967295)>>>0},codegenImpl:e=>e.dataType.type==="u32"?S`${e}`:S`u32(${e})`}),J=Object.assign(Rp,{type:"u32"}),Np=G({name:"i32",signature:e=>({argTypes:e?[e]:[],returnType:Ue}),normalImpl(e){return e===void 0?0:typeof e=="boolean"?e?1:0:e|0},codegenImpl:e=>e.dataType.type==="i32"?S`${e}`:S`i32(${e})`}),Fp={[E]:!0,type:"u16"},Ue=Object.assign(Np,{type:"i32"}),Lp=G({name:"f32",signature:e=>({argTypes:e?[e]:[],returnType:$}),normalImpl(e){return e===void 0?0:typeof e=="boolean"?e?1:0:Math.fround(e)},codegenImpl:e=>e.dataType.type==="f32"?S`${e}`:S`f32(${e})`}),$=Object.assign(Lp,{type:"f32"}),Wl=new ArrayBuffer(4),jp=new Float32Array(Wl),Yp=new Uint32Array(Wl);function Cp(e){jp[0]=e;let t=Yp[0],n=t>>>31&1,r=t>>>23&255,s=t&8388607;return r===255?n<<15|31744|(s?512:0):(r=r-127+15,r<=0?r<-10?n<<15:(s=(s|8388608)>>1-r,s=s+4096>>13,n<<15|s):r>=31||(s=s+4096,s&8388608&&(s=0,++r,r>=31))?n<<15|31744:n<<15|r<<10|s>>13)}function qp(e){let t=e&32768?-1:1,n=e>>10&31,r=e&1023;return n===0?r?t*r*2**-24:t*0:n===31?r?Number.NaN:t===1?Number.POSITIVE_INFINITY:Number.NEGATIVE_INFINITY:t*(1+r/1024)*2**(n-15)}function Wp(e){return qp(Cp(e))}var Xp=G({name:"f16",signature:e=>({argTypes:e?[e]:[],returnType:ut}),normalImpl(e){return e===void 0?0:typeof e=="boolean"?e?1:0:Wp(e)},codegenImpl:e=>e.dataType.type==="f16"?S`${e}`:S`f16(${e})`}),ut=Object.assign(Xp,{type:"f16"}),Dr=class extends Array{castElement(){return this[E].elementSchema[E].jsImpl}[he](){let t=this[E].elementSchema;return this.every(n=>!n)?B(`${this.kind}()`,t):this.every(n=>this[0]===n)?B(`${this.kind}(${this[0]})`,t):B(`${this.kind}(${this.join(", ")})`,t)}toString(){return this[he]().value}get xx(){return new this._Vec2(this[0],this[0])}get xy(){return new this._Vec2(this[0],this[1])}get xz(){return new this._Vec2(this[0],this[2])}get xw(){return new this._Vec2(this[0],this[3])}get yx(){return new this._Vec2(this[1],this[0])}get yy(){return new this._Vec2(this[1],this[1])}get yz(){return new this._Vec2(this[1],this[2])}get yw(){return new this._Vec2(this[1],this[3])}get zx(){return new this._Vec2(this[2],this[0])}get zy(){return new this._Vec2(this[2],this[1])}get zz(){return new this._Vec2(this[2],this[2])}get zw(){return new this._Vec2(this[2],this[3])}get wx(){return new this._Vec2(this[3],this[0])}get wy(){return new this._Vec2(this[3],this[1])}get wz(){return new this._Vec2(this[3],this[2])}get ww(){return new this._Vec2(this[3],this[3])}get xxx(){return new this._Vec3(this[0],this[0],this[0])}get xxy(){return new this._Vec3(this[0],this[0],this[1])}get xxz(){return new this._Vec3(this[0],this[0],this[2])}get xxw(){return new this._Vec3(this[0],this[0],this[3])}get xyx(){return new this._Vec3(this[0],this[1],this[0])}get xyy(){return new this._Vec3(this[0],this[1],this[1])}get xyz(){return new this._Vec3(this[0],this[1],this[2])}get xyw(){return new this._Vec3(this[0],this[1],this[3])}get xzx(){return new this._Vec3(this[0],this[2],this[0])}get xzy(){return new this._Vec3(this[0],this[2],this[1])}get xzz(){return new this._Vec3(this[0],this[2],this[2])}get xzw(){return new this._Vec3(this[0],this[2],this[3])}get xwx(){return new this._Vec3(this[0],this[3],this[0])}get xwy(){return new this._Vec3(this[0],this[3],this[1])}get xwz(){return new this._Vec3(this[0],this[3],this[2])}get xww(){return new this._Vec3(this[0],this[3],this[3])}get yxx(){return new this._Vec3(this[1],this[0],this[0])}get yxy(){return new this._Vec3(this[1],this[0],this[1])}get yxz(){return new this._Vec3(this[1],this[0],this[2])}get yxw(){return new this._Vec3(this[1],this[0],this[3])}get yyx(){return new this._Vec3(this[1],this[1],this[0])}get yyy(){return new this._Vec3(this[1],this[1],this[1])}get yyz(){return new this._Vec3(this[1],this[1],this[2])}get yyw(){return new this._Vec3(this[1],this[1],this[3])}get yzx(){return new this._Vec3(this[1],this[2],this[0])}get yzy(){return new this._Vec3(this[1],this[2],this[1])}get yzz(){return new this._Vec3(this[1],this[2],this[2])}get yzw(){return new this._Vec3(this[1],this[2],this[3])}get ywx(){return new this._Vec3(this[1],this[3],this[0])}get ywy(){return new this._Vec3(this[1],this[3],this[1])}get ywz(){return new this._Vec3(this[1],this[3],this[2])}get yww(){return new this._Vec3(this[1],this[3],this[3])}get zxx(){return new this._Vec3(this[2],this[0],this[0])}get zxy(){return new this._Vec3(this[2],this[0],this[1])}get zxz(){return new this._Vec3(this[2],this[0],this[2])}get zxw(){return new this._Vec3(this[2],this[0],this[3])}get zyx(){return new this._Vec3(this[2],this[1],this[0])}get zyy(){return new this._Vec3(this[2],this[1],this[1])}get zyz(){return new this._Vec3(this[2],this[1],this[2])}get zyw(){return new this._Vec3(this[2],this[1],this[3])}get zzx(){return new this._Vec3(this[2],this[2],this[0])}get zzy(){return new this._Vec3(this[2],this[2],this[1])}get zzz(){return new this._Vec3(this[2],this[2],this[2])}get zzw(){return new this._Vec3(this[2],this[2],this[3])}get zwx(){return new this._Vec3(this[2],this[3],this[0])}get zwy(){return new this._Vec3(this[2],this[3],this[1])}get zwz(){return new this._Vec3(this[2],this[3],this[2])}get zww(){return new this._Vec3(this[2],this[3],this[3])}get wxx(){return new this._Vec3(this[3],this[0],this[0])}get wxy(){return new this._Vec3(this[3],this[0],this[1])}get wxz(){return new this._Vec3(this[3],this[0],this[2])}get wxw(){return new this._Vec3(this[3],this[0],this[3])}get wyx(){return new this._Vec3(this[3],this[1],this[0])}get wyy(){return new this._Vec3(this[3],this[1],this[1])}get wyz(){return new this._Vec3(this[3],this[1],this[2])}get wyw(){return new this._Vec3(this[3],this[1],this[3])}get wzx(){return new this._Vec3(this[3],this[2],this[0])}get wzy(){return new this._Vec3(this[3],this[2],this[1])}get wzz(){return new this._Vec3(this[3],this[2],this[2])}get wzw(){return new this._Vec3(this[3],this[2],this[3])}get wwx(){return new this._Vec3(this[3],this[3],this[0])}get wwy(){return new this._Vec3(this[3],this[3],this[1])}get wwz(){return new this._Vec3(this[3],this[3],this[2])}get www(){return new this._Vec3(this[3],this[3],this[3])}get xxxx(){return new this._Vec4(this[0],this[0],this[0],this[0])}get xxxy(){return new this._Vec4(this[0],this[0],this[0],this[1])}get xxxz(){return new this._Vec4(this[0],this[0],this[0],this[2])}get xxxw(){return new this._Vec4(this[0],this[0],this[0],this[3])}get xxyx(){return new this._Vec4(this[0],this[0],this[1],this[0])}get xxyy(){return new this._Vec4(this[0],this[0],this[1],this[1])}get xxyz(){return new this._Vec4(this[0],this[0],this[1],this[2])}get xxyw(){return new this._Vec4(this[0],this[0],this[1],this[3])}get xxzx(){return new this._Vec4(this[0],this[0],this[2],this[0])}get xxzy(){return new this._Vec4(this[0],this[0],this[2],this[1])}get xxzz(){return new this._Vec4(this[0],this[0],this[2],this[2])}get xxzw(){return new this._Vec4(this[0],this[0],this[2],this[3])}get xxwx(){return new this._Vec4(this[0],this[0],this[3],this[0])}get xxwy(){return new this._Vec4(this[0],this[0],this[3],this[1])}get xxwz(){return new this._Vec4(this[0],this[0],this[3],this[2])}get xxww(){return new this._Vec4(this[0],this[0],this[3],this[3])}get xyxx(){return new this._Vec4(this[0],this[1],this[0],this[0])}get xyxy(){return new this._Vec4(this[0],this[1],this[0],this[1])}get xyxz(){return new this._Vec4(this[0],this[1],this[0],this[2])}get xyxw(){return new this._Vec4(this[0],this[1],this[0],this[3])}get xyyx(){return new this._Vec4(this[0],this[1],this[1],this[0])}get xyyy(){return new this._Vec4(this[0],this[1],this[1],this[1])}get xyyz(){return new this._Vec4(this[0],this[1],this[1],this[2])}get xyyw(){return new this._Vec4(this[0],this[1],this[1],this[3])}get xyzx(){return new this._Vec4(this[0],this[1],this[2],this[0])}get xyzy(){return new this._Vec4(this[0],this[1],this[2],this[1])}get xyzz(){return new this._Vec4(this[0],this[1],this[2],this[2])}get xyzw(){return new this._Vec4(this[0],this[1],this[2],this[3])}get xywx(){return new this._Vec4(this[0],this[1],this[3],this[0])}get xywy(){return new this._Vec4(this[0],this[1],this[3],this[1])}get xywz(){return new this._Vec4(this[0],this[1],this[3],this[2])}get xyww(){return new this._Vec4(this[0],this[1],this[3],this[3])}get xzxx(){return new this._Vec4(this[0],this[2],this[0],this[0])}get xzxy(){return new this._Vec4(this[0],this[2],this[0],this[1])}get xzxz(){return new this._Vec4(this[0],this[2],this[0],this[2])}get xzxw(){return new this._Vec4(this[0],this[2],this[0],this[3])}get xzyx(){return new this._Vec4(this[0],this[2],this[1],this[0])}get xzyy(){return new this._Vec4(this[0],this[2],this[1],this[1])}get xzyz(){return new this._Vec4(this[0],this[2],this[1],this[2])}get xzyw(){return new this._Vec4(this[0],this[2],this[1],this[3])}get xzzx(){return new this._Vec4(this[0],this[2],this[2],this[0])}get xzzy(){return new this._Vec4(this[0],this[2],this[2],this[1])}get xzzz(){return new this._Vec4(this[0],this[2],this[2],this[2])}get xzzw(){return new this._Vec4(this[0],this[2],this[2],this[3])}get xzwx(){return new this._Vec4(this[0],this[2],this[3],this[0])}get xzwy(){return new this._Vec4(this[0],this[2],this[3],this[1])}get xzwz(){return new this._Vec4(this[0],this[2],this[3],this[2])}get xzww(){return new this._Vec4(this[0],this[2],this[3],this[3])}get xwxx(){return new this._Vec4(this[0],this[3],this[0],this[0])}get xwxy(){return new this._Vec4(this[0],this[3],this[0],this[1])}get xwxz(){return new this._Vec4(this[0],this[3],this[0],this[2])}get xwxw(){return new this._Vec4(this[0],this[3],this[0],this[3])}get xwyx(){return new this._Vec4(this[0],this[3],this[1],this[0])}get xwyy(){return new this._Vec4(this[0],this[3],this[1],this[1])}get xwyz(){return new this._Vec4(this[0],this[3],this[1],this[2])}get xwyw(){return new this._Vec4(this[0],this[3],this[1],this[3])}get xwzx(){return new this._Vec4(this[0],this[3],this[2],this[0])}get xwzy(){return new this._Vec4(this[0],this[3],this[2],this[1])}get xwzz(){return new this._Vec4(this[0],this[3],this[2],this[2])}get xwzw(){return new this._Vec4(this[0],this[3],this[2],this[3])}get xwwx(){return new this._Vec4(this[0],this[3],this[3],this[0])}get xwwy(){return new this._Vec4(this[0],this[3],this[3],this[1])}get xwwz(){return new this._Vec4(this[0],this[3],this[3],this[2])}get xwww(){return new this._Vec4(this[0],this[3],this[3],this[3])}get yxxx(){return new this._Vec4(this[1],this[0],this[0],this[0])}get yxxy(){return new this._Vec4(this[1],this[0],this[0],this[1])}get yxxz(){return new this._Vec4(this[1],this[0],this[0],this[2])}get yxxw(){return new this._Vec4(this[1],this[0],this[0],this[3])}get yxyx(){return new this._Vec4(this[1],this[0],this[1],this[0])}get yxyy(){return new this._Vec4(this[1],this[0],this[1],this[1])}get yxyz(){return new this._Vec4(this[1],this[0],this[1],this[2])}get yxyw(){return new this._Vec4(this[1],this[0],this[1],this[3])}get yxzx(){return new this._Vec4(this[1],this[0],this[2],this[0])}get yxzy(){return new this._Vec4(this[1],this[0],this[2],this[1])}get yxzz(){return new this._Vec4(this[1],this[0],this[2],this[2])}get yxzw(){return new this._Vec4(this[1],this[0],this[2],this[3])}get yxwx(){return new this._Vec4(this[1],this[0],this[3],this[0])}get yxwy(){return new this._Vec4(this[1],this[0],this[3],this[1])}get yxwz(){return new this._Vec4(this[1],this[0],this[3],this[2])}get yxww(){return new this._Vec4(this[1],this[0],this[3],this[3])}get yyxx(){return new this._Vec4(this[1],this[1],this[0],this[0])}get yyxy(){return new this._Vec4(this[1],this[1],this[0],this[1])}get yyxz(){return new this._Vec4(this[1],this[1],this[0],this[2])}get yyxw(){return new this._Vec4(this[1],this[1],this[0],this[3])}get yyyx(){return new this._Vec4(this[1],this[1],this[1],this[0])}get yyyy(){return new this._Vec4(this[1],this[1],this[1],this[1])}get yyyz(){return new this._Vec4(this[1],this[1],this[1],this[2])}get yyyw(){return new this._Vec4(this[1],this[1],this[1],this[3])}get yyzx(){return new this._Vec4(this[1],this[1],this[2],this[0])}get yyzy(){return new this._Vec4(this[1],this[1],this[2],this[1])}get yyzz(){return new this._Vec4(this[1],this[1],this[2],this[2])}get yyzw(){return new this._Vec4(this[1],this[1],this[2],this[3])}get yywx(){return new this._Vec4(this[1],this[1],this[3],this[0])}get yywy(){return new this._Vec4(this[1],this[1],this[3],this[1])}get yywz(){return new this._Vec4(this[1],this[1],this[3],this[2])}get yyww(){return new this._Vec4(this[1],this[1],this[3],this[3])}get yzxx(){return new this._Vec4(this[1],this[2],this[0],this[0])}get yzxy(){return new this._Vec4(this[1],this[2],this[0],this[1])}get yzxz(){return new this._Vec4(this[1],this[2],this[0],this[2])}get yzxw(){return new this._Vec4(this[1],this[2],this[0],this[3])}get yzyx(){return new this._Vec4(this[1],this[2],this[1],this[0])}get yzyy(){return new this._Vec4(this[1],this[2],this[1],this[1])}get yzyz(){return new this._Vec4(this[1],this[2],this[1],this[2])}get yzyw(){return new this._Vec4(this[1],this[2],this[1],this[3])}get yzzx(){return new this._Vec4(this[1],this[2],this[2],this[0])}get yzzy(){return new this._Vec4(this[1],this[2],this[2],this[1])}get yzzz(){return new this._Vec4(this[1],this[2],this[2],this[2])}get yzzw(){return new this._Vec4(this[1],this[2],this[2],this[3])}get yzwx(){return new this._Vec4(this[1],this[2],this[3],this[0])}get yzwy(){return new this._Vec4(this[1],this[2],this[3],this[1])}get yzwz(){return new this._Vec4(this[1],this[2],this[3],this[2])}get yzww(){return new this._Vec4(this[1],this[2],this[3],this[3])}get ywxx(){return new this._Vec4(this[1],this[3],this[0],this[0])}get ywxy(){return new this._Vec4(this[1],this[3],this[0],this[1])}get ywxz(){return new this._Vec4(this[1],this[3],this[0],this[2])}get ywxw(){return new this._Vec4(this[1],this[3],this[0],this[3])}get ywyx(){return new this._Vec4(this[1],this[3],this[1],this[0])}get ywyy(){return new this._Vec4(this[1],this[3],this[1],this[1])}get ywyz(){return new this._Vec4(this[1],this[3],this[1],this[2])}get ywyw(){return new this._Vec4(this[1],this[3],this[1],this[3])}get ywzx(){return new this._Vec4(this[1],this[3],this[2],this[0])}get ywzy(){return new this._Vec4(this[1],this[3],this[2],this[1])}get ywzz(){return new this._Vec4(this[1],this[3],this[2],this[2])}get ywzw(){return new this._Vec4(this[1],this[3],this[2],this[3])}get ywwx(){return new this._Vec4(this[1],this[3],this[3],this[0])}get ywwy(){return new this._Vec4(this[1],this[3],this[3],this[1])}get ywwz(){return new this._Vec4(this[1],this[3],this[3],this[2])}get ywww(){return new this._Vec4(this[1],this[3],this[3],this[3])}get zxxx(){return new this._Vec4(this[2],this[0],this[0],this[0])}get zxxy(){return new this._Vec4(this[2],this[0],this[0],this[1])}get zxxz(){return new this._Vec4(this[2],this[0],this[0],this[2])}get zxxw(){return new this._Vec4(this[2],this[0],this[0],this[3])}get zxyx(){return new this._Vec4(this[2],this[0],this[1],this[0])}get zxyy(){return new this._Vec4(this[2],this[0],this[1],this[1])}get zxyz(){return new this._Vec4(this[2],this[0],this[1],this[2])}get zxyw(){return new this._Vec4(this[2],this[0],this[1],this[3])}get zxzx(){return new this._Vec4(this[2],this[0],this[2],this[0])}get zxzy(){return new this._Vec4(this[2],this[0],this[2],this[1])}get zxzz(){return new this._Vec4(this[2],this[0],this[2],this[2])}get zxzw(){return new this._Vec4(this[2],this[0],this[2],this[3])}get zxwx(){return new this._Vec4(this[2],this[0],this[3],this[0])}get zxwy(){return new this._Vec4(this[2],this[0],this[3],this[1])}get zxwz(){return new this._Vec4(this[2],this[0],this[3],this[2])}get zxww(){return new this._Vec4(this[2],this[0],this[3],this[3])}get zyxx(){return new this._Vec4(this[2],this[1],this[0],this[0])}get zyxy(){return new this._Vec4(this[2],this[1],this[0],this[1])}get zyxz(){return new this._Vec4(this[2],this[1],this[0],this[2])}get zyxw(){return new this._Vec4(this[2],this[1],this[0],this[3])}get zyyx(){return new this._Vec4(this[2],this[1],this[1],this[0])}get zyyy(){return new this._Vec4(this[2],this[1],this[1],this[1])}get zyyz(){return new this._Vec4(this[2],this[1],this[1],this[2])}get zyyw(){return new this._Vec4(this[2],this[1],this[1],this[3])}get zyzx(){return new this._Vec4(this[2],this[1],this[2],this[0])}get zyzy(){return new this._Vec4(this[2],this[1],this[2],this[1])}get zyzz(){return new this._Vec4(this[2],this[1],this[2],this[2])}get zyzw(){return new this._Vec4(this[2],this[1],this[2],this[3])}get zywx(){return new this._Vec4(this[2],this[1],this[3],this[0])}get zywy(){return new this._Vec4(this[2],this[1],this[3],this[1])}get zywz(){return new this._Vec4(this[2],this[1],this[3],this[2])}get zyww(){return new this._Vec4(this[2],this[1],this[3],this[3])}get zzxx(){return new this._Vec4(this[2],this[2],this[0],this[0])}get zzxy(){return new this._Vec4(this[2],this[2],this[0],this[1])}get zzxz(){return new this._Vec4(this[2],this[2],this[0],this[2])}get zzxw(){return new this._Vec4(this[2],this[2],this[0],this[3])}get zzyx(){return new this._Vec4(this[2],this[2],this[1],this[0])}get zzyy(){return new this._Vec4(this[2],this[2],this[1],this[1])}get zzyz(){return new this._Vec4(this[2],this[2],this[1],this[2])}get zzyw(){return new this._Vec4(this[2],this[2],this[1],this[3])}get zzzx(){return new this._Vec4(this[2],this[2],this[2],this[0])}get zzzy(){return new this._Vec4(this[2],this[2],this[2],this[1])}get zzzz(){return new this._Vec4(this[2],this[2],this[2],this[2])}get zzzw(){return new this._Vec4(this[2],this[2],this[2],this[3])}get zzwx(){return new this._Vec4(this[2],this[2],this[3],this[0])}get zzwy(){return new this._Vec4(this[2],this[2],this[3],this[1])}get zzwz(){return new this._Vec4(this[2],this[2],this[3],this[2])}get zzww(){return new this._Vec4(this[2],this[2],this[3],this[3])}get zwxx(){return new this._Vec4(this[2],this[3],this[0],this[0])}get zwxy(){return new this._Vec4(this[2],this[3],this[0],this[1])}get zwxz(){return new this._Vec4(this[2],this[3],this[0],this[2])}get zwxw(){return new this._Vec4(this[2],this[3],this[0],this[3])}get zwyx(){return new this._Vec4(this[2],this[3],this[1],this[0])}get zwyy(){return new this._Vec4(this[2],this[3],this[1],this[1])}get zwyz(){return new this._Vec4(this[2],this[3],this[1],this[2])}get zwyw(){return new this._Vec4(this[2],this[3],this[1],this[3])}get zwzx(){return new this._Vec4(this[2],this[3],this[2],this[0])}get zwzy(){return new this._Vec4(this[2],this[3],this[2],this[1])}get zwzz(){return new this._Vec4(this[2],this[3],this[2],this[2])}get zwzw(){return new this._Vec4(this[2],this[3],this[2],this[3])}get zwwx(){return new this._Vec4(this[2],this[3],this[3],this[0])}get zwwy(){return new this._Vec4(this[2],this[3],this[3],this[1])}get zwwz(){return new this._Vec4(this[2],this[3],this[3],this[2])}get zwww(){return new this._Vec4(this[2],this[3],this[3],this[3])}get wxxx(){return new this._Vec4(this[3],this[0],this[0],this[0])}get wxxy(){return new this._Vec4(this[3],this[0],this[0],this[1])}get wxxz(){return new this._Vec4(this[3],this[0],this[0],this[2])}get wxxw(){return new this._Vec4(this[3],this[0],this[0],this[3])}get wxyx(){return new this._Vec4(this[3],this[0],this[1],this[0])}get wxyy(){return new this._Vec4(this[3],this[0],this[1],this[1])}get wxyz(){return new this._Vec4(this[3],this[0],this[1],this[2])}get wxyw(){return new this._Vec4(this[3],this[0],this[1],this[3])}get wxzx(){return new this._Vec4(this[3],this[0],this[2],this[0])}get wxzy(){return new this._Vec4(this[3],this[0],this[2],this[1])}get wxzz(){return new this._Vec4(this[3],this[0],this[2],this[2])}get wxzw(){return new this._Vec4(this[3],this[0],this[2],this[3])}get wxwx(){return new this._Vec4(this[3],this[0],this[3],this[0])}get wxwy(){return new this._Vec4(this[3],this[0],this[3],this[1])}get wxwz(){return new this._Vec4(this[3],this[0],this[3],this[2])}get wxww(){return new this._Vec4(this[3],this[0],this[3],this[3])}get wyxx(){return new this._Vec4(this[3],this[1],this[0],this[0])}get wyxy(){return new this._Vec4(this[3],this[1],this[0],this[1])}get wyxz(){return new this._Vec4(this[3],this[1],this[0],this[2])}get wyxw(){return new this._Vec4(this[3],this[1],this[0],this[3])}get wyyx(){return new this._Vec4(this[3],this[1],this[1],this[0])}get wyyy(){return new this._Vec4(this[3],this[1],this[1],this[1])}get wyyz(){return new this._Vec4(this[3],this[1],this[1],this[2])}get wyyw(){return new this._Vec4(this[3],this[1],this[1],this[3])}get wyzx(){return new this._Vec4(this[3],this[1],this[2],this[0])}get wyzy(){return new this._Vec4(this[3],this[1],this[2],this[1])}get wyzz(){return new this._Vec4(this[3],this[1],this[2],this[2])}get wyzw(){return new this._Vec4(this[3],this[1],this[2],this[3])}get wywx(){return new this._Vec4(this[3],this[1],this[3],this[0])}get wywy(){return new this._Vec4(this[3],this[1],this[3],this[1])}get wywz(){return new this._Vec4(this[3],this[1],this[3],this[2])}get wyww(){return new this._Vec4(this[3],this[1],this[3],this[3])}get wzxx(){return new this._Vec4(this[3],this[2],this[0],this[0])}get wzxy(){return new this._Vec4(this[3],this[2],this[0],this[1])}get wzxz(){return new this._Vec4(this[3],this[2],this[0],this[2])}get wzxw(){return new this._Vec4(this[3],this[2],this[0],this[3])}get wzyx(){return new this._Vec4(this[3],this[2],this[1],this[0])}get wzyy(){return new this._Vec4(this[3],this[2],this[1],this[1])}get wzyz(){return new this._Vec4(this[3],this[2],this[1],this[2])}get wzyw(){return new this._Vec4(this[3],this[2],this[1],this[3])}get wzzx(){return new this._Vec4(this[3],this[2],this[2],this[0])}get wzzy(){return new this._Vec4(this[3],this[2],this[2],this[1])}get wzzz(){return new this._Vec4(this[3],this[2],this[2],this[2])}get wzzw(){return new this._Vec4(this[3],this[2],this[2],this[3])}get wzwx(){return new this._Vec4(this[3],this[2],this[3],this[0])}get wzwy(){return new this._Vec4(this[3],this[2],this[3],this[1])}get wzwz(){return new this._Vec4(this[3],this[2],this[3],this[2])}get wzww(){return new this._Vec4(this[3],this[2],this[3],this[3])}get wwxx(){return new this._Vec4(this[3],this[3],this[0],this[0])}get wwxy(){return new this._Vec4(this[3],this[3],this[0],this[1])}get wwxz(){return new this._Vec4(this[3],this[3],this[0],this[2])}get wwxw(){return new this._Vec4(this[3],this[3],this[0],this[3])}get wwyx(){return new this._Vec4(this[3],this[3],this[1],this[0])}get wwyy(){return new this._Vec4(this[3],this[3],this[1],this[1])}get wwyz(){return new this._Vec4(this[3],this[3],this[1],this[2])}get wwyw(){return new this._Vec4(this[3],this[3],this[1],this[3])}get wwzx(){return new this._Vec4(this[3],this[3],this[2],this[0])}get wwzy(){return new this._Vec4(this[3],this[3],this[2],this[1])}get wwzz(){return new this._Vec4(this[3],this[3],this[2],this[2])}get wwzw(){return new this._Vec4(this[3],this[3],this[2],this[3])}get wwwx(){return new this._Vec4(this[3],this[3],this[3],this[0])}get wwwy(){return new this._Vec4(this[3],this[3],this[3],this[1])}get wwwz(){return new this._Vec4(this[3],this[3],this[3],this[2])}get wwww(){return new this._Vec4(this[3],this[3],this[3],this[3])}},Zs=class extends Dr{e0;e1;constructor(t,n){super(2),this.e0=this.castElement()(t),this.e1=this.castElement()(n??t)}get 0(){return this.e0}get 1(){return this.e1}set 0(t){this.e0=this.castElement()(t)}set 1(t){this.e1=this.castElement()(t)}get x(){return this[0]}get y(){return this[1]}set x(t){this[0]=this.castElement()(t)}set y(t){this[1]=this.castElement()(t)}},Hs=class extends Dr{e0;e1;e2;constructor(t,n,r){super(3),this.e0=this.castElement()(t),this.e1=this.castElement()(n??t),this.e2=this.castElement()(r??t)}get 0(){return this.e0}get 1(){return this.e1}get 2(){return this.e2}set 0(t){this.e0=this.castElement()(t)}set 1(t){this.e1=this.castElement()(t)}set 2(t){this.e2=this.castElement()(t)}get x(){return this[0]}get y(){return this[1]}get z(){return this[2]}set x(t){this[0]=this.castElement()(t)}set y(t){this[1]=this.castElement()(t)}set z(t){this[2]=this.castElement()(t)}},Qs=class extends Dr{e0;e1;e2;e3;constructor(t,n,r,s){super(4),this.e0=this.castElement()(t),this.e1=this.castElement()(n??t),this.e2=this.castElement()(r??t),this.e3=this.castElement()(s??t)}get 0(){return this.e0}get 1(){return this.e1}get 2(){return this.e2}get 3(){return this.e3}set 0(t){this.e0=this.castElement()(t)}set 1(t){this.e1=this.castElement()(t)}set 2(t){this.e2=this.castElement()(t)}set 3(t){this.e3=this.castElement()(t)}get x(){return this[0]}get y(){return this[1]}get z(){return this[2]}get w(){return this[3]}set x(t){this[0]=t}set y(t){this[1]=t}set z(t){this[2]=t}set w(t){this[3]=t}},wo=class Xl extends Zs{get[E](){return{elementSchema:$}}get kind(){return"vec2f"}get _Vec2(){return Xl}get _Vec3(){return _o}get _Vec4(){return So}},xo=class Jl extends Zs{get[E](){return{elementSchema:ut}}get kind(){return"vec2h"}get _Vec2(){return Jl}get _Vec3(){return $o}get _Vec4(){return Po}},vo=class Zl extends Zs{get[E](){return{elementSchema:Ue}}get kind(){return"vec2i"}get _Vec2(){return Zl}get _Vec3(){return Mo}get _Vec4(){return Uo}},bo=class Hl extends Zs{get[E](){return{elementSchema:J}}get kind(){return"vec2u"}get _Vec2(){return Hl}get _Vec3(){return zo}get _Vec4(){return Ao}},To=class Ql extends Zs{get[E](){return{elementSchema:ke}}get kind(){return"vec2<bool>"}get _Vec2(){return Ql}get _Vec3(){return Eo}get _Vec4(){return Io}},_o=class Kl extends Hs{get[E](){return{elementSchema:$}}get kind(){return"vec3f"}get _Vec2(){return wo}get _Vec3(){return Kl}get _Vec4(){return So}},$o=class ec extends Hs{get[E](){return{elementSchema:ut}}get kind(){return"vec3h"}get _Vec2(){return xo}get _Vec3(){return ec}get _Vec4(){return Po}},Mo=class tc extends Hs{get[E](){return{elementSchema:Ue}}get kind(){return"vec3i"}get _Vec2(){return vo}get _Vec3(){return tc}get _Vec4(){return Uo}},zo=class nc extends Hs{get[E](){return{elementSchema:J}}get kind(){return"vec3u"}get _Vec2(){return bo}get _Vec3(){return nc}get _Vec4(){return Ao}},Eo=class rc extends Hs{get[E](){return{elementSchema:ke}}get kind(){return"vec3<bool>"}get _Vec2(){return To}get _Vec3(){return rc}get _Vec4(){return Io}},So=class sc extends Qs{get[E](){return{elementSchema:$}}get kind(){return"vec4f"}get _Vec2(){return wo}get _Vec3(){return _o}get _Vec4(){return sc}},Po=class ic extends Qs{get[E](){return{elementSchema:ut}}get kind(){return"vec4h"}get _Vec2(){return xo}get _Vec3(){return $o}get _Vec4(){return ic}},Uo=class ac extends Qs{get[E](){return{elementSchema:Ue}}get kind(){return"vec4i"}get _Vec2(){return vo}get _Vec3(){return Mo}get _Vec4(){return ac}},Ao=class oc extends Qs{get[E](){return{elementSchema:J}}get kind(){return"vec4u"}get _Vec2(){return bo}get _Vec3(){return zo}get _Vec4(){return oc}},Io=class uc extends Qs{get[E](){return{elementSchema:ke}}get kind(){return"vec4<bool>"}get _Vec2(){return To}get _Vec3(){return Eo}get _Vec4(){return uc}},F=Yt(wo,$),Pn=Yt(xo,ut),Be=Yt(vo,Ue),xt=Yt(bo,J),vr=Yt(To,ke),O=Yt(_o,$),Un=Yt($o,ut),Ot=Yt(Mo,Ue),rt=Yt(zo,J),br=Yt(Eo,ke),k=Yt(So,$),An=Yt(Po,ut),Fe=Yt(Uo,Ue),Ye=Yt(Ao,J),Tr=Yt(Io,ke),Gi={vec2f:F,vec2h:Pn,vec2i:Be,vec2u:xt,"vec2<bool>":vr,vec3f:O,vec3h:Un,vec3i:Ot,vec3u:rt,"vec3<bool>":br,vec4f:k,vec4h:An,vec4i:Fe,vec4u:Ye,"vec4<bool>":Tr};function Yt(e,t){let{kind:n,length:r}=new e,s=G({name:n,signature:(...p)=>({argTypes:p.map(y=>{let v=fr(y);return nr(v)?v:t}),returnType:i}),normalImpl:(...p)=>{let y=new Array(p.length),v=0;for(let _ of p)if(typeof _=="number"||typeof _=="boolean")y[v++]=_;else for(let P=0;P<_.length;++P)y[v++]=_[P];if(y.length<=1||y.length===r)return new e(...y);throw new Error(`'${n}' constructor called with invalid number of arguments.`)},ignoreImplicitCastWarning:!0,codegenImpl:(...p)=>S`${n}(${p})`}),i=Object.assign(s,{type:n,primitive:t,[ds]:void 0});return i}var pe=class{constructor(t){this.type=t}[E]=!0},ir={uint8:J,uint8x2:xt,uint8x4:Ye,sint8:Ue,sint8x2:Be,sint8x4:Fe,unorm8:$,unorm8x2:F,unorm8x4:k,snorm8:$,snorm8x2:F,snorm8x4:k,uint16:J,uint16x2:xt,uint16x4:Ye,sint16:Ue,sint16x2:Be,sint16x4:Fe,unorm16:$,unorm16x2:F,unorm16x4:k,snorm16:$,snorm16x2:F,snorm16x4:k,float16:$,float16x2:F,float16x4:k,float32:$,float32x2:F,float32x3:O,float32x4:k,uint32:J,uint32x2:xt,uint32x3:rt,uint32x4:Ye,sint32:Ue,sint32x2:Be,sint32x3:Ot,sint32x4:Fe,"unorm10-10-10-2":k,"unorm8x4-bgra":k},Bo=new Set(Object.keys(ir)),Jp=new pe("uint8"),Zp=new pe("uint8x2"),Hp=new pe("uint8x4"),Qp=new pe("sint8"),Kp=new pe("sint8x2"),ed=new pe("sint8x4"),td=new pe("unorm8"),nd=new pe("unorm8x2"),rd=new pe("unorm8x4"),sd=new pe("snorm8"),id=new pe("snorm8x2"),ad=new pe("snorm8x4"),od=new pe("uint16"),ud=new pe("uint16x2"),ld=new pe("uint16x4"),cd=new pe("sint16"),hd=new pe("sint16x2"),pd=new pe("sint16x4"),dd=new pe("unorm16"),fd=new pe("unorm16x2"),md=new pe("unorm16x4"),yd=new pe("snorm16"),gd=new pe("snorm16x2"),wd=new pe("snorm16x4"),xd=new pe("float16"),vd=new pe("float16x2"),bd=new pe("float16x4"),Td=new pe("float32"),_d=new pe("float32x2"),$d=new pe("float32x3"),Md=new pe("float32x4"),zd=new pe("uint32"),Ed=new pe("uint32x2"),Sd=new pe("uint32x3"),Pd=new pe("uint32x4"),Ud=new pe("sint32"),Ad=new pe("sint32x2"),Id=new pe("sint32x3"),Bd=new pe("sint32x4"),kd=new pe("unorm10-10-10-2"),Od=new pe("unorm8x4-bgra");function lc(e){return Ge(e)&&Bo.has(e?.type)}function Jt(e){let t=String(e);if(t!=="[object Object]")return t;try{return JSON.stringify(e)}catch(n){return console.error("Error parsing JSON:",n),"<invalid json>"}}function Oa(e){return Je(e)||Ln(e)?e.toString():Array.isArray(e)?`[${e.map(Oa).join(", ")}]`:e&&typeof e=="object"?`{ ${Object.entries(e).map(([t,n])=>`${t}: ${Oa(n)}`).join(", ")} }`:String(e)}var Vd={f32:4,f16:2,i32:4,u32:4,bool:4,u16:2,vec2f:8,vec2h:4,vec2i:8,vec2u:8,vec2b:8,vec3f:16,vec3h:8,vec3i:16,vec3u:16,vec3b:16,vec4f:16,vec4h:8,vec4i:16,vec4u:16,vec4b:16,mat2x2f:8,mat3x3f:16,mat4x4f:16,atomic:4};function Gd(e){let t=e?.type,n=Vd[t];if(n!==void 0)return n;if(vt(e))return Object.values(e.propTypes).map(tt).reduce((r,s)=>r>s?r:s);if(Lt(e))return tt(e.elementType);if(zn(e)){let r=Object.values(e.propTypes)[0];return r?Ps(r)??1:1}if(sr(e))return Ps(e.elementType)??1;if(Mn(e)||En(e))return Ps(e)??tt(e.inner);if(Bo.has(t))return 1;throw new Error(`Cannot determine alignment of data: ${Jt(e)}`)}function Dd(e){if(zn(e)){let t=Object.values(e.propTypes)[0];return t?wn(t):1}return sr(e)?wn(e.elementType):En(e)?Ps(e)??wn(e.inner):Ps(e)??1}var lu=new WeakMap,cu=new WeakMap;function tt(e){let t=lu.get(e);return t===void 0&&(t=Gd(e),lu.set(e,t)),t}function wn(e){let t=cu.get(e);return t===void 0&&(t=Dd(e),cu.set(e,t)),t}function Rd(e){return tt(e)}var sn=(e,t)=>{let n=t-1,r=~n;return(e&n)===0?e:(e&r)+t},Nd={bool:4,f32:4,f16:2,i32:4,u32:4,u16:2,vec2f:8,vec2h:4,vec2i:8,vec2u:8,"vec2<bool>":8,vec3f:12,vec3h:6,vec3i:12,vec3u:12,"vec3<bool>":12,vec4f:16,vec4h:8,vec4i:16,vec4u:16,"vec4<bool>":16,mat2x2f:16,mat3x3f:48,mat4x4f:64,uint8:1,uint8x2:2,uint8x4:4,sint8:1,sint8x2:2,sint8x4:4,unorm8:1,unorm8x2:2,unorm8x4:4,snorm8:1,snorm8x2:2,snorm8x4:4,uint16:2,uint16x2:4,uint16x4:8,sint16:2,sint16x2:4,sint16x4:8,unorm16:2,unorm16x2:4,unorm16x4:8,snorm16:2,snorm16x2:4,snorm16x4:8,float16:2,float16x2:4,float16x4:8,float32:4,float32x2:8,float32x3:12,float32x4:16,uint32:4,uint32x2:8,uint32x3:12,uint32x4:16,sint32:4,sint32x2:8,sint32x3:12,sint32x4:16,"unorm10-10-10-2":4,"unorm8x4-bgra":4,atomic:4};function Fd(e){let t=0,n=e.propTypes;for(let r of Object.values(n)){if(Number.isNaN(t))throw new Error("Only the last property of a struct can be unbounded");if(t=sn(t,tt(r)),t+=_e(r),Number.isNaN(t)&&r.type!=="array")throw new Error("Cannot nest unbounded struct within another struct")}return sn(t,tt(e))}function Ld(e){let t=0,n=e.propTypes;for(let r of Object.values(n)){let s=wn(r);t=sn(t,s),t+=_e(r)}return t}function jd(e){let t=Nd[e?.type];if(t!==void 0)return t;if(vt(e))return Fd(e);if(zn(e))return Ld(e);if(Lt(e)){if(e.elementCount===0)return Number.NaN;let n=tt(e.elementType);return sn(_e(e.elementType),n)*e.elementCount}if(sr(e)){let n=wn(e.elementType);return sn(_e(e.elementType),n)*e.elementCount}if(Mn(e)||En(e))return $p(e)??_e(e.inner);throw new Error(`Cannot determine size of data: ${e}`)}var hu=new WeakMap;function _e(e){let t=hu.get(e);return t===void 0&&(t=jd(e),hu.set(e,t)),t}function Yd(e){return _e(e)}function ms(e,t){return Mn(e)?new pu(e.inner,[t,...e.attribs]):En(e)?new du(e.inner,[t,...e.attribs]):fs(e)?new du(e,[t]):new pu(e,[t])}function Cd(e,t){return ms(t,{[E]:!0,type:"@align",params:[e]})}function qd(e,t){return ms(t,{[E]:!0,type:"@size",params:[e]})}function Di(e,t){return ms(t,{[E]:!0,type:"@location",params:[e]})}function Wd(e,t){return ms(t,{[E]:!0,type:"@interpolate",params:[e]})}function Xd(e){if(!Rr(e))throw new Error("The @invariant attribute must only be applied to the position built-in value.");let t=Mn(e)||En(e)?e.attribs.find(co):void 0;if(!t||t.params[0]!=="position")throw new Error("The @invariant attribute must only be applied to the position built-in value.");return ms(e,{[E]:!0,type:"@invariant",params:[]})}function Rr(e){return(Mn(e)||En(e))&&e.attribs.find(co)!==void 0}function ko(e){return!Mn(e)&&!En(e)?"":e.attribs.map(t=>t.params.length===0?`${t.type} `:`${t.type}(${t.params.join(", ")}) `).join("")}var cc=class{constructor(t,n){this.inner=t,this.attribs=n;let r=n.find(uo)?.params[0],s=n.find(lo)?.params[0];if(r!==void 0){if(r<=0)throw new Error(`Custom data alignment must be a positive number, got: ${r}.`);if(Math.log2(r)%1!==0)throw new Error(`Alignment has to be a power of 2, got: ${r}.`);if(zt(this.inner)&&r%tt(this.inner)!==0)throw new Error(`Custom alignment has to be a multiple of the standard data alignment. Got: ${r}, expected multiple of: ${tt(this.inner)}.`)}if(s!==void 0){if(s<_e(this.inner))throw new Error(`Custom data size cannot be smaller then the standard data size. Got: ${s}, expected at least: ${_e(this.inner)}.`);if(s<=0)throw new Error(`Custom data size must be a positive number. Got: ${s}.`)}}[E]=!0},pu=class extends cc{[E]=!0;type="decorated"},du=class extends cc{[E]=!0;type="loose-decorated"};function Br(e,t){let n=e?.type,r=n in ir?ir[n]:e;return typeof r!="function"?t:t===void 0?r():r(t)}function qn(e){return hc(e,!1)}function wt(e){return hc(e,!0)}function hc(e,t){let n=r=>Object.fromEntries(Object.entries(e).map(([s,i])=>[s,Br(i,r?.[s])]));return Object.setPrototypeOf(n,Jd),n.propTypes=e,Object.defineProperty(n,E,{value:{isAbstruct:t}}),n}var Jd={type:"struct",$name(e){return Ne(this,e),this},toString(){return`struct:${W(this)??"<unnamed>"}`}},Yn=ce(((e,t)=>t===void 0?n=>da(e,n):da(e,t)),(e,t)=>{if(t?.value===void 0){let n=r=>Yn[E].gpuImpl(e,r);return n[E]=!0,B(n,kt)}if(typeof t.value!="number")throw new Error(`Cannot create array schema with count unknown at compile-time: '${t.value}'`);return B(da(e.value,t.value),e.value)},"arrayOf");function da(e,t){let n=r=>{if(r&&r.length!==t)throw new Error(`Array schema of ${t} elements of type ${e.type} called with ${r.length} argument(s).`);return Array.from({length:t},(s,i)=>Br(e,r?.[i]))};if(Object.setPrototypeOf(n,Zd),Number.isNaN(_e(e)))throw new Error("Cannot nest runtime sized arrays.");if(n.elementType=e,!Number.isInteger(t)||t<0)throw new Error(`Cannot create array schema with invalid element count: ${t}.`);return n.elementCount=t,n}var Zd={[E]:!0,type:"array",toString(){return`arrayOf(${this.elementType}, ${this.elementCount})`}};function Nt(e,t){return ms(e,{[E]:!0,type:"@builtin",params:[t]})}var Ns={vertexIndex:Nt(J,"vertex_index"),instanceIndex:Nt(J,"instance_index"),position:Nt(k,"position"),clipDistances:Nt(Yn(J,8),"clip_distances"),frontFacing:Nt(ke,"front_facing"),fragDepth:Nt($,"frag_depth"),sampleIndex:Nt(J,"sample_index"),sampleMask:Nt(J,"sample_mask"),localInvocationId:Nt(rt,"local_invocation_id"),localInvocationIndex:Nt(J,"local_invocation_index"),globalInvocationId:Nt(rt,"global_invocation_id"),workgroupId:Nt(rt,"workgroup_id"),numWorkgroups:Nt(rt,"num_workgroups"),subgroupInvocationId:Nt(J,"subgroup_invocation_id"),subgroupSize:Nt(J,"subgroup_size")},Hd={block:0,binaryExpr:1,assignmentExpr:2,logicalExpr:3,unaryExpr:4,numericLiteral:5,call:6,memberAccess:7,indexAccess:8,return:10,if:11,let:12,const:13,for:14,while:15,continue:16,break:17,arrayExpr:100,preUpdate:101,postUpdate:102,stringLiteral:103,objectExpr:104},Va={identifier:"i",destructuredObject:"d"},Qd=1;const Kd=Object.freeze(Object.defineProperty({__proto__:null,FORMAT_VERSION:Qd,FuncParameterType:Va,NodeTypeCatalog:Hd},Symbol.toStringTag,{value:"Module"}));function As(e,t){for(let[n,r]of Object.entries(t))e[n]=r,r&&(typeof r=="object"||typeof r=="function")&&W(r)===void 0&&Ne(r,n)}function ef(e,t,n){let r=[...e.matchAll(/:\s*(?<arg>.*?)\s*[,)]/g)].map(s=>s?s[1]:void 0);n(Object.fromEntries(t.flatMap((s,i)=>{let p=r?r[i]:void 0;return vt(s)&&p!==void 0?[[p,s]]:[]})))}function pc(e,t,n){let r=e.match(/->\s(?<output>[\w\d_]+)\s{/),s=r?r[1]?.trim():void 0;vt(t)&&s&&!/\s/g.test(s)&&n({[s]:t})}function tf(e){return new RegExp(`(?<![\\w\\$_.])${e.replaceAll(".","\\.").replaceAll("$","\\$")}(?![\\w\\$_])`,"g")}function ea(e,t,n){return Object.entries(t).reduce((r,[s,i])=>{let p=tf(s);if(n&&s!=="Out"&&s!=="In"&&!p.test(n)&&console.warn(`The external '${s}' wasn't used in the resolved template.`),Ap(i)||fs(i)||Ss(i))return r.replaceAll(p,e.resolve(i).value);if(i!==null&&typeof i=="object"){let y=[...n.matchAll(new RegExp(`${s.replaceAll(".","\\.").replaceAll("$","\\$")}\\.(?<prop>.*?)(?![\\w\\$_])`,"g"))].map(v=>v[1]);return[...new Set(y)].reduce((v,_)=>_&&_ in i?ea(e,{[`${s}.${_}`]:i[_]},v):v,r)}return console.warn(`During resolution, the external '${s}' has been omitted. Only primitives, TGPU resources and plain JS objects can be used as externals.`),r},n)}function nf(e){let{strippedCode:t,argRange:n}=rf(e),r=new dc(t);r.consume("(");let s=[];for(;!r.isAt(")");){let p=[];for(;r.isAt("@");)r.parseUntil(fu,mu),r.consume(")"),p.push(r.lastParsed);r.parseUntil(af);let y=r.lastParsed,v;r.isAt(":")&&(r.consume(":"),r.parseUntil(of,lf),v=r.lastParsed),s.push({identifier:y,attributes:p,type:v}),r.isAt(",")&&r.consume(",")}r.consume(")");let i;if(r.isAt("->")){r.consume("->");let p=[];for(;r.isAt("@");)r.parseUntil(fu,mu),r.consume(")"),p.push(r.lastParsed);i={type:r.str.slice(r.pos),attributes:p}}return{args:s,ret:i,range:{begin:n[0],end:n[1]}}}function rf(e){let t=new dc(e),n="",r;for(;!t.isFinished();){if(t.isAt(sf)){t.advanceBy(1);continue}if(t.isAt("//")){t.consume("//"),t.parseUntil(fc),t.advanceBy(1);continue}if(t.isAt("/*")){t.parseUntil(uf,cf),t.consume("*/");continue}if(t.isAt("{"))return{strippedCode:n,argRange:[r,t.pos]};t.isAt("(")&&r===void 0&&(r=t.pos),r!==void 0&&(n+=t.str[t.pos]),t.advanceBy(1)}throw new Error("Invalid wgsl code!")}var dc=class{constructor(t){this.str=t,this.#t=0}#e;#t;get pos(){return this.#t}get lastParsed(){if(this.#e===void 0)throw new Error("Parse was not called yet!");return this.str.slice(this.#e,this.pos)}isFinished(){return this.#t>=this.str.length}isAt(t){if(typeof t=="string"){for(let n=0;n<t.length;n++)if(this.str[this.#t+n]!==t[n])return!1;return!0}for(let n of t)if(this.isAt(n))return!0;return!1}parseUntil(t,n){this.#e=this.#t;let r=0;for(;this.#t<this.str.length;){if(n&&this.isAt(n[0])&&(r+=1),n&&this.isAt(n[1])&&(r-=1),r===0&&this.isAt(t))return this.#t;this.#t+=1}throw new Error("Reached the end of the string without finding a match!")}advanceBy(t){this.#t+=t}consume(t){if(!this.isAt(t))throw new Error(`Expected '${t}' at position ${this.#t}, but found '${this.str.slice(this.#t,this.#t+t.length)}'`);this.advanceBy(t.length)}},fc=new Set([`
`,"\v","\f","\r","","\u2028","\u2029"]),sf=new Set([...fc," ","	","",""]),fu=new Set([")"]),af=new Set([":",",",")"]),of=new Set([",",")"]),uf=new Set(["*/"]),mu=["(",")"],lf=["<",">"],cf=["/*","*/"];function Ks(e,t=""){let n=[],r={applyExternals(i){n.push(i)},resolve(i,p,y){let v={};for(let oe of n)As(v,oe);let _=i.getUniqueName(this);if(typeof e=="string"){if(!y)throw new Error("Explicit return type is required for string implementation");let oe=ea(i,v,e),be="",ze="";if(t!==""){let Se=vt(p[0])?`(in: ${i.resolve(p[0]).value})`:"()",Pe=zt(y)?ko(y):"",yt=y!==at?vt(y)?`-> ${i.resolve(y).value}`:`-> ${Pe!==""?Pe:"@location(0)"} ${i.resolve(y).value}`:"";be=`${Se} ${yt} `,ze=oe}else{let Se=nf(oe);if(Se.args.length!==p.length)throw new Error(`WGSL implementation has ${Se.args.length} arguments, while the shell has ${p.length} arguments.`);let Pe=Se.args.map((ht,it)=>`${ht.identifier}: ${yu(i,`parameter ${ht.identifier}`,ht.type,p[it])}`).join(", "),yt=y===at?"":`-> ${yu(i,"return type",Se.ret?.type,y)}`;be=`(${Pe}) ${yt}`,ze=oe.slice(Se.range.end)}return i.addDeclaration(`${t}fn ${_}${be}${ze}`),B(_,y)}let P=Qi(e);if(P?.externals){let oe=Object.fromEntries(Object.entries(P.externals).filter(([be])=>!(be in v)));As(v,oe)}let U=P?.ast;if(!U)throw new Error("Missing metadata for tgpu.fn function body (either missing 'use gpu' directive, or misconfigured `unplugin-typegpu`)");let R=U.externalNames.filter(oe=>!(oe in v));if(R.length>0)throw new Sp(W(this),R);let j=U.params[1];j&&j.type==="i"&&t!==""&&As(v,{[j.name]:fr(y)});let L=[],Z=[];for(let[oe,be]of p.entries()){let ze=U.params[oe];switch(ze?.type){case Va.identifier:{let Se=ze.name,Pe=B(i.makeNameValid(Se),be);L.push(Pe),Pe.value!==Se&&Z.push([Se,Pe]);break}case Va.destructuredObject:{L.push(B(`_arg_${oe}`,be)),Z.push(...ze.props.map(({name:Se,alias:Pe})=>[Pe,B(`_arg_${oe}.${Se}`,p[oe].propTypes[Se])]));break}case void 0:L.push(B(`_arg_${oe}`,be))}}let{head:Q,body:re,returnType:Me}=i.fnToWgsl({args:L,argAliases:Object.fromEntries(Z),returnType:y,body:U.body,externalMap:v});return i.addDeclaration(`${t}fn ${_}${i.resolve(Q).value}${i.resolve(re).value}`),B(_,Me)}},s=W(e);return s!==void 0&&Ne(r,s),r}function yu(e,t,n,r){let s=e.resolve(r).value.replace(/\s/g,"");if(!n)return s;let i=n.replace(/\s/g,"");if(i!==s)throw new Error(`Type mismatch between TGPU shell and WGSL code string: ${t}, JS type "${s}", WGSL type "${i}".`);return n}function hf(e,t={}){let n=0,r=new Set;return Object.fromEntries(Object.entries(e??{}).map(([s,i])=>{let p=mr(i);if(p!==void 0){if(r.has(p))throw new Error("Duplicate custom location attributes found");r.add(p)}return[s,i]}).map(([s,i])=>{if(Rr(i))return[s,i];if(mr(i)!==void 0)return[s,i];if(t[s])return[s,Di(t[s],i)];for(;r.has(n);)n++;return[s,Di(n++,i)]}))}function ei(e,t={}){return Gr(e)?Ul(e)||mr(e)!==void 0?e:Di(0,e):qn(hf(e,t))}function ta(e,...t){return pf(e)?df(e,...t):e}function pf(e){return Array.isArray(e)&&"raw"in e&&Array.isArray(e.raw)&&e.raw.every(t=>typeof t=="string")}function df(e,...t){return e.slice(1).reduce((n,r,s)=>`${n}${t[s]}${r}`,e[0])}function mc(e){if(Object.keys(e.out).length===0)throw new Error("A vertexFn output cannot be empty since it must include the 'position' builtin.");let t={in:e.in,out:e.out,argTypes:e.in&&Object.keys(e.in).length!==0?[ei(e.in)]:[],isEntry:!0},n=(r,...s)=>ff(t,ta(r,...s));return Object.assign(Object.assign(n,t),{does:n})}function ff(e,t){let n=Ks(t,"@vertex "),r=e.argTypes[0];return{shell:e,$uses(s){return n.applyExternals(s),this},[E]:!0,[st]:n,$name(s){return Ne(n,s),Hi(r)&&r.$name(`${s}_Input`),this},[he](s){let i=ei(e.out,s.varyingLocations).$name(`${W(this)??""}_Output`);return typeof t=="string"&&(r&&n.applyExternals({In:r}),n.applyExternals({Out:i})),n.resolve(s,e.argTypes,i)},toString(){return`vertexFn:${W(n)??"<unnamed>"}`}}}var ys=class{};function Oo(e){let t=ce((...r)=>{let s=[];for(let i of r)if(typeof i=="number")s.push(i);else for(let p=0;p<i.length;++p)s.push(i[p]);if(s.length!==0&&s.length!==e.columns*e.rows)throw new Error(`'${e.type}' constructor called with invalid number of arguments.`);for(let i=s.length;i<e.columns*e.rows;++i)s.push(0);return new e.MatImpl(...s)},(...r)=>B(S`${e.type}(${r})`,n),e.type),n=Object.assign(t,{type:e.type,identity:bf[e.columns],translation:e.columns===4?na:void 0,scaling:e.columns===4?ra:void 0,rotationX:e.columns===4?sa:void 0,rotationY:e.columns===4?ia:void 0,rotationZ:e.columns===4?aa:void 0});return n}var mf=class extends ys{[E]=!0;columns;length=4;constructor(...t){super(),this.columns=[this.makeColumn(t[0],t[1]),this.makeColumn(t[2],t[3])]}get 0(){return this.columns[0].x}get 1(){return this.columns[0].y}get 2(){return this.columns[1].x}get 3(){return this.columns[1].y}set 0(t){this.columns[0].x=t}set 1(t){this.columns[0].y=t}set 2(t){this.columns[1].x=t}set 3(t){this.columns[1].y=t}*[Symbol.iterator](){yield this[0],yield this[1],yield this[2],yield this[3]}[he](){return B(`${this.kind}(${Array.from({length:this.length}).map((t,n)=>this[n]).join(", ")})`,xn)}toString(){return this[he]().value}},yf=class extends mf{kind="mat2x2f";makeColumn(t,n){return F(t,n)}},gf=class extends ys{[E]=!0;columns;length=12;constructor(...t){super(),this.columns=[this.makeColumn(t[0],t[1],t[2]),this.makeColumn(t[3],t[4],t[5]),this.makeColumn(t[6],t[7],t[8])]}get 0(){return this.columns[0].x}get 1(){return this.columns[0].y}get 2(){return this.columns[0].z}get 3(){return 0}get 4(){return this.columns[1].x}get 5(){return this.columns[1].y}get 6(){return this.columns[1].z}get 7(){return 0}get 8(){return this.columns[2].x}get 9(){return this.columns[2].y}get 10(){return this.columns[2].z}get 11(){return 0}set 0(t){this.columns[0].x=t}set 1(t){this.columns[0].y=t}set 2(t){this.columns[0].z=t}set 3(t){}set 4(t){this.columns[1].x=t}set 5(t){this.columns[1].y=t}set 6(t){this.columns[1].z=t}set 7(t){}set 8(t){this.columns[2].x=t}set 9(t){this.columns[2].y=t}set 10(t){this.columns[2].z=t}set 11(t){}*[Symbol.iterator](){for(let t=0;t<12;t++)yield this[t]}[he](){return B(`${this.kind}(${this[0]}, ${this[1]}, ${this[2]}, ${this[4]}, ${this[5]}, ${this[6]}, ${this[8]}, ${this[9]}, ${this[10]})`,In)}toString(){return this[he]().value}},wf=class extends gf{kind="mat3x3f";makeColumn(t,n,r){return O(t,n,r)}},xf=class extends ys{[E]=!0;columns;constructor(...t){super(),this.columns=[this.makeColumn(t[0],t[1],t[2],t[3]),this.makeColumn(t[4],t[5],t[6],t[7]),this.makeColumn(t[8],t[9],t[10],t[11]),this.makeColumn(t[12],t[13],t[14],t[15])]}length=16;get 0(){return this.columns[0].x}get 1(){return this.columns[0].y}get 2(){return this.columns[0].z}get 3(){return this.columns[0].w}get 4(){return this.columns[1].x}get 5(){return this.columns[1].y}get 6(){return this.columns[1].z}get 7(){return this.columns[1].w}get 8(){return this.columns[2].x}get 9(){return this.columns[2].y}get 10(){return this.columns[2].z}get 11(){return this.columns[2].w}get 12(){return this.columns[3].x}get 13(){return this.columns[3].y}get 14(){return this.columns[3].z}get 15(){return this.columns[3].w}set 0(t){this.columns[0].x=t}set 1(t){this.columns[0].y=t}set 2(t){this.columns[0].z=t}set 3(t){this.columns[0].w=t}set 4(t){this.columns[1].x=t}set 5(t){this.columns[1].y=t}set 6(t){this.columns[1].z=t}set 7(t){this.columns[1].w=t}set 8(t){this.columns[2].x=t}set 9(t){this.columns[2].y=t}set 10(t){this.columns[2].z=t}set 11(t){this.columns[2].w=t}set 12(t){this.columns[3].x=t}set 13(t){this.columns[3].y=t}set 14(t){this.columns[3].z=t}set 15(t){this.columns[3].w=t}*[Symbol.iterator](){for(let t=0;t<16;t++)yield this[t]}[he](){return B(`${this.kind}(${Array.from({length:this.length}).map((t,n)=>this[n]).join(", ")})`,we)}toString(){return this[he]().value}},vf=class extends xf{kind="mat4x4f";makeColumn(t,n,r,s){return k(t,n,r,s)}},yc=ce(()=>xn(1,0,0,1),()=>B("mat2x2f(1, 0, 0, 1)",xn),"identity2"),gc=ce(()=>In(1,0,0,0,1,0,0,0,1),()=>B("mat3x3f(1, 0, 0, 0, 1, 0, 0, 0, 1)",In),"identity3"),wc=ce(()=>we(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),()=>B("mat4x4f(1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1)",we),"identity4"),bf={2:yc,3:gc,4:wc},na=ce(e=>we(1,0,0,0,0,1,0,0,0,0,1,0,e.x,e.y,e.z,1),e=>B(S`mat4x4f(1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, ${e}.x, ${e}.y, ${e}.z, 1)`,we),"translation4"),ra=ce(e=>we(e.x,0,0,0,0,e.y,0,0,0,0,e.z,0,0,0,0,1),e=>B(S`mat4x4f(${e}.x, 0, 0, 0, 0, ${e}.y, 0, 0, 0, 0, ${e}.z, 0, 0, 0, 0, 1)`,we),"scaling4"),sa=ce(e=>we(1,0,0,0,0,Math.cos(e),Math.sin(e),0,0,-Math.sin(e),Math.cos(e),0,0,0,0,1),e=>B(S`mat4x4f(1, 0, 0, 0, 0, cos(${e}), sin(${e}), 0, 0, -sin(${e}), cos(${e}), 0, 0, 0, 0, 1)`,we),"rotationX4"),ia=ce(e=>we(Math.cos(e),0,-Math.sin(e),0,0,1,0,0,Math.sin(e),0,Math.cos(e),0,0,0,0,1),e=>B(S`mat4x4f(cos(${e}), 0, -sin(${e}), 0, 0, 1, 0, 0, sin(${e}), 0, cos(${e}), 0, 0, 0, 0, 1)`,we),"rotationY4"),aa=ce(e=>we(Math.cos(e),Math.sin(e),0,0,-Math.sin(e),Math.cos(e),0,0,0,0,1,0,0,0,0,1),e=>B(S`mat4x4f(cos(${e}), sin(${e}), 0, 0, -sin(${e}), cos(${e}), 0, 0, 0, 0, 1, 0, 0, 0, 0, 1)`,we),"rotationZ4"),xn=Oo({type:"mat2x2f",rows:2,columns:2,MatImpl:yf}),In=Oo({type:"mat3x3f",rows:3,columns:3,MatImpl:wf}),we=Oo({type:"mat4x4f",rows:4,columns:4,MatImpl:vf});function Tf(e){return e.kind==="mat3x3f"?[e[0],e[1],e[2],e[4],e[5],e[6],e[8],e[9],e[10]]:Array.from({length:e.length}).map((t,n)=>e[n])}function _f(e){return e?.[Re]}var $f={f:{1:$,2:F,3:O,4:k},h:{1:ut,2:Pn,3:Un,4:An},i:{1:Ue,2:Be,3:Ot,4:Fe},u:{1:J,2:xt,3:rt,4:Ye},b:{1:ke,2:vr,3:br,4:Tr}},Mf={vec2f:F,vec2h:Pn,vec2i:Be,vec2u:xt,"vec2<bool>":vr,vec3f:O,vec3h:Un,vec3i:Ot,vec3u:rt,"vec3<bool>":br,vec4f:k,vec4h:An,vec4i:Fe,vec4u:Ye,"vec4<bool>":Tr,mat2x2f:xn,mat3x3f:In,mat4x4f:we};function Ga(e,t){if(vt(e)||zn(e))return e.propTypes[t]??kt;if(e===ke||rr(e))return kt;let n=t.length;if(nr(e)&&n>=1&&n<=4){let r=e.type.includes("bool")?"b":e.type[4],s=$f[r][n];if(s)return s}return kt}var gu={mat2x2f:F,mat3x3f:O,mat4x4f:k};function fa(e){return Lt(e)||sr(e)?e.elementType:nr(e)?e.primitive:e.type in gu?gu[e.type]:kt}function Ri(e){return e>=2**63||e<-9223372036854776e3?B(e,Sn):Number.isInteger(e)?(Number.isSafeInteger(e)||console.warn(`The integer ${e} exceeds the safe integer range and may have lost precision.`),B(e,Js)):B(e,Sn)}function Fs(e){return e.type==="abstractFloat"?$:e.type==="abstractInt"?Ue:e}function zf(e){return e.map(t=>B(t.value,Fs(t.dataType)))}function Mi(e){return fo(e)?e:mo(e)||(Je(e)||Ln(e)?B(e,Mf[e.kind]):typeof e=="string"||typeof e=="function"||typeof e=="object"||typeof e=="symbol"||typeof e>"u"||e===null?B(e,kt):typeof e=="number"?Ri(e):typeof e=="boolean"?B(e,ke):B(e,kt))}var kn={get(e,t){if(t in e)return Reflect.get(e,t);if(t==="toString"||t===Symbol.toStringTag||t===Symbol.toPrimitive)return()=>e.toString();if(typeof t=="symbol")return;let n=mo(e).dataType,r=Ga(n,String(t));if(r.type!=="unknown")return new Proxy({[E]:!0,[he]:s=>B(`${s.resolve(e).value}.${String(t)}`,r),get[Xt](){return B(this,r)},toString:()=>`${String(e)}.${t}`},kn)}};function oa(e){let t=e;for(;;){let n=_f(t);if(!n)break;t=n}return t}function Da(e,t){return new Ef(e,t)}var Ef=class{constructor(t,n){this.dataType=t,this.#e=n}[E]={};#e;$name(t){return Ne(this,t),this}[he](t){let n=t.getUniqueName(this),r=t.resolve(this.dataType).value,s=t.resolve(this.#e,this.dataType).value;return t.addDeclaration(`const ${n}: ${r} = ${s};`),B(n,this.dataType)}toString(){return`const:${W(this)??"<unnamed>"}`}get[Re](){let t=this.dataType;return new Proxy({[E]:!0,get[Xt](){return B(this,t)},[he]:n=>n.resolve(this),toString:()=>`const:${W(this)??"<unnamed>"}.$`},kn)}get value(){return Bn()?this[Re]:this.#e}get $(){return this.value}};function Vo(){return{[E]:!0,type:"sampler",[ds]:void 0}}function Go(){return{[E]:!0,type:"sampler_comparison",[ds]:void 0}}function Sf(e){return!!e[E]&&e.type==="sampler"}function Pf(e){return!!e[E]&&e.type==="sampler_comparison"}function Ra(e){if("multisampled"in e){if(e.multisampled){if(e.dimension==="2d")return vc(e.sampleType);throw new Error(`Multisampled textures only support '2d' dimension, got '${e.dimension}'`)}switch(e.dimension){case"1d":return xc(e.sampleType);case"2d":return hs(e.sampleType);case"2d-array":return bc(e.sampleType);case"3d":return $c(e.sampleType);case"cube":return Tc(e.sampleType);case"cube-array":return _c(e.sampleType);default:throw new Error(`Unsupported texture dimension: '${e.dimension}'`)}}if(!("access"in e))throw new Error("Descriptor is neither a sampled nor a storage texture");switch(e.dimension){case"1d":return Mc(e.format,e.access);case"2d":return ni(e.format,e.access);case"2d-array":return zc(e.format,e.access);case"3d":return Ec(e.format,e.access);default:throw new Error(`Unsupported storage texture dimension: '${e.dimension}'`)}}function vn(e,t){let n=e.startsWith("texture_depth")?["depth","float","unfilterable-float"]:t.sampleType.type==="i32"?["sint"]:t.sampleType.type==="u32"?["uint"]:["float","unfilterable-float"];return{[E]:!0,[ds]:void 0,type:e,bindingSampleType:n,...t}}function ua(e,t){return{[E]:!0,[ds]:void 0,type:e,...t}}var wu=new Map,ti={"write-only":"write","read-only":"read","read-write":"read_write"};function Et(e,t){let n=wu.get(e);return n||(n=t(),wu.set(e,n)),n}function xc(e){let t=e||$,n=`texture_1d<${t.type}>`;return Et(n,()=>vn("texture_1d",{dimension:"1d",sampleType:t,multisampled:!1}))}function hs(e){let t=e||$,n=`texture_2d<${t.type}>`;return Et(n,()=>vn("texture_2d",{dimension:"2d",sampleType:t,multisampled:!1}))}function vc(e){let t=e||$,n=`texture_multisampled_2d<${t.type}>`;return Et(n,()=>vn("texture_multisampled_2d",{dimension:"2d",sampleType:t,multisampled:!0}))}function bc(e){let t=e||$,n=`texture_2d_array<${t.type}>`;return Et(n,()=>vn("texture_2d_array",{dimension:"2d-array",sampleType:t,multisampled:!1}))}function Tc(e){let t=e||$,n=`texture_cube<${t.type}>`;return Et(n,()=>vn("texture_cube",{dimension:"cube",sampleType:t,multisampled:!1}))}function _c(e){let t=e||$,n=`texture_cube_array<${t.type}>`;return Et(n,()=>vn("texture_cube_array",{dimension:"cube-array",sampleType:t,multisampled:!1}))}function $c(e){let t=e||$,n=`texture_3d<${t.type}>`;return Et(n,()=>vn("texture_3d",{dimension:"3d",sampleType:t,multisampled:!1}))}function Mc(e,t){let n=t||"write-only",r=`texture_storage_1d<${e}, ${ti[n]}>`;return Et(r,()=>ua("texture_storage_1d",{dimension:"1d",format:e,access:n}))}function ni(e,t){let n=t||"write-only",r=`texture_storage_2d<${e}, ${ti[n]}>`;return Et(r,()=>ua("texture_storage_2d",{dimension:"2d",format:e,access:n}))}function zc(e,t){let n=t||"write-only",r=`texture_storage_2d_array<${e}, ${ti[n]}>`;return Et(r,()=>ua("texture_storage_2d_array",{dimension:"2d-array",format:e,access:n}))}function Ec(e,t){let n=t||"write-only",r=`texture_storage_3d<${e}, ${ti[n]}>`;return Et(r,()=>ua("texture_storage_3d",{dimension:"3d",format:e,access:n}))}function Uf(){return Et("texture_depth_2d",()=>vn("texture_depth_2d",{dimension:"2d",sampleType:$,multisampled:!1}))}function Af(){return Et("texture_depth_multisampled_2d",()=>vn("texture_depth_multisampled_2d",{dimension:"2d",sampleType:$,multisampled:!0}))}function If(){return Et("texture_depth_2d_array",()=>vn("texture_depth_2d_array",{dimension:"2d-array",sampleType:$,multisampled:!1}))}function Bf(){return Et("texture_depth_cube",()=>vn("texture_depth_cube",{dimension:"cube",sampleType:$,multisampled:!1}))}function kf(){return Et("texture_depth_cube_array",()=>vn("texture_depth_cube_array",{dimension:"cube-array",sampleType:$,multisampled:!1}))}function Sc(){return Et("texture_external",()=>({[E]:!0,[ds]:void 0,type:"texture_external",dimension:"2d"}))}function Pc(e){return!!e[E]&&typeof e.multisampled=="boolean"}function Na(e){return!!e[E]&&typeof e.format=="string"&&typeof e.access=="string"}function Uc(e){return new Of(e)}var Of=class{constructor(t){this.inner=t}[E]=!0;type="atomic"},zr=(e,t,n)=>{if(e===t)return 0;let r=me((n-e)/(t-e),0,1);return r*r*(3-2*r)},me=(e,t,n)=>Math.min(Math.max(t,e),n),jr=(e,t)=>t===0?e:Math.trunc(e/t);function Vn(e){let t=new DataView(new ArrayBuffer(4));return t.setUint32(0,e,!0),t.getFloat32(0,!0)}function Gn(e){let t=new DataView(new ArrayBuffer(4));return t.setUint32(0,e,!0),t.getInt32(0,!0)}var hn=vr[E].jsImpl,fn=F[E].jsImpl,Jn=Pn[E].jsImpl,is=Be[E].jsImpl,Is=xt[E].jsImpl,pn=br[E].jsImpl,nn=O[E].jsImpl,Rn=Un[E].jsImpl,as=Ot[E].jsImpl,Bs=rt[E].jsImpl,dn=Tr[E].jsImpl,mn=k[E].jsImpl,Zn=An[E].jsImpl,os=Fe[E].jsImpl,ks=Ye[E].jsImpl,Yr=e=>Math.sqrt(e.x**2+e.y**2),Cr=e=>Math.sqrt(e.x**2+e.y**2+e.z**2),qr=e=>Math.sqrt(e.x**2+e.y**2+e.z**2+e.w**2),fi=(e,t)=>e.x*t.x+e.y*t.y,mi=(e,t)=>e.x*t.x+e.y*t.y+e.z*t.z,yi=(e,t)=>e.x*t.x+e.y*t.y+e.z*t.z+e.w*t.w,Xe=e=>t=>fn(e(t.x),e(t.y)),Qe=e=>t=>Jn(e(t.x),e(t.y)),Wr=e=>t=>is(e(t.x),e(t.y)),vs=e=>t=>Is(e(t.x),e(t.y)),qe=e=>t=>nn(e(t.x),e(t.y),e(t.z)),Ke=e=>t=>Rn(e(t.x),e(t.y),e(t.z)),Xr=e=>t=>as(e(t.x),e(t.y),e(t.z)),bs=e=>t=>Bs(e(t.x),e(t.y),e(t.z)),je=e=>t=>mn(e(t.x),e(t.y),e(t.z),e(t.w)),et=e=>t=>Zn(e(t.x),e(t.y),e(t.z),e(t.w)),Jr=e=>t=>os(e(t.x),e(t.y),e(t.z),e(t.w)),Ts=e=>t=>ks(e(t.x),e(t.y),e(t.z),e(t.w)),xu=e=>t=>{let n=t.columns;return xn(Xe(e)(n[0]),Xe(e)(n[1]))},vu=e=>t=>{let n=t.columns;return In(qe(e)(n[0]),qe(e)(n[1]),qe(e)(n[2]))},bu=e=>t=>{let n=t.columns;return we(je(e)(n[0]),je(e)(n[1]),je(e)(n[2]),je(e)(n[3]))},Xn=e=>(t,n)=>fn(e(t.x,n.x),e(t.y,n.y)),_r=e=>(t,n)=>Jn(e(t.x,n.x),e(t.y,n.y)),Zr=e=>(t,n)=>is(e(t.x,n.x),e(t.y,n.y)),Hr=e=>(t,n)=>Is(e(t.x,n.x),e(t.y,n.y)),Nn=e=>(t,n)=>nn(e(t.x,n.x),e(t.y,n.y),e(t.z,n.z)),$r=e=>(t,n)=>Rn(e(t.x,n.x),e(t.y,n.y),e(t.z,n.z)),Qr=e=>(t,n)=>as(e(t.x,n.x),e(t.y,n.y),e(t.z,n.z)),Kr=e=>(t,n)=>Bs(e(t.x,n.x),e(t.y,n.y),e(t.z,n.z)),$n=e=>(t,n)=>mn(e(t.x,n.x),e(t.y,n.y),e(t.z,n.z),e(t.w,n.w)),Mr=e=>(t,n)=>Zn(e(t.x,n.x),e(t.y,n.y),e(t.z,n.z),e(t.w,n.w)),es=e=>(t,n)=>os(e(t.x,n.x),e(t.y,n.y),e(t.z,n.z),e(t.w,n.w)),ts=e=>(t,n)=>ks(e(t.x,n.x),e(t.y,n.y),e(t.z,n.z),e(t.w,n.w)),Vf=e=>(t,n)=>{let r=t.columns,s=n.columns;return xn(Xn(e)(r[0],s[0]),Xn(e)(r[1],s[1]))},Gf=e=>(t,n)=>{let r=t.columns,s=n.columns;return In(Nn(e)(r[0],s[0]),Nn(e)(r[1],s[1]),Nn(e)(r[2],s[2]))},Df=e=>(t,n)=>{let r=t.columns,s=n.columns;return we($n(e)(r[0],s[0]),$n(e)(r[1],s[1]),$n(e)(r[2],s[2]),$n(e)(r[3],s[3]))},Rf=e=>(t,n,r)=>fn(e(t.x,n.x,r.x),e(t.y,n.y,r.y)),Nf=e=>(t,n,r)=>Jn(e(t.x,n.x,r.x),e(t.y,n.y,r.y)),Ff=e=>(t,n,r)=>nn(e(t.x,n.x,r.x),e(t.y,n.y,r.y),e(t.z,n.z,r.z)),Lf=e=>(t,n,r)=>Rn(e(t.x,n.x,r.x),e(t.y,n.y,r.y),e(t.z,n.z,r.z)),jf=e=>(t,n,r)=>mn(e(t.x,n.x,r.x),e(t.y,n.y,r.y),e(t.z,n.z,r.z),e(t.w,n.w,r.w)),Yf=e=>(t,n,r)=>Zn(e(t.x,n.x,r.x),e(t.y,n.y,r.y),e(t.z,n.z,r.z),e(t.w,n.w,r.w)),ee={eq:{vec2f:(e,t)=>hn(e.x===t.x,e.y===t.y),vec2h:(e,t)=>hn(e.x===t.x,e.y===t.y),vec2i:(e,t)=>hn(e.x===t.x,e.y===t.y),vec2u:(e,t)=>hn(e.x===t.x,e.y===t.y),"vec2<bool>":(e,t)=>hn(e.x===t.x,e.y===t.y),vec3f:(e,t)=>pn(e.x===t.x,e.y===t.y,e.z===t.z),vec3h:(e,t)=>pn(e.x===t.x,e.y===t.y,e.z===t.z),vec3i:(e,t)=>pn(e.x===t.x,e.y===t.y,e.z===t.z),vec3u:(e,t)=>pn(e.x===t.x,e.y===t.y,e.z===t.z),"vec3<bool>":(e,t)=>pn(e.x===t.x,e.y===t.y,e.z===t.z),vec4f:(e,t)=>dn(e.x===t.x,e.y===t.y,e.z===t.z,e.w===t.w),vec4h:(e,t)=>dn(e.x===t.x,e.y===t.y,e.z===t.z,e.w===t.w),vec4i:(e,t)=>dn(e.x===t.x,e.y===t.y,e.z===t.z,e.w===t.w),vec4u:(e,t)=>dn(e.x===t.x,e.y===t.y,e.z===t.z,e.w===t.w),"vec4<bool>":(e,t)=>dn(e.x===t.x,e.y===t.y,e.z===t.z,e.w===t.w)},lt:{vec2f:(e,t)=>hn(e.x<t.x,e.y<t.y),vec2h:(e,t)=>hn(e.x<t.x,e.y<t.y),vec2i:(e,t)=>hn(e.x<t.x,e.y<t.y),vec2u:(e,t)=>hn(e.x<t.x,e.y<t.y),vec3f:(e,t)=>pn(e.x<t.x,e.y<t.y,e.z<t.z),vec3h:(e,t)=>pn(e.x<t.x,e.y<t.y,e.z<t.z),vec3i:(e,t)=>pn(e.x<t.x,e.y<t.y,e.z<t.z),vec3u:(e,t)=>pn(e.x<t.x,e.y<t.y,e.z<t.z),vec4f:(e,t)=>dn(e.x<t.x,e.y<t.y,e.z<t.z,e.w<t.w),vec4h:(e,t)=>dn(e.x<t.x,e.y<t.y,e.z<t.z,e.w<t.w),vec4i:(e,t)=>dn(e.x<t.x,e.y<t.y,e.z<t.z,e.w<t.w),vec4u:(e,t)=>dn(e.x<t.x,e.y<t.y,e.z<t.z,e.w<t.w)},or:{"vec2<bool>":(e,t)=>hn(e.x||t.x,e.y||t.y),"vec3<bool>":(e,t)=>pn(e.x||t.x,e.y||t.y,e.z||t.z),"vec4<bool>":(e,t)=>dn(e.x||t.x,e.y||t.y,e.z||t.z,e.w||t.w)},all:{"vec2<bool>":e=>e.x&&e.y,"vec3<bool>":e=>e.x&&e.y&&e.z,"vec4<bool>":e=>e.x&&e.y&&e.z&&e.w},abs:{vec2f:Xe(Math.abs),vec2h:Qe(Math.abs),vec2i:Wr(Math.abs),vec2u:vs(Math.abs),vec3f:qe(Math.abs),vec3h:Ke(Math.abs),vec3i:Xr(Math.abs),vec3u:bs(Math.abs),vec4f:je(Math.abs),vec4h:et(Math.abs),vec4i:Jr(Math.abs),vec4u:Ts(Math.abs)},atan2:{vec2f:Xn(Math.atan2),vec2h:_r(Math.atan2),vec3f:Nn(Math.atan2),vec3h:$r(Math.atan2),vec4f:$n(Math.atan2),vec4h:Mr(Math.atan2)},acos:{vec2f:Xe(Math.acos),vec2h:Qe(Math.acos),vec2i:Wr(Math.acos),vec2u:vs(Math.acos),vec3f:qe(Math.acos),vec3h:Ke(Math.acos),vec3i:Xr(Math.acos),vec3u:bs(Math.acos),vec4f:je(Math.acos),vec4h:et(Math.acos),vec4i:Jr(Math.acos),vec4u:Ts(Math.acos)},acosh:{vec2f:Xe(Math.acosh),vec2h:Qe(Math.acosh),vec3f:qe(Math.acosh),vec3h:Ke(Math.acosh),vec4f:je(Math.acosh),vec4h:et(Math.acosh)},asin:{vec2f:Xe(Math.asin),vec2h:Qe(Math.asin),vec3f:qe(Math.asin),vec3h:Ke(Math.asin),vec4f:je(Math.asin),vec4h:et(Math.asin)},asinh:{vec2f:Xe(Math.asinh),vec2h:Qe(Math.asinh),vec3f:qe(Math.asinh),vec3h:Ke(Math.asinh),vec4f:je(Math.asinh),vec4h:et(Math.asinh)},atan:{vec2f:Xe(Math.atan),vec2h:Qe(Math.atan),vec3f:qe(Math.atan),vec3h:Ke(Math.atan),vec4f:je(Math.atan),vec4h:et(Math.atan)},atanh:{vec2f:Xe(Math.atanh),vec2h:Qe(Math.atanh),vec3f:qe(Math.atanh),vec3h:Ke(Math.atanh),vec4f:je(Math.atanh),vec4h:et(Math.atanh)},ceil:{vec2f:Xe(Math.ceil),vec2h:Qe(Math.ceil),vec3f:qe(Math.ceil),vec3h:Ke(Math.ceil),vec4f:je(Math.ceil),vec4h:et(Math.ceil)},clamp:{vec2f:(e,t,n)=>fn(me(e.x,t.x,n.x),me(e.y,t.y,n.y)),vec2h:(e,t,n)=>Jn(me(e.x,t.x,n.x),me(e.y,t.y,n.y)),vec2i:(e,t,n)=>is(me(e.x,t.x,n.x),me(e.y,t.y,n.y)),vec2u:(e,t,n)=>Is(me(e.x,t.x,n.x),me(e.y,t.y,n.y)),vec3f:(e,t,n)=>nn(me(e.x,t.x,n.x),me(e.y,t.y,n.y),me(e.z,t.z,n.z)),vec3h:(e,t,n)=>Rn(me(e.x,t.x,n.x),me(e.y,t.y,n.y),me(e.z,t.z,n.z)),vec3i:(e,t,n)=>as(me(e.x,t.x,n.x),me(e.y,t.y,n.y),me(e.z,t.z,n.z)),vec3u:(e,t,n)=>Bs(me(e.x,t.x,n.x),me(e.y,t.y,n.y),me(e.z,t.z,n.z)),vec4f:(e,t,n)=>mn(me(e.x,t.x,n.x),me(e.y,t.y,n.y),me(e.z,t.z,n.z),me(e.w,t.w,n.w)),vec4h:(e,t,n)=>Zn(me(e.x,t.x,n.x),me(e.y,t.y,n.y),me(e.z,t.z,n.z),me(e.w,t.w,n.w)),vec4i:(e,t,n)=>os(me(e.x,t.x,n.x),me(e.y,t.y,n.y),me(e.z,t.z,n.z),me(e.w,t.w,n.w)),vec4u:(e,t,n)=>ks(me(e.x,t.x,n.x),me(e.y,t.y,n.y),me(e.z,t.z,n.z),me(e.w,t.w,n.w))},length:{vec2f:Yr,vec2h:Yr,vec3f:Cr,vec3h:Cr,vec4f:qr,vec4h:qr},add:{vec2f:Xn((e,t)=>e+t),vec2h:_r((e,t)=>e+t),vec2i:Zr((e,t)=>e+t),vec2u:Hr((e,t)=>e+t),vec3f:Nn((e,t)=>e+t),vec3h:$r((e,t)=>e+t),vec3i:Qr((e,t)=>e+t),vec3u:Kr((e,t)=>e+t),vec4f:$n((e,t)=>e+t),vec4h:Mr((e,t)=>e+t),vec4i:es((e,t)=>e+t),vec4u:ts((e,t)=>e+t),mat2x2f:Vf((e,t)=>e+t),mat3x3f:Gf((e,t)=>e+t),mat4x4f:Df((e,t)=>e+t)},smoothstep:{vec2f:Rf(zr),vec2h:Nf(zr),vec3f:Ff(zr),vec3h:Lf(zr),vec4f:jf(zr),vec4h:Yf(zr)},addMixed:{vec2f:(e,t)=>Xe(n=>n+t)(e),vec2h:(e,t)=>Qe(n=>n+t)(e),vec2i:(e,t)=>Wr(n=>n+t)(e),vec2u:(e,t)=>vs(n=>n+t)(e),vec3f:(e,t)=>qe(n=>n+t)(e),vec3h:(e,t)=>Ke(n=>n+t)(e),vec3i:(e,t)=>Xr(n=>n+t)(e),vec3u:(e,t)=>bs(n=>n+t)(e),vec4f:(e,t)=>je(n=>n+t)(e),vec4h:(e,t)=>et(n=>n+t)(e),vec4i:(e,t)=>Jr(n=>n+t)(e),vec4u:(e,t)=>Ts(n=>n+t)(e),mat2x2f:(e,t)=>xu(n=>n+t)(e),mat3x3f:(e,t)=>vu(n=>n+t)(e),mat4x4f:(e,t)=>bu(n=>n+t)(e)},mulSxV:{vec2f:(e,t)=>Xe(n=>e*n)(t),vec2h:(e,t)=>Qe(n=>e*n)(t),vec2i:(e,t)=>Wr(n=>e*n)(t),vec2u:(e,t)=>vs(n=>e*n)(t),vec3f:(e,t)=>qe(n=>e*n)(t),vec3h:(e,t)=>Ke(n=>e*n)(t),vec3i:(e,t)=>Xr(n=>e*n)(t),vec3u:(e,t)=>bs(n=>e*n)(t),vec4f:(e,t)=>je(n=>e*n)(t),vec4h:(e,t)=>et(n=>e*n)(t),vec4i:(e,t)=>Jr(n=>e*n)(t),vec4u:(e,t)=>Ts(n=>e*n)(t),mat2x2f:(e,t)=>xu(n=>e*n)(t),mat3x3f:(e,t)=>vu(n=>e*n)(t),mat4x4f:(e,t)=>bu(n=>e*n)(t)},mulVxV:{vec2f:Xn((e,t)=>e*t),vec2h:_r((e,t)=>e*t),vec2i:Zr((e,t)=>e*t),vec2u:Hr((e,t)=>e*t),vec3f:Nn((e,t)=>e*t),vec3h:$r((e,t)=>e*t),vec3i:Qr((e,t)=>e*t),vec3u:Kr((e,t)=>e*t),vec4f:$n((e,t)=>e*t),vec4h:Mr((e,t)=>e*t),vec4i:es((e,t)=>e*t),vec4u:ts((e,t)=>e*t),mat2x2f:(e,t)=>{let n=e.columns,r=t.columns;return xn(n[0].x*r[0].x+n[1].x*r[0].y,n[0].y*r[0].x+n[1].y*r[0].y,n[0].x*r[1].x+n[1].x*r[1].y,n[0].y*r[1].x+n[1].y*r[1].y)},mat3x3f:(e,t)=>{let n=e.columns,r=t.columns;return In(n[0].x*r[0].x+n[1].x*r[0].y+n[2].x*r[0].z,n[0].y*r[0].x+n[1].y*r[0].y+n[2].y*r[0].z,n[0].z*r[0].x+n[1].z*r[0].y+n[2].z*r[0].z,n[0].x*r[1].x+n[1].x*r[1].y+n[2].x*r[1].z,n[0].y*r[1].x+n[1].y*r[1].y+n[2].y*r[1].z,n[0].z*r[1].x+n[1].z*r[1].y+n[2].z*r[1].z,n[0].x*r[2].x+n[1].x*r[2].y+n[2].x*r[2].z,n[0].y*r[2].x+n[1].y*r[2].y+n[2].y*r[2].z,n[0].z*r[2].x+n[1].z*r[2].y+n[2].z*r[2].z)},mat4x4f:(e,t)=>{let n=e.columns,r=t.columns;return we(n[0].x*r[0].x+n[1].x*r[0].y+n[2].x*r[0].z+n[3].x*r[0].w,n[0].y*r[0].x+n[1].y*r[0].y+n[2].y*r[0].z+n[3].y*r[0].w,n[0].z*r[0].x+n[1].z*r[0].y+n[2].z*r[0].z+n[3].z*r[0].w,n[0].w*r[0].x+n[1].w*r[0].y+n[2].w*r[0].z+n[3].w*r[0].w,n[0].x*r[1].x+n[1].x*r[1].y+n[2].x*r[1].z+n[3].x*r[1].w,n[0].y*r[1].x+n[1].y*r[1].y+n[2].y*r[1].z+n[3].y*r[1].w,n[0].z*r[1].x+n[1].z*r[1].y+n[2].z*r[1].z+n[3].z*r[1].w,n[0].w*r[1].x+n[1].w*r[1].y+n[2].w*r[1].z+n[3].w*r[1].w,n[0].x*r[2].x+n[1].x*r[2].y+n[2].x*r[2].z+n[3].x*r[2].w,n[0].y*r[2].x+n[1].y*r[2].y+n[2].y*r[2].z+n[3].y*r[2].w,n[0].z*r[2].x+n[1].z*r[2].y+n[2].z*r[2].z+n[3].z*r[2].w,n[0].w*r[2].x+n[1].w*r[2].y+n[2].w*r[2].z+n[3].w*r[2].w,n[0].x*r[3].x+n[1].x*r[3].y+n[2].x*r[3].z+n[3].x*r[3].w,n[0].y*r[3].x+n[1].y*r[3].y+n[2].y*r[3].z+n[3].y*r[3].w,n[0].z*r[3].x+n[1].z*r[3].y+n[2].z*r[3].z+n[3].z*r[3].w,n[0].w*r[3].x+n[1].w*r[3].y+n[2].w*r[3].z+n[3].w*r[3].w)}},mulMxV:{mat2x2f:(e,t)=>{let n=e.columns;return fn(n[0].x*t.x+n[1].x*t.y,n[0].y*t.x+n[1].y*t.y)},mat3x3f:(e,t)=>{let n=e.columns;return nn(n[0].x*t.x+n[1].x*t.y+n[2].x*t.z,n[0].y*t.x+n[1].y*t.y+n[2].y*t.z,n[0].z*t.x+n[1].z*t.y+n[2].z*t.z)},mat4x4f:(e,t)=>{let n=e.columns;return mn(n[0].x*t.x+n[1].x*t.y+n[2].x*t.z+n[3].x*t.w,n[0].y*t.x+n[1].y*t.y+n[2].y*t.z+n[3].y*t.w,n[0].z*t.x+n[1].z*t.y+n[2].z*t.z+n[3].z*t.w,n[0].w*t.x+n[1].w*t.y+n[2].w*t.z+n[3].w*t.w)}},mulVxM:{mat2x2f:(e,t)=>{let n=t.columns;return fn(e.x*n[0].x+e.y*n[0].y,e.x*n[1].x+e.y*n[1].y)},mat3x3f:(e,t)=>{let n=t.columns;return nn(e.x*n[0].x+e.y*n[0].y+e.z*n[0].z,e.x*n[1].x+e.y*n[1].y+e.z*n[1].z,e.x*n[2].x+e.y*n[2].y+e.z*n[2].z)},mat4x4f:(e,t)=>{let n=t.columns;return mn(e.x*n[0].x+e.y*n[0].y+e.z*n[0].z+e.w*n[0].w,e.x*n[1].x+e.y*n[1].y+e.z*n[1].z+e.w*n[1].w,e.x*n[2].x+e.y*n[2].y+e.z*n[2].z+e.w*n[2].w,e.x*n[3].x+e.y*n[3].y+e.z*n[3].z+e.w*n[3].w)}},div:{vec2f:Xn((e,t)=>e/t),vec2h:_r((e,t)=>e/t),vec2i:Zr(jr),vec2u:Hr(jr),vec3f:Nn((e,t)=>e/t),vec3h:$r((e,t)=>e/t),vec3i:Qr(jr),vec3u:Kr(jr),vec4f:$n((e,t)=>e/t),vec4h:Mr((e,t)=>e/t),vec4i:es(jr),vec4u:ts(jr)},dot:{vec2f:fi,vec2h:fi,vec2i:fi,vec2u:fi,vec3f:mi,vec3h:mi,vec3i:mi,vec3u:mi,vec4f:yi,vec4h:yi,vec4i:yi,vec4u:yi},normalize:{vec2f:e=>{let t=Yr(e);return fn(e.x/t,e.y/t)},vec2h:e=>{let t=Yr(e);return Jn(e.x/t,e.y/t)},vec2i:e=>{let t=Yr(e);return is(e.x/t,e.y/t)},vec2u:e=>{let t=Yr(e);return Is(e.x/t,e.y/t)},vec3f:e=>{let t=Cr(e);return nn(e.x/t,e.y/t,e.z/t)},vec3h:e=>{let t=Cr(e);return Rn(e.x/t,e.y/t,e.z/t)},vec3i:e=>{let t=Cr(e);return as(e.x/t,e.y/t,e.z/t)},vec3u:e=>{let t=Cr(e);return Bs(e.x/t,e.y/t,e.z/t)},vec4f:e=>{let t=qr(e);return mn(e.x/t,e.y/t,e.z/t,e.w/t)},vec4h:e=>{let t=qr(e);return Zn(e.x/t,e.y/t,e.z/t,e.w/t)},vec4i:e=>{let t=qr(e);return os(e.x/t,e.y/t,e.z/t,e.w/t)},vec4u:e=>{let t=qr(e);return ks(e.x/t,e.y/t,e.z/t,e.w/t)}},cross:{vec3f:(e,t)=>nn(e.y*t.z-e.z*t.y,e.z*t.x-e.x*t.z,e.x*t.y-e.y*t.x),vec3h:(e,t)=>Rn(e.y*t.z-e.z*t.y,e.z*t.x-e.x*t.z,e.x*t.y-e.y*t.x)},mod:{vec2f:Xn((e,t)=>e%t),vec2h:_r((e,t)=>e%t),vec2i:Zr((e,t)=>e%t),vec2u:Hr((e,t)=>e%t),vec3f:Nn((e,t)=>e%t),vec3h:$r((e,t)=>e%t),vec3i:Qr((e,t)=>e%t),vec3u:Kr((e,t)=>e%t),vec4f:$n((e,t)=>e%t),vec4h:Mr((e,t)=>e%t),vec4i:es((e,t)=>e%t),vec4u:ts((e,t)=>e%t)},floor:{vec2f:Xe(Math.floor),vec2h:Qe(Math.floor),vec3f:qe(Math.floor),vec3h:Ke(Math.floor),vec4f:je(Math.floor),vec4h:et(Math.floor)},max:{vec2f:Xn(Math.max),vec2h:_r(Math.max),vec2i:Zr(Math.max),vec2u:Hr(Math.max),vec3f:Nn(Math.max),vec3h:$r(Math.max),vec3i:Qr(Math.max),vec3u:Kr(Math.max),vec4f:$n(Math.max),vec4h:Mr(Math.max),vec4i:es(Math.max),vec4u:ts(Math.max)},min:{vec2f:Xn(Math.min),vec2h:_r(Math.min),vec2i:Zr(Math.min),vec2u:Hr(Math.min),vec3f:Nn(Math.min),vec3h:$r(Math.min),vec3i:Qr(Math.min),vec3u:Kr(Math.min),vec4f:$n(Math.min),vec4h:Mr(Math.min),vec4i:es(Math.min),vec4u:ts(Math.min)},pow:{vec2f:(e,t)=>fn(e.x**t.x,e.y**t.y),vec2h:(e,t)=>Jn(e.x**t.x,e.y**t.y),vec3f:(e,t)=>nn(e.x**t.x,e.y**t.y,e.z**t.z),vec3h:(e,t)=>Rn(e.x**t.x,e.y**t.y,e.z**t.z),vec4f:(e,t)=>mn(e.x**t.x,e.y**t.y,e.z**t.z,e.w**t.w),vec4h:(e,t)=>Zn(e.x**t.x,e.y**t.y,e.z**t.z,e.w**t.w)},sign:{vec2f:Xe(Math.sign),vec2h:Qe(Math.sign),vec2i:Wr(Math.sign),vec3f:qe(Math.sign),vec3h:Ke(Math.sign),vec3i:Xr(Math.sign),vec4f:je(Math.sign),vec4h:et(Math.sign),vec4i:Jr(Math.sign)},sqrt:{vec2f:Xe(Math.sqrt),vec2h:Qe(Math.sqrt),vec3f:qe(Math.sqrt),vec3h:Ke(Math.sqrt),vec4f:je(Math.sqrt),vec4h:et(Math.sqrt)},mix:{vec2f:(e,t,n)=>typeof n=="number"?fn(e.x*(1-n)+t.x*n,e.y*(1-n)+t.y*n):fn(e.x*(1-n.x)+t.x*n.x,e.y*(1-n.y)+t.y*n.y),vec2h:(e,t,n)=>typeof n=="number"?Jn(e.x*(1-n)+t.x*n,e.y*(1-n)+t.y*n):Jn(e.x*(1-n.x)+t.x*n.x,e.y*(1-n.y)+t.y*n.y),vec3f:(e,t,n)=>typeof n=="number"?nn(e.x*(1-n)+t.x*n,e.y*(1-n)+t.y*n,e.z*(1-n)+t.z*n):nn(e.x*(1-n.x)+t.x*n.x,e.y*(1-n.y)+t.y*n.y,e.z*(1-n.z)+t.z*n.z),vec3h:(e,t,n)=>typeof n=="number"?Rn(e.x*(1-n)+t.x*n,e.y*(1-n)+t.y*n,e.z*(1-n)+t.z*n):Rn(e.x*(1-n.x)+t.x*n.x,e.y*(1-n.y)+t.y*n.y,e.z*(1-n.z)+t.z*n.z),vec4f:(e,t,n)=>typeof n=="number"?mn(e.x*(1-n)+t.x*n,e.y*(1-n)+t.y*n,e.z*(1-n)+t.z*n,e.w*(1-n)+t.w*n):mn(e.x*(1-n.x)+t.x*n.x,e.y*(1-n.y)+t.y*n.y,e.z*(1-n.z)+t.z*n.z,e.w*(1-n.w)+t.w*n.w),vec4h:(e,t,n)=>typeof n=="number"?Zn(e.x*(1-n)+t.x*n,e.y*(1-n)+t.y*n,e.z*(1-n)+t.z*n,e.w*(1-n)+t.w*n):Zn(e.x*(1-n.x)+t.x*n.x,e.y*(1-n.y)+t.y*n.y,e.z*(1-n.z)+t.z*n.z,e.w*(1-n.w)+t.w*n.w)},sin:{vec2f:Xe(Math.sin),vec2h:Qe(Math.sin),vec3f:qe(Math.sin),vec3h:Ke(Math.sin),vec4f:je(Math.sin),vec4h:et(Math.sin)},cos:{vec2f:Xe(Math.cos),vec2h:Qe(Math.cos),vec3f:qe(Math.cos),vec3h:Ke(Math.cos),vec4f:je(Math.cos),vec4h:et(Math.cos)},cosh:{vec2f:Xe(Math.cosh),vec2h:Qe(Math.cosh),vec3f:qe(Math.cosh),vec3h:Ke(Math.cosh),vec4f:je(Math.cosh),vec4h:et(Math.cosh)},exp:{vec2f:Xe(Math.exp),vec2h:Qe(Math.exp),vec3f:qe(Math.exp),vec3h:Ke(Math.exp),vec4f:je(Math.exp),vec4h:et(Math.exp)},exp2:{vec2f:Xe(e=>2**e),vec2h:Qe(e=>2**e),vec3f:qe(e=>2**e),vec3h:Ke(e=>2**e),vec4f:je(e=>2**e),vec4h:et(e=>2**e)},log:{vec2f:Xe(Math.log),vec2h:Qe(Math.log),vec3f:qe(Math.log),vec3h:Ke(Math.log),vec4f:je(Math.log),vec4h:et(Math.log)},log2:{vec2f:Xe(Math.log2),vec2h:Qe(Math.log2),vec3f:qe(Math.log2),vec3h:Ke(Math.log2),vec4f:je(Math.log2),vec4h:et(Math.log2)},fract:{vec2f:Xe(e=>e-Math.floor(e)),vec2h:Qe(e=>e-Math.floor(e)),vec3f:qe(e=>e-Math.floor(e)),vec3h:Ke(e=>e-Math.floor(e)),vec4f:je(e=>e-Math.floor(e)),vec4h:et(e=>e-Math.floor(e))},isCloseToZero:{vec2f:(e,t)=>Math.abs(e.x)<=t&&Math.abs(e.y)<=t,vec2h:(e,t)=>Math.abs(e.x)<=t&&Math.abs(e.y)<=t,vec3f:(e,t)=>Math.abs(e.x)<=t&&Math.abs(e.y)<=t&&Math.abs(e.z)<=t,vec3h:(e,t)=>Math.abs(e.x)<=t&&Math.abs(e.y)<=t&&Math.abs(e.z)<=t,vec4f:(e,t)=>Math.abs(e.x)<=t&&Math.abs(e.y)<=t&&Math.abs(e.z)<=t&&Math.abs(e.w)<=t,vec4h:(e,t)=>Math.abs(e.x)<=t&&Math.abs(e.y)<=t&&Math.abs(e.z)<=t&&Math.abs(e.w)<=t},neg:{vec2f:Xe(e=>-e),vec2h:Qe(e=>-e),vec2i:Wr(e=>-e),vec2u:vs(e=>-e),"vec2<bool>":e=>hn(!e.x,!e.y),vec3f:qe(e=>-e),vec3h:Ke(e=>-e),vec3i:Xr(e=>-e),vec3u:bs(e=>-e),"vec3<bool>":e=>pn(!e.x,!e.y,!e.z),vec4f:je(e=>-e),vec4h:et(e=>-e),vec4i:Jr(e=>-e),vec4u:Ts(e=>-e),"vec4<bool>":e=>dn(!e.x,!e.y,!e.z,!e.w)},select:{vec2f:(e,t,n)=>fn(n.x?t.x:e.x,n.y?t.y:e.y),vec2h:(e,t,n)=>Jn(n.x?t.x:e.x,n.y?t.y:e.y),vec2i:(e,t,n)=>is(n.x?t.x:e.x,n.y?t.y:e.y),vec2u:(e,t,n)=>Is(n.x?t.x:e.x,n.y?t.y:e.y),"vec2<bool>":(e,t,n)=>hn(n.x?t.x:e.x,n.y?t.y:e.y),vec3f:(e,t,n)=>nn(n.x?t.x:e.x,n.y?t.y:e.y,n.z?t.z:e.z),vec3h:(e,t,n)=>Rn(n.x?t.x:e.x,n.y?t.y:e.y,n.z?t.z:e.z),vec3i:(e,t,n)=>as(n.x?t.x:e.x,n.y?t.y:e.y,n.z?t.z:e.z),vec3u:(e,t,n)=>Bs(n.x?t.x:e.x,n.y?t.y:e.y,n.z?t.z:e.z),"vec3<bool>":(e,t,n)=>pn(n.x?t.x:e.x,n.y?t.y:e.y,n.z?t.z:e.z),vec4f:(e,t,n)=>mn(n.x?t.x:e.x,n.y?t.y:e.y,n.z?t.z:e.z,n.w?t.w:e.w),vec4h:(e,t,n)=>Zn(n.x?t.x:e.x,n.y?t.y:e.y,n.z?t.z:e.z,n.w?t.w:e.w),vec4i:(e,t,n)=>os(n.x?t.x:e.x,n.y?t.y:e.y,n.z?t.z:e.z,n.w?t.w:e.w),vec4u:(e,t,n)=>ks(n.x?t.x:e.x,n.y?t.y:e.y,n.z?t.z:e.z,n.w?t.w:e.w),"vec4<bool>":(e,t,n)=>dn(n.x?t.x:e.x,n.y?t.y:e.y,n.z?t.z:e.z,n.w?t.w:e.w)},tanh:{vec2f:Xe(Math.tanh),vec2h:Qe(Math.tanh),vec3f:qe(Math.tanh),vec3h:Ke(Math.tanh),vec4f:je(Math.tanh),vec4h:et(Math.tanh)},bitcastU32toF32:{vec2u:e=>fn(Vn(e.x),Vn(e.y)),vec3u:e=>nn(Vn(e.x),Vn(e.y),Vn(e.z)),vec4u:e=>mn(Vn(e.x),Vn(e.y),Vn(e.z),Vn(e.w))},bitcastU32toI32:{vec2u:e=>is(Gn(e.x),Gn(e.y)),vec3u:e=>as(Gn(e.x),Gn(e.y),Gn(e.z)),vec4u:e=>os(Gn(e.x),Gn(e.y),Gn(e.z),Gn(e.w))}};function Ac(e,t){if(typeof e=="number"&&typeof t=="number")return e+t;if(typeof e=="number"&&Je(t))return ee.addMixed[t.kind](t,e);if(Je(e)&&typeof t=="number")return ee.addMixed[e.kind](e,t);if(Je(e)&&Je(t)||Ln(e)&&Ln(t))return ee.add[e.kind](e,t);throw new Error("Add/Sub called with invalid arguments.")}var ue=G({name:"add",signature:(...e)=>{let t=ct(e)??e;return{argTypes:t,returnType:rr(t[0])?t[1]:t[0]}},normalImpl:Ac,codegenImpl:(e,t)=>S`(${e} + ${t})`});function Cf(e,t){return Ac(e,Ic(-1,t))}var K=G({name:"sub",signature:(...e)=>{let t=ct(e)??e;return{argTypes:t,returnType:rr(t[0])?t[1]:t[0]}},normalImpl:Cf,codegenImpl:(e,t)=>S`(${e} - ${t})`});function Ic(e,t){if(typeof e=="number"&&typeof t=="number")return e*t;if(typeof e=="number"&&(Je(t)||Ln(t)))return ee.mulSxV[t.kind](e,t);if((Je(e)||Ln(e))&&typeof t=="number")return ee.mulSxV[e.kind](t,e);if(Je(e)&&Je(t))return ee.mulVxV[e.kind](e,t);if(tu(e)&&Ln(t))return ee.mulVxM[t.kind](e,t);if(Ln(e)&&tu(t))return ee.mulMxV[e.kind](e,t);if(Ln(e)&&Ln(t))return ee.mulVxV[e.kind](e,t);throw new Error("Mul called with invalid arguments.")}var xe=G({name:"mul",signature:(...e)=>{let t=ct(e)??e,n=rr(t[0])?t[1]:rr(t[1])||t[0].type.startsWith("vec")?t[0]:t[1].type.startsWith("vec")?t[1]:t[0];return{argTypes:t,returnType:n}},normalImpl:Ic,codegenImpl:(e,t)=>S`(${e} * ${t})`});function qf(e,t){if(typeof e=="number"&&typeof t=="number")return e/t;if(typeof e=="number"&&Je(t)){let n=Gi[t.kind][E].jsImpl;return ee.div[t.kind](n(e),t)}if(Je(e)&&typeof t=="number"){let n=Gi[e.kind][E].jsImpl;return ee.div[e.kind](e,n(t))}if(Je(e)&&Je(t))return ee.div[e.kind](e,t);throw new Error("Div called with invalid arguments.")}var Do=G({name:"div",signature:(...e)=>{let t=ct(e,[$,ut,Sn])??e;return{argTypes:t,returnType:rr(t[0])?t[1]:t[0]}},normalImpl:qf,codegenImpl:(e,t)=>S`(${e} / ${t})`,ignoreImplicitCastWarning:!0}),Wf=G({name:"mod",signature:(...e)=>{let t=ct(e)??e;return{argTypes:t,returnType:rr(t[0])?t[1]:t[0]}},normalImpl(e,t){if(typeof e=="number"&&typeof t=="number")return e%t;if(typeof e=="number"&&Je(t)){let n=Gi[t.kind];return ee.mod[t.kind](n(e),t)}if(Je(e)&&typeof t=="number"){let n=Gi[e.kind];return ee.mod[e.kind](e,n(t))}if(Je(e)&&Je(t))return ee.mod[e.kind](e,t);throw new Error("Mod called with invalid arguments, expected types: number or vector.")},codegenImpl:(e,t)=>S`(${e} % ${t})`});function Xf(e){return typeof e=="number"?-e:ee.neg[e.kind](e)}var Ls=G({name:"neg",signature:e=>({argTypes:[e],returnType:e}),normalImpl:Xf,codegenImpl:e=>S`-(${e})`});function Jf(e){return typeof e=="number"?Math.abs(e):ee.abs[e.kind](e)}var He=G({name:"abs",signature:e=>({argTypes:[e],returnType:e}),normalImpl:Jf,codegenImpl:e=>S`abs(${e})`});function Zf(e){return typeof e=="number"?Math.acos(e):ee.acos[e.kind](e)}var Fa=G({name:"acos",signature:e=>({argTypes:[e],returnType:e}),normalImpl:Zf,codegenImpl:e=>S`acos(${e})`});function Hf(e){return typeof e=="number"?Math.acosh(e):ee.acosh[e.kind](e)}var Qf=G({name:"acosh",signature:e=>({argTypes:[e],returnType:e}),normalImpl:Hf,codegenImpl:e=>S`acosh(${e})`});function Kf(e){return typeof e=="number"?Math.asin(e):ee.asin[e.kind](e)}var em=G({name:"asin",signature:e=>({argTypes:[e],returnType:e}),normalImpl:Kf,codegenImpl:e=>S`asin(${e})`});function tm(e){return typeof e=="number"?Math.asinh(e):ee.asinh[e.kind](e)}var nm=G({name:"asinh",signature:e=>({argTypes:[e],returnType:e}),normalImpl:tm,codegenImpl:e=>S`asinh(${e})`});function rm(e){return typeof e=="number"?Math.atan(e):ee.atan[e.kind](e)}var sm=G({name:"atan",signature:e=>({argTypes:[e],returnType:e}),normalImpl:rm,codegenImpl:e=>S`atan(${e})`});function im(e){return typeof e=="number"?Math.atanh(e):ee.atanh[e.kind](e)}var am=G({name:"atanh",signature:e=>({argTypes:[e],returnType:e}),normalImpl:im,codegenImpl:e=>S`atanh(${e})`});function om(e,t){return typeof e=="number"&&typeof t=="number"?Math.atan2(e,t):ee.atan2[e.kind](e,t)}var um=G({name:"atan2",signature:(...e)=>{let t=ct(e,[$,ut,Sn])??e;return{argTypes:t,returnType:t[0]}},normalImpl:om,codegenImpl:(e,t)=>S`atan2(${e}, ${t})`});function lm(e){return typeof e=="number"?Math.ceil(e):ee.ceil[e.kind](e)}var Bc=G({name:"ceil",signature:e=>({argTypes:[e],returnType:e}),normalImpl:lm,codegenImpl:e=>S`ceil(${e})`});function cm(e,t,n){return typeof e=="number"?Math.min(Math.max(t,e),n):ee.clamp[e.kind](e,t,n)}var kr=G({name:"clamp",signature:(...e)=>{let t=ct(e)??e;return{argTypes:t,returnType:t[0]}},normalImpl:cm,codegenImpl:(e,t,n)=>S`clamp(${e}, ${t}, ${n})`});function hm(e){return typeof e=="number"?Math.cos(e):ee.cos[e.kind](e)}var Ft=G({name:"cos",signature:e=>({argTypes:[e],returnType:e}),normalImpl:hm,codegenImpl:e=>S`cos(${e})`});function pm(e){return typeof e=="number"?Math.cosh(e):ee.cosh[e.kind](e)}var dm=G({name:"cosh",signature:e=>({argTypes:[e],returnType:e}),normalImpl:pm,codegenImpl:e=>S`cosh(${e})`}),fm=G({name:"countLeadingZeros",signature:e=>({argTypes:[e],returnType:e}),normalImpl:"CPU implementation for countLeadingZeros not implemented yet. Please submit an issue at https://github.com/software-mansion/TypeGPU/issues",codegenImpl:e=>S`countLeadingZeros(${e})`}),mm=G({name:"countOneBits",signature:e=>({argTypes:[e],returnType:e}),normalImpl:"CPU implementation for countOneBits not implemented yet. Please submit an issue at https://github.com/software-mansion/TypeGPU/issues",codegenImpl:e=>S`countOneBits(${e})`}),ym=G({name:"countTrailingZeros",signature:e=>({argTypes:[e],returnType:e}),normalImpl:"CPU implementation for countTrailingZeros not implemented yet. Please submit an issue at https://github.com/software-mansion/TypeGPU/issues",codegenImpl:e=>S`countTrailingZeros(${e})`}),kc=G({name:"cross",signature:(e,t)=>({argTypes:[e,t],returnType:e}),normalImpl:(e,t)=>ee.cross[e.kind](e,t),codegenImpl:(e,t)=>S`cross(${e}, ${t})`});function gm(e){if(typeof e=="number")return e*180/Math.PI;throw new on("CPU implementation for degrees on vectors not implemented yet. Please submit an issue at https://github.com/software-mansion/TypeGPU/issues")}var wm=G({name:"degrees",signature:e=>({argTypes:[e],returnType:e}),normalImpl:gm,codegenImpl:e=>S`degrees(${e})`}),xm=G({name:"determinant",signature:e=>({argTypes:[e],returnType:$}),normalImpl:"CPU implementation for determinant not implemented yet. Please submit an issue at https://github.com/software-mansion/TypeGPU/issues",codegenImpl:e=>S`determinant(${e})`});function vm(e,t){return typeof e=="number"&&typeof t=="number"?Math.abs(e-t):$e(K(e,t))}var bm=G({name:"distance",signature:(e,t)=>({argTypes:[e,t],returnType:ho(e)?ut:$}),normalImpl:vm,codegenImpl:(e,t)=>S`distance(${e}, ${t})`}),ae=G({name:"dot",signature:(e,t)=>({argTypes:[e,t],returnType:e.primitive}),normalImpl:(e,t)=>ee.dot[e.kind](e,t),codegenImpl:(e,t)=>S`dot(${e}, ${t})`}),Tm=G({name:"dot4U8Packed",signature:(e,t)=>({argTypes:[J,J],returnType:J}),normalImpl:"CPU implementation for dot4U8Packed not implemented yet. Please submit an issue at https://github.com/software-mansion/TypeGPU/issues",codegenImpl:(e,t)=>S`dot4U8Packed(${e}, ${t})`}),_m=G({name:"dot4I8Packed",signature:(e,t)=>({argTypes:[J,J],returnType:Ue}),normalImpl:"CPU implementation for dot4I8Packed not implemented yet. Please submit an issue at https://github.com/software-mansion/TypeGPU/issues",codegenImpl:(e,t)=>S`dot4I8Packed(${e}, ${t})`});function $m(e){return typeof e=="number"?Math.exp(e):ee.exp[e.kind](e)}var Oc=G({name:"exp",signature:e=>({argTypes:[e],returnType:e}),normalImpl:$m,codegenImpl:e=>S`exp(${e})`});function Mm(e){return typeof e=="number"?2**e:ee.exp2[e.kind](e)}var zm=G({name:"exp2",signature:e=>({argTypes:[e],returnType:e}),normalImpl:Mm,codegenImpl:e=>S`exp2(${e})`}),Em=G({name:"extractBits",signature:(e,t,n)=>({argTypes:[e,J,J],returnType:e}),normalImpl:"CPU implementation for extractBits not implemented yet. Please submit an issue at https://github.com/software-mansion/TypeGPU/issues",codegenImpl:(e,t,n)=>S`extractBits(${e}, ${t}, ${n})`}),Sm=G({name:"faceForward",signature:(e,t,n)=>({argTypes:[e,t,n],returnType:e}),normalImpl:"CPU implementation for faceForward not implemented yet. Please submit an issue at https://github.com/software-mansion/TypeGPU/issues",codegenImpl:(e,t,n)=>S`faceForward(${e}, ${t}, ${n})`}),Pm=G({name:"firstLeadingBit",signature:e=>({argTypes:[e],returnType:e}),normalImpl:"CPU implementation for firstLeadingBit not implemented yet. Please submit an issue at https://github.com/software-mansion/TypeGPU/issues",codegenImpl:e=>S`firstLeadingBit(${e})`}),Um=G({name:"firstTrailingBit",signature:e=>({argTypes:[e],returnType:e}),normalImpl:"CPU implementation for firstTrailingBit not implemented yet. Please submit an issue at https://github.com/software-mansion/TypeGPU/issues",codegenImpl:e=>S`firstTrailingBit(${e})`});function Am(e){return typeof e=="number"?Math.floor(e):ee.floor[e.kind](e)}var Or=G({name:"floor",signature:(...e)=>({argTypes:e,returnType:e[0]}),normalImpl:Am,codegenImpl:e=>S`floor(${e})`});function Im(e,t,n){if(typeof e=="number")return e*t+n;throw new on("CPU implementation for fma on vectors not implemented yet. Please submit an issue at https://github.com/software-mansion/TypeGPU/issues")}var Bm=G({name:"fma",signature:(e,t,n)=>({argTypes:[e,t,n],returnType:e}),normalImpl:Im,codegenImpl:(e,t,n)=>S`fma(${e}, ${t}, ${n})`});function km(e){return typeof e=="number"?e-Math.floor(e):ee.fract[e.kind](e)}var er=G({name:"fract",signature:(...e)=>({argTypes:e,returnType:e[0]}),normalImpl:km,codegenImpl:e=>S`fract(${e})`}),Om={f32:wt({fract:$,exp:Ue}),f16:wt({fract:ut,exp:Ue}),abstractFloat:wt({fract:Sn,exp:Js}),vec2f:wt({fract:F,exp:Be}),vec3f:wt({fract:O,exp:Ot}),vec4f:wt({fract:k,exp:Fe}),vec2h:wt({fract:Pn,exp:Be}),vec3h:wt({fract:Un,exp:Ot}),vec4h:wt({fract:An,exp:Fe})},Vm=ce(e=>{throw new on("CPU implementation for frexp not implemented yet. Please submit an issue at https://github.com/software-mansion/TypeGPU/issues")},e=>{let t=Om[e.dataType.type];if(!t)throw new Error(`Unsupported data type for frexp: ${e.dataType.type}. Supported types are f32, f16, abstractFloat, vec2f, vec3f, vec4f, vec2h, vec3h, vec4h.`);return B(S`frexp(${e})`,t)},"frexp"),Gm=G({name:"insertBits",signature:(e,t,n,r)=>({argTypes:[e,t,J,J],returnType:e}),normalImpl:"CPU implementation for insertBits not implemented yet. Please submit an issue at https://github.com/software-mansion/TypeGPU/issues",codegenImpl:(e,t,n,r)=>S`insertBits(${e}, ${t}, ${n}, ${r})`});function Dm(e){if(typeof e=="number")return 1/Math.sqrt(e);throw new on("CPU implementation for inverseSqrt on vectors not implemented yet. Please submit an issue at https://github.com/software-mansion/TypeGPU/issues")}var Rm=G({name:"inverseSqrt",signature:e=>({argTypes:[e],returnType:e}),normalImpl:Dm,codegenImpl:e=>S`inverseSqrt(${e})`}),Nm=G({name:"ldexp",signature:(e,t)=>{switch(e.type){case"abstractFloat":return{argTypes:[Sn,Js],returnType:e};case"f32":case"f16":return{argTypes:[e,Ue],returnType:e};case"vec2f":case"vec2h":return{argTypes:[e,Be],returnType:e};case"vec3f":case"vec3h":return{argTypes:[e,Ot],returnType:e};case"vec4f":case"vec4h":return{argTypes:[e,Fe],returnType:e};default:throw new Error(`Unsupported data type for ldexp: ${e.type}. Supported types are abstractFloat, f32, f16, vec2f, vec2h, vec3f, vec3h, vec4f, vec4h.`)}},normalImpl:"CPU implementation for ldexp not implemented yet. Please submit an issue at https://github.com/software-mansion/TypeGPU/issues",codegenImpl:(e,t)=>S`ldexp(${e}, ${t})`});function Fm(e){return typeof e=="number"?Math.abs(e):ee.length[e.kind](e)}var $e=G({name:"length",signature:e=>({argTypes:[e],returnType:ho(e)?ut:$}),normalImpl:Fm,codegenImpl:e=>S`length(${e})`});function Lm(e){return typeof e=="number"?Math.log(e):ee.log[e.kind](e)}var js=G({name:"log",signature:e=>({argTypes:[e],returnType:e}),normalImpl:Lm,codegenImpl:e=>S`log(${e})`});function jm(e){return typeof e=="number"?Math.log2(e):ee.log2[e.kind](e)}var Ym=G({name:"log2",signature:e=>({argTypes:[e],returnType:e}),normalImpl:jm,codegenImpl:e=>S`log2(${e})`});function Cm(e,t){return typeof e=="number"?Math.max(e,t):ee.max[e.kind](e,t)}var ie=G({name:"max",signature:(...e)=>{let t=ct(e)??e;return{argTypes:t,returnType:t[0]}},normalImpl:Cm,codegenImpl:(e,t)=>S`max(${e}, ${t})`});function qm(e,t){return typeof e=="number"?Math.min(e,t):ee.min[e.kind](e,t)}var Ie=G({name:"min",signature:(...e)=>{let t=ct(e)??e;return{argTypes:t,returnType:t[0]}},normalImpl:qm,codegenImpl:(e,t)=>S`min(${e}, ${t})`});function Wm(e,t,n){if(typeof e=="number"){if(typeof n!="number"||typeof t!="number")throw new Error("When e1 and e2 are numbers, the blend factor must be a number.");return e*(1-n)+t*n}if(typeof e=="number"||typeof t=="number")throw new Error("e1 and e2 need to both be vectors of the same kind.");return ee.mix[e.kind](e,t,n)}var rn=G({name:"mix",signature:(e,t,n)=>({argTypes:[e,t,n],returnType:e}),normalImpl:Wm,codegenImpl:(e,t,n)=>S`mix(${e}, ${t}, ${n})`}),Xm={f32:wt({fract:$,whole:$}),f16:wt({fract:ut,whole:ut}),abstractFloat:wt({fract:Sn,whole:Sn}),vec2f:wt({fract:F,whole:F}),vec3f:wt({fract:O,whole:O}),vec4f:wt({fract:k,whole:k}),vec2h:wt({fract:Pn,whole:Pn}),vec3h:wt({fract:Un,whole:Un}),vec4h:wt({fract:An,whole:An})},Jm=G({name:"modf",signature:e=>{let t=Xm[e.type];if(!t)throw new Error(`Unsupported data type for modf: ${e.type}. Supported types are f32, f16, abstractFloat, vec2f, vec3f, vec4f, vec2h, vec3h, vec4h.`);return{argTypes:[e],returnType:t}},normalImpl:"CPU implementation for modf not implemented yet. Please submit an issue at https://github.com/software-mansion/TypeGPU/issues",codegenImpl:e=>S`modf(${e})`}),an=G({name:"normalize",signature:e=>({argTypes:[e],returnType:e}),normalImpl:e=>ee.normalize[e.kind](e),codegenImpl:e=>S`normalize(${e})`});function Zm(e,t){if(typeof e=="number"&&typeof t=="number")return e**t;if(Je(e)&&Je(t))return ee.pow[e.kind](e,t);throw new Error("Invalid arguments to pow()")}var gr=G({name:"pow",signature:(...e)=>{let t=ct(e,[$,ut,Sn])??e;return{argTypes:t,returnType:rr(t[0])?t[1]:t[0]}},normalImpl:Zm,codegenImpl:(e,t)=>S`pow(${e}, ${t})`}),Hm=G({name:"quantizeToF16",signature:e=>({argTypes:[e],returnType:e}),normalImpl:"CPU implementation for quantizeToF16 not implemented yet. Please submit an issue at https://github.com/software-mansion/TypeGPU/issues",codegenImpl:e=>S`quantizeToF16(${e})`});function Qm(e){if(typeof e=="number")return e*Math.PI/180;throw new on("CPU implementation for radians on vectors not implemented yet. Please submit an issue at https://github.com/software-mansion/TypeGPU/issues")}var Km=G({name:"radians",signature:(...e)=>{let t=ct(e,[$,ut,Sn])??e;return{argTypes:t,returnType:t[0]}},normalImpl:Qm,codegenImpl:e=>S`radians(${e})`}),Vc=G({name:"reflect",signature:(e,t)=>({argTypes:[e,t],returnType:e}),normalImpl:(e,t)=>K(e,xe(2*ae(t,e),t)),codegenImpl:(e,t)=>S`reflect(${e}, ${t})`}),e1=ce((e,t,n)=>{throw new on("CPU implementation for refract not implemented yet. Please submit an issue at https://github.com/software-mansion/TypeGPU/issues")},(e,t,n)=>B(S`refract(${e}, ${t}, ${n})`,e.dataType),"refract",(e,t,n)=>[e.dataType,t.dataType,ho(e)?ut:$]),t1=G({name:"reverseBits",signature:e=>({argTypes:[e],returnType:e}),normalImpl:"CPU implementation for reverseBits not implemented yet. Please submit an issue at https://github.com/software-mansion/TypeGPU/issues",codegenImpl:e=>S`reverseBits(${e})`});function n1(e){if(typeof e=="number")return Math.round(e);throw new on("CPU implementation for round on vectors not implemented yet. Please submit an issue at https://github.com/software-mansion/TypeGPU/issues")}var r1=G({name:"round",signature:e=>({argTypes:[e],returnType:e}),normalImpl:n1,codegenImpl:e=>S`round(${e})`});function s1(e){if(typeof e=="number")return Math.max(0,Math.min(1,e));throw new on("CPU implementation for saturate on vectors not implemented yet. Please submit an issue at https://github.com/software-mansion/TypeGPU/issues")}var jt=G({name:"saturate",signature:e=>({argTypes:[e],returnType:e}),normalImpl:s1,codegenImpl:e=>S`saturate(${e})`});function i1(e){return typeof e=="number"?Math.sign(e):ee.sign[e.kind](e)}var ar=G({name:"sign",signature:e=>({argTypes:[e],returnType:e}),normalImpl:i1,codegenImpl:e=>S`sign(${e})`});function a1(e){return typeof e=="number"?Math.sin(e):ee.sin[e.kind](e)}var un=G({name:"sin",signature:e=>({argTypes:[e],returnType:e}),normalImpl:a1,codegenImpl:e=>S`sin(${e})`});function o1(e){if(typeof e=="number")return Math.sinh(e);throw new on("CPU implementation for sinh on vectors not implemented yet. Please submit an issue at https://github.com/software-mansion/TypeGPU/issues")}var u1=G({name:"sinh",signature:e=>({argTypes:[e],returnType:e}),normalImpl:o1,codegenImpl:e=>S`sinh(${e})`});function l1(e,t,n){return typeof n=="number"?zr(e,t,n):ee.smoothstep[n.kind](e,t,n)}var Gc=G({name:"smoothstep",signature:(e,t,n)=>({argTypes:[e,t,n],returnType:n}),normalImpl:l1,codegenImpl:(e,t,n)=>S`smoothstep(${e}, ${t}, ${n})`});function c1(e){return typeof e=="number"?Math.sqrt(e):ee.sqrt[e.kind](e)}var gn=G({name:"sqrt",signature:e=>({argTypes:[e],returnType:e}),normalImpl:c1,codegenImpl:e=>S`sqrt(${e})`});function h1(e,t){if(typeof e=="number")return e<=t?1:0;throw new on("CPU implementation for step on vectors not implemented yet. Please submit an issue at https://github.com/software-mansion/TypeGPU/issues")}var La=G({name:"step",signature:(...e)=>{let t=ct(e,[$,ut,Sn])??e;return{argTypes:t,returnType:t[0]}},normalImpl:h1,codegenImpl:(e,t)=>S`step(${e}, ${t})`});function p1(e){if(typeof e=="number")return Math.tan(e);throw new on("CPU implementation for tan on vectors not implemented yet. Please submit an issue at https://github.com/software-mansion/TypeGPU/issues")}var ja=G({name:"tan",signature:e=>({argTypes:[e],returnType:e}),normalImpl:p1,codegenImpl:e=>S`tan(${e})`});function d1(e){return typeof e=="number"?Math.tanh(e):ee.tanh[e.kind](e)}var Dc=G({name:"tanh",signature:e=>({argTypes:[e],returnType:e}),normalImpl:d1,codegenImpl:e=>S`tanh(${e})`}),f1=G({name:"transpose",signature:e=>({argTypes:[e],returnType:e}),normalImpl:"CPU implementation for transpose not implemented yet. Please submit an issue at https://github.com/software-mansion/TypeGPU/issues",codegenImpl:e=>S`transpose(${e})`}),m1=G({name:"trunc",signature:e=>({argTypes:[e],returnType:e}),normalImpl:"CPU implementation for trunc not implemented yet. Please submit an issue at https://github.com/software-mansion/TypeGPU/issues",codegenImpl:e=>S`trunc(${e})`}),{NodeTypeCatalog:Ce}=Kd,y1=["==","!=","<","<=",">",">=","<<",">>","+","-","*","/","%","|","^","&","&&","||"],g1=["&&","||","==","!=","<","<=",">",">="],w1=["vec2f","vec3f","vec4f","vec2h","vec3h","vec4h","vec2i","vec3i","vec4i","vec2u","vec3u","vec4u","mat2x2f","mat3x3f","mat4x4f"],Ya={add:ue,sub:K,mul:xe,div:Do};function Tu(e,t,n){return n?g1.includes(t)?ke:t==="="?n:e:t==="!"||t==="~"?ke:e}var x1={"+":ue[E].gpuImpl,"-":K[E].gpuImpl,"*":xe[E].gpuImpl,"/":Do[E].gpuImpl,"**":gr[E].gpuImpl},v1=class{#e=void 0;initGenerator(t){this.#e=t}get ctx(){if(!this.#e)throw new Error("WGSL Generator has not yet been initialized. Please call initialize(ctx) before using the generator.");return this.#e}block([t,n]){this.ctx.pushBlockScope();try{this.ctx.indent();let r=n.map(s=>this.statement(s)).join(`
`);return this.ctx.dedent(),`{
${r}
${this.ctx.pre}}`}finally{this.ctx.popBlockScope()}}blockVariable(t,n){let r=B(this.ctx.makeNameValid(t),n);return this.ctx.defineVariable(t,r),r}identifier(t){if(!t)throw new Error("Cannot resolve an empty identifier");let n=this.ctx.getById(t);if(!n)throw new Error(`Identifier ${t} not found`);return n}typedExpression(t,n){let r=this.ctx.expectedType;this.ctx.expectedType=n;try{let s=this.expression(t);return ka(s,n)}finally{this.ctx.expectedType=r}}expression(t){if(typeof t=="string")return this.identifier(t);if(typeof t=="boolean")return B(t,ke);if(t[0]===Ce.logicalExpr||t[0]===Ce.binaryExpr||t[0]===Ce.assignmentExpr){let[n,r,s,i]=t,p=this.expression(r),y=this.expression(i),v=x1[s];if(v)return v(p,y);let _=t[0]===Ce.assignmentExpr?p.dataType.type==="ptr"?[p.dataType.inner]:[p.dataType]:void 0,[P,U]=Us([p,y],_)??[p,y],R=this.ctx.resolve(P.value,P.dataType).value,j=this.ctx.resolve(U.value,U.dataType).value,L=Tu(P.dataType,s,U.dataType);return B(y1.includes(s)?`(${R} ${s} ${j})`:`${R} ${s} ${j}`,L)}if(t[0]===Ce.postUpdate){let[n,r,s]=t,i=this.expression(s),p=this.ctx.resolve(i.value,i.dataType).value;return B(`${p}${r}`,i.dataType)}if(t[0]===Ce.unaryExpr){let[n,r,s]=t,i=this.expression(s),p=this.ctx.resolve(i.value,i.dataType).value,y=Tu(i.dataType,r);return B(`${r}${p}`,y)}if(t[0]===Ce.memberAccess){let[n,r,s]=t,i=this.expression(r);if(i.value===console)return B(new su(s),kt);if(w1.includes(i.dataType.type)&&s in Ya)return{value:new nu(s,i,Ya[s][E].gpuImpl),dataType:kt};if(i.dataType.type==="unknown"){let p=i.value[s];return Mi(p)}return Ir(i.dataType)?B(`(*${this.ctx.resolve(i.value).value}).${s}`,Ga(i.dataType.inner,s)):Lt(i.dataType)&&s==="length"?i.dataType.elementCount===0?B(`arrayLength(&${this.ctx.resolve(i.value).value})`,J):B(String(i.dataType.elementCount),Js):Rs(i.dataType)&&s==="columns"?B(new ru(i),kt):nr(i.dataType)&&Je(i.value)?Mi(i.value[s]):B(`${this.ctx.resolve(i.value).value}.${s}`,Ga(i.dataType,s))}if(t[0]===Ce.indexAccess){let[n,r,s]=t,i=this.expression(r),p=this.expression(s),y=this.ctx.resolve(p.value,p.dataType).value;if(i.value instanceof ru)return B(S`${i.value.matrix}[${y}]`,fa(i.value.matrix.dataType));let v=this.ctx.resolve(i.value,i.dataType).value;if(i.dataType.type==="unknown"){if(Array.isArray(s)&&s[0]===Ce.numericLiteral)return Mi(i.value[s[1]]);throw new Error(`Unable to index a value of unknown type with index ${y}. If the value is an array, to address this, consider one of the following approaches: (1) declare the array using 'tgpu.const', (2) store the array in a buffer, or (3) define the array within the GPU function scope.`)}if(Rs(i.dataType))throw new Error("The only way of accessing matrix elements in TGSL is through the 'columns' property.");return Ir(i.dataType)?B(`(*${v})[${y}]`,fa(i.dataType.inner)):B(`${v}[${y}]`,Gr(i.dataType)?fa(i.dataType):kt)}if(t[0]===Ce.numericLiteral){let n=typeof t[1]=="string"?Ri(T1(t[1])):Ri(t[1]);if(!n)throw new Error(`Invalid numeric literal ${t[1]}`);return n}if(t[0]===Ce.call){let[n,r,s]=t,i=this.expression(r);if(vt(i.value)||Lt(i.value)){if(s.length>1)throw new yn("Array and struct schemas should always be called with at most 1 argument");if(!s[0])return B(`${this.ctx.resolve(i.value).value}()`,i.value);let y=this.typedExpression(s[0],i.value);return B(this.ctx.resolve(y.value,i.value).value,i.value)}if(i.value===Da)throw new Error("Constants cannot be defined within TypeGPU function scope. To address this, move the constant definition outside the function scope.");if(i.value instanceof nu){if(!s[0])throw new yn(`An infix operator '${i.value.name}' was called without any arguments`);let y=this.expression(s[0]);return i.value.operator(i.value.lhs,y)}if(!Ge(i.value)){let y=s.map(_=>this.expression(_)),v=this.ctx.shelllessRepo.get(i.value,y);if(v)return this.ctx.withResetIndentLevel(()=>{let _=this.ctx.resolve(v);return B(S`${_.value}(${y})`,_.dataType)});throw new Error(`Function '${W(i.value)??String(i.value)}' is not marked with the 'use gpu' directive and cannot be used in a shader`)}let p=i.value[E]?.argConversionHint??"keep";try{let y;if(Array.isArray(p))y=s.map((_,P)=>{let U=p[P];if(!U)throw new yn(`Function '${W(i.value)}' was called with too many arguments`);return this.typedExpression(_,U)});else{let _=s.map(P=>this.expression(P));p==="keep"?y=_:p==="unify"?y=Us(_)??_:y=p(..._).map((P,U)=>[P,_[U]]).map(([P,U])=>ka(U,P))}if(i.value instanceof su)return this.ctx.generateLog(i.value.op,y);let v=i.value(...y);if(!fo(v))throw new Error("Functions running in codegen mode must return snippets");return v}catch(y){throw new $s(y,[{toString:()=>W(i.value)}])}}if(t[0]===Ce.objectExpr){let n=t[1],r=this.ctx.expectedType;if(!r||!vt(r))throw new yn(`No target type could be inferred for object with keys [${Object.keys(n).join(", ")}], please wrap the object in the corresponding schema.`);let s=Object.fromEntries(Object.entries(r.propTypes).map(([p,y])=>{let v=n[p];if(v===void 0)throw new yn(`Missing property ${p} in object literal for struct ${r}`);let _=this.typedExpression(v,y);return[p,_]})),i=Vp(r,s);return B(S`${this.ctx.resolve(r).value}(${i})`,r)}if(t[0]===Ce.arrayExpr){let[n,r]=t,s=this.ctx.expectedType,i,p;if(Lt(s)){if(i=s.elementType,p=r.map(v=>this.typedExpression(v,i)),p.length!==s.elementCount)throw new yn(`Cannot create value of type '${s}' from an array of length: ${p.length}`)}else{let v=r.map(P=>this.expression(P));if(v.length===0)throw new yn("Cannot infer the type of an empty array literal.");let _=Us(v);if(!_)throw new yn("The given values cannot be automatically converted to a common type. Consider wrapping the array in an appropriate schema");p=_,i=Fs(p[0]?.dataType)}let y=`array<${this.ctx.resolve(i).value}, ${p.length}>`;return B(S`${y}(${p})`,Yn[E].jsImpl(i,p.length))}if(t[0]===Ce.stringLiteral)return B(t[1],kt);if(t[0]===Ce.preUpdate)throw new Error("Cannot use pre-updates in TGSL.");b1(t)}functionDefinition(t){return this.block(t)}statement(t){if(typeof t=="string")return`${this.ctx.pre}${this.ctx.resolve(this.identifier(t).value).value};`;if(typeof t=="boolean")return`${this.ctx.pre}${t?"true":"false"};`;if(t[0]===Ce.return){let n=t[1];if(n!==void 0){let r=this.ctx.topFunctionReturnType,s=r?this.typedExpression(n,r):this.expression(n);return Kn(s.dataType.type!=="unknown"),this.ctx.reportReturnType(s.dataType),S`${this.ctx.pre}return ${s};`}return`${this.ctx.pre}return;`}if(t[0]===Ce.if){let[n,r,s,i]=t,p=this.typedExpression(r,ke),y=p.value===!1?void 0:this.block(gi(s)),v=p.value===!0||!i?void 0:this.block(gi(i));return p.value===!0?`${this.ctx.pre}${y}`:p.value===!1?v?`${this.ctx.pre}${v}`:"":v?S`\
${this.ctx.pre}if (${p}) ${y}
${this.ctx.pre}else ${v}`:S`${this.ctx.pre}if (${p}) ${y}`}if(t[0]===Ce.let||t[0]===Ce.const){let[n,r,s]=t,i=s!==void 0?this.expression(s):void 0;if(!i)throw new Error(`Cannot create variable '${r}' without an initial value.`);if(fs(i.dataType))throw new Error(`Cannot create variable '${r}' with loose data type.`);let p=this.blockVariable(r,Fs(i.dataType));return S`${this.ctx.pre}var ${p.value} = ${i};`}if(t[0]===Ce.block)return this.block(t);if(t[0]===Ce.for){let[n,r,s,i,p]=t,[y,v,_]=this.ctx.withResetIndentLevel(()=>[r?this.statement(r):void 0,s?this.typedExpression(s,ke):void 0,i?this.statement(i):void 0]),P=y?y.slice(0,-1):"",U=_?_.slice(0,-1):"",R=this.block(gi(p));return S`${this.ctx.pre}for (${P}; ${v}; ${U}) ${R}`}if(t[0]===Ce.while){let[n,r,s]=t,i=this.typedExpression(r,ke),p=this.ctx.resolve(i.value).value,y=this.block(gi(s));return`${this.ctx.pre}while (${p}) ${y}`}return t[0]===Ce.continue?`${this.ctx.pre}continue;`:t[0]===Ce.break?`${this.ctx.pre}break;`:`${this.ctx.pre}${this.ctx.resolve(this.expression(t).value).value};`}};function b1(e){throw new Error(`'${Jt(e)}' was not handled by the WGSL generator.`)}function T1(e){return/^0x[0-9a-f]+$/i.test(e)?Number.parseInt(e):/^0b[01]+$/i.test(e)?Number.parseInt(e.slice(2),2):Number.parseFloat(e)}function gi(e){return typeof e!="object"||e[0]!==Ce.block?[Ce.block,[e]]:e}var _1=new v1,Rc=_1,Nc=Object.defineProperty,$1=(e,t,n)=>t in e?Nc(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,M1=(e,t)=>{for(var n in t)Nc(e,n,{get:t[n],enumerable:!0})},ye=(e,t,n)=>$1(e,typeof t!="symbol"?t+"":t,n),z1={};M1(z1,{BufferReader:()=>hr,BufferWriter:()=>Nr,MaxValue:()=>ot,Measurer:()=>nt,UnresolvedReferenceError:()=>Sr,ValidationError:()=>la,arrayOf:()=>A1,bool:()=>B1,byte:()=>R1,chars:()=>K1,concat:()=>ry,dynamicArrayOf:()=>iy,f16:()=>J1,f32:()=>H1,f32Array:()=>by,f64Array:()=>Ty,generic:()=>ty,genericEnum:()=>ny,i16:()=>F1,i16Array:()=>xy,i32:()=>C1,i32Array:()=>vy,i8:()=>G1,i8Array:()=>wy,keyed:()=>uy,object:()=>ey,optional:()=>cy,string:()=>O1,tupleOf:()=>dy,u16:()=>j1,u16Array:()=>yy,u32:()=>W1,u32Array:()=>gy,u8:()=>Cc,u8Array:()=>fy,u8ClampedArray:()=>my});var Sr=class Fc extends Error{constructor(t){super(t),Object.setPrototypeOf(this,Fc.prototype)}},la=class Lc extends Error{constructor(t){super(t),Object.setPrototypeOf(this,Lc.prototype)}},E1=class{constructor(){ye(this,"size",Number.NaN),ye(this,"unbounded",this),ye(this,"isUnbounded",!0)}add(){return this}fork(){return this}},S1=new E1,nt=class jc{constructor(){ye(this,"size",0),ye(this,"unbounded",S1),ye(this,"isUnbounded",!1)}add(t){return this.size+=t,this}fork(){const t=new jc;return t.size=this.size,t}},ot=Symbol("The biggest (in amount of bytes needed) value a schema can represent"),Tt=class{constructor(){ye(this,"__unwrapped")}resolveReferences(e){}seekProperty(e,t){return null}},P1=class{constructor(e){this.key=e}},Os={STRING:"string",ENUM:"enum"},U1=class extends Tt{constructor(e,t){super(),this._unstableElementSchema=e,this.length=t,ye(this,"elementSchema"),this.elementSchema=e}resolveReferences(e){this.elementSchema=e.resolve(this._unstableElementSchema)}write(e,t){if(t.length!==this.length)throw new la(`Expected array of length ${this.length}, got ${t.length}`);for(const n of t)this.elementSchema.write(e,n)}read(e){const t=[];for(let n=0;n<this.length;++n)t.push(this.elementSchema.read(e));return t}get maxSize(){return this.elementSchema.measure(ot).size*this.length}measure(e,t=new nt){for(let n=0;n<this.length;++n)this.elementSchema.measure(e===ot?ot:e[n],t);return t}};function A1(e,t){return new U1(e,t)}var I1=class extends Tt{constructor(){super(...arguments),ye(this,"maxSize",1)}read(e){return e.readBool()}write(e,t){e.writeBool(t)}measure(e,t=new nt){return t.add(1)}},B1=new I1,Yc=class Ms extends Tt{static get _encoder(){return Ms._cachedEncoder||(Ms._cachedEncoder=new TextEncoder),Ms._cachedEncoder}read(t){return t.readString()}write(t,n){t.writeString(n)}measure(t,n=new nt){if(t===ot)return n.unbounded;const r=Ms._encoder.encode(t);return n.add(r.byteLength+1)}};ye(Yc,"_cachedEncoder");var k1=Yc,O1=new k1,V1=class extends Tt{constructor(){super(...arguments),ye(this,"maxSize",1)}read(e){return e.readInt8()}write(e,t){e.writeInt8(t)}measure(e,t=new nt){return t.add(1)}},G1=new V1,D1=class extends Tt{constructor(){super(...arguments),ye(this,"maxSize",1)}read(e){return e.readUint8()}write(e,t){e.writeUint8(t)}measure(e,t=new nt){return t.add(1)}},Cc=new D1,R1=Cc,N1=class extends Tt{constructor(){super(...arguments),ye(this,"maxSize",2)}read(e){return e.readInt16()}write(e,t){e.writeInt16(t)}measure(e,t=new nt){return t.add(2)}},F1=new N1,L1=class extends Tt{constructor(){super(...arguments),ye(this,"maxSize",2)}read(e){return e.readUint16()}write(e,t){e.writeUint16(t)}measure(e,t=new nt){return t.add(2)}},j1=new L1,Y1=class extends Tt{constructor(){super(...arguments),ye(this,"maxSize",4)}read(e){return e.readInt32()}write(e,t){e.writeInt32(t)}measure(e,t=new nt){return t.add(4)}},C1=new Y1,q1=class extends Tt{constructor(){super(...arguments),ye(this,"maxSize",4)}read(e){return e.readUint32()}write(e,t){e.writeUint32(t)}measure(e,t=new nt){return t.add(4)}},W1=new q1,X1=class extends Tt{constructor(){super(...arguments),ye(this,"maxSize",2)}read(e){return e.readFloat16()}write(e,t){e.writeFloat16(t)}measure(e,t=new nt){return t.add(2)}},J1=new X1,Z1=class extends Tt{constructor(){super(...arguments),ye(this,"maxSize",4)}read(e){return e.readFloat32()}write(e,t){e.writeFloat32(t)}measure(e,t=new nt){return t.add(4)}},H1=new Z1,Q1=class extends Tt{constructor(e){super(),this.length=e}write(e,t){if(t.length!==this.length)throw new la(`Expected char-string of length ${this.length}, got ${t.length}`);for(let n=0;n<t.length;++n)e.writeUint8(t.charCodeAt(n))}read(e){let t="";for(let n=0;n<this.length;++n)t+=String.fromCharCode(e.readByte());return t}measure(e,t=new nt){return t.add(this.length)}};function K1(e){return new Q1(e)}function cr(e){return Object.entries(e)}function qc(e,t){const n={};for(const[r,s]of cr(t))n[r]=e.resolve(s);return n}var Ro=class extends Tt{constructor(e){super(),this._properties=e,ye(this,"properties"),this.properties=e}resolveReferences(e){this.properties=qc(e,this._properties)}write(e,t){for(const[n,r]of cr(this.properties))r.write(e,t[n])}read(e){const t={};for(const[n,r]of cr(this.properties))t[n]=r.read(e);return t}get maxSize(){const e=new nt;for(const t of Object.values(this.properties))t.measure(ot,e);return e.size}measure(e,t=new nt){for(const[n,r]of cr(this.properties))r.measure(e===ot?ot:e[n],t);return t}seekProperty(e,t){let n=0;for(const[r,s]of cr(this.properties)){if(r===t)return{bufferOffset:n,schema:s};n+=s.measure(e).size}return null}};function ey(e){return new Ro(e)}var Wc=class extends Tt{constructor(e,t,n){super(),this.keyedBy=e,this._subTypeMap=n,ye(this,"_baseObject"),ye(this,"subTypeMap"),this._baseObject=new Ro(t),this.subTypeMap=n}resolveReferences(e){this._baseObject.resolveReferences(e),this.subTypeMap=qc(e,this._subTypeMap)}write(e,t){const n=t.type,r=this.subTypeMap[n]||null;if(r===null)throw new Error(`Unknown sub-type '${n.toString()}' in among '${JSON.stringify(Object.keys(this.subTypeMap))}'`);this.keyedBy===Os.ENUM?e.writeUint8(t.type):e.writeString(t.type),this._baseObject.write(e,t);for(const[s,i]of cr(r.properties))i.write(e,t[s])}read(e){const t=this.keyedBy===Os.ENUM?e.readByte():e.readString(),n=this.subTypeMap[t]||null;if(n===null)throw new Error(`Unknown sub-type '${t}' in among '${JSON.stringify(Object.keys(this.subTypeMap))}'`);const r=this._baseObject.read(e);if(r.type=t,n!==null)for(const[s,i]of cr(n.properties))r[s]=i.read(e);return r}measure(e,t=new nt){if(this._baseObject.measure(e,t),this.keyedBy===Os.ENUM)t.add(1);else if(e!==ot)t.add(e.type.length+1);else return t.unbounded;if(e===ot){const n=Object.values(this.subTypeMap).map(r=>{const s=t.fork();for(const i of Object.values(r.properties))i.measure(ot,s);return[r,s.size]}).reduce((r,s)=>r[1]>s[1]?r:s)[0];for(const r of Object.values(n.properties))r.measure(ot,t)}else{const n=e.type,r=this.subTypeMap[n]||null;if(r===null)throw new Error(`Unknown sub-type '${n.toString()}', expected one of '${JSON.stringify(Object.keys(this.subTypeMap))}'`);for(const[s,i]of cr(r.properties))i.measure(e[s],t)}return t}};function ty(e,t){return new Wc(Os.STRING,e,t)}function ny(e,t){return new Wc(Os.ENUM,e,t)}function ry(e){return new Ro(Object.fromEntries(e.flatMap(({properties:t})=>Object.entries(t))))}var sy=class extends Tt{constructor(e){super(),this._unstableElementType=e,ye(this,"elementType"),this.elementType=e}resolveReferences(e){this.elementType=e.resolve(this._unstableElementType)}write(e,t){e.writeUint32(t.length);for(const n of t)this.elementType.write(e,n)}read(e){const t=[],n=e.readUint32();for(let r=0;r<n;++r)t.push(this.elementType.read(e));return t}get maxSize(){return this.measure(ot).size}measure(e,t=new nt){if(e===ot)return t.unbounded;t.add(4);for(const n of e)this.elementType.measure(n,t);return t}seekProperty(e,t){if(typeof t=="symbol")return null;const n=Number.parseInt(String(t),10);if(Number.isNaN(n))return null;if(e===ot)return{bufferOffset:this.elementType.measure(ot).size*n,schema:this.elementType};if(n>=e.length)return null;const r=new nt;for(let s=0;s<n;++s)this.elementType.measure(e[s],r);return{bufferOffset:r.size,schema:this.elementType}}};function iy(e){return new sy(e)}var Xc=class{constructor(e){ye(this,"__unwrapped"),ye(this,"ref"),this.ref=new P1(e)}resolveReferences(){throw new Sr("Tried to resolve a reference directly. Do it through a RefResolver instead.")}read(){throw new Sr("Tried to read a reference directly. Resolve it instead.")}write(){throw new Sr("Tried to write a reference directly. Resolve it instead.")}measure(){throw new Sr("Tried to measure size of a reference directly. Resolve it instead.")}seekProperty(){throw new Sr("Tried to seek property of a reference directly. Resolve it instead.")}},ay=class{constructor(){ye(this,"registry",{})}hasKey(e){return this.registry[e]!==void 0}register(e,t){this.registry[e]=t}resolve(e){if(e instanceof Xc){const n=e.ref.key;if(this.registry[n]!==void 0)return this.registry[n];throw new Sr(`Couldn't resolve reference to ${n}. Unknown key.`)}return e.resolveReferences(this),e}},oy=class{constructor(e,t){this.key=e,ye(this,"__unwrapped"),ye(this,"__keyDefinition"),ye(this,"innerType"),this.innerType=t(new Xc(e)),this.resolveReferences(new ay)}resolveReferences(e){e.hasKey(this.key)||(e.register(this.key,this.innerType),this.innerType.resolveReferences(e))}read(e){return this.innerType.read(e)}write(e,t){this.innerType.write(e,t)}get maxSize(){return this.measure(ot).size}measure(e,t=new nt){return this.innerType.measure(e,t)}seekProperty(e,t){return this.innerType.seekProperty(e,t)}};function uy(e,t){return new oy(e,t)}var ly=class extends Tt{constructor(e){super(),this._innerUnstableSchema=e,ye(this,"innerSchema"),this.innerSchema=e}resolveReferences(e){this.innerSchema=e.resolve(this._innerUnstableSchema)}write(e,t){t!=null?(e.writeBool(!0),this.innerSchema.write(e,t)):e.writeBool(!1)}read(e){if(e.readBool())return this.innerSchema.read(e)}get maxSize(){return this.measure(ot).size}measure(e,t=new nt){return e!==void 0&&this.innerSchema.measure(e,t),t.add(1)}};function cy(e){return new ly(e)}function hy(e,t){return t.map(n=>e.resolve(n))}var py=class extends Tt{constructor(e){super(),this._unstableSchemas=e,ye(this,"schemas"),this.schemas=e}resolveReferences(e){this.schemas=hy(e,this._unstableSchemas)}write(e,t){if(t.length!==this.schemas.length)throw new la(`Expected tuple of length ${this.schemas.length}, got ${t.length}`);for(let n=0;n<this.schemas.length;++n)this.schemas[n].write(e,t[n])}read(e){const t=[];for(let n=0;n<this.schemas.length;++n)t.push(this.schemas[n].read(e));return t}get maxSize(){return this.measure(ot).size}measure(e,t=new nt){for(let n=0;n<this.schemas.length;++n)this.schemas[n].measure(e===ot?ot:e[n],t);return t}};function dy(e){return new py(e)}var or=class extends Tt{constructor(e,t){super(),this.length=e,this._arrayConstructor=t,ye(this,"byteLength"),this.byteLength=e*t.BYTES_PER_ELEMENT}write(e,t){e.writeSlice(t)}read(e){const t=new ArrayBuffer(this.byteLength),n=new this._arrayConstructor(t,0,this.length);return e.readSlice(n,0,this.byteLength),n}measure(e,t=new nt){return t.add(this.byteLength)}},fy=e=>new or(e,Uint8Array),my=e=>new or(e,Uint8ClampedArray),yy=e=>new or(e,Uint16Array),gy=e=>new or(e,Uint32Array),wy=e=>new or(e,Int8Array),xy=e=>new or(e,Int16Array),vy=e=>new or(e,Int32Array),by=e=>new or(e,Float32Array),Ty=e=>new or(e,Float64Array);function _y(){const e=new Uint8Array(4),t=new Uint32Array(e.buffer);return t[0]=1,e[0]===0}function Jc(){return _y()?"big":"little"}function No(e){let t=0,n=e;return n&&"buffer"in n&&"byteOffset"in n&&(t+=n.byteOffset,n=n.buffer),{buffer:n,byteOffset:t,byteLength:e.byteLength}}var Zc=class{constructor(e,t){ye(this,"dataView"),ye(this,"littleEndian"),ye(this,"byteOffset",0),ye(this,"endianness");const{byteOffset:n=0,endianness:r="system"}=t??{};this.byteOffset=n;const s=Jc();this.endianness=r==="system"?s:r,this.littleEndian=this.endianness==="little";const i=No(e);this.byteOffset+=i.byteOffset,this.dataView=new DataView(i.buffer)}get currentByteOffset(){return this.byteOffset}seekTo(e){this.byteOffset=e}skipBytes(e){this.byteOffset+=e}};function $y(e){if(e===0)return 0;if(Number.isNaN(e))return 32256;if(!Number.isFinite(e))return e>0?31744:64512;const t=e<0?1:0,n=Math.abs(e),r=Math.floor(Math.log2(n)),s=n/2**r-1,i=r+15,p=Math.floor(s*1024);return t<<15|i<<10|p}function My(e){const t=(e&32768)>>15,n=(e&31744)>>10,r=e&1023;return n===0?t===0?r/1024:-r/1024:n===31?r===0?t===0?Number.POSITIVE_INFINITY:Number.NEGATIVE_INFINITY:Number.NaN:(t===0?1:-1)*(1+r/1024)*2**(n-15)}var hr=class extends Zc{constructor(){super(...arguments),ye(this,"_cachedTextDecoder")}get _textDecoder(){return this._cachedTextDecoder||(this._cachedTextDecoder=new TextDecoder(void 0,{fatal:!0})),this._cachedTextDecoder}readBool(){return this.dataView.getUint8(this.byteOffset++)!==0}readByte(){return this.dataView.getUint8(this.byteOffset++)}readInt8(){return this.dataView.getInt8(this.byteOffset++)}readUint8(){return this.dataView.getUint8(this.byteOffset++)}readInt16(){const e=this.dataView.getInt16(this.byteOffset,this.littleEndian);return this.byteOffset+=2,e}readUint16(){const e=this.dataView.getUint16(this.byteOffset,this.littleEndian);return this.byteOffset+=2,e}readInt32(){const e=this.dataView.getInt32(this.byteOffset,this.littleEndian);return this.byteOffset+=4,e}readUint32(){const e=this.dataView.getUint32(this.byteOffset,this.littleEndian);return this.byteOffset+=4,e}readFloat16(){const e=this.dataView.getUint16(this.byteOffset,this.littleEndian);return this.byteOffset+=2,My(e)}readFloat32(){const e=this.dataView.getFloat32(this.byteOffset,this.littleEndian);return this.byteOffset+=4,e}readString(){let e=0;for(;this.byteOffset+e<this.dataView.byteLength&&this.dataView.getUint8(this.byteOffset+e++)!==0;);const t=this._textDecoder.decode(new Uint8Array(this.dataView.buffer,this.byteOffset,e-1));return this.byteOffset+=e,t}readSlice(e,t,n){const r=No(e),s=new Uint8Array(r.buffer,r.byteOffset+t);for(let i=0;i<n;++i)s[i]=this.dataView.getUint8(this.byteOffset++)}},Nr=class extends Zc{constructor(){super(...arguments),ye(this,"_cachedTextEncoder")}get _textEncoder(){return this._cachedTextEncoder||(this._cachedTextEncoder=new TextEncoder),this._cachedTextEncoder}writeBool(e){this.dataView.setUint8(this.byteOffset++,e?1:0)}writeByte(e){this.dataView.setUint8(this.byteOffset++,e)}writeInt8(e){this.dataView.setInt8(this.byteOffset++,e)}writeUint8(e){this.dataView.setUint8(this.byteOffset++,e)}writeInt16(e){this.dataView.setInt16(this.byteOffset,e,this.littleEndian),this.byteOffset+=2}writeUint16(e){this.dataView.setUint16(this.byteOffset,e,this.littleEndian),this.byteOffset+=2}writeInt32(e){this.dataView.setInt32(this.byteOffset,e,this.littleEndian),this.byteOffset+=4}writeUint32(e){this.dataView.setUint32(this.byteOffset,e,this.littleEndian),this.byteOffset+=4}writeFloat16(e){this.dataView.setUint16(this.byteOffset,$y(e),this.littleEndian),this.byteOffset+=2}writeFloat32(e){this.dataView.setFloat32(this.byteOffset,e,this.littleEndian),this.byteOffset+=4}writeString(e){const t=this._textEncoder.encodeInto(e,new Uint8Array(this.dataView.buffer,this.byteOffset));this.byteOffset+=t.written,this.dataView.setUint8(this.byteOffset++,0)}writeSlice(e){const t=No(e),n=new Uint8Array(t.buffer,t.byteOffset,t.byteLength);for(const r of n)this.dataView.setUint8(this.byteOffset++,r)}},Hc=G({name:"bitcastU32toF32",normalImpl:(e=>typeof e=="number"?Vn(e):ee.bitcastU32toF32[e.kind](e)),codegenImpl:e=>S`bitcast<f32>(${e})`,signature:(...e)=>{let t=ct(e,[J])??e;return{argTypes:t,returnType:nr(t[0])?t[0].type==="vec2u"?F:t[0].type==="vec3u"?O:k:$}}}),Qc=G({name:"bitcastU32toI32",normalImpl:(e=>typeof e=="number"?Gn(e):ee.bitcastU32toI32[e.kind](e)),codegenImpl:e=>S`bitcast<i32>(${e})`,signature:(...e)=>{let t=ct(e,[J])??e;return{argTypes:t,returnType:nr(t[0])?t[0].type==="vec2u"?Be:t[0].type==="vec3u"?Ot:Fe:Ue}}}),Kc=ce(e=>{let t=new ArrayBuffer(4);new Nr(t).writeUint32(e);let n=new hr(t);return F(n.readFloat16(),n.readFloat16())},e=>B(S`unpack2x16float(${e})`,F),"unpack2x16float"),zy=ce(e=>{let t=new ArrayBuffer(4),n=new Nr(t);n.writeFloat16(e.x),n.writeFloat16(e.y);let r=new hr(t);return J(r.readUint32())},e=>B(S`pack2x16float(${e})`,J),"pack2x16float"),Ey=ce(e=>{let t=new ArrayBuffer(4);new Nr(t).writeUint32(e);let n=new hr(t);return k(n.readUint8()/255,n.readUint8()/255,n.readUint8()/255,n.readUint8()/255)},e=>B(S`unpack4x8unorm(${e})`,k),"unpack4x8unorm"),Sy=ce(e=>{let t=new ArrayBuffer(4),n=new Nr(t);n.writeUint8(e.x*255),n.writeUint8(e.y*255),n.writeUint8(e.z*255),n.writeUint8(e.w*255);let r=new hr(t);return J(r.readUint32())},e=>B(S`pack4x8unorm(${e})`,J),"pack4x8unorm");function gs(e){return e.type.includes("2")?vr:e.type.includes("3")?br:Tr}var eh=G({name:"allEq",signature:(...e)=>({argTypes:e,returnType:ke}),normalImpl:(e,t)=>Lo(ri(e,t)),codegenImpl:(e,t)=>S`all(${e} == ${t})`}),ri=(e,t)=>ee.eq[e.kind](e,t),Py=G({name:"eq",signature:(...e)=>({argTypes:e,returnType:gs(e[0])}),normalImpl:ri,codegenImpl:(e,t)=>S`(${e} == ${t})`}),Uy=G({name:"ne",signature:(...e)=>({argTypes:e,returnType:gs(e[0])}),normalImpl:(e,t)=>tr(ri(e,t)),codegenImpl:(e,t)=>S`(${e} != ${t})`}),ca=(e,t)=>ee.lt[e.kind](e,t),Ay=G({name:"lt",signature:(...e)=>({argTypes:e,returnType:gs(e[0])}),normalImpl:ca,codegenImpl:(e,t)=>S`(${e} < ${t})`}),Iy=G({name:"le",signature:(...e)=>({argTypes:e,returnType:gs(e[0])}),normalImpl:(e,t)=>Fo(ca(e,t),ri(e,t)),codegenImpl:(e,t)=>S`(${e} <= ${t})`}),By=G({name:"gt",signature:(...e)=>({argTypes:e,returnType:gs(e[0])}),normalImpl:(e,t)=>th(tr(ca(e,t)),tr(ri(e,t))),codegenImpl:(e,t)=>S`(${e} > ${t})`}),ky=G({name:"ge",signature:(...e)=>({argTypes:e,returnType:gs(e[0])}),normalImpl:(e,t)=>tr(ca(e,t)),codegenImpl:(e,t)=>S`(${e} >= ${t})`}),tr=e=>ee.neg[e.kind](e),Oy=G({name:"not",signature:(...e)=>({argTypes:e,returnType:e[0]}),normalImpl:tr,codegenImpl:e=>S`!(${e})`}),Fo=(e,t)=>ee.or[e.kind](e,t),Vy=G({name:"or",signature:(...e)=>({argTypes:e,returnType:e[0]}),normalImpl:Fo,codegenImpl:(e,t)=>S`(${e} | ${t})`}),th=(e,t)=>tr(Fo(tr(e),tr(t))),Gy=G({name:"and",signature:(...e)=>({argTypes:e,returnType:e[0]}),normalImpl:th,codegenImpl:(e,t)=>S`(${e} & ${t})`}),Lo=e=>ee.all[e.kind](e),Dy=G({name:"all",signature:(...e)=>({argTypes:e,returnType:ke}),normalImpl:Lo,codegenImpl:e=>S`all(${e})`}),Ry=G({name:"any",signature:(...e)=>({argTypes:e,returnType:ke}),normalImpl:e=>!Lo(tr(e)),codegenImpl:e=>S`any(${e})`}),Ny=G({name:"isCloseTo",signature:(...e)=>({argTypes:e,returnType:ke}),normalImpl:(e,t,n=.01)=>typeof e=="number"&&typeof t=="number"?Math.abs(e-t)<n:Je(e)&&Je(t)?ee.isCloseToZero[e.kind](K[E].jsImpl(e,t),n):!1,codegenImpl:(e,t,n=B(.01,$))=>di(e)&&di(t)?S`(abs(f32(${e}) - f32(${t})) <= ${n})`:!di(e)&&!di(t)?S`all(abs(${e} - ${t}) <= (${e} - ${e}) + ${n})`:"false"});function Fy(e,t,n){return typeof n=="boolean"?n?t:e:ee.select[e.kind](e,t,n)}var Ys=G({name:"select",signature:(e,t,n)=>{let[r,s]=ct([e,t])??[e,t];return{argTypes:[r,s,n],returnType:r}},normalImpl:Fy,codegenImpl:(e,t,n)=>S`select(${e}, ${t}, ${n})`}),ws={r8unorm:{channelType:$,vectorType:k,texelSize:1,sampleTypes:["float","unfilterable-float"],aspects:["color"],canRenderAttachment:!0,canBlend:!0,canMultisample:!0,canResolve:!0,storageBindings:["write-only","read-only","read-write"]},r8snorm:{channelType:$,vectorType:k,texelSize:1,sampleTypes:["float","unfilterable-float"],aspects:["color"],canRenderAttachment:!1,canBlend:!1,canMultisample:!1,canResolve:!1,storageBindings:["write-only","read-only"]},r8uint:{channelType:J,vectorType:Ye,texelSize:1,sampleTypes:["uint"],aspects:["color"],canRenderAttachment:!0,canBlend:!1,canMultisample:!0,canResolve:!1,storageBindings:["write-only","read-only","read-write"]},r8sint:{channelType:Ue,vectorType:Fe,texelSize:1,sampleTypes:["sint"],aspects:["color"],canRenderAttachment:!0,canBlend:!1,canMultisample:!0,canResolve:!1,storageBindings:["write-only","read-only","read-write"]},rg8unorm:{channelType:$,vectorType:k,texelSize:2,sampleTypes:["float","unfilterable-float"],aspects:["color"],canRenderAttachment:!0,canBlend:!0,canMultisample:!0,canResolve:!0,storageBindings:["write-only","read-only"]},rg8snorm:{channelType:$,vectorType:k,texelSize:2,sampleTypes:["float","unfilterable-float"],aspects:["color"],canRenderAttachment:!1,canBlend:!1,canMultisample:!1,canResolve:!1,storageBindings:["write-only","read-only"]},rg8uint:{channelType:J,vectorType:Ye,texelSize:2,sampleTypes:["uint"],aspects:["color"],canRenderAttachment:!0,canBlend:!1,canMultisample:!0,canResolve:!1,storageBindings:["write-only","read-only"]},rg8sint:{channelType:Ue,vectorType:Fe,texelSize:2,sampleTypes:["sint"],aspects:["color"],canRenderAttachment:!0,canBlend:!1,canMultisample:!0,canResolve:!1,storageBindings:["write-only","read-only"]},rgba8unorm:{channelType:$,vectorType:k,texelSize:4,sampleTypes:["float","unfilterable-float"],aspects:["color"],canRenderAttachment:!0,canBlend:!0,canMultisample:!0,canResolve:!0,storageBindings:["write-only","read-only","read-write"]},"rgba8unorm-srgb":{channelType:$,vectorType:k,texelSize:4,sampleTypes:["float","unfilterable-float"],aspects:["color"],canRenderAttachment:!0,canBlend:!0,canMultisample:!0,canResolve:!0,storageBindings:null},rgba8snorm:{channelType:$,vectorType:k,texelSize:4,sampleTypes:["float","unfilterable-float"],aspects:["color"],canRenderAttachment:!0,canBlend:!1,canMultisample:!0,canResolve:!1,storageBindings:["write-only","read-only"]},rgba8uint:{channelType:J,vectorType:Ye,texelSize:4,sampleTypes:["uint"],aspects:["color"],canRenderAttachment:!0,canBlend:!1,canMultisample:!0,canResolve:!1,storageBindings:["write-only","read-only","read-write"]},rgba8sint:{channelType:Ue,vectorType:Fe,texelSize:4,sampleTypes:["sint"],aspects:["color"],canRenderAttachment:!0,canBlend:!1,canMultisample:!0,canResolve:!1,storageBindings:["write-only","read-only","read-write"]},bgra8unorm:{channelType:$,vectorType:k,texelSize:4,sampleTypes:["float","unfilterable-float"],aspects:["color"],canRenderAttachment:!0,canBlend:!0,canMultisample:!0,canResolve:!0,storageBindings:["write-only"]},"bgra8unorm-srgb":{channelType:$,vectorType:k,texelSize:4,sampleTypes:["float","unfilterable-float"],aspects:["color"],canRenderAttachment:!0,canBlend:!0,canMultisample:!0,canResolve:!0,storageBindings:null},r16unorm:{channelType:$,vectorType:k,texelSize:2,sampleTypes:["unfilterable-float"],aspects:["color"],canRenderAttachment:!0,canBlend:!0,canMultisample:!0,canResolve:!1,storageBindings:["write-only","read-only"]},r16snorm:{channelType:$,vectorType:k,texelSize:2,sampleTypes:["unfilterable-float"],aspects:["color"],canRenderAttachment:!0,canBlend:!0,canMultisample:!0,canResolve:!1,storageBindings:["write-only","read-only"]},r16uint:{channelType:J,vectorType:Ye,texelSize:2,sampleTypes:["uint"],aspects:["color"],canRenderAttachment:!0,canBlend:!1,canMultisample:!0,canResolve:!1,storageBindings:["write-only","read-only","read-write"]},r16sint:{channelType:Ue,vectorType:Fe,texelSize:2,sampleTypes:["sint"],aspects:["color"],canRenderAttachment:!0,canBlend:!1,canMultisample:!0,canResolve:!1,storageBindings:["write-only","read-only","read-write"]},r16float:{channelType:$,vectorType:k,texelSize:2,sampleTypes:["float","unfilterable-float"],aspects:["color"],canRenderAttachment:!0,canBlend:!0,canMultisample:!0,canResolve:!0,storageBindings:["write-only","read-only","read-write"]},rg16unorm:{channelType:$,vectorType:k,texelSize:4,sampleTypes:["unfilterable-float"],aspects:["color"],canRenderAttachment:!0,canBlend:!0,canMultisample:!0,canResolve:!1,storageBindings:["write-only","read-only"]},rg16snorm:{channelType:$,vectorType:k,texelSize:4,sampleTypes:["unfilterable-float"],aspects:["color"],canRenderAttachment:!0,canBlend:!0,canMultisample:!0,canResolve:!1,storageBindings:["write-only","read-only"]},rg16uint:{channelType:J,vectorType:Ye,texelSize:4,sampleTypes:["uint"],aspects:["color"],canRenderAttachment:!0,canBlend:!1,canMultisample:!0,canResolve:!1,storageBindings:["write-only","read-only"]},rg16sint:{channelType:Ue,vectorType:Fe,texelSize:4,sampleTypes:["sint"],aspects:["color"],canRenderAttachment:!0,canBlend:!1,canMultisample:!0,canResolve:!1,storageBindings:["write-only","read-only"]},rg16float:{channelType:$,vectorType:k,texelSize:4,sampleTypes:["float","unfilterable-float"],aspects:["color"],canRenderAttachment:!0,canBlend:!0,canMultisample:!0,canResolve:!0,storageBindings:["write-only","read-only"]},rgba16unorm:{channelType:$,vectorType:k,texelSize:8,sampleTypes:["unfilterable-float"],aspects:["color"],canRenderAttachment:!0,canBlend:!0,canMultisample:!0,canResolve:!1,storageBindings:["write-only","read-only"]},rgba16snorm:{channelType:$,vectorType:k,texelSize:8,sampleTypes:["unfilterable-float"],aspects:["color"],canRenderAttachment:!0,canBlend:!0,canMultisample:!0,canResolve:!1,storageBindings:["write-only","read-only"]},rgba16uint:{channelType:J,vectorType:Ye,texelSize:8,sampleTypes:["uint"],aspects:["color"],canRenderAttachment:!0,canBlend:!1,canMultisample:!0,canResolve:!1,storageBindings:["write-only","read-only","read-write"]},rgba16sint:{channelType:Ue,vectorType:Fe,texelSize:8,sampleTypes:["sint"],aspects:["color"],canRenderAttachment:!0,canBlend:!1,canMultisample:!0,canResolve:!1,storageBindings:["write-only","read-only","read-write"]},rgba16float:{channelType:$,vectorType:k,texelSize:8,sampleTypes:["float","unfilterable-float"],aspects:["color"],canRenderAttachment:!0,canBlend:!0,canMultisample:!0,canResolve:!0,storageBindings:["write-only","read-only","read-write"]},r32uint:{channelType:J,vectorType:Ye,texelSize:4,sampleTypes:["uint"],aspects:["color"],canRenderAttachment:!0,canBlend:!1,canMultisample:!1,canResolve:!1,storageBindings:["write-only","read-only","read-write"]},r32sint:{channelType:Ue,vectorType:Fe,texelSize:4,sampleTypes:["sint"],aspects:["color"],canRenderAttachment:!0,canBlend:!1,canMultisample:!1,canResolve:!1,storageBindings:["write-only","read-only","read-write"]},r32float:{channelType:$,vectorType:k,texelSize:4,sampleTypes:["float","unfilterable-float"],aspects:["color"],canRenderAttachment:!0,canBlend:!0,canMultisample:!0,canResolve:!1,storageBindings:["write-only","read-only","read-write"]},rg32uint:{channelType:J,vectorType:Ye,texelSize:8,sampleTypes:["uint"],aspects:["color"],canRenderAttachment:!0,canBlend:!1,canMultisample:!1,canResolve:!1,storageBindings:["write-only","read-only"]},rg32sint:{channelType:Ue,vectorType:Fe,texelSize:8,sampleTypes:["sint"],aspects:["color"],canRenderAttachment:!0,canBlend:!1,canMultisample:!1,canResolve:!1,storageBindings:["write-only","read-only"]},rg32float:{channelType:$,vectorType:k,texelSize:8,sampleTypes:["float","unfilterable-float"],aspects:["color"],canRenderAttachment:!0,canBlend:!0,canMultisample:!1,canResolve:!1,storageBindings:["write-only","read-only","read-write"]},rgba32uint:{channelType:J,vectorType:Ye,texelSize:16,sampleTypes:["uint"],aspects:["color"],canRenderAttachment:!0,canBlend:!1,canMultisample:!1,canResolve:!1,storageBindings:["write-only","read-only","read-write"]},rgba32sint:{channelType:Ue,vectorType:Fe,texelSize:16,sampleTypes:["sint"],aspects:["color"],canRenderAttachment:!0,canBlend:!1,canMultisample:!1,canResolve:!1,storageBindings:["write-only","read-only","read-write"]},rgba32float:{channelType:$,vectorType:k,texelSize:16,sampleTypes:["float","unfilterable-float"],aspects:["color"],canRenderAttachment:!0,canBlend:!0,canMultisample:!1,canResolve:!1,storageBindings:["write-only","read-only","read-write"]},rgb10a2uint:{channelType:J,vectorType:Ye,texelSize:4,sampleTypes:["uint"],aspects:["color"],canRenderAttachment:!0,canBlend:!1,canMultisample:!0,canResolve:!1,storageBindings:["write-only","read-only"]},rgb10a2unorm:{channelType:$,vectorType:k,texelSize:4,sampleTypes:["float","unfilterable-float"],aspects:["color"],canRenderAttachment:!0,canBlend:!0,canMultisample:!0,canResolve:!0,storageBindings:["write-only","read-only"]},rg11b10ufloat:{channelType:$,vectorType:k,texelSize:4,sampleTypes:["float","unfilterable-float"],aspects:["color"],canRenderAttachment:!0,canBlend:!0,canMultisample:!0,canResolve:!0,storageBindings:["write-only","read-only"]},rgb9e5ufloat:{channelType:$,vectorType:k,texelSize:4,sampleTypes:["float","unfilterable-float"],aspects:["color"],canRenderAttachment:!1,canBlend:!1,canMultisample:!1,canResolve:!1,storageBindings:null},stencil8:{channelType:J,vectorType:Ye,texelSize:1,sampleTypes:["uint"],aspects:["stencil"],canRenderAttachment:!0,canBlend:!1,canMultisample:!0,canResolve:!1,storageBindings:null},depth16unorm:{channelType:$,vectorType:k,texelSize:2,sampleTypes:["depth","unfilterable-float"],aspects:["depth"],canRenderAttachment:!0,canBlend:!1,canMultisample:!0,canResolve:!1,storageBindings:null},depth24plus:{channelType:$,vectorType:k,texelSize:4,sampleTypes:["depth","unfilterable-float"],aspects:["depth"],canRenderAttachment:!0,canBlend:!1,canMultisample:!0,canResolve:!1,storageBindings:null},"depth24plus-stencil8":{channelType:$,vectorType:k,texelSize:4,sampleTypes:["depth","unfilterable-float"],aspects:["depth","stencil"],canRenderAttachment:!0,canBlend:!1,canMultisample:!0,canResolve:!1,storageBindings:null},depth32float:{channelType:$,vectorType:k,texelSize:4,sampleTypes:["depth","unfilterable-float"],aspects:["depth"],canRenderAttachment:!0,canBlend:!1,canMultisample:!0,canResolve:!1,storageBindings:null},"depth32float-stencil8":{channelType:$,vectorType:k,texelSize:4,sampleTypes:["depth","unfilterable-float"],aspects:["depth","stencil"],canRenderAttachment:!0,canBlend:!1,canMultisample:!0,canResolve:!1,storageBindings:null},"bc1-rgba-unorm":{channelType:$,vectorType:k,texelSize:8,sampleTypes:["float","unfilterable-float"],aspects:["color"],canRenderAttachment:!1,canBlend:!1,canMultisample:!1,canResolve:!1,storageBindings:null},"bc1-rgba-unorm-srgb":{channelType:$,vectorType:k,texelSize:8,sampleTypes:["float","unfilterable-float"],aspects:["color"],canRenderAttachment:!1,canBlend:!1,canMultisample:!1,canResolve:!1,storageBindings:null},"bc2-rgba-unorm":{channelType:$,vectorType:k,texelSize:16,sampleTypes:["float","unfilterable-float"],aspects:["color"],canRenderAttachment:!1,canBlend:!1,canMultisample:!1,canResolve:!1,storageBindings:null},"bc2-rgba-unorm-srgb":{channelType:$,vectorType:k,texelSize:16,sampleTypes:["float","unfilterable-float"],aspects:["color"],canRenderAttachment:!1,canBlend:!1,canMultisample:!1,canResolve:!1,storageBindings:null},"bc3-rgba-unorm":{channelType:$,vectorType:k,texelSize:16,sampleTypes:["float","unfilterable-float"],aspects:["color"],canRenderAttachment:!1,canBlend:!1,canMultisample:!1,canResolve:!1,storageBindings:null},"bc3-rgba-unorm-srgb":{channelType:$,vectorType:k,texelSize:16,sampleTypes:["float","unfilterable-float"],aspects:["color"],canRenderAttachment:!1,canBlend:!1,canMultisample:!1,canResolve:!1,storageBindings:null},"bc4-r-unorm":{channelType:$,vectorType:k,texelSize:8,sampleTypes:["float","unfilterable-float"],aspects:["color"],canRenderAttachment:!1,canBlend:!1,canMultisample:!1,canResolve:!1,storageBindings:null},"bc4-r-snorm":{channelType:$,vectorType:k,texelSize:8,sampleTypes:["float","unfilterable-float"],aspects:["color"],canRenderAttachment:!1,canBlend:!1,canMultisample:!1,canResolve:!1,storageBindings:null},"bc5-rg-unorm":{channelType:$,vectorType:k,texelSize:16,sampleTypes:["float","unfilterable-float"],aspects:["color"],canRenderAttachment:!1,canBlend:!1,canMultisample:!1,canResolve:!1,storageBindings:null},"bc5-rg-snorm":{channelType:$,vectorType:k,texelSize:16,sampleTypes:["float","unfilterable-float"],aspects:["color"],canRenderAttachment:!1,canBlend:!1,canMultisample:!1,canResolve:!1,storageBindings:null},"bc6h-rgb-ufloat":{channelType:$,vectorType:k,texelSize:16,sampleTypes:["float","unfilterable-float"],aspects:["color"],canRenderAttachment:!1,canBlend:!1,canMultisample:!1,canResolve:!1,storageBindings:null},"bc6h-rgb-float":{channelType:$,vectorType:k,texelSize:16,sampleTypes:["float","unfilterable-float"],aspects:["color"],canRenderAttachment:!1,canBlend:!1,canMultisample:!1,canResolve:!1,storageBindings:null},"bc7-rgba-unorm":{channelType:$,vectorType:k,texelSize:16,sampleTypes:["float","unfilterable-float"],aspects:["color"],canRenderAttachment:!1,canBlend:!1,canMultisample:!1,canResolve:!1,storageBindings:null},"bc7-rgba-unorm-srgb":{channelType:$,vectorType:k,texelSize:16,sampleTypes:["float","unfilterable-float"],aspects:["color"],canRenderAttachment:!1,canBlend:!1,canMultisample:!1,canResolve:!1,storageBindings:null},"etc2-rgb8unorm":{channelType:$,vectorType:k,texelSize:8,sampleTypes:["float","unfilterable-float"],aspects:["color"],canRenderAttachment:!1,canBlend:!1,canMultisample:!1,canResolve:!1,storageBindings:null},"etc2-rgb8unorm-srgb":{channelType:$,vectorType:k,texelSize:8,sampleTypes:["float","unfilterable-float"],aspects:["color"],canRenderAttachment:!1,canBlend:!1,canMultisample:!1,canResolve:!1,storageBindings:null},"etc2-rgb8a1unorm":{channelType:$,vectorType:k,texelSize:8,sampleTypes:["float","unfilterable-float"],aspects:["color"],canRenderAttachment:!1,canBlend:!1,canMultisample:!1,canResolve:!1,storageBindings:null},"etc2-rgb8a1unorm-srgb":{channelType:$,vectorType:k,texelSize:8,sampleTypes:["float","unfilterable-float"],aspects:["color"],canRenderAttachment:!1,canBlend:!1,canMultisample:!1,canResolve:!1,storageBindings:null},"etc2-rgba8unorm":{channelType:$,vectorType:k,texelSize:16,sampleTypes:["float","unfilterable-float"],aspects:["color"],canRenderAttachment:!1,canBlend:!1,canMultisample:!1,canResolve:!1,storageBindings:null},"etc2-rgba8unorm-srgb":{channelType:$,vectorType:k,texelSize:16,sampleTypes:["float","unfilterable-float"],aspects:["color"],canRenderAttachment:!1,canBlend:!1,canMultisample:!1,canResolve:!1,storageBindings:null},"eac-r11unorm":{channelType:$,vectorType:k,texelSize:8,sampleTypes:["float","unfilterable-float"],aspects:["color"],canRenderAttachment:!1,canBlend:!1,canMultisample:!1,canResolve:!1,storageBindings:null},"eac-r11snorm":{channelType:$,vectorType:k,texelSize:8,sampleTypes:["float","unfilterable-float"],aspects:["color"],canRenderAttachment:!1,canBlend:!1,canMultisample:!1,canResolve:!1,storageBindings:null},"eac-rg11unorm":{channelType:$,vectorType:k,texelSize:16,sampleTypes:["float","unfilterable-float"],aspects:["color"],canRenderAttachment:!1,canBlend:!1,canMultisample:!1,canResolve:!1,storageBindings:null},"eac-rg11snorm":{channelType:$,vectorType:k,texelSize:16,sampleTypes:["float","unfilterable-float"],aspects:["color"],canRenderAttachment:!1,canBlend:!1,canMultisample:!1,canResolve:!1,storageBindings:null},"astc-4x4-unorm":{channelType:$,vectorType:k,texelSize:16,sampleTypes:["float","unfilterable-float"],aspects:["color"],canRenderAttachment:!1,canBlend:!1,canMultisample:!1,canResolve:!1,storageBindings:null},"astc-4x4-unorm-srgb":{channelType:$,vectorType:k,texelSize:16,sampleTypes:["float","unfilterable-float"],aspects:["color"],canRenderAttachment:!1,canBlend:!1,canMultisample:!1,canResolve:!1,storageBindings:null},"astc-5x4-unorm":{channelType:$,vectorType:k,texelSize:16,sampleTypes:["float","unfilterable-float"],aspects:["color"],canRenderAttachment:!1,canBlend:!1,canMultisample:!1,canResolve:!1,storageBindings:null},"astc-5x4-unorm-srgb":{channelType:$,vectorType:k,texelSize:16,sampleTypes:["float","unfilterable-float"],aspects:["color"],canRenderAttachment:!1,canBlend:!1,canMultisample:!1,canResolve:!1,storageBindings:null},"astc-5x5-unorm":{channelType:$,vectorType:k,texelSize:16,sampleTypes:["float","unfilterable-float"],aspects:["color"],canRenderAttachment:!1,canBlend:!1,canMultisample:!1,canResolve:!1,storageBindings:null},"astc-5x5-unorm-srgb":{channelType:$,vectorType:k,texelSize:16,sampleTypes:["float","unfilterable-float"],aspects:["color"],canRenderAttachment:!1,canBlend:!1,canMultisample:!1,canResolve:!1,storageBindings:null},"astc-6x5-unorm":{channelType:$,vectorType:k,texelSize:16,sampleTypes:["float","unfilterable-float"],aspects:["color"],canRenderAttachment:!1,canBlend:!1,canMultisample:!1,canResolve:!1,storageBindings:null},"astc-6x5-unorm-srgb":{channelType:$,vectorType:k,texelSize:16,sampleTypes:["float","unfilterable-float"],aspects:["color"],canRenderAttachment:!1,canBlend:!1,canMultisample:!1,canResolve:!1,storageBindings:null},"astc-6x6-unorm":{channelType:$,vectorType:k,texelSize:16,sampleTypes:["float","unfilterable-float"],aspects:["color"],canRenderAttachment:!1,canBlend:!1,canMultisample:!1,canResolve:!1,storageBindings:null},"astc-6x6-unorm-srgb":{channelType:$,vectorType:k,texelSize:16,sampleTypes:["float","unfilterable-float"],aspects:["color"],canRenderAttachment:!1,canBlend:!1,canMultisample:!1,canResolve:!1,storageBindings:null},"astc-8x5-unorm":{channelType:$,vectorType:k,texelSize:16,sampleTypes:["float","unfilterable-float"],aspects:["color"],canRenderAttachment:!1,canBlend:!1,canMultisample:!1,canResolve:!1,storageBindings:null},"astc-8x5-unorm-srgb":{channelType:$,vectorType:k,texelSize:16,sampleTypes:["float","unfilterable-float"],aspects:["color"],canRenderAttachment:!1,canBlend:!1,canMultisample:!1,canResolve:!1,storageBindings:null},"astc-8x6-unorm":{channelType:$,vectorType:k,texelSize:16,sampleTypes:["float","unfilterable-float"],aspects:["color"],canRenderAttachment:!1,canBlend:!1,canMultisample:!1,canResolve:!1,storageBindings:null},"astc-8x6-unorm-srgb":{channelType:$,vectorType:k,texelSize:16,sampleTypes:["float","unfilterable-float"],aspects:["color"],canRenderAttachment:!1,canBlend:!1,canMultisample:!1,canResolve:!1,storageBindings:null},"astc-8x8-unorm":{channelType:$,vectorType:k,texelSize:16,sampleTypes:["float","unfilterable-float"],aspects:["color"],canRenderAttachment:!1,canBlend:!1,canMultisample:!1,canResolve:!1,storageBindings:null},"astc-8x8-unorm-srgb":{channelType:$,vectorType:k,texelSize:16,sampleTypes:["float","unfilterable-float"],aspects:["color"],canRenderAttachment:!1,canBlend:!1,canMultisample:!1,canResolve:!1,storageBindings:null},"astc-10x5-unorm":{channelType:$,vectorType:k,texelSize:16,sampleTypes:["float","unfilterable-float"],aspects:["color"],canRenderAttachment:!1,canBlend:!1,canMultisample:!1,canResolve:!1,storageBindings:null},"astc-10x5-unorm-srgb":{channelType:$,vectorType:k,texelSize:16,sampleTypes:["float","unfilterable-float"],aspects:["color"],canRenderAttachment:!1,canBlend:!1,canMultisample:!1,canResolve:!1,storageBindings:null},"astc-10x6-unorm":{channelType:$,vectorType:k,texelSize:16,sampleTypes:["float","unfilterable-float"],aspects:["color"],canRenderAttachment:!1,canBlend:!1,canMultisample:!1,canResolve:!1,storageBindings:null},"astc-10x6-unorm-srgb":{channelType:$,vectorType:k,texelSize:16,sampleTypes:["float","unfilterable-float"],aspects:["color"],canRenderAttachment:!1,canBlend:!1,canMultisample:!1,canResolve:!1,storageBindings:null},"astc-10x8-unorm":{channelType:$,vectorType:k,texelSize:16,sampleTypes:["float","unfilterable-float"],aspects:["color"],canRenderAttachment:!1,canBlend:!1,canMultisample:!1,canResolve:!1,storageBindings:null},"astc-10x8-unorm-srgb":{channelType:$,vectorType:k,texelSize:16,sampleTypes:["float","unfilterable-float"],aspects:["color"],canRenderAttachment:!1,canBlend:!1,canMultisample:!1,canResolve:!1,storageBindings:null},"astc-10x10-unorm":{channelType:$,vectorType:k,texelSize:16,sampleTypes:["float","unfilterable-float"],aspects:["color"],canRenderAttachment:!1,canBlend:!1,canMultisample:!1,canResolve:!1,storageBindings:null},"astc-10x10-unorm-srgb":{channelType:$,vectorType:k,texelSize:16,sampleTypes:["float","unfilterable-float"],aspects:["color"],canRenderAttachment:!1,canBlend:!1,canMultisample:!1,canResolve:!1,storageBindings:null},"astc-12x10-unorm":{channelType:$,vectorType:k,texelSize:16,sampleTypes:["float","unfilterable-float"],aspects:["color"],canRenderAttachment:!1,canBlend:!1,canMultisample:!1,canResolve:!1,storageBindings:null},"astc-12x10-unorm-srgb":{channelType:$,vectorType:k,texelSize:16,sampleTypes:["float","unfilterable-float"],aspects:["color"],canRenderAttachment:!1,canBlend:!1,canMultisample:!1,canResolve:!1,storageBindings:null},"astc-12x12-unorm":{channelType:$,vectorType:k,texelSize:16,sampleTypes:["float","unfilterable-float"],aspects:["color"],canRenderAttachment:!1,canBlend:!1,canMultisample:!1,canResolve:!1,storageBindings:null},"astc-12x12-unorm-srgb":{channelType:$,vectorType:k,texelSize:16,sampleTypes:["float","unfilterable-float"],aspects:["color"],canRenderAttachment:!1,canBlend:!1,canMultisample:!1,canResolve:!1,storageBindings:null}};function nh(e,t){let n=ws[e];if(!n)throw new Error(`Unknown texture format: ${e}`);let r={...n};switch(e){case"r32float":case"rg32float":case"rgba32float":t.features.has("float32-filterable")||(r={...r,sampleTypes:n.sampleTypes.filter(s=>s!=="float")}),t.features.has("float32-blendable")||(r={...r,canBlend:!1});break;case"bgra8unorm":t.features.has("bgra8unorm-storage")||(r={...r,storageBindings:null});break;case"rg11b10ufloat":t.features.has("rg11b10ufloat-renderable")||(r={...r,canRenderAttachment:!1,canBlend:!1,canMultisample:!1,canResolve:!1});break}if(r.storageBindings){let s=t.features.has("texture-formats-tier1"),i=t.features.has("texture-formats-tier2"),p=[...r.storageBindings],y=["r8unorm","r8uint","r8sint","r16uint","r16sint","r16float","rgba8unorm","rgba8uint","rgba8sint","rgba16uint","rgba16sint","rgba16float","r32uint","r32sint","r32float","rgba32uint","rgba32sint","rgba32float"],v=["r8snorm","rg8unorm","rg8snorm","rg8uint","rg8sint","rgba8snorm","r16unorm","r16snorm","rg16unorm","rg16snorm","rg16uint","rg16sint","rg16float","rgba16unorm","rgba16snorm","rgb10a2uint","rgb10a2unorm","rg11b10ufloat"];y.includes(e)&&!i&&(p=p.filter(_=>_!=="read-write")),v.includes(e)&&!s&&(p=p.filter(_=>_!=="write-only"&&_!=="read-only")),r={...r,storageBindings:p.length>0?p:null}}return r}var jo=["f16","clip_distances","dual_source_blending","subgroups","primitive_index"],rh={f16:"shader-f16",clip_distances:"clip-distances",dual_source_blending:"dual-source-blending",subgroups:"subgroups",primitive_index:"primitive-index"};function Ly(e){return new jy(e)}var jy=class{constructor(t){this.declaration=t}[E]=!0;externalsToApply=[];$uses(t){return this.externalsToApply.push(t),this}[he](t){let n={};for(let s of this.externalsToApply)As(n,s);let r=ea(t,n,this.declaration);return t.addDeclaration(r),B("",at)}toString(){return`declare: ${this.declaration}`}};function sh(e){let t={argTypes:e.in&&Object.keys(e.in).length!==0?[ei(e.in)]:[],returnType:at,workgroupSize:[e.workgroupSize[0]??1,e.workgroupSize[1]??1,e.workgroupSize[2]??1],isEntry:!0},n=(r,...s)=>Yy(t,e.workgroupSize,ta(r,...s));return Object.assign(Object.assign(n,t),{does:n})}function Yy(e,t,n){let r=Ks(n,`@compute @workgroup_size(${t.join(", ")}) `),s=e.argTypes[0];return{shell:e,$uses(i){return r.applyExternals(i),this},[E]:!0,[st]:r,$name(i){return Ne(r,i),Hi(s)&&s.$name(`${i}_Input`),this},[he](i){return r.resolve(i,e.argTypes,e.returnType)},toString(){return`computeFn:${W(r)??"<unnamed>"}`}}}function Ve(e,t){let n={[E]:!0,argTypes:e,returnType:t??at,isEntry:!1};return Object.assign((r,...s)=>qy(n,ta(r,...s)),n)}function ih(e){return Ge(e)&&e?.resourceType==="function"}function Cy([e,t]){return`${W(e)??"<unnamed>"}=${t}`}function qy(e,t){let n=Ks(t,""),r={shell:e,resourceType:"function",$uses(p){return n.applyExternals(p),this},[st]:n,$name(p){return Ne(n,p),this},with(p,y){return ah(i,[[Ki(p)?p.slot:p,y]])},[he](p){return typeof t=="string"&&(ef(t,e.argTypes,n.applyExternals),pc(t,e.returnType,n.applyExternals)),n.resolve(p,e.argTypes,e.returnType)}},s=ce((...p)=>Ip(()=>{try{if(typeof t=="string")throw new Error("Cannot execute on the CPU functions constructed with raw WGSL");let y=p.map((_,P)=>Br(e.argTypes[P],_)),v=t(...y);return Br(e.returnType,v)}catch(y){throw y instanceof iu?y.appendToTrace(i):new iu(y,[i])}}),(...p)=>B(new oh(i,p),e.returnType),"tgpuFnCall",e.argTypes),i=Object.assign(s,r);return i[E].implementation=t,Object.defineProperty(i,"toString",{value(){return`fn:${W(n)??"<unnamed>"}`}}),i}function ah(e,t){let n={resourceType:"function",shell:e.shell,[Ur]:{inner:e,pairs:t},$uses(i){return e.$uses(i),this},[st]:e,$name(i){return e.$name(i),this},with(i,p){return ah(s,[...t,[Ki(i)?i.slot:i,p]])}},r=ce((...i)=>e(...i),(...i)=>B(new oh(s,i),e.shell.returnType),"tgpuFnCall",e.shell.argTypes),s=Object.assign(r,n);return s[E].implementation=e[E].implementation,Object.defineProperty(s,"toString",{value(){return`fn:${W(e)??"<unnamed>"}[${t.map(Cy).join(", ")}]`}}),s[E].implementation=e[E].implementation,s}var oh=class{[E]=!0;[Xt];[st];#e;#t;constructor(t,n){this.#e=t,this.#t=n,this[st]=t,this[Xt]=B(this,this.#e.shell.returnType)}[he](t){return t.withResetIndentLevel(()=>B(S`${t.resolve(this.#e).value}(${this.#t})`,this.#e.shell.returnType))}toString(){return`call:${W(this)??"<unnamed>"}`}};function Wy(e){let t={in:e.in,out:e.out,returnType:ei(e.out),isEntry:!0},n=(r,...s)=>Xy(t,ta(r,...s));return Object.assign(Object.assign(n,t),{does:n})}function Xy(e,t){let n=Ks(t,"@fragment "),r=e.returnType;return typeof t=="string"&&pc(t,r,s=>n.applyExternals(s)),{shell:e,outputType:r,$uses(s){return n.applyExternals(s),this},[E]:!0,[st]:n,$name(s){return Ne(n,s),Hi(r)&&r.$name(`${s}_Output`),this},[he](s){let i=e.in?ei(e.in,s.varyingLocations).$name(`${W(this)??""}_Input`):void 0;return i&&n.applyExternals({In:i}),n.applyExternals({Out:r}),n.resolve(s,i?[i]:[],e.returnType)},toString(){return`fragmentFn:${W(n)??"<unnamed>"}`}}}var uh=new Set(["alias","break","case","const","const_assert","continue","continuing","default","diagnostic","discard","else","enable","false","fn","for","if","let","loop","override","requires","return","struct","switch","true","var","while","NULL","Self","abstract","active","alignas","alignof","as","asm","asm_fragment","async","attribute","auto","await","become","cast","catch","class","co_await","co_return","co_yield","coherent","column_major","common","compile","compile_fragment","concept","const_cast","consteval","constexpr","constinit","crate","debugger","decltype","delete","demote","demote_to_helper","do","dynamic_cast","enum","explicit","export","extends","extern","external","fallthrough","filter","final","finally","friend","from","fxgroup","get","goto","groupshared","highp","impl","implements","import","inline","instanceof","interface","layout","lowp","macro","macro_rules","match","mediump","meta","mod","module","move","mut","mutable","namespace","new","nil","noexcept","noinline","nointerpolation","non_coherent","noncoherent","noperspective","null","nullptr","of","operator","package","packoffset","partition","pass","patch","pixelfragment","precise","precision","premerge","priv","protected","pub","public","readonly","ref","regardless","register","reinterpret_cast","require","resource","restrict","self","set","shared","sizeof","smooth","snorm","static","static_assert","static_cast","std","subroutine","super","target","template","this","thread_local","throw","trait","try","type","typedef","typeid","typename","typeof","union","unless","unorm","unsafe","unsized","use","using","varying","virtual","volatile","wgsl","where","with","writeonly","yield"]);function lh(e){if(e==="_"||e.startsWith("__")||/\s/.test(e))throw new Error(`Invalid identifier '${e}'. Choose an identifier without whitespaces or leading underscores.`);let t=e.split("_")[0];return!uh.has(t)}var ch=class{makeValid(t){return lh(t)?t:this.makeUnique(t)}},Jy=class extends ch{lastUniqueId=0;makeUnique(t){let n;return t?(n=t.replaceAll(/\s/g,"_"),n=n.replaceAll(/[^\w\d]/g,"")):n="item",`${n}_${this.lastUniqueId++}`}},Zy=class extends ch{_usedNames=new Set(uh);makeUnique(t){if(t===void 0)throw new Error("Unnamed item found when using a strict name registry");let n=0,r=t;for(;this._usedNames.has(r);)n++,r=`${t}_${n}`;return this._usedNames.add(r),r}};function Hy(e,t){let n=Ks(t,"");return{[E]:!0,[st]:n,resourceType:"shellless-impl",[he](r){return n.resolve(r,e,void 0)},toString(){return`fn*:${W(n)??"<unnamed>"}`}}}var Qy=class{cache=new Map;get(t,n){let r=Qi(t);if(!r?.ast)return;if(!n&&r.ast.params.length>0)throw new Error(`Cannot resolve '${W(t)}' directly, because it expects arguments. Either call it from another function, or wrap it in a shell`);let s=(n??[]).map(y=>Fs(y.dataType)),i=this.cache.get(t);if(i){let y=i.find(v=>v.argTypes.every((_,P)=>_===s[P]));if(y)return y.value}else i=[],this.cache.set(t,i);let p=Hy(s,t);return i.push({argTypes:s,value:p}),p}},Ky=class{[E];constructor(t){this[E]={nameRegistry:t,shelllessRepo:new Qy,memoizedResolves:new WeakMap,memoizedDerived:new WeakMap,listeners:{name:new Set}}}on(t,n){if(t==="name"){let r=this[E].listeners.name;return r.add(n),()=>r.delete(n)}throw new Error(`Unsupported event: ${t}`)}};function eg(e,t){let n=e.nameRegistry.makeUnique(W(t));for(let r of e.listeners.name)r({target:t,name:n});return n}function si(e){let{names:t="random"}=e||{};return new Ky(t==="strict"?new Zy:new Jy)}function ha(e){return typeof e?.format=="string"}function tg(e,t){let n=[];if(Gr(e)){if(!ha(t))throw new Error("Shader expected a single attribute, not a record of attributes to be passed in.");return n.push(t._layout),{usedVertexLayouts:n,bufferDefinitions:[{arrayStride:t._layout.stride,stepMode:t._layout.stepMode,attributes:[{format:t.format,offset:t.offset,shaderLocation:mr(e)??0}]}]}}let r=[],s=new WeakMap,i=0;for(let[p,y]of Object.entries(e)){if(Rr(y))continue;let v=t[p];if(!v)throw new Error(`An attribute by the name of '${p}' was not provided to the shader.`);let _=v._layout,P=s.get(_);P||(n.push(_),P=[],r.push({arrayStride:_.stride,stepMode:_.stepMode,attributes:P}),s.set(_,P)),i=mr(y)??i,P.push({format:v.format,offset:v.offset,shaderLocation:i++})}return{usedVertexLayouts:n,bufferDefinitions:r}}var ng=["bool","f32","f16","i32","u32","vec2f","vec3f","vec4f","vec2h","vec3h","vec4h","vec2i","vec3i","vec4i","vec2u","vec3u","vec4u","vec2<bool>","vec3<bool>","vec4<bool>","mat2x2f","mat3x3f","mat4x4f","texture_external"];function rg(e){return ng.includes(e.type)}function Ca(e,[t,n]){if(!lh(t))throw new Error(`Property key '${t}' is a reserved WGSL word. Choose a different name.`);return`  ${ko(n)}${t}: ${e.resolve(n).value},
`}function sg(e,t){if(t[E].isAbstruct)throw new Error("Cannot resolve abstract struct types to WGSL.");let n=e.getUniqueName(t);return e.addDeclaration(`struct ${n} {
${Object.entries(t.propTypes).map(r=>Ca(e,r)).join("")}}`),n}function ig(e,t){let n=e.getUniqueName(t);return e.addDeclaration(`struct ${n} {
${Object.entries(t.propTypes).map(r=>ha(r[1])?Ca(e,[r[0],ir[r[1].format]]):Ca(e,r)).join("")}
}`),n}function ag(e,t){let n=e.resolve(t.elementType).value;return t.elementCount===0?`array<${n}>`:`array<${n}, ${t.elementCount}>`}function og(e,t){let n=e.resolve(ha(t.elementType)?ir[t.elementType.format]:t.elementType).value;return t.elementCount===0?`array<${n}>`:`array<${n}, ${t.elementCount}>`}function hh(e,t){if(fs(t))return t.type==="unstruct"?ig(e,t):t.type==="disarray"?og(e,t):t.type==="loose-decorated"?e.resolve(ha(t.inner)?ir[t.inner.format]:t.inner).value:e.resolve(ir[t.type]).value;if(rg(t))return t.type;if(t.type==="struct")return sg(e,t);if(t.type==="array")return ag(e,t);if(t.type==="atomic")return`atomic<${hh(e,t.inner)}>`;if(t.type==="decorated")return e.resolve(t.inner).value;if(t.type==="ptr")return t.addressSpace==="storage"?`ptr<storage, ${e.resolve(t.inner).value}, ${t.access==="read-write"?"read_write":t.access}>`:`ptr<${t.addressSpace}, ${e.resolve(t.inner).value}>`;if(t.type==="abstractInt"||t.type==="abstractFloat"||t.type==="void"||t.type==="u16")throw new Error(`${t.type} has no representation in WGSL`);if(Na(t))return`${t.type}<${t.format}, ${ti[t.access]}>`;if(Pc(t))return t.type.startsWith("texture_depth")?t.type:`${t.type}<${t.sampleType.type}>`;if(Pf(t)||Sf(t))return t.type;cs(t,"resolveData")}var ph=class qa{constructor(t){this.bindings=t}with(t,n){return new qa([...this.bindings,[Ki(t)?t.slot:t,n]])}pipe(t){let n=t(this);return new qa([...this.bindings,...n.bindings])}};function*ug(e){let t=0;for(;;)e.has(t)||(yield t),t++}function lg(e,t){let n="size"in e?e.size:e.currentByteOffset,r=t-1,s=n&r;"skipBytes"in e?e.skipBytes(t-s&r):e.add(t-s&r)}var mt=lg,_u=new WeakMap;function dh(e){let t=_u.get(e);if(t)return t;let n=new nt,r={},s;for(let i in e.propTypes){let p=e.propTypes[i];if(p===void 0)throw new Error(`Property ${i} is undefined in struct`);let y=n.size;mt(n,zn(e)?wn(p):tt(p)),s&&(s.padding=n.size-y);let v=_e(p);r[i]={offset:n.size,size:v},s=r[i],n.add(v)}return s&&(s.padding=sn(_e(e),tt(e))-n.size),_u.set(e,r),r}var cg=(()=>{try{return new Function("return true"),!0}catch{return!1}})(),ma=new WeakMap,wi={u32:"u32",vec2u:"u32",vec3u:"u32",vec4u:"u32",u16:"u16",i32:"i32",vec2i:"i32",vec3i:"i32",vec4i:"i32",f32:"f32",vec2f:"f32",vec3f:"f32",vec4f:"f32",f16:"f16",vec2h:"f16",vec3h:"f16",vec4h:"f16",mat2x2f:"f32",mat3x3f:"f32",mat4x4f:"f32"},hg={uint8:"u8",uint8x2:"u8",uint8x4:"u8",sint8:"i8",sint8x2:"i8",sint8x4:"i8",unorm8:"u8",unorm8x2:"u8",unorm8x4:"u8",snorm8:"i8",snorm8x2:"i8",snorm8x4:"i8",uint16:"u16",uint16x2:"u16",uint16x4:"u16",sint16:"i16",sint16x2:"i16",sint16x4:"i16",unorm16:"u16",unorm16x2:"u16",unorm16x4:"u16",snorm16:"i16",snorm16x2:"i16",snorm16x4:"i16",float16:"f16",float16x2:"f16",float16x4:"f16",float32:"f32",float32x2:"f32",float32x3:"f32",float32x4:"f32",uint32:"u32",uint32x2:"u32",uint32x3:"u32",uint32x4:"u32",sint32:"i32",sint32x2:"i32",sint32x3:"i32",sint32x4:"i32"},xi={u32:"setUint32",i32:"setInt32",f32:"setFloat32",u16:"setUint16",i16:"setInt16",f16:"setFloat16",u8:"setUint8",i8:"setInt8"},pg={unorm8:e=>`Math.round(${e} * 255)`,unorm8x2:e=>`Math.round(${e} * 255)`,unorm8x4:e=>`Math.round(${e} * 255)`,snorm8:e=>`Math.round(${e} * 127)`,snorm8x2:e=>`Math.round(${e} * 127)`,snorm8x4:e=>`Math.round(${e} * 127)`,unorm16:e=>`Math.round(${e} * 65535)`,unorm16x2:e=>`Math.round(${e} * 65535)`,unorm16x4:e=>`Math.round(${e} * 65535)`,snorm16:e=>`Math.round(${e} * 32767)`,snorm16x2:e=>`Math.round(${e} * 32767)`,snorm16x4:e=>`Math.round(${e} * 32767)`},$u={"unorm10-10-10-2":{writeFunction:"setUint32",generator:(e,t)=>`output.setUint32(${e}, ((${t}.x*1023&0x3FF)<<22)|((${t}.y*1023&0x3FF)<<12)|((${t}.z*1023&0x3FF)<<2)|(${t}.w*3&3), littleEndian);
`},"unorm8x4-bgra":{writeFunction:"setUint8",generator:(e,t)=>{let n=["z","y","x","w"],r="";for(let s=0;s<4;s++)r+=`output.setUint8((${e} + ${s}), Math.round(${t}.${n[s]} * 255), littleEndian);
`;return r}}};function zi(e,t,n,r=0){let s=["i","j","k"][r]||`i${r}`;if(Bi(e)||Mn(e))return zi(e.inner,t,n,r);if(vt(e)||zn(e)){let p=dh(e),y="";for(let[v,_]of Object.entries(p)){let P=e.propTypes[v];P&&(y+=zi(P,`(${t} + ${_.offset})`,`${n}.${v}`,r))}return y}if(Lt(e)||sr(e)){let p=sn(_e(e.elementType),tt(e)),y="";return y+=`for (let ${s} = 0; ${s} < ${e.elementCount}; ${s}++) {
`,y+=zi(e.elementType,`(${t} + ${s} * ${p})`,`${n}[${s}]`,r+1),y+=`}
`,y}if(nr(e)){let p=wi[e.type],y="",v=xi[p],_=["x","y","z","w"],P=Ma(e)?2:za(e)?3:4;for(let U=0;U<P;U++)y+=`output.${v}((${t} + ${U*4}), ${n}.${_[U]}, littleEndian);
`;return y}if(Rs(e)){let p=wi[e.type],y=xi[p],v=El(e)?2:Sl(e)?3:4,_=v*v,P=sn(v*4,8),U="";for(let R=0;R<_;R++){let j=Math.floor(R/v),L=R%v,Z=j*P+L*4;U+=`output.${y}((${t} + ${Z}), ${n}.columns[${j}].${["x","y","z","w"][L]}, littleEndian);
`}return U}if(lc(e)){let p=e.type;if(p in $u)return $u[p].generator(t,n);let y=hg[p],v=xi[y],_=ir[p],P=zl(_)?4:za(_)?3:Ma(_)?2:1,U=y==="u8"||y==="i8"?1:y==="u16"||y==="i16"||y==="f16"?2:4,R=["x","y","z","w"],j=pg[p],L="";for(let Z=0;Z<P;Z++){let Q=P===1?n:`${n}.${R[Z]}`,re=j?j(Q):Q;L+=`output.${v}((${t} + ${Z*U}), ${re}, littleEndian);
`}return L}if(!Object.hasOwn(wi,e.type))throw new Error(`Primitive ${e.type} is unsupported by compiled writer`);let i=wi[e.type];return`output.${xi[i]}(${t}, ${n}, littleEndian);
`}function Mu(e){if(!cg){console.warn("This environment does not allow eval - using default writer as fallback");return}if(ma.has(e))return ma.get(e);try{let t=zi(e,"offset","value",0),n=new Function("output","offset","value","littleEndian=true",t);return ma.set(e,n),n}catch(t){console.warn(`Failed to compile writer for schema: ${e}
Reason: ${t instanceof Error?t.message:String(t)}
Falling back to default writer`)}}var rs={bool(){throw new Error("Booleans are not host-shareable")},f32(e,t,n){e.writeFloat32(n)},f16(e,t,n){e.writeFloat16(n)},i32(e,t,n){e.writeInt32(n)},u32(e,t,n){e.writeUint32(n)},u16(e,t,n){e.writeUint16(n)},vec2f(e,t,n){e.writeFloat32(n.x),e.writeFloat32(n.y)},vec2h(e,t,n){e.writeFloat16(n.x),e.writeFloat16(n.y)},vec2i(e,t,n){e.writeInt32(n.x),e.writeInt32(n.y)},vec2u(e,t,n){e.writeUint32(n.x),e.writeUint32(n.y)},"vec2<bool>"(){throw new Error("Booleans are not host-shareable")},vec3f(e,t,n){e.writeFloat32(n.x),e.writeFloat32(n.y),e.writeFloat32(n.z)},vec3h(e,t,n){e.writeFloat16(n.x),e.writeFloat16(n.y),e.writeFloat16(n.z)},vec3i(e,t,n){e.writeInt32(n.x),e.writeInt32(n.y),e.writeInt32(n.z)},vec3u(e,t,n){e.writeUint32(n.x),e.writeUint32(n.y),e.writeUint32(n.z)},"vec3<bool>"(){throw new Error("Booleans are not host-shareable")},vec4f(e,t,n){e.writeFloat32(n.x),e.writeFloat32(n.y),e.writeFloat32(n.z),e.writeFloat32(n.w)},vec4h(e,t,n){e.writeFloat16(n.x),e.writeFloat16(n.y),e.writeFloat16(n.z),e.writeFloat16(n.w)},vec4i(e,t,n){e.writeInt32(n.x),e.writeInt32(n.y),e.writeInt32(n.z),e.writeInt32(n.w)},vec4u(e,t,n){e.writeUint32(n.x),e.writeUint32(n.y),e.writeUint32(n.z),e.writeUint32(n.w)},"vec4<bool>"(){throw new Error("Booleans are not host-shareable")},mat2x2f(e,t,n){for(let r=0;r<n.length;++r)e.writeFloat32(n[r])},mat3x3f(e,t,n){for(let r=0;r<n.length;++r)e.writeFloat32(n[r])},mat4x4f(e,t,n){for(let r=0;r<n.length;++r)e.writeFloat32(n[r])},struct(e,t,n){let r=tt(t);mt(e,r);for(let[s,i]of Object.entries(t.propTypes))mt(e,tt(i)),Ni(e,i,n[s]);mt(e,r)},array(e,t,n){if(t.elementCount===0)throw new Error("Cannot write using a runtime-sized schema.");let r=tt(t);mt(e,r);let s=e.currentByteOffset;for(let i=0;i<Math.min(t.elementCount,n.length);i++)mt(e,r),Ni(e,t.elementType,n[i]);e.seekTo(s+_e(t))},ptr(){throw new Error("Pointers are not host-shareable")},atomic(e,t,n){rs[t.inner.type]?.(e,t,n)},decorated(e,t,n){let r=wn(t);mt(e,r);let s=e.currentByteOffset;rs[t.inner?.type]?.(e,t.inner,n),e.seekTo(s+_e(t))},uint8(e,t,n){e.writeUint8(n)},uint8x2(e,t,n){e.writeUint8(n.x),e.writeUint8(n.y)},uint8x4(e,t,n){e.writeUint8(n.x),e.writeUint8(n.y),e.writeUint8(n.z),e.writeUint8(n.w)},sint8(e,t,n){e.writeInt8(n)},sint8x2(e,t,n){e.writeInt8(n.x),e.writeInt8(n.y)},sint8x4(e,t,n){e.writeInt8(n.x),e.writeInt8(n.y),e.writeInt8(n.z),e.writeInt8(n.w)},unorm8(e,t,n){e.writeUint8(Math.round(n*255))},unorm8x2(e,t,n){e.writeUint8(Math.round(n.x*255)),e.writeUint8(Math.round(n.y*255))},unorm8x4(e,t,n){e.writeUint8(Math.round(n.x*255)),e.writeUint8(Math.round(n.y*255)),e.writeUint8(Math.round(n.z*255)),e.writeUint8(Math.round(n.w*255))},snorm8(e,t,n){e.writeInt8(Math.round(n*127))},snorm8x2(e,t,n){e.writeInt8(Math.round(n.x*127)),e.writeInt8(Math.round(n.y*127))},snorm8x4(e,t,n){e.writeInt8(Math.round(n.x*127)),e.writeInt8(Math.round(n.y*127)),e.writeInt8(Math.round(n.z*127)),e.writeInt8(Math.round(n.w*127))},uint16(e,t,n){e.writeUint16(n)},uint16x2(e,t,n){e.writeUint16(n.x),e.writeUint16(n.y)},uint16x4(e,t,n){e.writeUint16(n.x),e.writeUint16(n.y),e.writeUint16(n.z),e.writeUint16(n.w)},sint16(e,t,n){e.writeInt16(n)},sint16x2(e,t,n){e.writeInt16(n.x),e.writeInt16(n.y)},sint16x4(e,t,n){e.writeInt16(n.x),e.writeInt16(n.y),e.writeInt16(n.z),e.writeInt16(n.w)},unorm16(e,t,n){e.writeUint16(n*65535)},unorm16x2(e,t,n){e.writeUint16(n.x*65535),e.writeUint16(n.y*65535)},unorm16x4(e,t,n){e.writeUint16(n.x*65535),e.writeUint16(n.y*65535),e.writeUint16(n.z*65535),e.writeUint16(n.w*65535)},snorm16(e,t,n){e.writeInt16(Math.round(n*32767))},snorm16x2(e,t,n){e.writeInt16(Math.round(n.x*32767)),e.writeInt16(Math.round(n.y*32767))},snorm16x4(e,t,n){e.writeInt16(Math.round(n.x*32767)),e.writeInt16(Math.round(n.y*32767)),e.writeInt16(Math.round(n.z*32767)),e.writeInt16(Math.round(n.w*32767))},float16(e,t,n){e.writeFloat16(n)},float16x2(e,t,n){e.writeFloat16(n.x),e.writeFloat16(n.y)},float16x4(e,t,n){e.writeFloat16(n.x),e.writeFloat16(n.y),e.writeFloat16(n.z),e.writeFloat16(n.w)},float32(e,t,n){e.writeFloat32(n)},float32x2(e,t,n){e.writeFloat32(n.x),e.writeFloat32(n.y)},float32x3(e,t,n){e.writeFloat32(n.x),e.writeFloat32(n.y),e.writeFloat32(n.z)},float32x4(e,t,n){e.writeFloat32(n.x),e.writeFloat32(n.y),e.writeFloat32(n.z),e.writeFloat32(n.w)},uint32(e,t,n){e.writeUint32(n)},uint32x2(e,t,n){e.writeUint32(n.x),e.writeUint32(n.y)},uint32x3(e,t,n){e.writeUint32(n.x),e.writeUint32(n.y),e.writeUint32(n.z)},uint32x4(e,t,n){e.writeUint32(n.x),e.writeUint32(n.y),e.writeUint32(n.z),e.writeUint32(n.w)},sint32(e,t,n){e.writeInt32(n)},sint32x2(e,t,n){e.writeInt32(n.x),e.writeInt32(n.y)},sint32x3(e,t,n){e.writeInt32(n.x),e.writeInt32(n.y),e.writeInt32(n.z)},sint32x4(e,t,n){e.writeInt32(n.x),e.writeInt32(n.y),e.writeInt32(n.z),e.writeInt32(n.w)},"unorm10-10-10-2"(e,t,n){let r=0;r|=(n.x*1023&1023)<<22,r|=(n.y*1023&1023)<<12,r|=(n.z*1023&1023)<<2,r|=n.w*3&3,e.writeUint32(r)},"unorm8x4-bgra"(e,t,n){e.writeUint8(n.z*255),e.writeUint8(n.y*255),e.writeUint8(n.x*255),e.writeUint8(n.w*255)},disarray(e,t,n){let r=tt(t);mt(e,r);let s=e.currentByteOffset;for(let i=0;i<Math.min(t.elementCount,n.length);i++)mt(e,r),rs[t.elementType?.type]?.(e,t.elementType,n[i]);e.seekTo(s+_e(t))},unstruct(e,t,n){let r=t.propTypes;for(let[s,i]of Object.entries(r))rs[i.type]?.(e,i,n[s])},"loose-decorated"(e,t,n){let r=wn(t);mt(e,r);let s=e.currentByteOffset,i=rs[t.inner?.type];return i?.(e,t.inner,n),e.seekTo(s+_e(t)),n}};function Ni(e,t,n){let r=rs[t.type];if(!r)throw new Error(`Cannot write data of type '${t.type}'.`);r(e,t,n)}var dg={bool(){throw new Error("Booleans are not host-shareable")},f32(e){return e.readFloat32()},f16(e){return e.readFloat16()},i32(e){return e.readInt32()},u32(e){return e.readUint32()},u16(e){return e.readUint16()},vec2f(e){return F(e.readFloat32(),e.readFloat32())},vec3f(e){return O(e.readFloat32(),e.readFloat32(),e.readFloat32())},vec4f(e){return k(e.readFloat32(),e.readFloat32(),e.readFloat32(),e.readFloat32())},vec2h(e){return Pn(e.readFloat16(),e.readFloat16())},vec3h(e){return Un(e.readFloat16(),e.readFloat16(),e.readFloat16())},vec4h(e){return An(e.readFloat16(),e.readFloat16(),e.readFloat16(),e.readFloat16())},vec2i(e){return Be(e.readInt32(),e.readInt32())},vec3i(e){return Ot(e.readInt32(),e.readInt32(),e.readInt32())},vec4i(e){return Fe(e.readInt32(),e.readInt32(),e.readInt32(),e.readInt32())},vec2u(e){return xt(e.readUint32(),e.readUint32())},vec3u(e){return rt(e.readUint32(),e.readUint32(),e.readUint32())},vec4u(e){return Ye(e.readUint32(),e.readUint32(),e.readUint32(),e.readUint32())},"vec2<bool>"(){throw new Error("Booleans are not host-shareable")},"vec3<bool>"(){throw new Error("Booleans are not host-shareable")},"vec4<bool>"(){throw new Error("Booleans are not host-shareable")},mat2x2f(e){return xn(e.readFloat32(),e.readFloat32(),e.readFloat32(),e.readFloat32())},mat3x3f(e){let t=()=>{let n=e.readFloat32();return e.readFloat32(),n};return In(e.readFloat32(),e.readFloat32(),t(),e.readFloat32(),e.readFloat32(),t(),e.readFloat32(),e.readFloat32(),t())},mat4x4f(e){return we(e.readFloat32(),e.readFloat32(),e.readFloat32(),e.readFloat32(),e.readFloat32(),e.readFloat32(),e.readFloat32(),e.readFloat32(),e.readFloat32(),e.readFloat32(),e.readFloat32(),e.readFloat32(),e.readFloat32(),e.readFloat32(),e.readFloat32(),e.readFloat32())},struct(e,t){let n=tt(t);mt(e,n);let r={},s=t.propTypes;for(let[i,p]of Object.entries(s))mt(e,tt(p)),r[i]=Fn(e,p);return mt(e,n),r},array(e,t){if(t.elementCount===0)throw new Error("Cannot read using a runtime-sized schema.");let n=tt(t),r=[];for(let s=0;s<t.elementCount;s++){mt(e,n);let i=t.elementType,p=Fn(e,i);r.push(p)}return mt(e,n),r},ptr(){throw new Error("Pointers are not host-shareable")},atomic(e,t){return Fn(e,t.inner)},decorated(e,t){let n=wn(t);mt(e,n);let r=e.currentByteOffset,s=Fn(e,t.inner);return e.seekTo(r+_e(t)),s},uint8:e=>e.readUint8(),uint8x2:e=>xt(e.readUint8(),e.readUint8()),uint8x4:e=>Ye(e.readUint8(),e.readUint8(),e.readUint8(),e.readUint8()),sint8:e=>e.readInt8(),sint8x2:e=>Be(e.readInt8(),e.readInt8()),sint8x4:e=>Fe(e.readInt8(),e.readInt8(),e.readInt8(),e.readInt8()),unorm8:e=>e.readUint8()/255,unorm8x2:e=>F(e.readUint8()/255,e.readUint8()/255),unorm8x4:e=>k(e.readUint8()/255,e.readUint8()/255,e.readUint8()/255,e.readUint8()/255),snorm8:e=>e.readInt8()/127,snorm8x2:e=>F(e.readInt8()/127,e.readInt8()/127),snorm8x4:e=>k(e.readInt8()/127,e.readInt8()/127,e.readInt8()/127,e.readInt8()/127),uint16:e=>e.readUint16(),uint16x2:e=>xt(e.readUint16(),e.readUint16()),uint16x4:e=>Ye(e.readUint16(),e.readUint16(),e.readUint16(),e.readUint16()),sint16:e=>e.readInt16(),sint16x2:e=>Be(e.readInt16(),e.readInt16()),sint16x4:e=>Fe(e.readInt16(),e.readInt16(),e.readInt16(),e.readInt16()),unorm16:e=>e.readUint16()/65535,unorm16x2:e=>F(e.readUint16()/65535,e.readUint16()/65535),unorm16x4:e=>k(e.readUint16()/65535,e.readUint16()/65535,e.readUint16()/65535,e.readUint16()/65535),snorm16:e=>e.readInt16()/32767,snorm16x2:e=>F(e.readInt16()/32767,e.readInt16()/32767),snorm16x4:e=>k(e.readInt16()/32767,e.readInt16()/32767,e.readInt16()/32767,e.readInt16()/32767),float16(e){return e.readFloat16()},float16x2:e=>F(e.readFloat16(),e.readFloat16()),float16x4:e=>k(e.readFloat16(),e.readFloat16(),e.readFloat16(),e.readFloat16()),float32:e=>e.readFloat32(),float32x2:e=>F(e.readFloat32(),e.readFloat32()),float32x3:e=>O(e.readFloat32(),e.readFloat32(),e.readFloat32()),float32x4:e=>k(e.readFloat32(),e.readFloat32(),e.readFloat32(),e.readFloat32()),uint32:e=>e.readUint32(),uint32x2:e=>xt(e.readUint32(),e.readUint32()),uint32x3:e=>rt(e.readUint32(),e.readUint32(),e.readUint32()),uint32x4:e=>Ye(e.readUint32(),e.readUint32(),e.readUint32(),e.readUint32()),sint32:e=>e.readInt32(),sint32x2:e=>Be(e.readInt32(),e.readInt32()),sint32x3:e=>Ot(e.readInt32(),e.readInt32(),e.readInt32()),sint32x4:e=>Fe(e.readInt32(),e.readInt32(),e.readInt32(),e.readInt32()),"unorm10-10-10-2"(e){let t=e.readUint32(),n=(t>>22)/1023,r=(t>>12&1023)/1023,s=(t>>2&1023)/1023,i=(t&3)/3;return k(n,r,s,i)},"unorm8x4-bgra"(e){let t=e.readByte()/255,n=e.readByte()/255,r=e.readByte()/255,s=e.readByte()/255;return k(r,n,t,s)},unstruct(e,t){let n={},r=t.propTypes;for(let[s,i]of Object.entries(r))n[s]=Fn(e,i);return n},disarray(e,t){let n=tt(t),r=[];for(let s=0;s<t.elementCount;s++)mt(e,n),r.push(Fn(e,t.elementType));return mt(e,n),r},"loose-decorated"(e,t){mt(e,wn(t));let n=e.currentByteOffset,r=Fn(e,t.inner);return e.seekTo(n+_e(t)),r}};function Fn(e,t){let n=dg[t.type];if(!n)throw new Error(`Cannot read data of type '${t.type}'.`);return n(e,t)}function fg(e,t){let n=_e(e);if(n===0||t===void 0||t===null)return[];let r=new ArrayBuffer(n),s=new Nr(r),i=[];function p(_,P,U,R){if(P!=null){if(vt(_)||zn(_)){let j=dh(_);for(let[L,Z]of Object.entries(j)){let Q=_.propTypes[L];if(!Q)continue;let re=P[L];re!==void 0&&p(Q,re,U+Z.offset,Z.padding??R)}return}if(Lt(_)||sr(_)){let j=_,L=sn(_e(j.elementType),tt(j.elementType));if(!Array.isArray(P))throw new Error("Partial value for array must be an array");let Z=P??[];Z.sort((Q,re)=>Q.idx-re.idx);for(let{idx:Q,value:re}of Z)p(j.elementType,re,U+Q*L,L-_e(j.elementType))}else{let j=_e(_);s.seekTo(U),Ni(s,_,P),i.push({start:U,end:U+j,padding:R})}}}if(p(e,t,0),i.length===0)return[];let y=[],v=i[0];for(let _=1;_<i.length;_++){let P=i[_];if(!P||!v)throw new Error("Internal error: missing segment");P.start===v.end+(v.padding??0)?(v.end=P.end,v.padding=P.padding):(y.push({data:new Uint8Array(r,v.start,v.end-v.start)}),v=P)}if(!v)throw new Error("Internal error: missing segment");return y.push({data:new Uint8Array(r,v.start,v.end-v.start)}),y}function Fi(e){return!!e?.usableAsStorage}var zu=class fh extends Error{constructor(t){super(`Resource '${W(t)??"<unnamed>"}' cannot be bound as 'storage'. Use .$usage('storage') to allow it.`),Object.setPrototypeOf(this,fh.prototype)}};function mh(e){return!!e.usableAsUniform}var yh={uniform:"uniform",mutable:"storage, read_write",readonly:"storage, read"},Yo=class{constructor(e,t){this.usage=e,this.buffer=t,this[E]={dataType:t.dataType},this[st]=t}resourceType="buffer-usage";[E];[st];$name(e){return this.buffer.$name(e),this}[he](e){let t=this.buffer.dataType,n=e.getUniqueName(this),{group:r,binding:s}=e.allocateFixedEntry(this.usage==="uniform"?{uniform:t}:{storage:t,access:this.usage},this.buffer),i=yh[this.usage];return e.addDeclaration(`@group(${r}) @binding(${s}) var<${i}> ${n}: ${e.resolve(t).value};`),B(n,t)}toString(){return`${this.usage}:${W(this)??"<unnamed>"}`}get[Re](){let e=this.buffer.dataType;return new Proxy({[E]:!0,get[Xt](){return B(this,e)},[he]:t=>t.resolve(this),toString:()=>`${this.usage}:${W(this)??"<unnamed>"}.$`},kn)}get $(){let e=Oi(),t=ki();if(e.type==="normal")throw new ou(t?`Cannot access ${String(this.buffer)}. TypeGPU functions that depends on GPU resources need to be part of a compute dispatch, draw call or simulation`:".$ and .value are inaccessible during normal JS execution. Try `.read()`");return e.type==="codegen"?this[Re]:e.type==="simulate"?(e.buffers.has(this.buffer)||e.buffers.set(this.buffer,Br(this.buffer.dataType,this.buffer.initial)),e.buffers.get(this.buffer)):cs(e,"bufferUsage.ts#TgpuFixedBufferImpl/$")}get value(){return this.$}set $(e){let t=Oi(),n=ki();if(t.type==="normal")throw new ou(n?`Cannot access ${String(this.buffer)}. TypeGPU functions that depends on GPU resources need to be part of a compute dispatch, draw call or simulation`:".$ and .value are inaccessible during normal JS execution. Try `.write()`");if(t.type==="codegen")throw new Error("Unreachable bufferUsage.ts#TgpuFixedBufferImpl/$");if(t.type==="simulate"){t.buffers.set(this.buffer,e);return}cs(t,"bufferUsage.ts#TgpuFixedBufferImpl/$")}set value(e){this.$=e}},Eu=class{constructor(e,t,n){this.usage=e,this.dataType=t,this[E]={dataType:t},this.#e=n,Ne(this,n.key)}[E];resourceType="buffer-usage";#e;[he](e){let t=this.dataType,n=e.getUniqueName(this),r=e.allocateLayoutEntry(this.#e.layout),s=yh[this.usage];return e.addDeclaration(`@group(${r}) @binding(${this.#e.idx}) var<${s}> ${n}: ${e.resolve(t).value};`),B(n,t)}toString(){return`${this.usage}:${W(this)??"<unnamed>"}`}get[Re](){let e=this.dataType;return new Proxy({[E]:!0,get[Xt](){return B(this,e)},[he]:t=>t.resolve(this),toString:()=>`${this.usage}:${W(this)??"<unnamed>"}.$`},kn)}get $(){if(Bn())return this[Re];throw new Error("Direct access to buffer values is possible only as part of a compute dispatch or draw call. Try .read() or .write() instead")}get value(){return this.$}},Su=new WeakMap;function mg(e){if(!Fi(e))throw new Error(`Cannot pass ${e} to asMutable, as it is not allowed to be used as storage. To allow it, call .$usage('storage') when creating the buffer.`);let t=Su.get(e);return t||(t=new Yo("mutable",e),Su.set(e,t)),t}var Pu=new WeakMap;function yg(e){if(!Fi(e))throw new Error(`Cannot pass ${e} to asReadonly, as it is not allowed to be used as storage. To allow it, call .$usage('storage') when creating the buffer.`);let t=Pu.get(e);return t||(t=new Yo("readonly",e),Pu.set(e,t)),t}var Uu=new WeakMap;function gg(e){if(!mh(e))throw new Error(`Cannot pass ${e} to asUniform, as it is not allowed to be used as a uniform. To allow it, call .$usage('uniform') when creating the buffer.`);let t=Uu.get(e);return t||(t=new Yo("uniform",e),Uu.set(e,t)),t}var wg={uniform:gg,mutable:mg,readonly:yg};function vi(e,t,n){return zt(t)?new Au(e,t,n):new Au(e,t,n,["storage","uniform"])}function Vs(e){return e.resourceType==="buffer"}var xg=Jc(),Au=class{constructor(t,n,r,s){this.dataType=n,this.initialOrBuffer=r,this._disallowedUsages=s,this.#e=t.device,Ba(r)?(this._ownBuffer=!1,this._buffer=r):(this._ownBuffer=!0,this.initial=r)}[E]=!0;resourceType="buffer";flags=GPUBufferUsage.COPY_DST|GPUBufferUsage.COPY_SRC;#e;_buffer=null;_ownBuffer;_destroyed=!1;_hostBuffer;initial;usableAsUniform=!1;usableAsStorage=!1;usableAsVertex=!1;usableAsIndex=!1;get buffer(){if(this._destroyed)throw new Error("This buffer has been destroyed");return this._buffer||(this._buffer=this.#e.createBuffer({size:_e(this.dataType),usage:this.flags,mappedAtCreation:!!this.initial,label:W(this)??"<unnamed>"}),this.initial&&(this._writeToTarget(this._buffer.getMappedRange(),this.initial),this._buffer.unmap())),this._buffer}get destroyed(){return this._destroyed}$name(t){return Ne(this,t),this._buffer&&(this._buffer.label=t),this}$usage(...t){for(let n of t){if(this._disallowedUsages?.includes(n))throw new Error(`Buffer of type ${this.dataType.type} cannot be used as ${n}`);this.flags|=n==="uniform"?GPUBufferUsage.UNIFORM:0,this.flags|=n==="storage"?GPUBufferUsage.STORAGE:0,this.flags|=n==="vertex"?GPUBufferUsage.VERTEX:0,this.flags|=n==="index"?GPUBufferUsage.INDEX:0,this.usableAsUniform=this.usableAsUniform||n==="uniform",this.usableAsStorage=this.usableAsStorage||n==="storage",this.usableAsVertex=this.usableAsVertex||n==="vertex",this.usableAsIndex=this.usableAsIndex||n==="index"}return this}$addFlags(t){if(!this._ownBuffer)throw new Error("Cannot add flags to a buffer that is not managed by TypeGPU.");return t&GPUBufferUsage.MAP_READ?(this.flags=GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ,this):t&GPUBufferUsage.MAP_WRITE?(this.flags=GPUBufferUsage.COPY_SRC|GPUBufferUsage.MAP_WRITE,this):(this.flags|=t,this)}compileWriter(){Mu(this.dataType)}_writeToTarget(t,n){let r=Mu(this.dataType);if(r)try{r(new DataView(t),0,n,xg==="little");return}catch(s){console.error(`Error when using compiled writer for buffer ${W(this)??"<unnamed>"} - this is likely a bug, please submit an issue at https://github.com/software-mansion/TypeGPU/issues
Using fallback writer instead.`,s)}Ni(new Nr(t),this.dataType,n)}write(t){let n=this.buffer;if(n.mapState==="mapped"){let s=n.getMappedRange();this._writeToTarget(s,t);return}let r=_e(this.dataType);this._hostBuffer||(this._hostBuffer=new ArrayBuffer(r)),this._writeToTarget(this._hostBuffer,t),this.#e.queue.writeBuffer(n,0,this._hostBuffer,0,r)}writePartial(t){let n=this.buffer,r=fg(this.dataType,t);if(n.mapState==="mapped"){let s=n.getMappedRange(),i=new Uint8Array(s);for(let p of r)i.set(p.data,p.data.byteOffset)}else for(let s of r)this.#e.queue.writeBuffer(n,s.data.byteOffset,s.data,0,s.data.byteLength)}clear(){let t=this.buffer;if(t.mapState==="mapped"){new Uint8Array(t.getMappedRange()).fill(0);return}let n=this.#e.createCommandEncoder();n.clearBuffer(t),this.#e.queue.submit([n.finish()])}copyFrom(t){if(this.buffer.mapState==="mapped")throw new Error("Cannot copy to a mapped buffer.");let n=_e(this.dataType),r=this.#e.createCommandEncoder();r.copyBufferToBuffer(t.buffer,0,this.buffer,0,n),this.#e.queue.submit([r.finish()])}async read(){let t=this.buffer;if(t.mapState==="mapped"){let i=t.getMappedRange();return Fn(new hr(i),this.dataType)}if(t.usage&GPUBufferUsage.MAP_READ){await t.mapAsync(GPUMapMode.READ);let i=t.getMappedRange(),p=Fn(new hr(i),this.dataType);return t.unmap(),p}let n=(globalThis.__TYPEGPU_AUTONAME__??(i=>i))(this.#e.createBuffer({size:_e(this.dataType),usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ}),"r"),r=this.#e.createCommandEncoder();r.copyBufferToBuffer(t,0,n,0,_e(this.dataType)),this.#e.queue.submit([r.finish()]),await n.mapAsync(GPUMapMode.READ,0,_e(this.dataType));let s=Fn(new hr(n.getMappedRange()),this.dataType);return n.unmap(),n.destroy(),s}as(t){return wg[t]?.(this)}destroy(){this._destroyed||(this._destroyed=!0,this._ownBuffer&&this._buffer?.destroy())}toString(){return`buffer:${W(this)??"<unnamed>"}`}};function vg(e,t){return new xh(Vo(),e,t)}function bg(e,t){return new xh(Go(),e,t)}function gh(e){let t=e;return t?.resourceType==="sampler"&&!!t[E]}function wh(e){let t=e;return t?.resourceType==="sampler-comparison"&&!!t[E]}var Tg=class{constructor(t,n){this.schema=t,this.#e=n,this.resourceType=t.type==="sampler_comparison"?"sampler-comparison":"sampler",Ne(this,n.key)}[E]={unwrap:void 0};resourceType;#e;[he](t){let n=t.getUniqueName(this),r=t.allocateLayoutEntry(this.#e.layout);return t.addDeclaration(`@group(${r}) @binding(${this.#e.idx}) var ${n}: ${t.resolve(this.schema).value};`),B(n,this.schema)}get[Re](){let t=this.schema;return new Proxy({[E]:!0,get[Xt](){return B(this,t)},[he]:n=>n.resolve(this),toString:()=>`${this.toString()}.$`},kn)}get $(){if(Bn())return this[Re];throw new Error("Direct access to sampler values is possible only as part of a compute dispatch or draw call.")}get value(){return this.$}toString(){return`${this.resourceType}:${W(this)??"<unnamed>"}`}},xh=class{constructor(t,n,r){this.schema=t,this.#n=n,this.#r=r,this.resourceType=t.type==="sampler_comparison"?"sampler-comparison":"sampler",this[E]={unwrap:()=>(this.#t||(this.#t=this.#r.device.createSampler({...this.#n,label:W(this)??"<unnamed>"})),this.#t)},this.#e=n.minFilter==="linear"||n.magFilter==="linear"||n.mipmapFilter==="linear"}[E];resourceType;#e;#t=null;#n;#r;[he](t){let n=t.getUniqueName(this),{group:r,binding:s}=t.allocateFixedEntry(this.schema.type==="sampler_comparison"?{sampler:"comparison"}:{sampler:this.#e?"filtering":"non-filtering"},this);return t.addDeclaration(`@group(${r}) @binding(${s}) var ${n}: ${t.resolve(this.schema).value};`),B(n,this.schema)}get[Re](){let t=this.schema;return new Proxy({[E]:!0,get[Xt](){return B(this,t)},[he]:n=>n.resolve(this),toString:()=>`${this.toString()}.$`},kn)}get $(){if(Bn())return this[Re];throw new Error("Direct access to sampler values is possible only as part of a compute dispatch or draw call.")}get value(){return this.$}$name(t){return Ne(this,t),this}toString(){return`${this.resourceType}:${W(this)??"<unnamed>"}`}},_g=class{constructor(t,n){this.schema=t,this.#e=n,Ne(this,n.key)}resourceType="external-texture";[E]=!0;#e;[he](t){let n=t.getUniqueName(this),r=t.allocateLayoutEntry(this.#e.layout);return t.addDeclaration(`@group(${r}) @binding(${this.#e.idx}) var ${n}: ${t.resolve(this.schema).value};`),B(n,Sc())}get[Re](){let t=this.schema;return new Proxy({[E]:!0,get[Xt](){return B(this,t)},[he]:n=>n.resolve(this),toString:()=>`textureExternal:${W(this)??"<unnamed>"}.$`},kn)}get $(){if(Bn())return this[Re];throw new Error("Direct access to texture views values is possible only as part of a compute dispatch or draw call. Try .read() or .write() instead")}get value(){return this.$}toString(){return`textureExternal:${W(this)??"<unnamed>"}`}};function Wa(e){let{videoWidth:t,videoHeight:n}=e;if(t&&n)return{width:t,height:n};let{naturalWidth:r,naturalHeight:s}=e;if(r&&s)return{width:r,height:s};let{codedWidth:i,codedHeight:p}=e;if(i&&p)return{width:i,height:p};let{width:y,height:v}=e||HTMLCanvasElement||OffscreenCanvas||HTMLImageElement||ImageData;if(!y||!v)throw new Error("Cannot determine dimensions of the provided image source.");return{width:y,height:v}}var Xa=new WeakMap;function vh(e){let t=Xa.get(e);return t||(t=new Map,Xa.set(e,t)),t}function $g(e){let t=Xa.get(e);t&&t.clear()}function Mg(e,t,n=0,r){if(t.dimension!=="2d")throw new Error("Cannot generate mipmaps for non-2D textures: only 2D textures are currently supported.");let s=r??t.mipLevelCount-n,i=nh(t.format,e);if(![...i.sampleTypes].some(p=>p==="float"||p==="unfilterable-float"))throw new Error(`Cannot generate mipmaps for format '${t.format}': only float and unfilterable-float formats are currently supported.`);if(!i.canRenderAttachment)throw new Error(`Cannot generate mipmaps for format '${t.format}': format does not support render attachments.`);for(let p=0;p<t.depthOrArrayLayers;p++)for(let y=n;y<n+s-1;y++){let v=y,_=y+1;Sg(e,t,v,_,p)}}function zg(e,t,n,r){if(t.dimension==="3d")throw new Error("Cannot resample to 3D textures: only 2D textures are currently supported.");let s=ws[t.format];if(![...s.sampleTypes].some(i=>i==="float"||i==="unfilterable-float"))throw new Error(`Cannot resample to format '${t.format}': only float and unfilterable-float formats are currently supported.`);if(!s.canRenderAttachment)throw new Error(`Cannot resample to format '${t.format}': format does not support render attachments.`);return Eg(e,t,n,r)}function Eg(e,t,n,r=0){let s=[...ws[t.format].sampleTypes].includes("float"),i=`${s?"filterable":"unfilterable"}`,p=vh(e),y=p.get(i);if(!y){let Q=e.createShaderModule({code:`
struct VertexOutput {
  @builtin(position) pos: vec4f,
  @location(0) uv: vec2f,
}

@vertex
fn vs_main(@builtin(vertex_index) vertexIndex: u32) -> VertexOutput {
  let pos = array<vec2f, 3>(vec2f(-1, -1), vec2f(3, -1), vec2f(-1, 3));
  let uv = array<vec2f, 3>(vec2f(0, 1), vec2f(2, 1), vec2f(0, -1));

  var output: VertexOutput;
  output.pos = vec4f(pos[vertexIndex], 0, 1);
  output.uv = uv[vertexIndex];
  return output;
}
      `}),re=(globalThis.__TYPEGPU_AUTONAME__??(ze=>ze))(e.createSampler({magFilter:s?"linear":"nearest",minFilter:s?"linear":"nearest"}),"R"),Me=e.createBindGroupLayout({entries:[{binding:0,visibility:GPUShaderStage.FRAGMENT,texture:{sampleType:"float"}},{binding:1,visibility:GPUShaderStage.FRAGMENT,sampler:{type:s?"filtering":"non-filtering"}}]}),oe=e.createPipelineLayout({bindGroupLayouts:[Me]}),be=e.createShaderModule({code:`
@group(0) @binding(0) var inputTexture: texture_2d<f32>;
@group(0) @binding(1) var inputSampler: sampler;

@fragment
fn fs_main(@location(0) uv: vec2f) -> @location(0) vec4f {
  ${s?"return textureSample(inputTexture, inputSampler, uv);":`let texelCoord = vec2u(uv * vec2f(textureDimensions(inputTexture)));
        return textureLoad(inputTexture, texelCoord, 0);`}
}
      `});y={vertexShader:Q,fragmentShader:be,bindGroupLayout:Me,pipelineLayout:oe,sampler:re},p.set(i,y)}let v=(globalThis.__TYPEGPU_AUTONAME__??(Q=>Q))(e.createTexture({size:[...Object.values(Wa(n))],format:"rgba8unorm",usage:GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.COPY_DST}),"l"),{width:_,height:P}=Wa(n);e.queue.copyExternalImageToTexture({source:n},{texture:v},[_,P,1]);let U=(globalThis.__TYPEGPU_AUTONAME__??(Q=>Q))(e.createTexture({size:[t.width,t.height,1],format:t.format,usage:GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.COPY_SRC}),"f"),R=e.createRenderPipeline({layout:y.pipelineLayout,vertex:{module:y.vertexShader},fragment:{module:y.fragmentShader,targets:[{format:t.format}]},primitive:{topology:"triangle-list"}}),j=e.createBindGroup({layout:y.bindGroupLayout,entries:[{binding:0,resource:v.createView()},{binding:1,resource:y.sampler}]}),L=e.createCommandEncoder(),Z=L.beginRenderPass({colorAttachments:[{view:U.createView(),loadOp:"clear",storeOp:"store"}]});Z.setPipeline(R),Z.setBindGroup(0,j),Z.draw(3),Z.end(),L.copyTextureToTexture({texture:U},{texture:t,origin:{x:0,y:0,z:r}},{width:t.width,height:t.height,depthOrArrayLayers:1}),e.queue.submit([L.finish()]),v.destroy(),U.destroy()}function Sg(e,t,n,r,s){let i=[...nh(t.format,e).sampleTypes].includes("float"),p=`${i?"filterable":"unfilterable"}`,y=vh(e),v=y.get(p);if(!v){let Z=e.createShaderModule({code:`
struct VertexOutput {
  @builtin(position) pos: vec4f,
  @location(0) uv: vec2f,
}

@vertex
fn vs_main(@builtin(vertex_index) vertexIndex: u32) -> VertexOutput {
  let pos = array<vec2f, 3>(vec2f(-1, -1), vec2f(3, -1), vec2f(-1, 3));
  let uv = array<vec2f, 3>(vec2f(0, 1), vec2f(2, 1), vec2f(0, -1));

  var output: VertexOutput;
  output.pos = vec4f(pos[vertexIndex], 0, 1);
  output.uv = uv[vertexIndex];
  return output;
}
      `}),Q=e.createShaderModule({code:`
@group(0) @binding(0) var inputTexture: texture_2d<f32>;
@group(0) @binding(1) var inputSampler: sampler;

@fragment
fn fs_main(@location(0) uv: vec2f) -> @location(0) vec4f {
  return textureSample(inputTexture, inputSampler, uv);
}
      `}),re=(globalThis.__TYPEGPU_AUTONAME__??(be=>be))(e.createSampler({magFilter:i?"linear":"nearest",minFilter:i?"linear":"nearest"}),"R"),Me=e.createBindGroupLayout({entries:[{binding:0,visibility:GPUShaderStage.FRAGMENT,texture:{sampleType:i?"float":"unfilterable-float"}},{binding:1,visibility:GPUShaderStage.FRAGMENT,sampler:{type:i?"filtering":"non-filtering"}}]}),oe=e.createPipelineLayout({bindGroupLayouts:[Me]});v={vertexShader:Z,fragmentShader:Q,bindGroupLayout:Me,pipelineLayout:oe,sampler:re},y.set(p,v)}let _=e.createRenderPipeline({layout:v.pipelineLayout,vertex:{module:v.vertexShader},fragment:{module:v.fragmentShader,targets:[{format:t.format}]},primitive:{topology:"triangle-list"}}),P=t.createView({baseMipLevel:n,dimension:"2d",mipLevelCount:1,...s!==void 0&&{baseArrayLayer:s,arrayLayerCount:1}}),U=t.createView({baseMipLevel:r,dimension:"2d",mipLevelCount:1,...s!==void 0&&{baseArrayLayer:s,arrayLayerCount:1}}),R=e.createBindGroup({layout:v.bindGroupLayout,entries:[{binding:0,resource:P},{binding:1,resource:v.sampler}]}),j=e.createCommandEncoder(),L=j.beginRenderPass({colorAttachments:[{view:U,loadOp:"clear",storeOp:"store"}]});L.setPipeline(_),L.setBindGroup(0,R),L.draw(3),L.end(),e.queue.submit([j.finish()])}function Pg(e){return{dimension:e.dimension??"2d",sampleType:ws[e.format].channelType,multisampled:(e.sampleCount??1)!==1}}function Ug(e){return e==="depth24plus-stencil8"||e==="depth32float-stencil8"?["depth","stencil"]:e==="depth16unorm"||e==="depth24plus"||e==="depth32float"?["depth"]:e==="stencil8"?["stencil"]:["color"]}function Ag(e,t){return new Ig(e,t)}function Cs(e){return e?.resourceType==="texture"&&!!e[E]}function Li(e){return e?.resourceType==="texture-view"&&!!e[E]}var Ig=class{constructor(t,n){this.props=t;let r=t.format;this.#i=n,this.#e=ws[r],this.#t=t.size[0]*(t.size[1]??1)*(t.size[2]??1)*this.#e.texelSize,this.aspects=Ug(r),this[E]={unwrap:()=>{if(this.#n)throw new Error("This texture has been destroyed");return this.#s||(this.#s=n.device.createTexture({label:W(this)??"<unnamed>",format:t.format,size:t.size,usage:this.#r,dimension:t.dimension??"2d",viewFormats:t.viewFormats??[],mipLevelCount:t.mipLevelCount??1,sampleCount:t.sampleCount??1})),this.#s}}}[E];resourceType="texture";aspects;usableAsSampled=!1;usableAsStorage=!1;usableAsRender=!1;#e;#t;#n=!1;#r=GPUTextureUsage.COPY_DST|GPUTextureUsage.COPY_SRC;#s=null;#i;$name(t){return Ne(this,t),this}$usage(...t){let n=t.includes("storage"),r=t.includes("sampled"),s=t.includes("render");return this.#r|=r?GPUTextureUsage.TEXTURE_BINDING:0,this.#r|=n?GPUTextureUsage.STORAGE_BINDING:0,this.#r|=s?GPUTextureUsage.RENDER_ATTACHMENT:0,this.usableAsStorage||=n,this.usableAsSampled||=r,this.usableAsRender||=s,this}createView(t,n){return new Bg(t??Ra(Pg(this.props)),this,n)}#a(t=0){let n=2**t,[r,s,i]=[Math.max(1,Math.floor((this.props.size[0]??1)/n)),Math.max(1,Math.floor((this.props.size[1]??1)/n)),Math.max(1,Math.floor((this.props.size[2]??1)/n))];this.#i.device.queue.writeTexture({texture:this[E].unwrap(),mipLevel:t},new Uint8Array(r*s*i*this.#e.texelSize),{bytesPerRow:this.#e.texelSize*r,rowsPerImage:s},[r,s,i])}clear(t="all"){if(t==="all"){let n=this.props.mipLevelCount??1;for(let r=0;r<n;r++)this.#a(r)}else this.#a(t)}generateMipmaps(t=0,n){if(this.usableAsRender===!1)throw new Error("generateMipmaps called without specifying 'render' usage. Add it via the $usage('render') method.");let r=n??(this.props.mipLevelCount??1)-t;if(r<=1){console.warn(`generateMipmaps is a no-op: would generate ${r} mip levels (base: ${t}, total: ${this.props.mipLevelCount??1})`);return}if(t>=(this.props.mipLevelCount??1))throw new Error(`Base mip level ${t} is out of range. Texture has ${this.props.mipLevelCount??1} mip levels.`);Mg(this.#i.device,this[E].unwrap(),t,r)}write(t,n=0){if(t instanceof ArrayBuffer||ArrayBuffer.isView(t)){this.#u(t,n);return}let r=this.props.dimension??"2d";if(!Array.isArray(t)){this.#o(t,r==="3d"?0:void 0);return}let s=this.props.size[2]??1;t.length>s&&console.warn(`Too many image sources provided. Expected ${s} layers, got ${t.length}. Extra sources will be ignored.`);for(let i=0;i<Math.min(t.length,s);i++){let p=t[i];p&&this.#o(p,i)}}#u(t,n){let r=Math.max(1,this.props.size[0]>>n),s=Math.max(1,(this.props.size[1]??1)>>n),i=Math.max(1,(this.props.size[2]??1)>>n),p=r*s*i*this.#e.texelSize,y=t.byteLength??t.byteLength;if(y!==p)throw new Error(`Buffer size mismatch. Expected ${p} bytes for mip level ${n}, got ${y} bytes.`);this.#i.device.queue.writeTexture({texture:this[E].unwrap(),mipLevel:n},t,{bytesPerRow:this.#e.texelSize*r,rowsPerImage:s},[r,s,i])}#o(t,n){let r=this.props.size[0],s=this.props.size[1]??1,{width:i,height:p}=Wa(t);if(i!==r||p!==s){zg(this.#i.device,this[E].unwrap(),t,n);return}this.#i.device.queue.copyExternalImageToTexture({source:t},{texture:this[E].unwrap(),...n!==void 0&&{origin:{x:0,y:0,z:n}}},n!==void 0?[r,s,1]:this.props.size)}copyFrom(t){if(t.props.format!==this.props.format)throw new Error(`Texture format mismatch. Source texture has format ${t.props.format}, target texture has format ${this.props.format}`);if(t.props.size[0]!==this.props.size[0]||(t.props.size[1]??1)!==(this.props.size[1]??1)||(t.props.size[2]??1)!==(this.props.size[2]??1))throw new Error(`Texture size mismatch. Source texture has size ${t.props.size.join("x")}, target texture has size ${this.props.size.join("x")}`);let n=this.#i.device.createCommandEncoder();n.copyTextureToTexture({texture:t[E].unwrap()},{texture:this[E].unwrap()},t.props.size),this.#i.device.queue.submit([n.finish()])}get destroyed(){return this.#n}destroy(){this.#n||(this.#n=!0,this.#s?.destroy())}},Bg=class{constructor(t,n,r){this.schema=t,this.#e=n,this.#n=r,this[E]={unwrap:()=>{if(!this.#t){let s=this.schema,i;Na(s)?i={label:W(this)??"<unnamed>",format:this.#n?.format??s.format,dimension:s.dimension}:i={label:W(this)??"<unnamed>",format:this.#n?.format??this.#e.props.format,dimension:s.dimension},this.#n?.mipLevelCount!==void 0&&(i.mipLevelCount=this.#n.mipLevelCount),this.#n?.arrayLayerCount!==void 0&&(i.arrayLayerCount=this.#n.arrayLayerCount),this.#t=this.#e[E].unwrap().createView(i)}return this.#t}}}[E];resourceType="texture-view";#e;#t;#n;$name(t){return Ne(this,t),this.#t&&(this.#t.label=t),this}get[Re](){let t=this.schema;return new Proxy({[E]:!0,get[Xt](){return B(this,t)},[he]:n=>n.resolve(this),toString:()=>`${this.toString()}.$`},kn)}get $(){if(Bn())return this[Re];throw new Error("Direct access to texture view values is possible only as part of a compute dispatch or draw call. Try .read() or .write() instead")}get value(){return this.$}toString(){return`textureView:${W(this)??"<unnamed>"}`}[he](t){let n=t.getUniqueName(this),{group:r,binding:s}=t.allocateFixedEntry(Na(this.schema)?{storageTexture:this.schema}:{texture:this.schema,sampleType:this.#n?.sampleType??this.schema.bindingSampleType[0]},this);return t.addDeclaration(`@group(${r}) @binding(${s}) var ${n}: ${t.resolve(this.schema).value};`),B(n,this.schema)}},Iu=class{constructor(e,t){this.schema=e,this.#e=t,Ne(this,t.key)}[E]={unwrap:void 0};resourceType="texture-view";#e;toString(){return`textureView:${W(this)??"<unnamed>"}`}[he](e){let t=e.getUniqueName(this),n=e.allocateLayoutEntry(this.#e.layout);return e.addDeclaration(`@group(${n}) @binding(${this.#e.idx}) var ${t}: ${e.resolve(this.schema).value};`),B(t,this.schema)}get[Re](){let e=this.schema;return new Proxy({[E]:!0,get[Xt](){return B(this,e)},[he]:t=>t.resolve(this),toString:()=>`${this.toString()}.$`},kn)}get $(){if(Bn())return this[Re];throw new Error("Direct access to texture views values is possible only as part of a compute dispatch or draw call. Try .read() or .write() instead")}get value(){return this.$}};function kg(e){return!!e?.usableAsSampled}var Og=class bh extends Error{constructor(t){super(`Resource '${W(t)??"<unnamed>"}' cannot be bound as 'sampled'. Use .$usage('sampled') to allow it.`),Object.setPrototypeOf(this,bh.prototype)}};function Vg(e){let t={};for(let[n,r]of Object.entries(e)){if(r===null){t[n]=null;continue}if("texture"in r&&typeof r.texture=="string"){let s=r.texture;t[n]={...r,texture:Ra({dimension:r.viewDimension??"2d",sampleType:s==="sint"?Ue:s==="uint"?J:$,multisampled:r.multisampled??!1})}}else if("storageTexture"in r&&typeof r.storageTexture=="string"){let s={readonly:"read-only",writeonly:"write-only",mutable:"read-write"};t[n]={...r,storageTexture:Ra({access:s[r.access??"writeonly"],format:r.storageTexture,dimension:r.viewDimension??"2d"})}}else"externalTexture"in r&&Object.keys(r.externalTexture).length===0?t[n]={...r,externalTexture:{type:"texture_external",dimension:"2d"}}:t[n]=r}return t}function Th(e){let t=Vg(e);return new Dg(t)}function _h(e){return!!e&&e.resourceType==="bind-group-layout"}function ji(e){return!!e&&e.resourceType==="bind-group"}var Gg=class $h extends Error{constructor(t,n){super(`Bind group '${t??"<unnamed>"}' is missing a required binding '${n}'`),Object.setPrototypeOf(this,$h.prototype)}},Bu=["compute","fragment"],_s=["compute","vertex","fragment"],Dg=class{constructor(t){this.entries=t;let n=0;for(let[r,s]of Object.entries(t)){if(s===null){n++;continue}let i={layout:this,key:r,idx:n};if("uniform"in s&&(this.bound[r]=new Eu("uniform",s.uniform,i)),"storage"in s){let p="type"in s.storage?s.storage:s.storage(0);this.bound[r]=new Eu(s.access??"readonly",p,i)}"texture"in s&&(this.bound[r]=new Iu(s.texture,i)),"storageTexture"in s&&(this.bound[r]=new Iu(s.storageTexture,i)),"externalTexture"in s&&(this.bound[r]=new _g(s.externalTexture,i)),"sampler"in s&&(this.bound[r]=new Tg(s.sampler==="comparison"?Go():Vo(),i)),Object.defineProperty(this.value,r,{get:()=>this.bound[r].value}),n++}}[E]=!0;_index;resourceType="bind-group-layout";bound={};value={};$=this.value;get[Re](){return this.$}toString(){return`bindGroupLayout:${W(this)??"<unnamed>"}`}get index(){return this._index}$name(t){return Ne(this,t),this}$idx(t){return this._index=t,this}unwrap(t){return t.device.createBindGroupLayout({label:W(this)??"<unnamed>",entries:Object.values(this.entries).map((n,r)=>{if(n===null)return null;let s=n.visibility,i={binding:r,visibility:0};if("uniform"in n)s=s??_s,i.buffer={type:"uniform"};else if("storage"in n)s=s??(n.access==="mutable"?Bu:_s),i.buffer={type:n.access==="mutable"?"storage":"read-only-storage"};else if("sampler"in n)s=s??_s,i.sampler={type:n.sampler};else if("texture"in n){s=s??_s;let{multisampled:p,dimension:y,bindingSampleType:v}=n.texture;i.texture={sampleType:n.sampleType??v[0],viewDimension:y,multisampled:p}}else if("storageTexture"in n){s=s??Bu;let{dimension:p,access:y,format:v}=n.storageTexture;i.storageTexture={access:y,format:v,viewDimension:p}}else"externalTexture"in n&&(s=s??_s,i.externalTexture={});return s?.includes("compute")&&(i.visibility|=GPUShaderStage.COMPUTE),s?.includes("vertex")&&(i.visibility|=GPUShaderStage.VERTEX),s?.includes("fragment")&&(i.visibility|=GPUShaderStage.FRAGMENT),i}).filter(n=>n!==null)})}},Mh=class{constructor(e,t){this.layout=e,this.entries=t;for(let n of Object.keys(e.entries))if(e.entries[n]!==null&&!(n in t))throw new Gg(W(e),n)}resourceType="bind-group";unwrap(e){return e.device.createBindGroup({label:W(this.layout)??"<unnamed>",layout:e.unwrap(this.layout),entries:Object.entries(this.layout.entries).map(([t,n],r)=>{if(n===null)return null;let s=this.entries[t];if(s===void 0)throw new Error(`'${t}' is a resource required to populate bind group layout '${W(this.layout)??"<unnamed>"}'.`);if("uniform"in n){let i;if(Vs(s)){if(!mh(s))throw new Ep(s);i={buffer:e.unwrap(s)}}else i={buffer:s};return{binding:r,resource:i}}if("storage"in n){let i;if(Vs(s)){if(!Fi(s))throw new zu(s);i={buffer:e.unwrap(s)}}else i={buffer:s};return{binding:r,resource:i}}if("texture"in n){let i;if(Cs(s)){if(!kg(s))throw new Og(s);i=e.unwrap(s.createView(n.texture))}else Li(s)?i=e.unwrap(s):i=s;return{binding:r,resource:i}}if("storageTexture"in n){let i;if(Cs(s)){if(!Fi(s))throw new zu(s);i=e.unwrap(s.createView(n.storageTexture))}else Li(s)?i=e.unwrap(s):i=s;return{binding:r,resource:i}}if("sampler"in n)return wh(s)||gh(s)?{binding:r,resource:e.unwrap(s)}:{binding:r,resource:s};if("externalTexture"in n)return{binding:r,resource:s};throw new Error(`Malformed bind group entry: ${Jt(s)}`)}).filter(t=>t!==null)})}};function Yi(e){return new Rg(e)}var Rg=class{constructor(t=void 0){this.defaultValue=t}[E]=!0;resourceType="slot";$name(t){return Ne(this,t),this}areEqual(t,n){return Object.is(t,n)}toString(){return`slot:${W(this)??"<unnamed>"}`}get[Re](){let t=yr();if(!t)throw new Error("Cannot access tgpu.slot's value outside of resolution.");return oa(t.unwrap(this))}get value(){return this[Re]}get $(){return this.value}};function Ci(e,t){return new zh("private",e,t)}function ku(e){return new zh("workgroup",e)}var zh=class{[E]={};#e;#t;#n;constructor(e,t,n){this.#e=e,this.#t=t,this.#n=n}[he](e){let t=e.getUniqueName(this),n=`var<${this.#e}> ${t}: ${e.resolve(this.#t).value}`;return this.#n?e.addDeclaration(`${n} = ${e.resolve(this.#n,this.#t).value};`):e.addDeclaration(`${n};`),B(t,this.#t)}$name(e){return Ne(this,e),this}toString(){return`var:${W(this)??"<unnamed>"}`}get[Re](){let e=this.#t;return new Proxy({[E]:!0,get[Xt](){return B(this,e)},[he]:t=>t.resolve(this),toString:()=>`var:${W(this)??"<unnamed>"}.$`},kn)}get $(){let e=Oi(),t=ki();if(e.type==="normal")throw new au(t?`Cannot access variable '${W(this)??"<unnamed>"}'. TypeGPU functions that depends on GPU resources need to be part of a compute dispatch, draw call or simulation`:"TypeGPU variables are inaccessible during normal JS execution. If you wanted to simulate GPU behavior, try `tgpu.simulate()`");return e.type==="codegen"?this[Re]:e.type==="simulate"?(e.vars[this.#e].has(this)||e.vars[this.#e].set(this,this.#n),e.vars[this.#e].get(this)):cs(e,"tgpuVariable.ts#TgpuVarImpl/$")}set $(e){let t=Oi(),n=ki();if(t.type==="normal")throw new au(n?`Cannot access ${String(this)}. TypeGPU functions that depends on GPU resources need to be part of a compute dispatch, draw call or simulation`:"TypeGPU variables are inaccessible during normal JS execution. If you wanted to simulate GPU behavior, try `tgpu.simulate()`");if(t.type==="codegen")throw new Error("Unreachable tgpuVariable.ts#TgpuVarImpl/$");if(t.type==="simulate"){t.vars[this.#e].set(this,e);return}cs(t,"tgpuVariable.ts#TgpuVarImpl/$")}get value(){return this.$}set value(e){this.$=e}},Eh=Ci(J,0).$name("dataBlockIndex"),Sh=Ci(J,0).$name("dataByteIndex"),Ph=Yi().$name("dataBuffer"),Ng=Ve([],J)`() {
  let i = dataByteIndex;
  dataByteIndex = dataByteIndex + 1u;
  return i;
}`.$uses({dataByteIndex:Sh}).$name("nextByteIndex"),q="dataBuffer[dataBlockIndex].serializedData[nextByteIndex()]",Uh={f32:Ve([$])`(n) => {
  ${q} = bitcast<u32>(n);
}`,f16:Ve([ut])`(n) => {
  ${q} = pack2x16float(vec2f(f32(n), 0.0));
}`,i32:Ve([Ue])`(n) => {
  ${q} = bitcast<u32>(n);
}`,u32:Ve([J])`(n) => {
  ${q} = n;
}`,bool:Ve([ke])`(b) => {
  ${q} = u32(b);
}`,vec2f:Ve([F])`(v) => {
  ${q} = bitcast<u32>(v.x);
  ${q} = bitcast<u32>(v.y);
}`,vec3f:Ve([O])`(v) => {
  ${q} = bitcast<u32>(v.x);
  ${q} = bitcast<u32>(v.y);
  ${q} = bitcast<u32>(v.z);
}`,vec4f:Ve([k])`(v) => {
  ${q} = bitcast<u32>(v.x);
  ${q} = bitcast<u32>(v.y);
  ${q} = bitcast<u32>(v.z);
  ${q} = bitcast<u32>(v.w);
}`,vec2h:Ve([Pn])`(v) => {
  ${q} = pack2x16float(vec2f(f32(v.x), f32(v.y)));
}`,vec3h:Ve([Un])`(v) => {
  ${q} = pack2x16float(vec2f(f32(v.x), f32(v.y)));
  ${q} = pack2x16float(vec2f(f32(v.z), 0.0));
}`,vec4h:Ve([An])`(v) => {
  ${q} = pack2x16float(vec2f(f32(v.x), f32(v.y)));
  ${q} = pack2x16float(vec2f(f32(v.z), f32(v.w)));
}`,vec2i:Ve([Be])`(v) => {
  ${q} = bitcast<u32>(v.x);
  ${q} = bitcast<u32>(v.y);
}`,vec3i:Ve([Ot])`(v) => {
  ${q} = bitcast<u32>(v.x);
  ${q} = bitcast<u32>(v.y);
  ${q} = bitcast<u32>(v.z);
}`,vec4i:Ve([Fe])`(v) => {
  ${q} = bitcast<u32>(v.x);
  ${q} = bitcast<u32>(v.y);
  ${q} = bitcast<u32>(v.z);
  ${q} = bitcast<u32>(v.w);
}`,vec2u:Ve([xt])`(v) => {
  ${q} = v.x;
  ${q} = v.y;
}`,vec3u:Ve([rt])`(v) => {
  ${q} = v.x;
  ${q} = v.y;
  ${q} = v.z;
}`,vec4u:Ve([Ye])`(v) => {
  ${q} = v.x;
  ${q} = v.y;
  ${q} = v.z;
  ${q} = v.w;
}`,"vec2<bool>":Ve([vr])`(v) => {
  ${q} = u32(v.x);
  ${q} = u32(v.y);
}`,"vec3<bool>":Ve([br])`(v) => {
  ${q} = u32(v.x);
  ${q} = u32(v.y);
  ${q} = u32(v.z);
}`,"vec4<bool>":Ve([Tr])`(v) => {
  ${q} = u32(v.x);
  ${q} = u32(v.y);
  ${q} = u32(v.z);
  ${q} = u32(v.w);
}`,mat2x2f:Ve([xn])`(m) => {
  ${q} = bitcast<u32>(m[0][0]);
  ${q} = bitcast<u32>(m[0][1]);
  ${q} = bitcast<u32>(m[1][0]);
  ${q} = bitcast<u32>(m[1][1]);
}`,mat3x3f:Ve([In])`(m) => {
  ${q} = bitcast<u32>(m[0][0]);
  ${q} = bitcast<u32>(m[0][1]);
  ${q} = bitcast<u32>(m[0][2]);
  ${q} = 0u;
  ${q} = bitcast<u32>(m[1][0]);
  ${q} = bitcast<u32>(m[1][1]);
  ${q} = bitcast<u32>(m[1][2]);
  ${q} = 0u;
  ${q} = bitcast<u32>(m[2][0]);
  ${q} = bitcast<u32>(m[2][1]);
  ${q} = bitcast<u32>(m[2][2]);
  ${q} = 0u;
}`,mat4x4f:Ve([we])`(m) => {
  ${q} = bitcast<u32>(m[0][0]);
  ${q} = bitcast<u32>(m[0][1]);
  ${q} = bitcast<u32>(m[0][2]);
  ${q} = bitcast<u32>(m[0][3]);
  ${q} = bitcast<u32>(m[1][0]);
  ${q} = bitcast<u32>(m[1][1]);
  ${q} = bitcast<u32>(m[1][2]);
  ${q} = bitcast<u32>(m[1][3]);
  ${q} = bitcast<u32>(m[2][0]);
  ${q} = bitcast<u32>(m[2][1]);
  ${q} = bitcast<u32>(m[2][2]);
  ${q} = bitcast<u32>(m[2][3]);
  ${q} = bitcast<u32>(m[3][0]);
  ${q} = bitcast<u32>(m[3][1]);
  ${q} = bitcast<u32>(m[3][2]);
  ${q} = bitcast<u32>(m[3][3]);
}`};for(let[e,t]of Object.entries(Uh))t.$name(`serialize${e[0].toLocaleUpperCase()}${e.slice(1)}`).$uses({dataBlockIndex:Eh,nextByteIndex:Ng,dataBuffer:Ph});function Ah(e){return`(${e.map((t,n)=>`_arg_${n}`).join(", ")})`}function Ih(e,t){let n=Uh[e.type];if(n)return n.with(Ph,t);if(vt(e)){let r=Object.keys(e.propTypes),s=Object.values(e.propTypes),i=Bh(s,t);return Ve([e])`(arg) {\n  propsSerializer(${r.map(p=>`arg.${p}`).join(", ")});\n}`.$uses({propsSerializer:i}).$name(`${W(e)??"struct"}Serializer`)}if(Lt(e)){let r=e.elementType,s=e.elementCount,i=Ih(r,t);return Ve([e])`(arg) {\n${Array.from({length:s},(p,y)=>`  elementSerializer(arg[${y}]);`).join(`
`)}\n}`.$uses({elementSerializer:i}).$name("arraySerializer")}throw new Error(`Cannot serialize data of type ${e.type}`)}function Bh(e,t){let n={},r=Ve(e),s=Ah(e),i=e.map((p,y)=>(n[`serializer${y}`]=Ih(p,t),`  serializer${y}(_arg_${y});`)).join(`
`);return r`${s} {\n${i}\n}`.$uses(n).$name("compoundSerializer")}function Fg(e,t,n,r,s){let i=t.map(_e).reduce((v,_)=>v+_,0);if(i>s.logSizeLimit)throw new Error(`Logged data needs to fit in ${s.logSizeLimit} bytes (one of the logs requires ${i} bytes). Consider increasing the limit by passing appropriate options to tgpu.init().`);let p=Bh(t,n).$name(`log${e}serializer`),y=Ah(t);return Ve(t)`${y} {
  dataBlockIndex = atomicAdd(&indexBuffer, 1);
  if (dataBlockIndex >= ${s.logCountLimit}) {
    return;
  }
  dataBuffer[dataBlockIndex].id = ${e};
  dataByteIndex = 0;

  compoundSerializer${y};
}`.$uses({indexBuffer:r,dataBuffer:n,dataBlockIndex:Eh,dataByteIndex:Sh,compoundSerializer:p}).$name(`log${e}`)}var Lg=["log","debug","info","warn","error","clear"],jg={logCountLimit:64,logSizeLimit:252,messagePrefix:" GPU "},kh=B("/* console.log() */",at),Yg=class{get logResources(){}generateLog(){return console.warn("'console.log' is currently only supported in compute pipelines."),kh}},Cg=class{#e;#t;#n=1;#r;#s;constructor(t){this.#e={...jg,...t[E].logOptions},this.#t=new Map;let n=qn({id:J,serializedData:Yn(J,Math.ceil(this.#e.logSizeLimit/4))}).$name("SerializedLogData");this.#s=t.createMutable(Yn(n,this.#e.logCountLimit)).$name("dataBuffer"),this.#r=t.createMutable(Uc(J)).$name("indexBuffer")}generateLog(t,n,r){if(!Lg.includes(n))return console.warn(`Unsupported log method '${n}' was used in TGSL.`),kh;let s=zf(r),i=this.#n++,p=s.filter(_=>_.dataType!==kt),y=Fg(i,p.map(_=>_.dataType),this.#s,this.#r,this.#e),v=s.map(_=>_.dataType===kt?_.value:_.dataType);return this.#t.set(i,{op:n,argTypes:v}),B(S`${t.resolve(y).value}(${p})`,at)}get logResources(){return this.#n===1?void 0:{dataBuffer:this.#s,indexBuffer:this.#r,options:this.#e,logIdToMeta:this.#t}}},Oh="#CATCHALL#",qg=class{_stack=[];_itemDepth=0;get itemDepth(){return this._itemDepth}get topItem(){let t=this._stack[this._stack.length-1];if(!t||t.type!=="item")throw new Error("Internal error, expected item layer to be on top.");return t}get topFunctionScope(){return this._stack.findLast(t=>t.type==="functionScope")}pushItem(){this._itemDepth++,this._stack.push({type:"item",usedSlots:new Set})}popItem(){this.pop("item")}pushSlotBindings(t){this._stack.push({type:"slotBinding",bindingMap:new WeakMap(t)})}popSlotBindings(){this.pop("slotBinding")}pushFunctionScope(t,n,r,s){let i={type:"functionScope",args:t,argAliases:n,returnType:r,externalMap:s,reportedReturnTypes:new Set};return this._stack.push(i),i}popFunctionScope(){this.pop("functionScope")}pushBlockScope(){this._stack.push({type:"blockScope",declarations:new Map})}popBlockScope(){this.pop("blockScope")}pop(t){let n=this._stack[this._stack.length-1];if(!n||t&&n.type!==t)throw new Error(`Internal error, expected a ${t} layer to be on top.`);this._stack.pop(),t==="item"&&this._itemDepth--}readSlot(t){for(let n=this._stack.length-1;n>=0;--n){let r=this._stack[n];if(r?.type==="item")r.usedSlots.add(t);else if(r?.type==="slotBinding"){let s=r.bindingMap.get(t);if(s!==void 0)return s}else if(!(r?.type==="functionScope"||r?.type==="blockScope"))throw new Error("Unknown layer type.")}return t.defaultValue}getSnippetById(t){for(let n=this._stack.length-1;n>=0;--n){let r=this._stack[n];if(r?.type==="functionScope"){let s=r.args.find(p=>p.value===t);if(s!==void 0)return s;if(r.argAliases[t])return r.argAliases[t];let i=r.externalMap[t];return i!=null?Mi(i):void 0}if(r?.type==="blockScope"){let s=r.declarations.get(t);if(s!==void 0)return s}}}defineBlockVariable(t,n){if(n.dataType.type==="unknown")throw Error(`Tried to define variable '${t}' of unknown type`);for(let r=this._stack.length-1;r>=0;--r){let s=this._stack[r];if(s?.type==="blockScope"){s.declarations.set(t,n);return}}throw new Error("No block scope found to define a variable in.")}},Ei=["","  ","    ","      ","        ","          ","            ","              ","                "],ya=Ei.length-1,Wg=class{identLevel=0;get pre(){return Ei[this.identLevel]??Ei[ya].repeat(this.identLevel/ya)+Ei[this.identLevel%ya]}indent(){let t=this.pre;return this.identLevel++,t}dedent(){return this.identLevel--,this.pre}withResetLevel(t){let n=this.identLevel;this.identLevel=0;try{return t()}finally{this.identLevel=n}}},Vh=class{#e;#t;_indentController=new Wg;_itemStateStack=new qg;#n=[];_declarations=[];_varyingLocations;#r=new WeakSet;#s;get varyingLocations(){return this._varyingLocations}[E]={itemStateStack:this._itemStateStack};bindGroupLayoutsToPlaceholderMap=new Map;_nextFreeLayoutPlaceholderIdx=0;fixedBindings=[];enableExtensions;expectedType;constructor(e){this.enableExtensions=e.enableExtensions,this.#t=e.shaderGenerator??Rc,this.#s=e.root?new Cg(e.root):new Yg,this.#e=e.namespace[E]}getUniqueName(e){return eg(this.#e,e)}makeNameValid(e){return this.#e.nameRegistry.makeValid(e)}get pre(){return this._indentController.pre}get topFunctionReturnType(){let e=this._itemStateStack.topFunctionScope;return Kn(e),e.returnType}get shelllessRepo(){return this.#e.shelllessRepo}indent(){return this._indentController.indent()}dedent(){return this._indentController.dedent()}withResetIndentLevel(e){return this._indentController.withResetLevel(e)}getById(e){let t=this._itemStateStack.getSnippetById(e);return t===void 0?null:t}defineVariable(e,t){this._itemStateStack.defineBlockVariable(e,t)}reportReturnType(e){let t=this._itemStateStack.topFunctionScope;Kn(t),t.reportedReturnTypes.add(e)}pushBlockScope(){this._itemStateStack.pushBlockScope()}popBlockScope(){this._itemStateStack.popBlockScope()}generateLog(e,t){return this.#s.generateLog(this,e,t)}get logResources(){return this.#s.logResources}fnToWgsl(e){let t=this._itemStateStack.pushFunctionScope(e.args,e.argAliases,e.returnType,e.externalMap);try{this.#t.initGenerator(this);let n=this.#t.functionDefinition(e.body),r=e.returnType;if(!r){let s=[...t.reportedReturnTypes];if(s.length===0)r=at;else{let i=go(s);i&&!i.hasImplicitConversions&&(r=i.targetType)}if(!r)throw new Error(`Expected function to have a single return type, got [${s.join(", ")}]. Cast explicitly to the desired type.`);r=Fs(r)}return{head:Xg(this,e.args,r),body:n,returnType:r}}finally{this._itemStateStack.popFunctionScope()}}addDeclaration(e){this._declarations.push(e)}allocateLayoutEntry(e){let t=this.bindGroupLayoutsToPlaceholderMap,n=t.get(e);return n||(n=`#BIND_GROUP_LAYOUT_${this._nextFreeLayoutPlaceholderIdx++}#`,t.set(e,n)),n}allocateFixedEntry(e,t){let n=this.fixedBindings.length;return this.fixedBindings.push({layoutEntry:e,resource:t}),{group:Oh,binding:n}}readSlot(e){let t=this._itemStateStack.readSlot(e);if(t===void 0)throw new zp(e);return t}withSlots(e,t){this._itemStateStack.pushSlotBindings(e);try{return t()}finally{this._itemStateStack.popSlotBindings()}}withVaryingLocations(e,t){this._varyingLocations=e;try{return t()}finally{this._varyingLocations=void 0}}unwrap(e){if(Ia(e))return this.withSlots(e[Ur].pairs,()=>this.unwrap(e[Ur].inner));let t=e;for(;;)if(Ua(t))t=this.readSlot(t);else if(Aa(t))t=this._getOrCompute(t);else break;return t}_getOrCompute(e){let t=this.#e.memoizedDerived.get(e)??[];this._itemStateStack.pushItem();try{for(let s of t)if([...s.slotToValueMap.entries()].every(([i,p])=>i.areEqual(this._itemStateStack.readSlot(i),p)))return s.result;this.pushMode(new jl);let n;try{n=e["~compute"]()}finally{this.popMode("normal")}let r=new Map;for(let s of this._itemStateStack.topItem.usedSlots)r.set(s,this._itemStateStack.readSlot(s));return t.push({slotToValueMap:r,result:n}),this.#e.memoizedDerived.set(e,t),n}catch(n){throw n instanceof $s?n.appendToTrace(e):new $s(n,[e])}finally{this._itemStateStack.popItem()}}_getOrInstantiate(e){let t=this.#e.memoizedResolves.get(e)??[];this._itemStateStack.pushItem();try{for(let s of t)if([...s.slotToValueMap.entries()].every(([i,p])=>i.areEqual(this._itemStateStack.readSlot(i),p)))return s.result;let n;if(Gr(e))n=B(hh(this,e),at);else if(Aa(e)||Ua(e))n=this.resolve(this.unwrap(e));else if(Yl(e))n=e[he](this);else if(Ss(e)){let s=this.#e.shelllessRepo.get(e,void 0);if(!s)throw new Error(`Couldn't resolve ${e.name}. Make sure it's a function that accepts no arguments, or call it from another TypeGPU function.`);return this.withResetIndentLevel(()=>this.resolve(s))}else throw new TypeError(`Unresolvable internal value: ${Jt(e)}`);let r=new Map;for(let s of this._itemStateStack.topItem.usedSlots)r.set(s,this._itemStateStack.readSlot(s));return t.push({slotToValueMap:r,result:n}),this.#e.memoizedResolves.set(e,t),n}catch(n){throw n instanceof $s?n.appendToTrace(e):new $s(n,[e])}finally{this._itemStateStack.popItem()}}resolve(e,t){if(ih(e)||Ss(e)){if(this.#r.has(e)&&!this.#e.memoizedResolves.has(e))throw new Error(`Recursive function ${e} detected. Recursion is not allowed on the GPU.`);this.#r.add(e)}if(Ia(e))return this.withSlots(e[Ur].pairs,()=>this.resolve(e[Ur].inner,t));if(Ge(e)||Ss(e)){if(this._itemStateStack.itemDepth===0)try{this.pushMode(new Pp);let n=Cl(this,()=>this._getOrInstantiate(e));return B(`${[...this._declarations].join(`

`)}${n.value}`,at)}finally{this.popMode("codegen")}return this._getOrInstantiate(e)}if(typeof e=="number"){let n=t??Ri(e).dataType;if(Kn(n.type!=="unknown"),n.type==="abstractInt")return B(`${e}`,n);if(n.type==="u32")return B(`${e}u`,n);if(n.type==="i32")return B(`${e}i`,n);let r=e.toExponential(),s=n.type==="abstractFloat"&&Number.isInteger(e)?`${e}.`:`${e}`,i=r.length<s.length?r:s;return n.type==="f32"?B(`${i}f`,n):n.type==="f16"?B(`${i}h`,n):B(i,n)}if(typeof e=="boolean")return B(e?"true":"false",ke);if(typeof e=="string")return B(e,at);if(t&&Lt(t)){if(!Array.isArray(e))throw new yn(`Cannot coerce ${e} into value of type '${t}'`);if(t.elementCount!==e.length)throw new yn(`Cannot create value of type '${t}' from an array of length: ${e.length}`);let n=this.resolve(t.elementType);return B(S`array<${n}, ${t.elementCount}>(${e.map(r=>B(r,t.elementType))})`,t)}if(Array.isArray(e))return B(S`array(${e.map(n=>this.resolve(n))})`,kt);if(t&&vt(t))return B(S`${this.resolve(t)}(${Object.entries(t.propTypes).map(([n,r])=>B(e[n],r))})`,t);throw new yn(`Value ${e} (as json: ${Jt(e)}) is not resolvable${t?` to type ${t.type}`:""}`)}pushMode(e){this.#n.push(e)}popMode(e){let t=this.#n.pop();e!==void 0&&Kn(t?.type===e)}get mode(){return this.#n[this.#n.length-1]??ql}};function Co(e,t){let n=new Vh(t),r=(t.config?n.withSlots(t.config(new ph([])).bindings,()=>n.resolve(e)):n.resolve(e)).value,s=n.bindGroupLayoutsToPlaceholderMap,i=[],p=new Set([...s.keys()].map(U=>U.index).filter(U=>U!==void 0)),y=ug(p),v=n.fixedBindings.map((U,R)=>[String(R),U.layoutEntry]),_=()=>{let U=y.next().value,R=Th(Object.fromEntries(v));return i[U]=R,r=r.replaceAll(Oh,String(U)),[U,new Mh(R,Object.fromEntries(n.fixedBindings.map((j,L)=>[String(L),j.resource])))]},P=v.length>0?_():void 0;for(let[U,R]of s.entries()){let j=U.index??y.next().value;i[j]=U,r=r.replaceAll(R,String(j))}return t.enableExtensions&&t.enableExtensions.length>0&&(r=`${t.enableExtensions.map(U=>`enable ${U};`).join(`
`)}

${r}`),{code:r,usedBindGroupLayouts:i,catchall:P,logResources:n.logResources}}function Xg(e,t,n){let r=t.map(s=>`${s.value}: ${e.resolve(s.dataType).value}`).join(", ");return n.type!=="void"?`(${r}) -> ${ko(n)}${e.resolve(n).value} `:`(${r}) `}function Gh(e){let t=e;return t?.resourceType==="compute-pipeline"&&!!t[E]}function Dh(e){let t=e;return t?.resourceType==="render-pipeline"&&!!t[E]}function Jg(e){return Dh(e)||Gh(e)}function Rh(e){let{externals:t,shaderGenerator:n,template:r,names:s="random",config:i,enableExtensions:p}=e,y={};As(y,t??{});let v={[E]:!0,[he](P){return B(ea(P,y,r??""),at)},toString:()=>"<root>"},_=Object.values(t).filter(Jg);if(_.length>1)throw new Error(`Found ${_.length} pipelines but can only resolve one at a time.`);return Co(v,{namespace:typeof s=="string"?si({names:s}):s,enableExtensions:p,shaderGenerator:n,config:i,root:_[0]?.[E].branch})}function Zg(e){return Rh(e).code}function Hg(e){let t=yr()??new Vh({namespace:si(),shaderGenerator:Rc}),n=[1,1,1],r=[1,1,1],s=[n[0]*r[0],n[1]*r[1],n[2]*r[2]],i=new Map,p=Array.from({length:n[0]},()=>Array.from({length:n[1]},()=>Array.from({length:n[2]},()=>new Map))),y=Array.from({length:s[0]},()=>Array.from({length:s[1]},()=>Array.from({length:s[2]},()=>new Map))),v=Array.from({length:s[0]},(_,P)=>Array.from({length:s[1]},(U,R)=>Array.from({length:s[2]},(j,L)=>{let Z=Math.floor(P/r[0]),Q=Math.floor(R/r[1]),re=Math.floor(L/r[2]);return new Up(i,{private:y[P][R][L],workgroup:p[Z][Q][re]})})));t.pushMode(v[0][0][0]);try{return{value:Cl(t,e),buffers:i,privateVars:y,workgroupVars:p}}finally{t.popMode("simulate")}}function Qg(e,t,n,r){return new Kg(e,t,n,r)}function qo(e){let t=e;return t?.resourceType==="query-set"&&!!t[E]}var Kg=class{constructor(t,n,r,s){this.type=n,this.count=r,this.rawQuerySet=s,this.#e=t.device,this._ownQuerySet=!s,this._querySet=s||null}resourceType="query-set";#e;_querySet=null;_ownQuerySet;_destroyed=!1;_available=!0;_readBuffer=null;_resolveBuffer=null;get querySet(){if(this._destroyed)throw new Error("This QuerySet has been destroyed.");return this.rawQuerySet?this.rawQuerySet:this._querySet?this._querySet:(this._querySet=this.#e.createQuerySet({type:this.type,count:this.count}),this._querySet)}get destroyed(){return this._destroyed}get available(){return this._available}get[E](){let t=this;return{get readBuffer(){return t._readBuffer||(t._readBuffer=t.#e.createBuffer({size:t.count*BigUint64Array.BYTES_PER_ELEMENT,usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ})),t._readBuffer},get resolveBuffer(){return t._resolveBuffer||(t._resolveBuffer=t.#e.createBuffer({size:t.count*BigUint64Array.BYTES_PER_ELEMENT,usage:GPUBufferUsage.QUERY_RESOLVE|GPUBufferUsage.COPY_SRC})),t._resolveBuffer}}}$name(t){return Ne(this,t),this._querySet&&(this._querySet.label=t),this}resolve(){if(this._destroyed)throw new Error("This QuerySet has been destroyed.");if(!this._available)throw new Error("This QuerySet is busy resolving or reading.");let t=this.#e.createCommandEncoder();t.resolveQuerySet(this.querySet,0,this.count,this[E].resolveBuffer,0),this.#e.queue.submit([t.finish()])}async read(){if(!this._resolveBuffer)throw new Error("QuerySet must be resolved before reading.");this._available=!1;try{let t=this.#e.createCommandEncoder();t.copyBufferToBuffer(this[E].resolveBuffer,0,this[E].readBuffer,0,this.count*BigUint64Array.BYTES_PER_ELEMENT),this.#e.queue.submit([t.finish()]);let n=this[E].readBuffer;await n.mapAsync(GPUMapMode.READ);let r=new BigUint64Array(n.getMappedRange().slice());return n.unmap(),Array.from(r)}finally{this._available=!0}}destroy(){this._destroyed||(this._destroyed=!0,this._querySet&&this._ownQuerySet&&this._querySet.destroy(),this._readBuffer?.destroy(),this._resolveBuffer?.destroy(),this._readBuffer=this._resolveBuffer=null)}},Ou=class{constructor(e){this._make=e}_map=new WeakMap;getOrMake(e,...t){if(this._map.has(e))return this._map.get(e);let n=this._make(e,...t);return this._map.set(e,n),n}},ga=class{constructor(e,t){this.resourceType=e,this.buffer=t,this[st]=t,this.#e=this.buffer.as(this.resourceType)}[E]=!0;[st];#e;$name(e){return Ne(this[st],e),this}write(e){this.buffer.write(e)}writePartial(e){this.buffer.writePartial(e)}read(){return this.buffer.read()}get[Re](){return this.#e.$}get $(){return this.#e.$}get value(){return this.$}[he](e){return e.resolve(this.#e)}},fe=e=>Hc(e??0),On=e=>Qc(e??0),ns=e=>Kc(e??0),ew={f32:e=>fe(e[0]),f16:e=>ns(e[0]).x,i32:e=>On(e[0]),u32:e=>e[0]??0,bool:e=>!!e[0],vec2f:e=>F(fe(e[0]),fe(e[1])),vec3f:e=>O(fe(e[0]),fe(e[1]),fe(e[2])),vec4f:e=>k(fe(e[0]),fe(e[1]),fe(e[2]),fe(e[3])),vec2h(e){let t=ns(e[0]);return Pn(t.x,t.y)},vec3h(e){let t=ns(e[0]),n=ns(e[1]);return Un(t.x,t.y,n.x)},vec4h(e){let t=ns(e[0]),n=ns(e[1]);return An(t.x,t.y,n.x,n.y)},vec2i:e=>Be(On(e[0]),On(e[1])),vec3i:e=>Ot(On(e[0]),On(e[1]),On(e[2])),vec4i:e=>Fe(On(e[0]),On(e[1]),On(e[2]),On(e[3])),vec2u:e=>xt(e[0]??0,e[1]??0),vec3u:e=>rt(e[0]??0,e[1]??0,e[2]??0),vec4u:e=>Ye(e[0]??0,e[1]??0,e[2]??0,e[3]??0),"vec2<bool>":e=>vr(!!e[0],!!e[1]),"vec3<bool>":e=>br(!!e[0],!!e[1],!!e[2]),"vec4<bool>":e=>Tr(!!e[0],!!e[1],!!e[2],!!e[3]),mat2x2f:e=>xn(fe(e[0]),fe(e[1]),fe(e[2]),fe(e[3])),mat3x3f:e=>In(fe(e[0]),fe(e[1]),fe(e[2]),fe(e[4]),fe(e[5]),fe(e[6]),fe(e[8]),fe(e[9]),fe(e[10])),mat4x4f:e=>we(fe(e[0]),fe(e[1]),fe(e[2]),fe(e[3]),fe(e[4]),fe(e[5]),fe(e[6]),fe(e[7]),fe(e[8]),fe(e[9]),fe(e[10]),fe(e[11]),fe(e[12]),fe(e[13]),fe(e[14]),fe(e[15]))};function tw(e,t){let n=ew[t.type];if(n)return n(e);if(vt(t)){let r=Object.keys(t.propTypes),s=Object.values(t.propTypes),i=Ja(e,s);return Object.fromEntries(r.map((p,y)=>[p,i[y]]))}if(Lt(t)){let r=t.elementType,s=t.elementCount;return Ja(e,Array.from({length:s},()=>r))}throw new Error(`Cannot deserialize data of type ${t.type}`)}function Ja(e,t){let n=0;return t.map(r=>{if(!zt(r))return r;let s=Math.ceil(_e(r)/4),i=tw(e.subarray(n,n+s),r);return n+=s,i})}function nw(e,t){return Ja(e,t).map(Oa)}function Za(e){let{indexBuffer:t,dataBuffer:n,logIdToMeta:r,options:s}=e;n.read().then(i=>{i.filter(p=>p.id).forEach(({id:p,serializedData:y})=>{let{argTypes:v,op:_}=r.get(p),P=nw(new Uint32Array(y),v);P.length===0&&P.push(""),console[_](`%c${s.messagePrefix}%c ${P[0]}`,"background: #936ff5; color: white;","color: inherit; background: none",...P.slice(1))})}),t.read().then(i=>{i>s.logCountLimit&&console.warn(`Log count limit per dispatch (${s.logCountLimit}) exceeded by ${i-s.logCountLimit} calls. Consider increasing the limit by passing appropriate options to tgpu.init().`)}),n.buffer.clear(),t.buffer.clear()}function Nh(e,t,n){if(!n.enabledFeatures.has("timestamp-query"))throw new Error('Performance callback requires the "timestamp-query" feature to be enabled on GPU device.');return e.timestampWrites?{...e,performanceCallback:t}:{...e,performanceCallback:t,hasAutoQuerySet:!0,timestampWrites:{querySet:(globalThis.__TYPEGPU_AUTONAME__??(r=>r))(n.createQuerySet("timestamp",2),"querySet"),beginningOfPassWriteIndex:0,endOfPassWriteIndex:1}}}function Fh(e,t,n){if(!n.enabledFeatures.has("timestamp-query"))throw new Error('Timestamp writes require the "timestamp-query" feature to be enabled on GPU device.');e.hasAutoQuerySet&&e.timestampWrites&&e.timestampWrites.querySet.destroy();let r={querySet:t.querySet};return t.beginningOfPassWriteIndex!==void 0&&(r.beginningOfPassWriteIndex=t.beginningOfPassWriteIndex),t.endOfPassWriteIndex!==void 0&&(r.endOfPassWriteIndex=t.endOfPassWriteIndex),{...e,hasAutoQuerySet:!1,timestampWrites:r}}function Lh(e,t){if(!e.timestampWrites)return{};let{querySet:n,beginningOfPassWriteIndex:r,endOfPassWriteIndex:s}=e.timestampWrites,i={querySet:qo(n)?t.unwrap(n):n};return r!==void 0&&(i.beginningOfPassWriteIndex=r),s!==void 0&&(i.endOfPassWriteIndex=s),{timestampWrites:i}}function Ha({root:e,priors:t}){let n=t.timestampWrites?.querySet,r=t.performanceCallback;if(!n)throw new Error("Cannot dispatch workgroups with performance callback without a query set.");if(!qo(n))throw new Error("Performance callback with raw GPUQuerySet is not supported. Use TgpuQuerySet instead.");let s=e.device.createCommandEncoder();s.resolveQuerySet(e.unwrap(n),0,n.count,n[E].resolveBuffer,0),e.device.queue.submit([s.finish()]),e.device.queue.onSubmittedWorkDone().then(async()=>{if(!n.available)return;let i=await n.read(),p=i[t.timestampWrites?.beginningOfPassWriteIndex??0],y=i[t.timestampWrites?.endOfPassWriteIndex??1];if(p===void 0||y===void 0)throw new Error("QuerySet did not return valid timestamps.");await r(p,y)})}function rw(e,t,n){return new sw(new iw(e,t,n),{})}var sw=class zs{constructor(t,n){this._core=t,this._priors=n,this[E]={get rawPipeline(){return t.unwrap().pipeline},get priors(){return n},get branch(){return t.branch}},this[st]=t}[E];resourceType="compute-pipeline";[st];[he](t){return t.resolve(this._core)}toString(){return`computePipeline:${W(this)??"<unnamed>"}`}get rawPipeline(){return this._core.unwrap().pipeline}with(t,n){return ji(t)?new zs(this._core,{...this._priors,bindGroupLayoutMap:new Map([...this._priors.bindGroupLayoutMap??[],[t.layout,t]])}):new zs(this._core,{...this._priors,bindGroupLayoutMap:new Map([...this._priors.bindGroupLayoutMap??[],[t,n]])})}withPerformanceCallback(t){let n=Nh(this._priors,t,this._core.branch);return new zs(this._core,n)}withTimestampWrites(t){let n=Fh(this._priors,t,this._core.branch);return new zs(this._core,n)}dispatchWorkgroups(t,n,r){let s=this._core.unwrap(),{branch:i}=this._core,p={label:W(this._core)??"<unnamed>",...Lh(this._priors,i)},y=i.device.createCommandEncoder(),v=y.beginComputePass(p);v.setPipeline(s.pipeline);let _=new Set(s.usedBindGroupLayouts);if(s.usedBindGroupLayouts.forEach((P,U)=>{if(s.catchall&&U===s.catchall[0])v.setBindGroup(U,i.unwrap(s.catchall[1])),_.delete(P);else{let R=this._priors.bindGroupLayoutMap?.get(P);R!==void 0&&(_.delete(P),v.setBindGroup(U,i.unwrap(R)))}}),_.size>0)throw new po(_);v.dispatchWorkgroups(t,n,r),v.end(),i.device.queue.submit([y.finish()]),s.logResources&&Za(s.logResources),this._priors.performanceCallback&&Ha({root:i,priors:this._priors})}$name(t){return Ne(this._core,t),this}},iw=class{constructor(t,n,r){this.branch=t,this._slotBindings=n,this._entryFn=r}[E]=!0;_memo;[he](t){return t.withSlots(this._slotBindings,()=>(t.resolve(this._entryFn),B("",at)))}toString(){return"computePipelineCore"}unwrap(){if(this._memo===void 0){let t=this.branch.device,n=jo.filter(P=>this.branch.enabledFeatures.has(rh[P])),r,s=si({names:this.branch.nameRegistrySetting});r=Co(this,{namespace:s,enableExtensions:n,shaderGenerator:this.branch.shaderGenerator,root:this.branch});let{code:i,usedBindGroupLayouts:p,catchall:y,logResources:v}=r;y!==void 0&&p[y[0]]?.$name(`${W(this)??"<unnamed>"} - Automatic Bind Group & Layout`);let _=t.createShaderModule({label:`${W(this)??"<unnamed>"} - Shader`,code:i});this._memo={pipeline:t.createComputePipeline({label:W(this)??"<unnamed>",layout:t.createPipelineLayout({label:`${W(this)??"<unnamed>"} - Pipeline Layout`,bindGroupLayouts:p.map(P=>this.branch.unwrap(P))}),compute:{module:_}}),usedBindGroupLayouts:p,catchall:y,logResources:v}}return this._memo}};function Vu(e,t="vertex"){return new aw(e,t)}function jh(e){return e?.resourceType==="vertex-layout"}var Qa=Symbol("defaultAttribEntry");function Si(e,t,n,r,s){if(Mn(t)||En(t)){let i=mr(t);return i!==void 0&&(r[s??Qa]=i),Si(e,t.inner,sn(n,wn(t)),r)}if(vt(t)){let i=n,p=t.propTypes;return Object.fromEntries(Object.entries(p).map(([y,v])=>{i=sn(i,tt(v));let _=[y,Si(e,v,i,r,y)];return i+=_e(v),_}))}if(zn(t)){let i=n,p=t.propTypes;return Object.fromEntries(Object.entries(p).map(([y,v])=>{i=sn(i,wn(v));let _=[y,Si(e,v,i,r,y)];return i+=_e(v),_}))}if("type"in t&&typeof t.type=="string"){if(Il.includes(t.type))return{_layout:e,format:t.type,offset:n};let i=Tp[t.type];if(i)return{_layout:e,format:i,offset:n}}throw new Error(`Unsupported data used in vertex layout: ${String(t)}`)}var aw=class{constructor(t,n){this.schemaForCount=t,this.stepMode=n;let r=t(0);this.stride=sn(_e(r.elementType),tt(r)),this.attrib=Si(this,r.elementType,0,this._customLocationMap)}[E]=!0;resourceType="vertex-layout";stride;attrib;_customLocationMap={};get vertexLayout(){if(this._customLocationMap[Qa]!==void 0){if(typeof this.attrib.format!="string"||typeof this.attrib.offset!="number")throw new Error("Single attribute vertex layouts must have a format and offset.");return{arrayStride:this.stride,stepMode:this.stepMode,attributes:[{format:this.attrib.format,offset:this.attrib.offset,shaderLocation:this._customLocationMap[Qa]}]}}if(!Object.keys(this.attrib).every(t=>this._customLocationMap[t]!==void 0))throw new Error("All attributes must have custom locations in order to unwrap a vertex layout.");return{arrayStride:this.stride,stepMode:this.stepMode,attributes:[...Object.entries(this.attrib).map(([t,n])=>({format:n.format,offset:n.offset,shaderLocation:this._customLocationMap[t]}))]}}$name(t){return Ne(this,t),this}};function ow(e){return typeof e?.loadOp=="string"}function uw(e,t){if(Gr(e)){if(!ow(t))throw new Error("Expected a single color attachment, not a record.");return[t]}let n=[];for(let r of Object.keys(e)){let s=e[r];if(Rr(s))continue;let i=t[r];if(!i)throw new Error(`A color attachment by the name of '${r}' was not provided to the shader.`);n.push(i)}return n}function lw(e){return typeof e?.format=="string"}function cw(e,t){if(Gr(e)){if(Ul(e))return[];if(!lw(t))throw new Error("Expected a single color target configuration, not a record.");return[t]}let n=[];for(let r of Object.keys(e)){let s=e[r];if(Rr(s))continue;let i=t[r];if(!i)throw new Error(`A color target by the name of '${r}' was not provided to the shader.`);n.push(i)}return n}function Yh(e){return new hw(new pw(e),{})}var hw=class Dn{[E];resourceType="render-pipeline";[st];hasIndexBuffer=!1;constructor(t,n){this[E]={core:t,priors:n,branch:t.options.branch},this[st]=t}[he](t){return t.resolve(this[E].core)}toString(){return`renderPipeline:${W(this)??"<unnamed>"}`}$name(t){return Ne(this[E].core,t),this}with(t,n){let r=this[E];if(ji(t))return new Dn(r.core,{...r.priors,bindGroupLayoutMap:new Map([...r.priors.bindGroupLayoutMap??[],[t.layout,t]])});if(_h(t))return new Dn(r.core,{...r.priors,bindGroupLayoutMap:new Map([...r.priors.bindGroupLayoutMap??[],[t,n]])});if(jh(t))return new Dn(r.core,{...r.priors,vertexLayoutMap:new Map([...r.priors.vertexLayoutMap??[],[t,n]])});throw new Error("Unsupported value passed into .with()")}withPerformanceCallback(t){let n=this[E],r=Nh(n.priors,t,n.core.options.branch);return new Dn(n.core,r)}withTimestampWrites(t){let n=this[E],r=Fh(n.priors,t,n.core.options.branch);return new Dn(n.core,r)}withColorAttachment(t){let n=this[E];return new Dn(n.core,{...n.priors,colorAttachment:t})}withDepthStencilAttachment(t){let n=this[E];return new Dn(n.core,{...n.priors,depthStencilAttachment:t})}withIndexBuffer(t,n,r,s){let i=this[E];if(Ba(t)){if(typeof n!="string")throw new Error("If a GPUBuffer is passed, indexFormat must be provided.");return new Dn(i.core,{...i.priors,indexBuffer:{buffer:t,indexFormat:n,offsetBytes:r,sizeBytes:s}})}let p={u32:"uint32",u16:"uint16"},y=t.dataType.elementType;return new Dn(i.core,{...i.priors,indexBuffer:{buffer:t,indexFormat:p[y.type],offsetBytes:n!==void 0?n*_e(y):void 0,sizeBytes:s!==void 0?s*_e(y):void 0}})}setupRenderPass(t){let n=this[E],r=n.core.unwrap(),{branch:s,fragmentFn:i}=n.core.options,p=i?uw(i.shell.out,n.priors.colorAttachment??{}).map(U=>Cs(U.view)?{...U,view:s.unwrap(U.view).createView()}:Li(U.view)?{...U,view:s.unwrap(U.view)}:U):[null],y={label:W(n.core)??"<unnamed>",colorAttachments:p,...Lh(n.priors,s)};if(n.priors.depthStencilAttachment!==void 0){let U=n.priors.depthStencilAttachment;Cs(U.view)?y.depthStencilAttachment={...U,view:s.unwrap(U.view).createView()}:y.depthStencilAttachment=U}let v=t.beginRenderPass(y);v.setPipeline(r.pipeline);let _=new Set(r.usedBindGroupLayouts);r.usedBindGroupLayouts.forEach((U,R)=>{if(r.catchall&&R===r.catchall[0])v.setBindGroup(R,s.unwrap(r.catchall[1])),_.delete(U);else{let j=n.priors.bindGroupLayoutMap?.get(U);j!==void 0&&(_.delete(U),v.setBindGroup(R,s.unwrap(j)))}});let P=new Set(n.core.usedVertexLayouts);if(n.core.usedVertexLayouts.forEach((U,R)=>{let j=n.priors.vertexLayoutMap?.get(U);j&&(P.delete(U),v.setVertexBuffer(R,s.unwrap(j)))}),_.size>0)throw new po(_);if(P.size>0)throw new Gl(P);return v}draw(t,n,r,s){let i=this[E],{branch:p}=i.core.options,{logResources:y}=i.core.unwrap(),v=p.device.createCommandEncoder(),_=this.setupRenderPass(v);_.draw(t,n,r,s),_.end(),p.device.queue.submit([v.finish()]),y&&Za(y),i.priors.performanceCallback&&Ha({root:p,priors:i.priors})}drawIndexed(t,n,r,s,i){let p=this[E];if(!p.priors.indexBuffer)throw new Error("No index buffer set for this render pipeline.");let{logResources:y}=p.core.unwrap(),{branch:v}=p.core.options,{buffer:_,indexFormat:P,offsetBytes:U,sizeBytes:R}=p.priors.indexBuffer,j=v.device.createCommandEncoder(),L=this.setupRenderPass(j);Ba(_)?L.setIndexBuffer(_,P,U,R):L.setIndexBuffer(v.unwrap(_),P,U,R),L.drawIndexed(t,n,r,s,i),L.end(),v.device.queue.submit([j.finish()]),y&&Za(y),p.priors.performanceCallback&&Ha({root:v,priors:p.priors})}},pw=class{constructor(t){this.options=t;let n=tg(t.vertexFn.shell.in??{},t.vertexAttribs);this._vertexBufferLayouts=n.bufferDefinitions,this.usedVertexLayouts=n.usedVertexLayouts,this._targets=t.fragmentFn&&t.targets?cw(t.fragmentFn.shell.out,t.targets):[null]}[E]=!0;usedVertexLayouts;_memo;_vertexBufferLayouts;_targets;[he](t){let{vertexFn:n,fragmentFn:r,slotBindings:s}=this.options,i=dw(n.shell.out,r?.shell.in,W(n)??"<unnamed>",W(r)??"<unnamed>");return t.withVaryingLocations(i,()=>t.withSlots(s,()=>(t.resolve(n),r&&t.resolve(r),B("",at))))}toString(){return"renderPipelineCore"}unwrap(){if(this._memo===void 0){let{branch:t,primitiveState:n,depthStencilState:r,multisampleState:s}=this.options,i=t.device,p=jo.filter(Q=>t.enabledFeatures.has(rh[Q])),y,v=si({names:t.nameRegistrySetting});y=Co(this,{namespace:v,enableExtensions:p,shaderGenerator:t.shaderGenerator,root:t});let{code:_,usedBindGroupLayouts:P,catchall:U,logResources:R}=y;U!==void 0&&P[U[0]]?.$name(`${W(this)??"<unnamed>"} - Automatic Bind Group & Layout`);let j=i.createShaderModule({label:`${W(this)??"<unnamed>"} - Shader`,code:_}),L={layout:i.createPipelineLayout({label:`${W(this)??"<unnamed>"} - Pipeline Layout`,bindGroupLayouts:P.map(Q=>t.unwrap(Q))}),vertex:{module:j,buffers:this._vertexBufferLayouts}},Z=W(this);Z!==void 0&&(L.label=Z),this.options.fragmentFn&&(L.fragment={module:j,targets:this._targets}),n&&(zt(n.stripIndexFormat)?L.primitive={...n,stripIndexFormat:{u32:"uint32",u16:"uint16"}[n.stripIndexFormat.type]}:L.primitive=n),r&&(L.depthStencil=r),s&&(L.multisample=s),this._memo={pipeline:i.createRenderPipeline(L),usedBindGroupLayouts:P,catchall:U,logResources:R}}return this._memo}};function dw(e,t,n,r){let s={},i=new Set;function p(v,_){s[v]=_,i.add(_)}for(let[v,_]of Object.entries(e)){let P=mr(_);P!==void 0&&p(v,P)}for(let[v,_]of Object.entries(t??{})){let P=mr(_);P!==void 0&&(s[v]===void 0?p(v,P):s[v]!==P&&console.warn(`Mismatched location between vertexFn (${n}) output (${s[v]}) and fragmentFn (${r}) input (${P}) for the key "${v}", using the location set on vertex output.`))}let y=0;for(let v of Object.keys(e??{}))if(!(Rr(e[v])||s[v]!==void 0)){for(;i.has(y);)y++;p(v,y)}return s}function fw(e){if(e.includes(0))throw new Error("Size and workgroupSize cannot contain zeroes.");return rt(e[0]??1,e[1]??1,e[2]??1)}var mw=[rt(1,1,1),rt(256,1,1),rt(16,16,1),rt(8,8,4)],yw=class Ch{#e;#t;#n;#r;#s;constructor(t,n,r,s){this.#e=t,this.#t=n,this.#n=r,this.#r=s,this.#s=rt()}with(t){return new Ch(this.#e,this.#t.with(t),this.#n,this.#r)}dispatchThreads(...t){let n=fw(t),r=Bc(O(n).div(O(this.#r)));eh(n,this.#s)||(this.#s=n,this.#n.write(n)),this.#t.dispatchWorkgroups(r.x,r.y,r.z)}get pipeline(){return this.#t}get sizeUniform(){return this.#n}},gw=class Ka{constructor(t,n){this._getRoot=t,this._slotBindings=n}with(t,n){return new Ka(this._getRoot,[...this._slotBindings,[Ki(t)?t.slot:t,n]])}withCompute(t){return new ww(this._getRoot(),this._slotBindings,t)}createGuardedComputePipeline(t){let n=this._getRoot();if(t.length>=4)throw new Error("Guarded compute callback only supports up to three dimensions.");let r=mw[t.length],s=Ve([J,J,J])(t),i=(globalThis.__TYPEGPU_AUTONAME__??(v=>v))(n.createUniform(rt),"o"),p=sh({workgroupSize:r,in:{id:Ns.globalInvocationId}})`{
  if (any(in.id >= sizeUniform)) {
    return;
  }
  wrappedCallback(in.id.x, in.id.y, in.id.z);
}`.$uses({sizeUniform:i,wrappedCallback:s}),y=(globalThis.__TYPEGPU_AUTONAME__??(v=>v))(this.withCompute(p).createPipeline(),"i");return new yw(n,y,i,r)}withVertex(t,n){return new xw({branch:this._getRoot(),primitiveState:void 0,depthStencilState:void 0,slotBindings:this._slotBindings,vertexFn:t,vertexAttribs:n,multisampleState:void 0})}pipe(t){let n=t(new ph([]));return new Ka(this._getRoot,[...this._slotBindings,...n.bindings])}},ww=class{constructor(e,t,n){this._root=e,this._slotBindings=t,this._entryFn=n}createPipeline(){return rw(this._root,this._slotBindings,this._entryFn)}},xw=class Pi{constructor(t){this._options=t}withFragment(t,n,r){return Kn(typeof t!="string"),Kn(typeof n!="string"),new vw({...this._options,fragmentFn:t,targets:n})}withPrimitive(t){return new Pi({...this._options,primitiveState:t})}withDepthStencil(t){return new Pi({...this._options,depthStencilState:t})}withMultisample(t){return new Pi({...this._options,multisampleState:t})}createPipeline(){return Yh({...this._options,fragmentFn:null,targets:null})}},vw=class Ui{constructor(t){this._options=t}withPrimitive(t){return new Ui({...this._options,primitiveState:t})}withDepthStencil(t){return new Ui({...this._options,depthStencilState:t})}withMultisample(t){return new Ui({...this._options,multisampleState:t})}createPipeline(){return Yh(this._options)}},qh=class extends gw{constructor(t,n,r,s,i){super(()=>this,[]),this.device=t,this.nameRegistrySetting=n,this._ownDevice=r,this.shaderGenerator=i,this["~unstable"]=this,this[E]={logOptions:s}}"~unstable";_unwrappedBindGroupLayouts=new Ou(t=>t.unwrap(this));_unwrappedBindGroups=new Ou(t=>t.unwrap(this));[E];get enabledFeatures(){return new Set(this.device.features)}createBuffer(t,n){return vi(this,t,n)}createUniform(t,n){let r=vi(this,t,n).$usage("uniform");return new ga("uniform",r)}createMutable(t,n){let r=vi(this,t,n).$usage("storage");return new ga("mutable",r)}createReadonly(t,n){let r=vi(this,t,n).$usage("storage");return new ga("readonly",r)}createQuerySet(t,n,r){return Qg(this,t,n,r)}createBindGroup(t,n){return new Mh(t,n)}destroy(){$g(this.device),this._ownDevice&&this.device.destroy()}createTexture(t){return Ag(t,this)}createSampler(t){return vg(t,this)}createComparisonSampler(t){return bg(t,this)}unwrap(t){if(Gh(t))return t[E].rawPipeline;if(Dh(t))return t[E].core.unwrap().pipeline;if(_h(t))return this._unwrappedBindGroupLayouts.getOrMake(t);if(ji(t))return this._unwrappedBindGroups.getOrMake(t);if(Vs(t))return t.buffer;if(Cs(t))return t[E].unwrap();if(Li(t)){if(!t[E].unwrap)throw new Error("Cannot unwrap laid-out texture view as it has no underlying resource.");return t[E].unwrap()}if(jh(t))return t.vertexLayout;if(gh(t)||wh(t)){if(t[E].unwrap)return t[E].unwrap();throw new Error("Cannot unwrap laid-out sampler.")}if(qo(t))return t.querySet;throw new Error(`Unknown resource type: ${t}`)}beginRenderPass(t,n){let r=this.device.createCommandEncoder(),s=r.beginRenderPass(t),i=new Map,p=new Map,y,v=()=>{if(!y)throw new Error("Cannot draw without a call to pass.setPipeline");let{core:_,priors:P}=y[E],U=_.unwrap();s.setPipeline(U.pipeline);let R=new Set(U.usedBindGroupLayouts);U.usedBindGroupLayouts.forEach((L,Z)=>{if(U.catchall&&Z===U.catchall[0])s.setBindGroup(Z,this.unwrap(U.catchall[1])),R.delete(L);else{let Q=P.bindGroupLayoutMap?.get(L)??i.get(L);Q!==void 0&&(R.delete(L),ji(Q)?s.setBindGroup(Z,this.unwrap(Q)):s.setBindGroup(Z,Q))}});let j=new Set;if(_.usedVertexLayouts.forEach((L,Z)=>{let Q=P.vertexLayoutMap?.get(L),re=Q?{buffer:Q,offset:void 0,size:void 0}:p.get(L);!re||!re.buffer?j.add(L):Vs(re.buffer)?s.setVertexBuffer(Z,this.unwrap(re.buffer),re.offset,re.size):s.setVertexBuffer(Z,re.buffer,re.offset,re.size)}),R.size>0)throw new po(R);if(j.size>0)throw new Gl(j)};n({setViewport(..._){s.setViewport(..._)},setScissorRect(..._){s.setScissorRect(..._)},setBlendConstant(..._){s.setBlendConstant(..._)},setStencilReference(..._){s.setStencilReference(..._)},beginOcclusionQuery(..._){s.beginOcclusionQuery(..._)},endOcclusionQuery(..._){s.endOcclusionQuery(..._)},executeBundles(..._){s.executeBundles(..._)},setPipeline(_){y=_},setIndexBuffer:(_,P,U,R)=>{Vs(_)?s.setIndexBuffer(this.unwrap(_),P,U,R):s.setIndexBuffer(_,P,U,R)},setVertexBuffer(_,P,U,R){p.set(_,{buffer:P,offset:U,size:R})},setBindGroup(_,P){i.set(_,P)},draw(_,P,U,R){v(),s.draw(_,P,U,R)},drawIndexed(..._){v(),s.drawIndexed(..._)},drawIndirect(..._){v(),s.drawIndirect(..._)},drawIndexedIndirect(..._){v(),s.drawIndexedIndirect(..._)}}),s.end(),this.device.queue.submit([r.finish()])}flush(){console.warn("flush() has been deprecated, and has no effect.")}};async function bw(e){let{adapter:t,device:n,unstable_names:r="random",unstable_logOptions:s}=e??{};if(!navigator.gpu)throw new Error("WebGPU is not supported by this browser.");let i=await navigator.gpu.requestAdapter(t);if(!i)throw new Error("Could not find a compatible GPU");let p=[];for(let v of n?.requiredFeatures??[]){if(!i.features.has(v))throw new Error(`Requested feature "${v}" is not supported by the adapter.`);p.push(v)}for(let v of n?.optionalFeatures??[])i.features.has(v)?p.push(v):console.warn(`Optional feature "${v}" is not supported by the adapter.`);let y=await i.requestDevice({...n,requiredFeatures:p});return new qh(y,r,!0,s??{},e?.shaderGenerator)}function Tw(e){let{device:t,unstable_names:n="random",unstable_logOptions:r}=e??{};return new qh(t,n,!1,r??{},e?.shaderGenerator)}function _w(e,t){return new $w(e,t)}var $w=class{constructor(e,t=void 0){this.schema=e,this.defaultValue=t,this.slot=Yi(t),this[st]=this.slot}[E]=!0;[st];resourceType="accessor";slot;get[Re](){return new Proxy({[E]:!0,[Xt]:this.#e(),[he]:e=>e.resolve(this),toString:()=>`accessor:${W(this)??"<unnamed>"}.$`},kn)}#e(){let e=yr(),t=oa(e.unwrap(this.slot));return ih(t)?t[E].gpuImpl():B(t,this.schema)}$name(e){return this.slot.$name(e),this}toString(){return`accessor:${W(this)??"<unnamed>"}`}get value(){if(Bn())return this[Re];throw new Error("`tgpu.accessor` relies on GPU resources and cannot be accessed outside of a compute dispatch or draw call")}get $(){return this.value}[he](e){let t=this.#e();return B(e.resolve(t.value,t.dataType).value,t.dataType)}};function Mw(e){return Ew(e)}function zw([e,t]){return`${W(e)??"<unnamed>"}=${t}`}function Ew(e){if(yr())throw new Error("Cannot create tgpu.derived objects at the resolution stage.");return{[E]:!0,resourceType:"derived","~compute":e,get[Re](){let t=yr();if(!t)throw new Error("Cannot access tgpu.derived's value outside of resolution.");return oa(t.unwrap(this))},get value(){return this[Re]},get $(){return this.value},with(t,n){return Wh(this,[[t,n]])},toString(){return"derived"}}}function Wh(e,t){return{[E]:!0,resourceType:"derived","~compute"(){throw new Error("'~compute' should never be read on bound derived items.")},[Ur]:{inner:e,pairs:t},get[Re](){let n=yr();if(!n)throw new Error("Cannot access tgpu.derived's value outside of resolution.");return oa(n.unwrap(this))},get value(){return this[Re]},get $(){return this.value},with(n,r){return Wh(e,[...t,[n,r]])},toString(){return`derived[${t.map(zw).join(", ")}]`}}}var Sw={fn:Ve,bindGroupLayout:Th,vertexLayout:Vu,slot:Yi,init:bw,initFromDevice:Tw,resolve:Zg,resolveWithContext:Rh,privateVar:Ci,workgroupVar:ku,const:Da,"~unstable":{fn:Ve,fragmentFn:Wy,vertexFn:mc,computeFn:sh,vertexLayout:Vu,namespace:si,derived:Mw,slot:Yi,accessor:_w,privateVar:Ci,workgroupVar:ku,const:Da,declare:Ly,simulate:Hg}},H=Sw;function Xh(e){return xs("function",e,"read-write")}function Pw(e){return xs("private",e,"read-write")}function Uw(e){return xs("workgroup",e,"read-write")}function Aw(e,t="read"){return xs("storage",e,t)}function Iw(e){return xs("uniform",e,"read")}function Bw(e){return xs("handle",e,"read")}function xs(e,t,n){return{[E]:!0,type:"ptr",addressSpace:e,inner:t,access:n}}var Jh=ce(((e,t)=>t===void 0?n=>wa(e,n):wa(e,t)),(e,t)=>{if(t===void 0||t.value===void 0){let n=r=>Jh[E].gpuImpl(e,r);return n[E]=!0,B(n,kt)}if(typeof t.value!="number")throw new Error(`Cannot create disarray schema with count unknown at compile-time: '${t.value}'`);return B(wa(e.value,t.value),e.value)},"disarrayOf");function wa(e,t){let n=r=>{if(r&&r.length!==t)throw new Error(`Disarray schema of ${t} elements of type ${e.type} called with ${r.length} argument(s).`);return Array.from({length:t},(s,i)=>Br(e,r?.[i]))};if(Object.setPrototypeOf(n,kw),n.elementType=e,!Number.isInteger(t)||t<0)throw new Error(`Cannot create disarray schema with invalid element count: ${t}.`);return n.elementCount=t,n}var kw={[E]:!0,type:"disarray",toString(){return`disarrayOf(${this.elementType}, ${this.elementCount})`}};function Ow(e){let t=n=>Object.fromEntries(Object.entries(e).map(([r,s])=>[r,Br(s,n?.[r])]));return Object.setPrototypeOf(t,Vw),t.propTypes=e,t}var Vw={[E]:!0,type:"unstruct",$name(e){return Ne(this,e),this},toString(){return`unstruct:${W(this)??"<unnamed>"}`}};function ss(e,t){if(e===t)return!0;if(e.type!==t.type)return!1;if(vt(e)&&vt(t)||zn(e)&&zn(t)){let n=e.propTypes,r=t.propTypes,s=Object.keys(n),i=Object.keys(r);if(s.length!==i.length)return!1;for(let p=0;p<s.length;p++){let y=s[p],v=i[p];if(y!==v||!y||!v||!ss(n[y],r[v]))return!1}return!0}if(Lt(e)&&Lt(t)||sr(e)&&sr(t))return e.elementCount===t.elementCount&&ss(e.elementType,t.elementType);if(Ir(e)&&Ir(t))return e.addressSpace===t.addressSpace&&e.access===t.access&&ss(e.inner,t.inner);if(Bi(e)&&Bi(t))return ss(e.inner,t.inner);if(Mn(e)&&Mn(t)||En(e)&&En(t)){if(!ss(e.inner,t.inner)||e.attribs.length!==t.attribs.length)return!1;let n=i=>{let p=i;return`${p.type}(${(p.params??[]).join(",")})`},r=e.attribs.map(n),s=t.attribs.map(n);for(let i=0;i<r.length;i++)if(r[i]!==s[i])return!1}return!0}function Fr(e,t){let n=e.prototype,r=Ya[t][E].jsImpl;n[t]=function(s){return r(this,s)}}Fr(Dr,"add");Fr(Dr,"sub");Fr(Dr,"mul");Fr(Dr,"div");Fr(ys,"add");Fr(ys,"sub");Fr(ys,"mul");const ve=Object.freeze(Object.defineProperty({__proto__:null,Void:at,align:Cd,alignmentOf:Rd,arrayOf:Yn,atomic:Uc,bool:ke,builtin:Ns,comparisonSampler:Go,deepEqual:ss,disarrayOf:Jh,f16:ut,f32:$,float16:xd,float16x2:vd,float16x4:bd,float32:Td,float32x2:_d,float32x3:$d,float32x4:Md,formatToWGSLType:ir,i32:Ue,interpolate:Wd,invariant:Xd,isAlignAttrib:uo,isAtomic:Bi,isBuiltin:Rr,isBuiltinAttrib:co,isData:Gr,isDecorated:Mn,isDisarray:sr,isInterpolateAttrib:vp,isLocationAttrib:Pl,isLooseData:fs,isLooseDecorated:En,isPackedData:lc,isPtr:Ir,isSizeAttrib:lo,isUnstruct:zn,isWgslArray:Lt,isWgslData:zt,isWgslStruct:vt,location:Di,mat2x2f:xn,mat3x3f:In,mat4x4f:we,matToArray:Tf,packedFormats:Bo,ptrFn:Xh,ptrHandle:Bw,ptrPrivate:Pw,ptrStorage:Aw,ptrUniform:Iw,ptrWorkgroup:Uw,sampler:Vo,sint16:cd,sint16x2:hd,sint16x4:pd,sint32:Ud,sint32x2:Ad,sint32x3:Id,sint32x4:Bd,sint8:Qp,sint8x2:Kp,sint8x4:ed,size:qd,sizeOf:Yd,snorm16:yd,snorm16x2:gd,snorm16x4:wd,snorm8:sd,snorm8x2:id,snorm8x4:ad,struct:qn,texture1d:xc,texture2d:hs,texture2dArray:bc,texture3d:$c,textureCube:Tc,textureCubeArray:_c,textureDepth2d:Uf,textureDepth2dArray:If,textureDepthCube:Bf,textureDepthCubeArray:kf,textureDepthMultisampled2d:Af,textureExternal:Sc,textureMultisampled2d:vc,textureStorage1d:Mc,textureStorage2d:ni,textureStorage2dArray:zc,textureStorage3d:Ec,u16:Fp,u32:J,uint16:od,uint16x2:ud,uint16x4:ld,uint32:zd,uint32x2:Ed,uint32x3:Sd,uint32x4:Pd,uint8:Jp,uint8x2:Zp,uint8x4:Hp,unorm10_10_10_2:kd,unorm16:dd,unorm16x2:fd,unorm16x4:md,unorm8:td,unorm8x2:nd,unorm8x4:rd,unorm8x4_bgra:Od,unstruct:Ow,vec2b:vr,vec2f:F,vec2h:Pn,vec2i:Be,vec2u:xt,vec3b:br,vec3f:O,vec3h:Un,vec3i:Ot,vec3u:rt,vec4b:Tr,vec4f:k,vec4h:An,vec4i:Fe,vec4u:Ye},Symbol.toStringTag,{value:"Module"}));var Gw=ce(()=>{throw new Error("`discard` relies on GPU resources and cannot be executed outside of a draw call")},()=>B("discard;",at),"discard"),ii=xe[E].jsImpl,Dw=na[E].jsImpl,Rw=na[E].gpuImpl,Nw=ra[E].jsImpl,Fw=ra[E].gpuImpl,Lw=sa[E].jsImpl,jw=sa[E].gpuImpl,Yw=ia[E].jsImpl,Cw=ia[E].gpuImpl,qw=aa[E].jsImpl,Ww=aa[E].gpuImpl,Xw=ce((e,t)=>ii(Dw(t),e),(e,t)=>B(S`(${Rw(t)} * ${e})`,e.dataType),"translate4"),Jw=ce((e,t)=>ii(Nw(t),e),(e,t)=>B(S`(${Fw(t)} * ${e})`,e.dataType),"scale4"),Zw=ce((e,t)=>ii(Lw(t),e),(e,t)=>B(S`(${jw(t)} * ${e})`,e.dataType),"rotateX4"),Hw=ce((e,t)=>ii(Yw(t),e),(e,t)=>B(S`(${Cw(t)} * ${e})`,e.dataType),"rotateY4"),Qw=ce((e,t)=>ii(qw(t),e),(e,t)=>B(S`(${Ww(t)} * ${e})`,e.dataType),"rotateZ4"),Kw=ce(()=>console.warn("workgroupBarrier is a no-op outside of CODEGEN mode."),()=>B("workgroupBarrier()",at),"workgroupBarrier"),e0=ce(()=>console.warn("storageBarrier is a no-op outside of CODEGEN mode."),()=>B("storageBarrier()",at),"storageBarrier"),t0=ce(()=>console.warn("textureBarrier is a no-op outside of CODEGEN mode."),()=>B("textureBarrier()",at),"textureBarrier"),n0=ce(e=>{throw new Error("Atomic operations are not supported outside of CODEGEN mode.")},e=>{if(zt(e.dataType)&&e.dataType.type==="atomic")return B(S`atomicLoad(&${e})`,e.dataType.inner);throw new Error(`Invalid atomic type: ${Jt(e.dataType)}`)},"atomicLoad"),r0=ce((e,t)=>{throw new Error("Atomic operations are not supported outside of CODEGEN mode.")},(e,t)=>{if(!zt(e.dataType)||e.dataType.type!=="atomic")throw new Error(`Invalid atomic type: ${Jt(e.dataType)}`);return B(S`atomicStore(&${e}, ${t})`,at)},"atomicStore"),Lr=(e,t)=>e.dataType.type==="atomic"&&e.dataType.inner.type==="i32"?[e.dataType,Ue]:[e.dataType,J],s0=ce((e,t)=>{throw new Error("Atomic operations are not supported outside of CODEGEN mode.")},(e,t)=>{if(zt(e.dataType)&&e.dataType.type==="atomic")return B(S`atomicAdd(&${e}, ${t})`,e.dataType.inner);throw new Error(`Invalid atomic type: ${Jt(e.dataType)}`)},"atomicAdd",Lr),i0=ce((e,t)=>{throw new Error("Atomic operations are not supported outside of CODEGEN mode.")},(e,t)=>{if(zt(e.dataType)&&e.dataType.type==="atomic")return B(S`atomicSub(&${e}, ${t})`,e.dataType.inner);throw new Error(`Invalid atomic type: ${Jt(e.dataType)}`)},"atomicSub",Lr),a0=ce((e,t)=>{throw new Error("Atomic operations are not supported outside of CODEGEN mode.")},(e,t)=>{if(zt(e.dataType)&&e.dataType.type==="atomic")return B(S`atomicMax(&${e}, ${t})`,e.dataType.inner);throw new Error(`Invalid atomic type: ${Jt(e.dataType)}`)},"atomicMax",Lr),o0=ce((e,t)=>{throw new Error("Atomic operations are not supported outside of CODEGEN mode.")},(e,t)=>{if(zt(e.dataType)&&e.dataType.type==="atomic")return B(S`atomicMin(&${e}, ${t})`,e.dataType.inner);throw new Error(`Invalid atomic type: ${Jt(e.dataType)}`)},"atomicMin",Lr),u0=ce((e,t)=>{throw new Error("Atomic operations are not supported outside of CODEGEN mode.")},(e,t)=>{if(zt(e.dataType)&&e.dataType.type==="atomic")return B(S`atomicAnd(&${e}, ${t})`,e.dataType.inner);throw new Error(`Invalid atomic type: ${Jt(e.dataType)}`)},"atomicAnd",Lr),l0=ce((e,t)=>{throw new Error("Atomic operations are not supported outside of CODEGEN mode.")},(e,t)=>{if(zt(e.dataType)&&e.dataType.type==="atomic")return B(S`atomicOr(&${e}, ${t})`,e.dataType.inner);throw new Error(`Invalid atomic type: ${Jt(e.dataType)}`)},"atomicOr",Lr),c0=ce((e,t)=>{throw new Error("Atomic operations are not supported outside of CODEGEN mode.")},(e,t)=>{if(zt(e.dataType)&&e.dataType.type==="atomic")return B(S`atomicXor(&${e}, ${t})`,e.dataType.inner);throw new Error(`Invalid atomic type: ${Jt(e.dataType)}`)},"atomicXor",Lr);function h0(e){throw new Error("Derivative builtins are not allowed on the cpu")}var p0=ce(h0,e=>B(S`dpdx(${e})`,e.dataType),"dpdx");function d0(e){throw new Error("Derivative builtins are not allowed on the cpu")}var f0=ce(d0,e=>B(S`dpdxCoarse(${e})`,e.dataType),"dpdxCoarse");function m0(e){throw new Error("Derivative builtins are not allowed on the cpu")}var y0=ce(m0,e=>B(S`dpdxFine(${e})`,e.dataType),"dpdxFine");function g0(e){throw new Error("Derivative builtins are not allowed on the cpu")}var w0=ce(g0,e=>B(S`dpdy(${e})`,e.dataType),"dpdy");function x0(e){throw new Error("Derivative builtins are not allowed on the cpu")}var v0=ce(x0,e=>B(S`dpdyCoarse(${e})`,e.dataType),"dpdyCoarse");function b0(e){throw new Error("Derivative builtins are not allowed on the cpu")}var T0=ce(b0,e=>B(S`dpdyFine(${e})`,e.dataType),"dpdyFine");function _0(e){throw new Error("Derivative builtins are not allowed on the cpu")}var $0=ce(_0,e=>B(S`fwidth(${e})`,e.dataType),"fwidth");function M0(e){throw new Error("Derivative builtins are not allowed on the cpu")}var z0=ce(M0,e=>B(S`fwidthCoarse(${e})`,e.dataType),"fwidthCoarse");function E0(e){throw new Error("Derivative builtins are not allowed on the cpu")}var S0=ce(E0,e=>B(S`fwidthFine(${e})`,e.dataType),"fwidthFine"),Gu=e=>Ir(e)&&Lt(e.inner)?e.inner.elementCount:0,P0=G({name:"arrayLength",signature:e=>{let t=Ir(e)?e:Xh(e);return{argTypes:[t],returnType:Gu(t)>0?Js:J}},normalImpl:e=>e.length,codegenImpl(e){let t=Gu(e.dataType);return t>0?String(t):S`arrayLength(${e})`}});function U0(e,t,n,r,s){throw new Error("Texture sampling relies on GPU resources and cannot be executed outside of a draw call")}var Zh=G({name:"textureSample",normalImpl:U0,codegenImpl:(...e)=>S`textureSample(${e})`,signature:(...e)=>{let t=e[0].type.startsWith("texture_depth");return{argTypes:e,returnType:t?$:k}}});function A0(e,t,n,r,s,i){throw new Error("Texture sampling with bias relies on GPU resources and cannot be executed outside of a draw call")}var I0=G({name:"textureSampleBias",normalImpl:A0,codegenImpl:(...e)=>S`textureSampleBias(${e})`,signature:(...e)=>({argTypes:e,returnType:k})});function B0(e,t,n,r,s,i){throw new Error("Texture sampling relies on GPU resources and cannot be executed outside of a draw call")}var k0=G({name:"textureSampleLevel",normalImpl:B0,codegenImpl:(...e)=>S`textureSampleLevel(${e})`,signature:(...e)=>{let t=e[0].type.startsWith("texture_depth");return{argTypes:e,returnType:t?$:k}}});function O0(e,t,n){throw new Error("`textureLoad` relies on GPU resources and cannot be executed outside of a draw call")}var Ai=G({name:"textureLoad",normalImpl:O0,codegenImpl:(...e)=>S`textureLoad(${e})`,signature:(...e)=>{let t=e[0];if(Pc(t)){let s=t.type.startsWith("texture_depth"),i=t.sampleType;return{argTypes:e,returnType:s?$:i.type==="f32"?k:i.type==="u32"?Ye:Fe}}let n=t.format,r=ws[n].vectorType;return{argTypes:e,returnType:r}}});function V0(e,t,n,r){throw new Error("`textureStore` relies on GPU resources and cannot be executed outside of a draw call")}var Hh=G({name:"textureStore",normalImpl:V0,codegenImpl:(...e)=>S`textureStore(${e})`,signature:(...e)=>({argTypes:e,returnType:at})});function G0(e,t){throw new Error("`textureDimensions` relies on GPU resources and cannot be executed outside of a draw call")}var Qh=G({name:"textureDimensions",normalImpl:G0,codegenImpl:(...e)=>S`textureDimensions(${e})`,signature:(...e)=>{let t=e[0].dimension;return t==="1d"?{argTypes:e,returnType:J}:t==="3d"?{argTypes:e,returnType:rt}:{argTypes:e,returnType:xt}}});function D0(e,t,n,r,s,i){throw new Error("Texture comparison sampling relies on GPU resources and cannot be executed outside of a draw call")}var R0=G({name:"textureSampleCompare",normalImpl:D0,codegenImpl:(...e)=>S`textureSampleCompare(${e})`,signature:(...e)=>({argTypes:e,returnType:$})});function N0(e,t,n){throw new Error("Texture sampling with base clamp to edge is not supported outside of GPU mode.")}var F0=G({name:"textureSampleBaseClampToEdge",normalImpl:N0,codegenImpl:(...e)=>S`textureSampleBaseClampToEdge(${e})`,signature:(...e)=>({argTypes:e,returnType:k})}),lt="Subgroup operations can only be used in the GPU context.",L0=G({name:"subgroupAdd",signature:e=>({argTypes:[e],returnType:e}),normalImpl:lt,codegenImpl:e=>S`subgroupAdd(${e})`}),j0=G({name:"subgroupExclusiveAdd",signature:e=>({argTypes:[e],returnType:e}),normalImpl:lt,codegenImpl:e=>S`subgroupExclusiveAdd(${e})`}),Y0=G({name:"subgroupInclusiveAdd",signature:e=>({argTypes:[e],returnType:e}),normalImpl:lt,codegenImpl:e=>S`subgroupInclusiveAdd(${e})`}),C0=G({name:"subgroupAll",signature:{argTypes:[ke],returnType:ke},normalImpl:lt,codegenImpl:e=>S`subgroupAll(${e})`}),q0=G({name:"subgroupAnd",signature:e=>({argTypes:[e],returnType:e}),normalImpl:lt,codegenImpl:e=>S`subgroupAnd(${e})`}),W0=G({name:"subgroupAny",signature:{argTypes:[ke],returnType:ke},normalImpl:lt,codegenImpl:e=>S`subgroupAny(${e})`}),X0=G({name:"subgroupBallot",signature:{argTypes:[ke],returnType:Ye},normalImpl:lt,codegenImpl:e=>S`subgroupBallot(${e})`}),J0=G({name:"subgroupBroadcast",signature:(...e)=>{let t=ct([e[1]],[Ue,J]);if(!t)throw new Error(`subgroupBroadcast's second argument has to be compatible with i32 or u32. Got: ${e[1].type}`);return{argTypes:[e[0],t[0]],returnType:e[0]}},normalImpl:lt,codegenImpl:(e,t)=>S`subgroupBroadcast(${e}, ${t})`}),Z0=G({name:"subgroupBroadcastFirst",signature:e=>({argTypes:[e],returnType:e}),normalImpl:lt,codegenImpl:e=>S`subgroupBroadcastFirst(${e})`}),H0=G({name:"subgroupElect",signature:{argTypes:[],returnType:ke},normalImpl:lt,codegenImpl:()=>S`subgroupElect()`}),Q0=G({name:"subgroupMax",signature:e=>({argTypes:[e],returnType:e}),normalImpl:lt,codegenImpl:e=>S`subgroupMax(${e})`}),K0=G({name:"subgroupMin",signature:e=>({argTypes:[e],returnType:e}),normalImpl:lt,codegenImpl:e=>S`subgroupMin(${e})`}),ex=G({name:"subgroupMul",signature:e=>({argTypes:[e],returnType:e}),normalImpl:lt,codegenImpl:e=>S`subgroupMul(${e})`}),tx=G({name:"subgroupExclusiveMul",signature:e=>({argTypes:[e],returnType:e}),normalImpl:lt,codegenImpl:e=>S`subgroupExclusiveMul(${e})`}),nx=G({name:"subgroupInclusiveMul",signature:e=>({argTypes:[e],returnType:e}),normalImpl:lt,codegenImpl:e=>S`subgroupInclusiveMul(${e})`}),rx=G({name:"subgroupOr",signature:e=>({argTypes:[e],returnType:e}),normalImpl:lt,codegenImpl:e=>S`subgroupOr(${e})`}),sx=G({name:"subgroupShuffle",signature:(...e)=>{let t=ct([e[1]],[Ue,J]);if(!t)throw new Error(`subgroupShuffle's second argument has to be compatible with i32 or u32. Got: ${e[1].type}`);return{argTypes:[e[0],t[0]],returnType:e[0]}},normalImpl:lt,codegenImpl:(e,t)=>S`subgroupShuffle(${e}, ${t})`}),ix=G({name:"subgroupShuffleDown",signature:(...e)=>{let t=ct([e[1]],[J]);if(!t)throw new Error(`subgroupShuffleDown's second argument has to be compatible with u32. Got: ${e[1].type}`);return{argTypes:[e[0],t[0]],returnType:e[0]}},normalImpl:lt,codegenImpl:(e,t)=>S`subgroupShuffleDown(${e}, ${t})`}),ax=G({name:"subgroupShuffleUp",signature:(...e)=>{let t=ct([e[1]],[J]);if(!t)throw new Error(`subgroupShuffleUp's second argument has to be compatible with u32. Got: ${e[1].type}`);return{argTypes:[e[0],t[0]],returnType:e[0]}},normalImpl:lt,codegenImpl:(e,t)=>S`subgroupShuffleUp(${e}, ${t})`}),ox=G({name:"subgroupShuffleXor",signature:(...e)=>{let t=ct([e[1]],[J]);if(!t)throw new Error(`subgroupShuffleXor's second argument has to be compatible with u32. Got: ${e[1].type}`);return{argTypes:[e[0],t[0]],returnType:e[0]}},normalImpl:lt,codegenImpl:(e,t)=>S`subgroupShuffleXor(${e}, ${t})`}),ux=G({name:"subgroupXor",signature:e=>({argTypes:[e],returnType:e}),normalImpl:lt,codegenImpl:e=>S`subgroupXor(${e})`}),lx=(()=>{let e=r=>{let s=yr();if(!s)throw new Error("extensionEnabled can only be called in a GPU codegen context.");return(s.enableExtensions??[]).includes(r)},t=r=>{let{value:s}=r;if(typeof s!="string"||!jo.includes(s))throw new Error(`extensionEnabled has to be called with a string literal representing a valid WGSL extension name. Got: ${s}`);return B(e(s),ke)},n=r=>{if(Bn())return t(r);throw new Error("extensionEnabled can only be called in a GPU codegen context.")};return Object.defineProperty(n,E,{value:{jsImpl:e,gpuImpl:t,argConversionHint:"keep"}}),n})();const We=Object.freeze(Object.defineProperty({__proto__:null,abs:He,acos:Fa,acosh:Qf,add:ue,all:Dy,allEq:eh,and:Gy,any:Ry,arrayLength:P0,asin:em,asinh:nm,atan:sm,atan2:um,atanh:am,atomicAdd:s0,atomicAnd:u0,atomicLoad:n0,atomicMax:a0,atomicMin:o0,atomicOr:l0,atomicStore:r0,atomicSub:i0,atomicXor:c0,bitcastU32toF32:Hc,bitcastU32toI32:Qc,ceil:Bc,clamp:kr,cos:Ft,cosh:dm,countLeadingZeros:fm,countOneBits:mm,countTrailingZeros:ym,cross:kc,degrees:wm,determinant:xm,discard:Gw,distance:bm,div:Do,dot:ae,dot4I8Packed:_m,dot4U8Packed:Tm,dpdx:p0,dpdxCoarse:f0,dpdxFine:y0,dpdy:w0,dpdyCoarse:v0,dpdyFine:T0,eq:Py,exp:Oc,exp2:zm,extensionEnabled:lx,extractBits:Em,faceForward:Sm,firstLeadingBit:Pm,firstTrailingBit:Um,floor:Or,fma:Bm,fract:er,frexp:Vm,fwidth:$0,fwidthCoarse:z0,fwidthFine:S0,ge:ky,gt:By,identity2:yc,identity3:gc,identity4:wc,insertBits:Gm,inverseSqrt:Rm,isCloseTo:Ny,ldexp:Nm,le:Iy,length:$e,log:js,log2:Ym,lt:Ay,max:ie,min:Ie,mix:rn,mod:Wf,modf:Jm,mul:xe,ne:Uy,neg:Ls,normalize:an,not:Oy,or:Vy,pack2x16float:zy,pack4x8unorm:Sy,pow:gr,quantizeToF16:Hm,radians:Km,reflect:Vc,refract:e1,reverseBits:t1,rotateX4:Zw,rotateY4:Hw,rotateZ4:Qw,rotationX4:sa,rotationY4:ia,rotationZ4:aa,round:r1,saturate:jt,scale4:Jw,scaling4:ra,select:Ys,sign:ar,sin:un,sinh:u1,smoothstep:Gc,sqrt:gn,step:La,storageBarrier:e0,sub:K,subgroupAdd:L0,subgroupAll:C0,subgroupAnd:q0,subgroupAny:W0,subgroupBallot:X0,subgroupBroadcast:J0,subgroupBroadcastFirst:Z0,subgroupElect:H0,subgroupExclusiveAdd:j0,subgroupExclusiveMul:tx,subgroupInclusiveAdd:Y0,subgroupInclusiveMul:nx,subgroupMax:Q0,subgroupMin:K0,subgroupMul:ex,subgroupOr:rx,subgroupShuffle:sx,subgroupShuffleDown:ix,subgroupShuffleUp:ax,subgroupShuffleXor:ox,subgroupXor:ux,tan:ja,tanh:Dc,textureBarrier:t0,textureDimensions:Qh,textureLoad:Ai,textureSample:Zh,textureSampleBaseClampToEdge:F0,textureSampleBias:I0,textureSampleCompare:R0,textureSampleLevel:k0,textureStore:Hh,translate4:Xw,translation4:na,transpose:f1,trunc:m1,unpack2x16float:Kc,unpack4x8unorm:Ey,workgroupBarrier:Kw},Symbol.toStringTag,{value:"Module"})),cx=(globalThis.__TYPEGPU_AUTONAME__??(e=>e))(H.fn([$,$,$],$)((e=>(globalThis.__TYPEGPU_META__??=new WeakMap).set(e.f=((t,n,r)=>{const s=ie(r-He(t-n),0)/r;return Ie(t,n)-s*s*r*(1/4)}),{v:1,name:void 0,ast:{params:[{type:"i",name:"d1"},{type:"i",name:"d2"},{type:"i",name:"k"}],body:[0,[[13,"h",[1,[6,[7,"std","max"],[[1,"k","-",[6,[7,"std","abs"],[[1,"d1","-","d2"]]]],[5,"0"]]],"/","k"]],[10,[1,[6,[7,"std","min"],["d1","d2"]],"-",[1,[1,[1,"h","*","h"],"*","k"],"*",[1,[5,"1"],"/",[5,"4"]]]]]]],externalNames:["std"]},get externals(){return{std:We}}})&&e.f)({})),"opSmoothUnion"),hx=(globalThis.__TYPEGPU_AUTONAME__??(e=>e))(H.fn([$,$,$],$)((e=>(globalThis.__TYPEGPU_META__??=new WeakMap).set(e.f=((t,n,r)=>{const s=ie(r-He(-t-n),0)/r;return ie(-n,t)+s*s*r*(1/4)}),{v:1,name:void 0,ast:{params:[{type:"i",name:"d1"},{type:"i",name:"d2"},{type:"i",name:"k"}],body:[0,[[13,"h",[1,[6,[7,"std","max"],[[1,"k","-",[6,[7,"std","abs"],[[1,[4,"-","d1"],"-","d2"]]]],[5,"0"]]],"/","k"]],[10,[1,[6,[7,"std","max"],[[4,"-","d2"],"d1"]],"+",[1,[1,[1,"h","*","h"],"*","k"],"*",[1,[5,"1"],"/",[5,"4"]]]]]]],externalNames:["std"]},get externals(){return{std:We}}})&&e.f)({})),"opSmoothDifference"),px=(globalThis.__TYPEGPU_AUTONAME__??(e=>e))(H.fn([O,$,$],$)((e=>(globalThis.__TYPEGPU_META__??=new WeakMap).set(e.f=((t,n,r)=>{const s=F(n,He(t.z)-r);return Ie(ie(s.x,s.y),0)+$e(ie(s,F()))}),{v:1,name:void 0,ast:{params:[{type:"i",name:"p"},{type:"i",name:"dd"},{type:"i",name:"h"}],body:[0,[[13,"w",[6,[7,"d","vec2f"],["dd",[1,[6,[7,"std","abs"],[[7,"p","z"]]],"-","h"]]]],[10,[1,[6,[7,"std","min"],[[6,[7,"std","max"],[[7,"w","x"],[7,"w","y"]]],[5,"0"]]],"+",[6,[7,"std","length"],[[6,[7,"std","max"],["w",[6,[7,"d","vec2f"],[]]]]]]]]]],externalNames:["d","std"]},get externals(){return{d:ve,std:We}}})&&e.f)({})),"opExtrudeZ"),dx=(globalThis.__TYPEGPU_AUTONAME__??(e=>e))(H.fn([O,$,$],$)((e=>(globalThis.__TYPEGPU_META__??=new WeakMap).set(e.f=((t,n,r)=>{const s=F(n,He(t.x)-r);return Ie(ie(s.x,s.y),0)+$e(ie(s,F()))}),{v:1,name:void 0,ast:{params:[{type:"i",name:"p"},{type:"i",name:"dd"},{type:"i",name:"h"}],body:[0,[[13,"w",[6,[7,"d","vec2f"],["dd",[1,[6,[7,"std","abs"],[[7,"p","x"]]],"-","h"]]]],[10,[1,[6,[7,"std","min"],[[6,[7,"std","max"],[[7,"w","x"],[7,"w","y"]]],[5,"0"]]],"+",[6,[7,"std","length"],[[6,[7,"std","max"],["w",[6,[7,"d","vec2f"],[]]]]]]]]]],externalNames:["d","std"]},get externals(){return{d:ve,std:We}}})&&e.f)({})),"opExtrudeX"),Kh=(globalThis.__TYPEGPU_AUTONAME__??(e=>e))(H.fn([O,$,$],$)((e=>(globalThis.__TYPEGPU_META__??=new WeakMap).set(e.f=((t,n,r)=>{const s=F(n,He(t.y)-r);return Ie(ie(s.x,s.y),0)+$e(ie(s,F()))}),{v:1,name:void 0,ast:{params:[{type:"i",name:"p"},{type:"i",name:"dd"},{type:"i",name:"h"}],body:[0,[[13,"w",[6,[7,"d","vec2f"],["dd",[1,[6,[7,"std","abs"],[[7,"p","y"]]],"-","h"]]]],[10,[1,[6,[7,"std","min"],[[6,[7,"std","max"],[[7,"w","x"],[7,"w","y"]]],[5,"0"]]],"+",[6,[7,"std","length"],[[6,[7,"std","max"],["w",[6,[7,"d","vec2f"],[]]]]]]]]]],externalNames:["d","std"]},get externals(){return{d:ve,std:We}}})&&e.f)({})),"opExtrudeY"),ep=(globalThis.__TYPEGPU_AUTONAME__??(e=>e))(H.fn([$,$],$)((e=>(globalThis.__TYPEGPU_META__??=new WeakMap).set(e.f=((t,n)=>Ie(t,n)),{v:1,name:void 0,ast:{params:[{type:"i",name:"d1"},{type:"i",name:"d2"}],body:[0,[[10,[6,[7,"std","min"],["d1","d2"]]]]],externalNames:["std"]},get externals(){return{std:We}}})&&e.f)({})),"opUnion"),fx=(globalThis.__TYPEGPU_AUTONAME__??(e=>e))(H.fn([F,$],$)((e=>(globalThis.__TYPEGPU_META__??=new WeakMap).set(e.f=((t,n)=>$e(t)-n),{v:1,name:void 0,ast:{params:[{type:"i",name:"p"},{type:"i",name:"radius"}],body:[0,[[10,[1,[6,"length",["p"]],"-","radius"]]]],externalNames:["length"]},get externals(){return{length:$e}}})&&e.f)({})),"sdDisk"),mx=(globalThis.__TYPEGPU_AUTONAME__??(e=>e))(H.fn([F,F],$)((e=>(globalThis.__TYPEGPU_META__??=new WeakMap).set(e.f=((t,n)=>{const r=K(He(t),n);return $e(ie(r,F(0)))+Ie(ie(r.x,r.y),0)}),{v:1,name:void 0,ast:{params:[{type:"i",name:"p"},{type:"i",name:"size"}],body:[0,[[13,"d",[6,"sub",[[6,"abs",["p"]],"size"]]],[10,[1,[6,"length",[[6,"max",["d",[6,"vec2f",[[5,"0"]]]]]]],"+",[6,"min",[[6,"max",[[7,"d","x"],[7,"d","y"]]],[5,"0"]]]]]]],externalNames:["sub","abs","length","max","vec2f","min"]},get externals(){return{sub:K,abs:He,length:$e,max:ie,vec2f:F,min:Ie}}})&&e.f)({})),"sdBox2d"),yx=(globalThis.__TYPEGPU_AUTONAME__??(e=>e))(H.fn([F,F,$],$)((e=>(globalThis.__TYPEGPU_META__??=new WeakMap).set(e.f=((t,n,r)=>{const s=ue(K(He(t),n),F(r));return $e(ie(s,F(0)))+Ie(ie(s.x,s.y),0)-r}),{v:1,name:void 0,ast:{params:[{type:"i",name:"p"},{type:"i",name:"size"},{type:"i",name:"cornerRadius"}],body:[0,[[13,"d",[6,"add",[[6,"sub",[[6,"abs",["p"]],"size"]],[6,"vec2f",["cornerRadius"]]]]],[10,[1,[1,[6,"length",[[6,"max",["d",[6,"vec2f",[[5,"0"]]]]]]],"+",[6,"min",[[6,"max",[[7,"d","x"],[7,"d","y"]]],[5,"0"]]]],"-","cornerRadius"]]]],externalNames:["add","sub","abs","vec2f","length","max","min"]},get externals(){return{add:ue,sub:K,abs:He,vec2f:F,length:$e,max:ie,min:Ie}}})&&e.f)({})),"sdRoundedBox2d"),gx=(globalThis.__TYPEGPU_AUTONAME__??(e=>e))(H.fn([F,F,F],$)((e=>(globalThis.__TYPEGPU_META__??=new WeakMap).set(e.f=((t,n,r)=>{const s=K(t,n),i=K(r,n),p=ie(0,Ie(1,ae(s,i)/ae(i,i)));return $e(K(s,i.mul(p)))}),{v:1,name:void 0,ast:{params:[{type:"i",name:"p"},{type:"i",name:"a"},{type:"i",name:"b"}],body:[0,[[13,"pa",[6,"sub",["p","a"]]],[13,"ba",[6,"sub",["b","a"]]],[13,"h",[6,"max",[[5,"0"],[6,"min",[[5,"1"],[1,[6,"dot",["pa","ba"]],"/",[6,"dot",["ba","ba"]]]]]]]],[10,[6,"length",[[6,"sub",["pa",[6,[7,"ba","mul"],["h"]]]]]]]]],externalNames:["sub","max","min","dot","length"]},get externals(){return{sub:K,max:ie,min:Ie,dot:ae,length:$e}}})&&e.f)({})),"sdLine"),us=(e=>(globalThis.__TYPEGPU_META__??=new WeakMap).set(e.f=(t=>(globalThis.__TYPEGPU_META__??=new WeakMap).set(t.f=(n=>{"use gpu";return ae(n,n)}),{v:1,name:void 0,ast:{params:[{type:"i",name:"v"}],body:[0,[[10,[6,"dot",["v","v"]]]]],externalNames:["dot"]},get externals(){return{dot:ae}}})&&t.f)({}),{v:1,name:"dot2",ast:{params:[{type:"i",name:"v"}],body:[0,[[10,[6,"dot",["v","v"]]]]],externalNames:["dot"]},get externals(){return{dot:ae}}})&&e.f)({}),wx=(globalThis.__TYPEGPU_AUTONAME__??(e=>e))(H.fn([F,F,F,F],$)((e=>(globalThis.__TYPEGPU_META__??=new WeakMap).set(e.f=((t,n,r,s)=>{const i=r.sub(n),p=n.sub(r.mul(2)).add(s),y=i.mul($(2)),v=n.sub(t),P=1/ie(ae(p,p),1e-4),U=P*ae(i,p),R=P*($(2)*ae(i,i)+ae(v,p))/3,j=P*ae(v,i);let L=$(0);const Z=R-U*U,Q=Z*Z*Z,re=U*(2*U*U-3*R)+j;let Me=re*re+4*Q;if(Me>=0){Me=gn(Me);const oe=F(Me,-Me).sub(re).mul(.5),be=ar(oe).mul(gr(He(oe),F(1/3))),ze=kr(be.x+be.y-U,0,1);L=us(v.add(y.add(p.mul(ze)).mul(ze)))}else{const oe=gn(-Z),be=Fa(re/(Z*oe*2))/3,ze=Ft(be),Se=xe(un(be),1.732050808),Pe=jt(O(ze+ze,-Se-ze,Se-ze).mul(oe).sub(U));L=Ie(us(v.add(y.add(p.mul(Pe.x)).mul(Pe.x))),us(v.add(y.add(p.mul(Pe.y)).mul(Pe.y))))}return gn(L)}),{v:1,name:void 0,ast:{params:[{type:"i",name:"pos"},{type:"i",name:"A"},{type:"i",name:"B"},{type:"i",name:"C"}],body:[0,[[13,"a",[6,[7,"B","sub"],["A"]]],[13,"b",[6,[7,[6,[7,"A","sub"],[[6,[7,"B","mul"],[[5,"2"]]]]],"add"],["C"]]],[13,"c",[6,[7,"a","mul"],[[6,"f32",[[5,"2"]]]]]],[13,"d",[6,[7,"A","sub"],["pos"]]],[13,"dotB",[6,"max",[[6,"dot",["b","b"]],[5,"0.0001"]]]],[13,"kk",[1,[5,"1"],"/","dotB"]],[13,"kx",[1,"kk","*",[6,"dot",["a","b"]]]],[13,"ky",[1,[1,"kk","*",[1,[1,[6,"f32",[[5,"2"]]],"*",[6,"dot",["a","a"]]],"+",[6,"dot",["d","b"]]]],"/",[5,"3"]]],[13,"kz",[1,"kk","*",[6,"dot",["d","a"]]]],[12,"res",[6,"f32",[[5,"0"]]]],[13,"p",[1,"ky","-",[1,"kx","*","kx"]]],[13,"p3",[1,[1,"p","*","p"],"*","p"]],[13,"q",[1,[1,"kx","*",[1,[1,[1,[5,"2"],"*","kx"],"*","kx"],"-",[1,[5,"3"],"*","ky"]]],"+","kz"]],[12,"h",[1,[1,"q","*","q"],"+",[1,[5,"4"],"*","p3"]]],[11,[1,"h",">=",[5,"0"]],[0,[[2,"h","=",[6,"sqrt",["h"]]],[13,"x",[6,[7,[6,[7,[6,"vec2f",["h",[4,"-","h"]]],"sub"],["q"]],"mul"],[[5,"0.5"]]]],[13,"uv",[6,[7,[6,"sign",["x"]],"mul"],[[6,"pow",[[6,"abs",["x"]],[6,"vec2f",[[1,[5,"1"],"/",[5,"3"]]]]]]]]],[13,"t",[6,"clamp",[[1,[1,[7,"uv","x"],"+",[7,"uv","y"]],"-","kx"],[5,"0"],[5,"1"]]]],[2,"res","=",[6,"dot2",[[6,[7,"d","add"],[[6,[7,[6,[7,"c","add"],[[6,[7,"b","mul"],["t"]]]],"mul"],["t"]]]]]]]]],[0,[[13,"z",[6,"sqrt",[[4,"-","p"]]]],[13,"v",[1,[6,"acos",[[1,"q","/",[1,[1,"p","*","z"],"*",[5,"2"]]]]],"/",[5,"3"]]],[13,"m",[6,"cos",["v"]]],[13,"n",[6,"mul",[[6,"sin",["v"]],[5,"1.732050808"]]]],[13,"t",[6,"saturate",[[6,[7,[6,[7,[6,"vec3f",[[1,"m","+","m"],[1,[4,"-","n"],"-","m"],[1,"n","-","m"]]],"mul"],["z"]],"sub"],["kx"]]]]],[2,"res","=",[6,"min",[[6,"dot2",[[6,[7,"d","add"],[[6,[7,[6,[7,"c","add"],[[6,[7,"b","mul"],[[7,"t","x"]]]]],"mul"],[[7,"t","x"]]]]]]],[6,"dot2",[[6,[7,"d","add"],[[6,[7,[6,[7,"c","add"],[[6,[7,"b","mul"],[[7,"t","y"]]]]],"mul"],[[7,"t","y"]]]]]]]]]]]]],[10,[6,"sqrt",["res"]]]]],externalNames:["f32","max","dot","sqrt","vec2f","sign","pow","abs","clamp","dot2","acos","cos","mul","sin","saturate","vec3f","min"]},get externals(){return{f32:$,max:ie,dot:ae,sqrt:gn,vec2f:F,sign:ar,pow:gr,abs:He,clamp:kr,dot2:us,acos:Fa,cos:Ft,mul:xe,sin:un,saturate:jt,vec3f:O,min:Ie}}})&&e.f)({})),"sdBezier"),bi=(e=>(globalThis.__TYPEGPU_META__??=new WeakMap).set(e.f=(t=>(globalThis.__TYPEGPU_META__??=new WeakMap).set(t.f=((n,r)=>{"use gpu";return n.x*r.y-n.y*r.x}),{v:1,name:void 0,ast:{params:[{type:"i",name:"a"},{type:"i",name:"b"}],body:[0,[[10,[1,[1,[7,"a","x"],"*",[7,"b","y"]],"-",[1,[7,"a","y"],"*",[7,"b","x"]]]]]],externalNames:[]},get externals(){return{}}})&&t.f)({}),{v:1,name:"cro",ast:{params:[{type:"i",name:"a"},{type:"i",name:"b"}],body:[0,[[10,[1,[1,[7,"a","x"],"*",[7,"b","y"]],"-",[1,[7,"a","y"],"*",[7,"b","x"]]]]]],externalNames:[]},get externals(){return{}}})&&e.f)({}),xx=(globalThis.__TYPEGPU_AUTONAME__??(e=>e))(H.fn([F,F,F,F],$)((e=>(globalThis.__TYPEGPU_META__??=new WeakMap).set(e.f=((t,n,r,s)=>{const i=n.sub(s),p=s.sub(r),y=r.sub(n),v=p.sub(y),_=n.sub(t),P=r.sub(t),U=s.sub(t),R=bi(_,U),j=bi(P,_),L=bi(U,P),Z=p.mul(j).add(y.mul(L)).mul(2).sub(i.mul(R)),Q=(j*L-R*R*.25)/us(Z),re=jt((.5*R+j+Q*ae(Z,v))/(R+j+L)),Me=_.add(y.add(y).add(v.mul(re)).mul(re));return $e(Me)}),{v:1,name:void 0,ast:{params:[{type:"i",name:"pos"},{type:"i",name:"A"},{type:"i",name:"B"},{type:"i",name:"C"}],body:[0,[[13,"i",[6,[7,"A","sub"],["C"]]],[13,"j",[6,[7,"C","sub"],["B"]]],[13,"k",[6,[7,"B","sub"],["A"]]],[13,"w",[6,[7,"j","sub"],["k"]]],[13,"v0",[6,[7,"A","sub"],["pos"]]],[13,"v1",[6,[7,"B","sub"],["pos"]]],[13,"v2",[6,[7,"C","sub"],["pos"]]],[13,"x",[6,"cro",["v0","v2"]]],[13,"y",[6,"cro",["v1","v0"]]],[13,"z",[6,"cro",["v2","v1"]]],[13,"s",[6,[7,[6,[7,[6,[7,[6,[7,"j","mul"],["y"]],"add"],[[6,[7,"k","mul"],["z"]]]],"mul"],[[5,"2"]]],"sub"],[[6,[7,"i","mul"],["x"]]]]],[13,"r",[1,[1,[1,"y","*","z"],"-",[1,[1,"x","*","x"],"*",[5,"0.25"]]],"/",[6,"dot2",["s"]]]],[13,"t",[6,"saturate",[[1,[1,[1,[1,[5,"0.5"],"*","x"],"+","y"],"+",[1,"r","*",[6,"dot",["s","w"]]]],"/",[1,[1,"x","+","y"],"+","z"]]]]],[13,"d",[6,[7,"v0","add"],[[6,[7,[6,[7,[6,[7,"k","add"],["k"]],"add"],[[6,[7,"w","mul"],["t"]]]],"mul"],["t"]]]]],[10,[6,"length",["d"]]]]],externalNames:["cro","dot2","saturate","dot","length"]},get externals(){return{cro:bi,dot2:us,saturate:jt,dot:ae,length:$e}}})&&e.f)({})),"sdBezierApprox"),vx=(globalThis.__TYPEGPU_AUTONAME__??(e=>e))(H.fn([F,F,$],$)((e=>(globalThis.__TYPEGPU_META__??=new WeakMap).set(e.f=((t,n,r)=>{const s=t;s.x=He(t.x);const i=$e(s)-r,p=$e(s.sub(n.mul(kr(ae(s,n),0,r))));return ie(i,p*ar(n.y*s.x-n.x*s.y))}),{v:1,name:void 0,ast:{params:[{type:"i",name:"p"},{type:"i",name:"c"},{type:"i",name:"r"}],body:[0,[[13,"p_w","p"],[2,[7,"p_w","x"],"=",[6,"abs",[[7,"p","x"]]]],[13,"l",[1,[6,"length",["p_w"]],"-","r"]],[13,"m",[6,"length",[[6,[7,"p_w","sub"],[[6,[7,"c","mul"],[[6,"clamp",[[6,"dot",["p_w","c"]],[5,"0"],"r"]]]]]]]]],[10,[6,"max",["l",[1,"m","*",[6,"sign",[[1,[1,[7,"c","y"],"*",[7,"p_w","x"]],"-",[1,[7,"c","x"],"*",[7,"p_w","y"]]]]]]]]]]],externalNames:["abs","length","clamp","dot","max","sign"]},get externals(){return{abs:He,length:$e,clamp:kr,dot:ae,max:ie,sign:ar}}})&&e.f)({})),"sdPie"),bx=(globalThis.__TYPEGPU_AUTONAME__??(e=>e))(H.fn([O,$],$)((e=>(globalThis.__TYPEGPU_META__??=new WeakMap).set(e.f=((t,n)=>$e(t)-n),{v:1,name:void 0,ast:{params:[{type:"i",name:"p"},{type:"i",name:"radius"}],body:[0,[[10,[1,[6,"length",["p"]],"-","radius"]]]],externalNames:["length"]},get externals(){return{length:$e}}})&&e.f)({})),"sdSphere"),Tx=(globalThis.__TYPEGPU_AUTONAME__??(e=>e))(H.fn([O,O],$)((e=>(globalThis.__TYPEGPU_META__??=new WeakMap).set(e.f=((t,n)=>{const r=K(He(t),n);return $e(ie(r,O(0)))+Ie(ie(ie(r.x,r.y),r.z),0)}),{v:1,name:void 0,ast:{params:[{type:"i",name:"p"},{type:"i",name:"size"}],body:[0,[[13,"d",[6,"sub",[[6,"abs",["p"]],"size"]]],[10,[1,[6,"length",[[6,"max",["d",[6,"vec3f",[[5,"0"]]]]]]],"+",[6,"min",[[6,"max",[[6,"max",[[7,"d","x"],[7,"d","y"]]],[7,"d","z"]]],[5,"0"]]]]]]],externalNames:["sub","abs","length","max","vec3f","min"]},get externals(){return{sub:K,abs:He,length:$e,max:ie,vec3f:O,min:Ie}}})&&e.f)({})),"sdBox3d"),tp=(globalThis.__TYPEGPU_AUTONAME__??(e=>e))(H.fn([O,O,$],$)((e=>(globalThis.__TYPEGPU_META__??=new WeakMap).set(e.f=((t,n,r)=>{const s=ue(K(He(t),n),O(r));return $e(ie(s,O(0)))+Ie(ie(ie(s.x,s.y),s.z),0)-r}),{v:1,name:void 0,ast:{params:[{type:"i",name:"p"},{type:"i",name:"size"},{type:"i",name:"cornerRadius"}],body:[0,[[13,"d",[6,"add",[[6,"sub",[[6,"abs",["p"]],"size"]],[6,"vec3f",["cornerRadius"]]]]],[10,[1,[1,[6,"length",[[6,"max",["d",[6,"vec3f",[[5,"0"]]]]]]],"+",[6,"min",[[6,"max",[[6,"max",[[7,"d","x"],[7,"d","y"]]],[7,"d","z"]]],[5,"0"]]]],"-","cornerRadius"]]]],externalNames:["add","sub","abs","vec3f","length","max","min"]},get externals(){return{add:ue,sub:K,abs:He,vec3f:O,length:$e,max:ie,min:Ie}}})&&e.f)({})),"sdRoundedBox3d"),_x=(globalThis.__TYPEGPU_AUTONAME__??(e=>e))(H.fn([O,O,$],$)((e=>(globalThis.__TYPEGPU_META__??=new WeakMap).set(e.f=((t,n,r)=>{const s=K(He(t),n),i=K(He(ue(s,r)),O(r)),p=$e(ie(O(s.x,i.y,i.z),O(0)))+Ie(ie(s.x,ie(i.y,i.z)),0),y=$e(ie(O(i.x,s.y,i.z),O(0)))+Ie(ie(i.x,ie(s.y,i.z)),0),v=$e(ie(O(i.x,i.y,s.z),O(0)))+Ie(ie(i.x,ie(i.y,s.z)),0);return Ie(Ie(p,y),v)}),{v:1,name:void 0,ast:{params:[{type:"i",name:"p"},{type:"i",name:"size"},{type:"i",name:"thickness"}],body:[0,[[13,"p1",[6,"sub",[[6,"abs",["p"]],"size"]]],[13,"q",[6,"sub",[[6,"abs",[[6,"add",["p1","thickness"]]]],[6,"vec3f",["thickness"]]]]],[13,"d1",[1,[6,"length",[[6,"max",[[6,"vec3f",[[7,"p1","x"],[7,"q","y"],[7,"q","z"]]],[6,"vec3f",[[5,"0"]]]]]]],"+",[6,"min",[[6,"max",[[7,"p1","x"],[6,"max",[[7,"q","y"],[7,"q","z"]]]]],[5,"0"]]]]],[13,"d2",[1,[6,"length",[[6,"max",[[6,"vec3f",[[7,"q","x"],[7,"p1","y"],[7,"q","z"]]],[6,"vec3f",[[5,"0"]]]]]]],"+",[6,"min",[[6,"max",[[7,"q","x"],[6,"max",[[7,"p1","y"],[7,"q","z"]]]]],[5,"0"]]]]],[13,"d3",[1,[6,"length",[[6,"max",[[6,"vec3f",[[7,"q","x"],[7,"q","y"],[7,"p1","z"]]],[6,"vec3f",[[5,"0"]]]]]]],"+",[6,"min",[[6,"max",[[7,"q","x"],[6,"max",[[7,"q","y"],[7,"p1","z"]]]]],[5,"0"]]]]],[10,[6,"min",[[6,"min",["d1","d2"]],"d3"]]]]],externalNames:["sub","abs","add","vec3f","length","max","min"]},get externals(){return{sub:K,abs:He,add:ue,vec3f:O,length:$e,max:ie,min:Ie}}})&&e.f)({})),"sdBoxFrame3d"),$x=(globalThis.__TYPEGPU_AUTONAME__??(e=>e))(H.fn([O,O,O],$)((e=>(globalThis.__TYPEGPU_META__??=new WeakMap).set(e.f=((t,n,r)=>{const s=K(t,n),i=K(r,n),p=ie(0,Ie(1,ae(s,i)/ae(i,i)));return $e(K(s,i.mul(p)))}),{v:1,name:void 0,ast:{params:[{type:"i",name:"p"},{type:"i",name:"a"},{type:"i",name:"b"}],body:[0,[[13,"pa",[6,"sub",["p","a"]]],[13,"ba",[6,"sub",["b","a"]]],[13,"h",[6,"max",[[5,"0"],[6,"min",[[5,"1"],[1,[6,"dot",["pa","ba"]],"/",[6,"dot",["ba","ba"]]]]]]]],[10,[6,"length",[[6,"sub",["pa",[6,[7,"ba","mul"],["h"]]]]]]]]],externalNames:["sub","max","min","dot","length"]},get externals(){return{sub:K,max:ie,min:Ie,dot:ae,length:$e}}})&&e.f)({})),"sdLine3d"),np=(globalThis.__TYPEGPU_AUTONAME__??(e=>e))(H.fn([O,O,$],$)((e=>(globalThis.__TYPEGPU_META__??=new WeakMap).set(e.f=((t,n,r)=>ae(t,n)+r),{v:1,name:void 0,ast:{params:[{type:"i",name:"p"},{type:"i",name:"n"},{type:"i",name:"h"}],body:[0,[[10,[1,[6,"dot",["p","n"]],"+","h"]]]],externalNames:["dot"]},get externals(){return{dot:ae}}})&&e.f)({})),"sdPlane"),Mx=(globalThis.__TYPEGPU_AUTONAME__??(e=>e))(H.fn([O,O,O,$],$)((e=>(globalThis.__TYPEGPU_META__??=new WeakMap).set(e.f=((t,n,r,s)=>{const i=K(t,n),p=K(r,n),y=jt(ae(i,p)/ae(p,p));return $e(K(i,p.mul(y)))-s}),{v:1,name:void 0,ast:{params:[{type:"i",name:"p"},{type:"i",name:"a"},{type:"i",name:"b"},{type:"i",name:"radius"}],body:[0,[[13,"pa",[6,"sub",["p","a"]]],[13,"ba",[6,"sub",["b","a"]]],[13,"h",[6,"saturate",[[1,[6,"dot",["pa","ba"]],"/",[6,"dot",["ba","ba"]]]]]],[10,[1,[6,"length",[[6,"sub",["pa",[6,[7,"ba","mul"],["h"]]]]]],"-","radius"]]]],externalNames:["sub","saturate","dot","length"]},get externals(){return{sub:K,saturate:jt,dot:ae,length:$e}}})&&e.f)({})),"sdCapsule"),rp=Object.freeze(Object.defineProperty({__proto__:null,opExtrudeX:dx,opExtrudeY:Kh,opExtrudeZ:px,opSmoothDifference:hx,opSmoothUnion:cx,opUnion:ep,sdBezier:wx,sdBezierApprox:xx,sdBox2d:mx,sdBox3d:Tx,sdBoxFrame3d:_x,sdCapsule:Mx,sdDisk:fx,sdLine:gx,sdLine3d:$x,sdPie:vx,sdPlane:np,sdRoundedBox2d:yx,sdRoundedBox3d:tp,sdSphere:bx},Symbol.toStringTag,{value:"Module"}));var sp=mc({in:{vertexIndex:Ns.vertexIndex},out:{pos:Ns.position,uv:F}})`{
  const pos = array<vec2f, 3>(vec2f(-1, -1), vec2f(3, -1), vec2f(-1, 3));
  const uv = array<vec2f, 3>(vec2f(0, 1), vec2f(2, 1), vec2f(0, -1));

  return Out(vec4f(pos[in.vertexIndex], 0, 1), uv[in.vertexIndex]);
}`;const zx=(globalThis.__TYPEGPU_AUTONAME__??(e=>e))(H.fn([],$),"randomGeneratorShell"),Ex=(()=>{const e=(globalThis.__TYPEGPU_AUTONAME__??(t=>t))(H.privateVar(F),"seed");return{seed:(globalThis.__TYPEGPU_AUTONAME__??(t=>t))(H.fn([$])((t=>(globalThis.__TYPEGPU_META__??=new WeakMap).set(t.f=(n=>{e.value=F(n,0)}),{v:1,name:void 0,ast:{params:[{type:"i",name:"value"}],body:[0,[[2,[7,"seed","value"],"=",[6,[7,"d","vec2f"],["value",[5,"0"]]]]]],externalNames:["seed","d"]},get externals(){return{seed:e,d:ve}}})&&t.f)({})),"seed"),seed2:(globalThis.__TYPEGPU_AUTONAME__??(t=>t))(H.fn([F])((t=>(globalThis.__TYPEGPU_META__??=new WeakMap).set(t.f=(n=>{e.value=n}),{v:1,name:void 0,ast:{params:[{type:"i",name:"value"}],body:[0,[[2,[7,"seed","value"],"=","value"]]],externalNames:["seed"]},get externals(){return{seed:e}}})&&t.f)({})),"seed2"),seed3:(globalThis.__TYPEGPU_AUTONAME__??(t=>t))(H.fn([O])((t=>(globalThis.__TYPEGPU_META__??=new WeakMap).set(t.f=(n=>{e.value=ue(n.xy,F(n.z))}),{v:1,name:void 0,ast:{params:[{type:"i",name:"value"}],body:[0,[[2,[7,"seed","value"],"=",[6,"add",[[7,"value","xy"],[6,[7,"d","vec2f"],[[7,"value","z"]]]]]]]],externalNames:["seed","add","d"]},get externals(){return{seed:e,add:ue,d:ve}}})&&t.f)({})),"seed3"),seed4:(globalThis.__TYPEGPU_AUTONAME__??(t=>t))(H.fn([k])((t=>(globalThis.__TYPEGPU_META__??=new WeakMap).set(t.f=(n=>{e.value=ue(n.xy,n.zw)}),{v:1,name:void 0,ast:{params:[{type:"i",name:"value"}],body:[0,[[2,[7,"seed","value"],"=",[6,"add",[[7,"value","xy"],[7,"value","zw"]]]]]],externalNames:["seed","add"]},get externals(){return{seed:e,add:ue}}})&&t.f)({})),"seed4"),sample:zx((t=>(globalThis.__TYPEGPU_META__??=new WeakMap).set(t.f=(n=>(globalThis.__TYPEGPU_META__??=new WeakMap).set(n.f=(()=>{"use gpu";const r=ae(e.value,F(23.14077926,232.61690225)),s=ae(e.value,F(54.47856553,345.84153136));return e.value.x=er(Ft(r)*136.8168),e.value.y=er(Ft(s)*534.7645),e.value.y}),{v:1,name:void 0,ast:{params:[],body:[0,[[13,"a",[6,"dot",[[7,"seed","value"],[6,[7,"d","vec2f"],[[5,"23.14077926"],[5,"232.61690225"]]]]]],[13,"b",[6,"dot",[[7,"seed","value"],[6,[7,"d","vec2f"],[[5,"54.47856553"],[5,"345.84153136"]]]]]],[2,[7,[7,"seed","value"],"x"],"=",[6,"fract",[[1,[6,"cos",["a"]],"*",[5,"136.8168"]]]]],[2,[7,[7,"seed","value"],"y"],"=",[6,"fract",[[1,[6,"cos",["b"]],"*",[5,"534.7645"]]]]],[10,[7,[7,"seed","value"],"y"]]]],externalNames:["dot","seed","d","fract","cos"]},get externals(){return{dot:ae,seed:e,d:ve,fract:er,cos:Ft}}})&&n.f)({}),{v:1,name:void 0,ast:{params:[],body:[0,[[13,"a",[6,"dot",[[7,"seed","value"],[6,[7,"d","vec2f"],[[5,"23.14077926"],[5,"232.61690225"]]]]]],[13,"b",[6,"dot",[[7,"seed","value"],[6,[7,"d","vec2f"],[[5,"54.47856553"],[5,"345.84153136"]]]]]],[2,[7,[7,"seed","value"],"x"],"=",[6,"fract",[[1,[6,"cos",["a"]],"*",[5,"136.8168"]]]]],[2,[7,[7,"seed","value"],"y"],"=",[6,"fract",[[1,[6,"cos",["b"]],"*",[5,"534.7645"]]]]],[10,[7,[7,"seed","value"],"y"]]]],externalNames:["dot","seed","d","fract","cos"]},get externals(){return{dot:ae,seed:e,d:ve,fract:er,cos:Ft}}})&&t.f)({}))}})(),Sx=Ex,Oe=(globalThis.__TYPEGPU_AUTONAME__??(e=>e))(H.slot(Sx),"randomGeneratorSlot"),wr=Math.PI*2,Gs=1e-7,Px=(globalThis.__TYPEGPU_AUTONAME__??(e=>e))(H.fn([$])((e=>(globalThis.__TYPEGPU_META__??=new WeakMap).set(e.f=(t=>{Oe.value.seed(t)}),{v:1,name:void 0,ast:{params:[{type:"i",name:"seed"}],body:[0,[[6,[7,[7,"randomGeneratorSlot","value"],"seed"],["seed"]]]],externalNames:["randomGeneratorSlot"]},get externals(){return{randomGeneratorSlot:Oe}}})&&e.f)({})),"randSeed"),eo=(globalThis.__TYPEGPU_AUTONAME__??(e=>e))(H.fn([F])((e=>(globalThis.__TYPEGPU_META__??=new WeakMap).set(e.f=(t=>{Oe.value.seed2(t)}),{v:1,name:void 0,ast:{params:[{type:"i",name:"seed"}],body:[0,[[6,[7,[7,"randomGeneratorSlot","value"],"seed2"],["seed"]]]],externalNames:["randomGeneratorSlot"]},get externals(){return{randomGeneratorSlot:Oe}}})&&e.f)({})),"randSeed2"),to=(globalThis.__TYPEGPU_AUTONAME__??(e=>e))(H.fn([O])((e=>(globalThis.__TYPEGPU_META__??=new WeakMap).set(e.f=(t=>{Oe.value.seed3(t)}),{v:1,name:void 0,ast:{params:[{type:"i",name:"seed"}],body:[0,[[6,[7,[7,"randomGeneratorSlot","value"],"seed3"],["seed"]]]],externalNames:["randomGeneratorSlot"]},get externals(){return{randomGeneratorSlot:Oe}}})&&e.f)({})),"randSeed3"),Ux=(globalThis.__TYPEGPU_AUTONAME__??(e=>e))(H.fn([k])((e=>(globalThis.__TYPEGPU_META__??=new WeakMap).set(e.f=(t=>{Oe.value.seed4(t)}),{v:1,name:void 0,ast:{params:[{type:"i",name:"seed"}],body:[0,[[6,[7,[7,"randomGeneratorSlot","value"],"seed4"],["seed"]]]],externalNames:["randomGeneratorSlot"]},get externals(){return{randomGeneratorSlot:Oe}}})&&e.f)({})),"randSeed4"),Ax=(globalThis.__TYPEGPU_AUTONAME__??(e=>e))(H.fn([],$)((e=>(globalThis.__TYPEGPU_META__??=new WeakMap).set(e.f=(()=>Oe.value.sample()),{v:1,name:void 0,ast:{params:[],body:[0,[[10,[6,[7,[7,"randomGeneratorSlot","value"],"sample"],[]]]]],externalNames:["randomGeneratorSlot"]},get externals(){return{randomGeneratorSlot:Oe}}})&&e.f)({})),"randFloat01"),Ix=(globalThis.__TYPEGPU_AUTONAME__??(e=>e))(H.fn([],O)((e=>(globalThis.__TYPEGPU_META__??=new WeakMap).set(e.f=(()=>O(Oe.value.sample(),Oe.value.sample(),Oe.value.sample())),{v:1,name:void 0,ast:{params:[],body:[0,[[10,[6,[7,"d","vec3f"],[[6,[7,[7,"randomGeneratorSlot","value"],"sample"],[]],[6,[7,[7,"randomGeneratorSlot","value"],"sample"],[]],[6,[7,[7,"randomGeneratorSlot","value"],"sample"],[]]]]]]],externalNames:["d","randomGeneratorSlot"]},get externals(){return{d:ve,randomGeneratorSlot:Oe}}})&&e.f)({})),"randInUnitCube"),Bx=(globalThis.__TYPEGPU_AUTONAME__??(e=>e))(H.fn([],O)((e=>(globalThis.__TYPEGPU_META__??=new WeakMap).set(e.f=(()=>{const t=J(Oe.value.sample()*6),n=t%3,r=O();return r[n]=$(Ys(0,1,t>2)),r[(n+1)%3]=Oe.value.sample(),r[(n+2)%3]=Oe.value.sample(),r}),{v:1,name:void 0,ast:{params:[],body:[0,[[13,"face",[6,[7,"d","u32"],[[1,[6,[7,[7,"randomGeneratorSlot","value"],"sample"],[]],"*",[5,"6"]]]]],[13,"axis",[1,"face","%",[5,"3"]]],[13,"result",[6,[7,"d","vec3f"],[]]],[2,[8,"result","axis"],"=",[6,[7,"d","f32"],[[6,"select",[[5,"0"],[5,"1"],[1,"face",">",[5,"2"]]]]]]],[2,[8,"result",[1,[1,"axis","+",[5,"1"]],"%",[5,"3"]]],"=",[6,[7,[7,"randomGeneratorSlot","value"],"sample"],[]]],[2,[8,"result",[1,[1,"axis","+",[5,"2"]],"%",[5,"3"]]],"=",[6,[7,[7,"randomGeneratorSlot","value"],"sample"],[]]],[10,"result"]]],externalNames:["d","randomGeneratorSlot","select"]},get externals(){return{d:ve,randomGeneratorSlot:Oe,select:Ys}}})&&e.f)({})),"randOnUnitCube"),kx=(globalThis.__TYPEGPU_AUTONAME__??(e=>e))(H.fn([],F)((e=>(globalThis.__TYPEGPU_META__??=new WeakMap).set(e.f=(()=>{const t=gn(Oe.value.sample()),n=Oe.value.sample()*wr;return F(Ft(n)*t,un(n)*t)}),{v:1,name:void 0,ast:{params:[],body:[0,[[13,"radius",[6,"sqrt",[[6,[7,[7,"randomGeneratorSlot","value"],"sample"],[]]]]],[13,"angle",[1,[6,[7,[7,"randomGeneratorSlot","value"],"sample"],[]],"*","TWO_PI"]],[10,[6,[7,"d","vec2f"],[[1,[6,"cos",["angle"]],"*","radius"],[1,[6,"sin",["angle"]],"*","radius"]]]]]],externalNames:["sqrt","randomGeneratorSlot","TWO_PI","d","cos","sin"]},get externals(){return{sqrt:gn,randomGeneratorSlot:Oe,TWO_PI:wr,d:ve,cos:Ft,sin:un}}})&&e.f)({})),"randInUnitCircle"),no=(globalThis.__TYPEGPU_AUTONAME__??(e=>e))(H.fn([],F)((e=>(globalThis.__TYPEGPU_META__??=new WeakMap).set(e.f=(()=>{const t=Oe.value.sample()*wr;return F(Ft(t),un(t))}),{v:1,name:void 0,ast:{params:[],body:[0,[[13,"angle",[1,[6,[7,[7,"randomGeneratorSlot","value"],"sample"],[]],"*","TWO_PI"]],[10,[6,[7,"d","vec2f"],[[6,"cos",["angle"]],[6,"sin",["angle"]]]]]]],externalNames:["randomGeneratorSlot","TWO_PI","d","cos","sin"]},get externals(){return{randomGeneratorSlot:Oe,TWO_PI:wr,d:ve,cos:Ft,sin:un}}})&&e.f)({})),"randOnUnitCircle");(globalThis.__TYPEGPU_AUTONAME__??(e=>e))(H.fn([O],O)((e=>(globalThis.__TYPEGPU_META__??=new WeakMap).set(e.f=(t=>{let n=t;return $e(t)===0&&(n=t.add(Gs)),an(n)}),{v:1,name:void 0,ast:{params:[{type:"i",name:"v"}],body:[0,[[12,"vNonZero","v"],[11,[1,[6,"length",["v"]],"==",[5,"0"]],[0,[[2,"vNonZero","=",[6,[7,"v","add"],["EPS"]]]]]],[10,[6,"normalize",["vNonZero"]]]]],externalNames:["length","EPS","normalize"]},get externals(){return{length:$e,EPS:Gs,normalize:an}}})&&e.f)({})),"safeNormalize");const ro=(globalThis.__TYPEGPU_AUTONAME__??(e=>e))(H.fn([],O)((e=>(globalThis.__TYPEGPU_META__??=new WeakMap).set(e.f=(()=>{const t=Oe.value.sample(),n=O(Es(0,1),Es(0,1),Es(0,1));return an(n).mul(gr(t,.33))}),{v:1,name:void 0,ast:{params:[],body:[0,[[13,"u",[6,[7,[7,"randomGeneratorSlot","value"],"sample"],[]]],[13,"v",[6,[7,"d","vec3f"],[[6,"randNormal",[[5,"0"],[5,"1"]]],[6,"randNormal",[[5,"0"],[5,"1"]]],[6,"randNormal",[[5,"0"],[5,"1"]]]]]],[13,"vNorm",[6,"normalize",["v"]]],[10,[6,[7,"vNorm","mul"],[[6,"pow",["u",[5,"0.33"]]]]]]]],externalNames:["randomGeneratorSlot","d","randNormal","normalize","pow"]},get externals(){return{randomGeneratorSlot:Oe,d:ve,randNormal:Es,normalize:an,pow:gr}}})&&e.f)({})),"randInUnitSphere"),qs=(globalThis.__TYPEGPU_AUTONAME__??(e=>e))(H.fn([],O)((e=>(globalThis.__TYPEGPU_META__??=new WeakMap).set(e.f=(()=>{const t=2*Oe.value.sample()-1,n=gn(1-t*t),r=wr*Oe.value.sample(),s=Ft(r)*n,i=un(r)*n;return O(s,i,t)}),{v:1,name:void 0,ast:{params:[],body:[0,[[13,"z",[1,[1,[5,"2"],"*",[6,[7,[7,"randomGeneratorSlot","value"],"sample"],[]]],"-",[5,"1"]]],[13,"oneMinusZSq",[6,"sqrt",[[1,[5,"1"],"-",[1,"z","*","z"]]]]],[13,"theta",[1,"TWO_PI","*",[6,[7,[7,"randomGeneratorSlot","value"],"sample"],[]]]],[13,"x",[1,[6,"cos",["theta"]],"*","oneMinusZSq"]],[13,"y",[1,[6,"sin",["theta"]],"*","oneMinusZSq"]],[10,[6,[7,"d","vec3f"],["x","y","z"]]]]],externalNames:["randomGeneratorSlot","sqrt","TWO_PI","cos","sin","d"]},get externals(){return{randomGeneratorSlot:Oe,sqrt:gn,TWO_PI:wr,cos:Ft,sin:un,d:ve}}})&&e.f)({})),"randOnUnitSphere"),Ox=(globalThis.__TYPEGPU_AUTONAME__??(e=>e))(H.fn([O],O)((e=>(globalThis.__TYPEGPU_META__??=new WeakMap).set(e.f=(t=>{const n=ro(),r=ae(t,n);return xe(ar(r),n)}),{v:1,name:void 0,ast:{params:[{type:"i",name:"normal"}],body:[0,[[13,"value",[6,"randInUnitSphere",[]]],[13,"alignment",[6,"dot",["normal","value"]]],[10,[6,"mul",[[6,"sign",["alignment"]],"value"]]]]],externalNames:["randInUnitSphere","dot","mul","sign"]},get externals(){return{randInUnitSphere:ro,dot:ae,mul:xe,sign:ar}}})&&e.f)({})),"randInUnitHemisphere"),Vx=(globalThis.__TYPEGPU_AUTONAME__??(e=>e))(H.fn([O],O)((e=>(globalThis.__TYPEGPU_META__??=new WeakMap).set(e.f=(t=>{const n=qs(),r=ae(t,n);return xe(ar(r),n)}),{v:1,name:void 0,ast:{params:[{type:"i",name:"normal"}],body:[0,[[13,"value",[6,"randOnUnitSphere",[]]],[13,"alignment",[6,"dot",["normal","value"]]],[10,[6,"mul",[[6,"sign",["alignment"]],"value"]]]]],externalNames:["randOnUnitSphere","dot","mul","sign"]},get externals(){return{randOnUnitSphere:qs,dot:ae,mul:xe,sign:ar}}})&&e.f)({})),"randOnUnitHemisphere"),pr=(globalThis.__TYPEGPU_AUTONAME__??(e=>e))(H.fn([],$)((e=>(globalThis.__TYPEGPU_META__??=new WeakMap).set(e.f=(()=>Oe.value.sample()*(1-2*Gs)+Gs),{v:1,name:void 0,ast:{params:[],body:[0,[[10,[1,[1,[6,[7,[7,"randomGeneratorSlot","value"],"sample"],[]],"*",[1,[5,"1"],"-",[1,[5,"2"],"*","EPS"]]],"+","EPS"]]]],externalNames:["randomGeneratorSlot","EPS"]},get externals(){return{randomGeneratorSlot:Oe,EPS:Gs}}})&&e.f)({})),"randUniformExclusive"),Es=(globalThis.__TYPEGPU_AUTONAME__??(e=>e))(H.fn([$,$],$)((e=>(globalThis.__TYPEGPU_META__??=new WeakMap).set(e.f=((t,n)=>{const r=wr*pr();return gn(-2*js(pr()))*un(r)*n+t}),{v:1,name:void 0,ast:{params:[{type:"i",name:"mu"},{type:"i",name:"sigma"}],body:[0,[[13,"theta",[1,"TWO_PI","*",[6,"randUniformExclusive",[]]]],[13,"R",[6,"sqrt",[[1,[4,"-",[5,"2"]],"*",[6,"log",[[6,"randUniformExclusive",[]]]]]]]],[10,[1,[1,[1,"R","*",[6,"sin",["theta"]]],"*","sigma"],"+","mu"]]]],externalNames:["TWO_PI","randUniformExclusive","sqrt","log","sin"]},get externals(){return{TWO_PI:wr,randUniformExclusive:pr,sqrt:gn,log:js,sin:un}}})&&e.f)({})),"randNormal"),Gx=(globalThis.__TYPEGPU_AUTONAME__??(e=>e))(H.fn([$],$)((e=>(globalThis.__TYPEGPU_META__??=new WeakMap).set(e.f=(t=>{const n=pr();return-1/t*js(n)}),{v:1,name:void 0,ast:{params:[{type:"i",name:"rate"}],body:[0,[[13,"u",[6,"randUniformExclusive",[]]],[10,[1,[1,[4,"-",[5,"1"]],"/","rate"],"*",[6,"log",["u"]]]]]],externalNames:["randUniformExclusive","log"]},get externals(){return{randUniformExclusive:pr,log:js}}})&&e.f)({})),"randExponential"),Dx=(globalThis.__TYPEGPU_AUTONAME__??(e=>e))(H.fn([$,$],$)((e=>(globalThis.__TYPEGPU_META__??=new WeakMap).set(e.f=((t,n)=>{const r=pr();return t+n*ja(Math.PI*(r-.5))}),{v:1,name:void 0,ast:{params:[{type:"i",name:"x0"},{type:"i",name:"gamma"}],body:[0,[[13,"u",[6,"randUniformExclusive",[]]],[10,[1,"x0","+",[1,"gamma","*",[6,"tan",[[1,[7,"Math","PI"],"*",[1,"u","-",[5,"0.5"]]]]]]]]]],externalNames:["randUniformExclusive","tan","Math"]},get externals(){return{randUniformExclusive:pr,tan:ja,Math}}})&&e.f)({})),"randCauchy"),Rx=(globalThis.__TYPEGPU_AUTONAME__??(e=>e))(H.fn([$],$)((e=>(globalThis.__TYPEGPU_META__??=new WeakMap).set(e.f=(t=>{const n=Oe.value.sample();return La(n,t)}),{v:1,name:void 0,ast:{params:[{type:"i",name:"p"}],body:[0,[[13,"u",[6,[7,[7,"randomGeneratorSlot","value"],"sample"],[]]],[10,[6,"step",["u","p"]]]]],externalNames:["randomGeneratorSlot","step"]},get externals(){return{randomGeneratorSlot:Oe,step:La}}})&&e.f)({})),"randBernoulli"),ip=(e=>(globalThis.__TYPEGPU_META__??=new WeakMap).set(e.f=(t=>(globalThis.__TYPEGPU_META__??=new WeakMap).set(t.f=(n=>{"use gpu";return xe(xe(n,xe(n,n)),ue(xe(n,K(xe(n,6),15)),10))}),{v:1,name:void 0,ast:{params:[{type:"i",name:"t"}],body:[0,[[10,[6,"mul",[[6,"mul",["t",[6,"mul",["t","t"]]]],[6,"add",[[6,"mul",["t",[6,"sub",[[6,"mul",["t",[5,"6"]]],[5,"15"]]]]],[5,"10"]]]]]]]],externalNames:["mul","add","sub"]},get externals(){return{mul:xe,add:ue,sub:K}}})&&t.f)({}),{v:1,name:"quinticInterpolationImpl",ast:{params:[{type:"i",name:"t"}],body:[0,[[10,[6,"mul",[[6,"mul",["t",[6,"mul",["t","t"]]]],[6,"add",[[6,"mul",["t",[6,"sub",[[6,"mul",["t",[5,"6"]]],[5,"15"]]]]],[5,"10"]]]]]]]],externalNames:["mul","add","sub"]},get externals(){return{mul:xe,add:ue,sub:K}}})&&e.f)({}),qi=(globalThis.__TYPEGPU_AUTONAME__??(e=>e))(H.fn([F],F)(ip),"quinticInterpolation2"),Du=(globalThis.__TYPEGPU_AUTONAME__??(e=>e))(H.fn([O],O)(ip),"quinticInterpolation3"),ap=(e=>(globalThis.__TYPEGPU_META__??=new WeakMap).set(e.f=(t=>(globalThis.__TYPEGPU_META__??=new WeakMap).set(t.f=(n=>{"use gpu";return xe(xe(xe(30,n),n),ue(xe(n,K(n,2)),1))}),{v:1,name:void 0,ast:{params:[{type:"i",name:"t"}],body:[0,[[10,[6,"mul",[[6,"mul",[[6,"mul",[[5,"30"],"t"]],"t"]],[6,"add",[[6,"mul",["t",[6,"sub",["t",[5,"2"]]]]],[5,"1"]]]]]]]],externalNames:["mul","add","sub"]},get externals(){return{mul:xe,add:ue,sub:K}}})&&t.f)({}),{v:1,name:"quinticDerivativeImpl",ast:{params:[{type:"i",name:"t"}],body:[0,[[10,[6,"mul",[[6,"mul",[[6,"mul",[[5,"30"],"t"]],"t"]],[6,"add",[[6,"mul",["t",[6,"sub",["t",[5,"2"]]]]],[5,"1"]]]]]]]],externalNames:["mul","add","sub"]},get externals(){return{mul:xe,add:ue,sub:K}}})&&e.f)({}),Ru=(globalThis.__TYPEGPU_AUTONAME__??(e=>e))(H.fn([F],F)(ap),"quinticDerivative2");(globalThis.__TYPEGPU_AUTONAME__??(e=>e))(H.fn([O],O)(ap),"quinticDerivative3");const Nx=(globalThis.__TYPEGPU_AUTONAME__??(e=>e))(H.fn([Be],F)((e=>(globalThis.__TYPEGPU_META__??=new WeakMap).set(e.f=(t=>(eo(xe(.001,F(t))),no())),{v:1,name:void 0,ast:{params:[{type:"i",name:"pos"}],body:[0,[[6,"randSeed2",[[6,"mul",[[5,"0.001"],[6,[7,"d","vec2f"],["pos"]]]]]],[10,[6,"randOnUnitCircle",[]]]]],externalNames:["randSeed2","mul","d","randOnUnitCircle"]},get externals(){return{randSeed2:eo,mul:xe,d:ve,randOnUnitCircle:no}}})&&e.f)({})),"computeJunctionGradient"),jn=(globalThis.__TYPEGPU_AUTONAME__??(e=>e))(H.slot(Nx),"getJunctionGradientSlot");(globalThis.__TYPEGPU_AUTONAME__??(e=>e))(H.fn([F],$)((e=>(globalThis.__TYPEGPU_META__??=new WeakMap).set(e.f=(t=>{const n=Be(Or(t)),r=er(t),s=qi(r),i=jn.$(n),p=jn.$(ue(n,Be(1,0))),y=jn.$(ue(n,Be(0,1))),v=jn.$(ue(n,Be(1,1))),_=ae(i,K(r,F(0,0))),P=ae(p,K(r,F(1,0))),U=ae(y,K(r,F(0,1))),R=ae(v,K(r,F(1,1)));return _+s.x*(P-_)+s.y*(U-_)+s.x*s.y*(_-P-U+R)}),{v:1,name:void 0,ast:{params:[{type:"i",name:"pos"}],body:[0,[[13,"i",[6,[7,"d","vec2i"],[[6,"floor",["pos"]]]]],[13,"f",[6,"fract",["pos"]]],[13,"u",[6,"quinticInterpolation2",["f"]]],[13,"ga",[6,[7,"getJunctionGradientSlot","$"],["i"]]],[13,"gb",[6,[7,"getJunctionGradientSlot","$"],[[6,"add",["i",[6,[7,"d","vec2i"],[[5,"1"],[5,"0"]]]]]]]],[13,"gc",[6,[7,"getJunctionGradientSlot","$"],[[6,"add",["i",[6,[7,"d","vec2i"],[[5,"0"],[5,"1"]]]]]]]],[13,"gd",[6,[7,"getJunctionGradientSlot","$"],[[6,"add",["i",[6,[7,"d","vec2i"],[[5,"1"],[5,"1"]]]]]]]],[13,"va",[6,"dot",["ga",[6,"sub",["f",[6,[7,"d","vec2f"],[[5,"0"],[5,"0"]]]]]]]],[13,"vb",[6,"dot",["gb",[6,"sub",["f",[6,[7,"d","vec2f"],[[5,"1"],[5,"0"]]]]]]]],[13,"vc",[6,"dot",["gc",[6,"sub",["f",[6,[7,"d","vec2f"],[[5,"0"],[5,"1"]]]]]]]],[13,"vd",[6,"dot",["gd",[6,"sub",["f",[6,[7,"d","vec2f"],[[5,"1"],[5,"1"]]]]]]]],[13,"noise",[1,[1,[1,"va","+",[1,[7,"u","x"],"*",[1,"vb","-","va"]]],"+",[1,[7,"u","y"],"*",[1,"vc","-","va"]]],"+",[1,[1,[7,"u","x"],"*",[7,"u","y"]],"*",[1,[1,[1,"va","-","vb"],"-","vc"],"+","vd"]]]],[10,"noise"]]],externalNames:["d","floor","fract","quinticInterpolation2","getJunctionGradientSlot","add","dot","sub"]},get externals(){return{d:ve,floor:Or,fract:er,quinticInterpolation2:qi,getJunctionGradientSlot:jn,add:ue,dot:ae,sub:K}}})&&e.f)({})),"sample");(globalThis.__TYPEGPU_AUTONAME__??(e=>e))(H.fn([F],O)((e=>(globalThis.__TYPEGPU_META__??=new WeakMap).set(e.f=(t=>{const n=Be(Or(t)),r=er(t),s=qi(r),i=Ru(r),p=jn.$(n),y=jn.$(ue(n,Be(1,0))),v=jn.$(ue(n,Be(0,1))),_=jn.$(ue(n,Be(1,1))),P=ae(p,K(r,F(0,0))),U=ae(y,K(r,F(1,0))),R=ae(v,K(r,F(0,1))),j=ae(_,K(r,F(1,1))),L=P+s.x*(U-P)+s.y*(R-P)+s.x*s.y*(P-U-R+j),Z=ue(p,ue(ue(ue(xe(s.x,K(y,p)),xe(s.y,K(v,p))),xe(s.x,xe(s.y,ue(K(K(p,y),v),_)))),xe(i,K(ue(xe(s.yx,P-U-R+j),F(U,R)),P))));return O(L,Z)}),{v:1,name:void 0,ast:{params:[{type:"i",name:"pos"}],body:[0,[[13,"i",[6,[7,"d","vec2i"],[[6,"floor",["pos"]]]]],[13,"f",[6,"fract",["pos"]]],[13,"u",[6,"quinticInterpolation2",["f"]]],[13,"du",[6,"quinticDerivative2",["f"]]],[13,"ga",[6,[7,"getJunctionGradientSlot","$"],["i"]]],[13,"gb",[6,[7,"getJunctionGradientSlot","$"],[[6,"add",["i",[6,[7,"d","vec2i"],[[5,"1"],[5,"0"]]]]]]]],[13,"gc",[6,[7,"getJunctionGradientSlot","$"],[[6,"add",["i",[6,[7,"d","vec2i"],[[5,"0"],[5,"1"]]]]]]]],[13,"gd",[6,[7,"getJunctionGradientSlot","$"],[[6,"add",["i",[6,[7,"d","vec2i"],[[5,"1"],[5,"1"]]]]]]]],[13,"va",[6,"dot",["ga",[6,"sub",["f",[6,[7,"d","vec2f"],[[5,"0"],[5,"0"]]]]]]]],[13,"vb",[6,"dot",["gb",[6,"sub",["f",[6,[7,"d","vec2f"],[[5,"1"],[5,"0"]]]]]]]],[13,"vc",[6,"dot",["gc",[6,"sub",["f",[6,[7,"d","vec2f"],[[5,"0"],[5,"1"]]]]]]]],[13,"vd",[6,"dot",["gd",[6,"sub",["f",[6,[7,"d","vec2f"],[[5,"1"],[5,"1"]]]]]]]],[13,"noise",[1,[1,[1,"va","+",[1,[7,"u","x"],"*",[1,"vb","-","va"]]],"+",[1,[7,"u","y"],"*",[1,"vc","-","va"]]],"+",[1,[1,[7,"u","x"],"*",[7,"u","y"]],"*",[1,[1,[1,"va","-","vb"],"-","vc"],"+","vd"]]]],[13,"grad",[6,"add",["ga",[6,"add",[[6,"add",[[6,"add",[[6,"mul",[[7,"u","x"],[6,"sub",["gb","ga"]]]],[6,"mul",[[7,"u","y"],[6,"sub",["gc","ga"]]]]]],[6,"mul",[[7,"u","x"],[6,"mul",[[7,"u","y"],[6,"add",[[6,"sub",[[6,"sub",["ga","gb"]],"gc"]],"gd"]]]]]]]],[6,"mul",["du",[6,"sub",[[6,"add",[[6,"mul",[[7,"u","yx"],[1,[1,[1,"va","-","vb"],"-","vc"],"+","vd"]]],[6,[7,"d","vec2f"],["vb","vc"]]]],"va"]]]]]]]]],[10,[6,[7,"d","vec3f"],["noise","grad"]]]]],externalNames:["d","floor","fract","quinticInterpolation2","quinticDerivative2","getJunctionGradientSlot","add","dot","sub","mul"]},get externals(){return{d:ve,floor:Or,fract:er,quinticInterpolation2:qi,quinticDerivative2:Ru,getJunctionGradientSlot:jn,add:ue,dot:ae,sub:K,mul:xe}}})&&e.f)({})),"sampleWithGradient");Yn(F);Yn(F);const Fx=(globalThis.__TYPEGPU_AUTONAME__??(e=>e))(H.fn([Ot],O)((e=>(globalThis.__TYPEGPU_META__??=new WeakMap).set(e.f=(t=>(to(xe(.001,O(t))),qs())),{v:1,name:void 0,ast:{params:[{type:"i",name:"pos"}],body:[0,[[6,"randSeed3",[[6,"mul",[[5,"0.001"],[6,[7,"d","vec3f"],["pos"]]]]]],[10,[6,"randOnUnitSphere",[]]]]],externalNames:["randSeed3","mul","d","randOnUnitSphere"]},get externals(){return{randSeed3:to,mul:xe,d:ve,randOnUnitSphere:qs}}})&&e.f)({})),"computeJunctionGradient"),Nu=(globalThis.__TYPEGPU_AUTONAME__??(e=>e))(H.slot(Fx),"getJunctionGradientSlot"),Wn=(globalThis.__TYPEGPU_AUTONAME__??(e=>e))(H.fn([O,O],$)((e=>(globalThis.__TYPEGPU_META__??=new WeakMap).set(e.f=((t,n)=>{const r=K(t,n),s=Nu.value(Ot(n));return ae(r,s)}),{v:1,name:void 0,ast:{params:[{type:"i",name:"pos"},{type:"i",name:"junction"}],body:[0,[[13,"relative",[6,"sub",["pos","junction"]]],[13,"gridVector",[6,[7,"getJunctionGradientSlot","value"],[[6,[7,"d","vec3i"],["junction"]]]]],[10,[6,"dot",["relative","gridVector"]]]]],externalNames:["sub","getJunctionGradientSlot","d","dot"]},get externals(){return{sub:K,getJunctionGradientSlot:Nu,d:ve,dot:ae}}})&&e.f)({})),"dotProdGrid");(globalThis.__TYPEGPU_AUTONAME__??(e=>e))(H.fn([O],$)((e=>(globalThis.__TYPEGPU_META__??=new WeakMap).set(e.f=(t=>{const n=Or(t),r=Wn(t,n),s=Wn(t,ue(n,O(0,0,1))),i=Wn(t,ue(n,O(0,1,0))),p=Wn(t,ue(n,O(0,1,1))),y=Wn(t,ue(n,O(1,0,0))),v=Wn(t,ue(n,O(1,0,1))),_=Wn(t,ue(n,O(1,1,0))),P=Wn(t,ue(n,O(1,1,1))),U=K(t,n),R=Du(U),j=rn(r,s,R.z),L=rn(i,p,R.z),Z=rn(y,v,R.z),Q=rn(_,P,R.z),re=rn(j,L,R.y),Me=rn(Z,Q,R.y);return rn(re,Me,R.x)}),{v:1,name:void 0,ast:{params:[{type:"i",name:"pos"}],body:[0,[[13,"minJunction",[6,"floor",["pos"]]],[13,"xyz",[6,"dotProdGrid",["pos","minJunction"]]],[13,"xyZ",[6,"dotProdGrid",["pos",[6,"add",["minJunction",[6,[7,"d","vec3f"],[[5,"0"],[5,"0"],[5,"1"]]]]]]]],[13,"xYz",[6,"dotProdGrid",["pos",[6,"add",["minJunction",[6,[7,"d","vec3f"],[[5,"0"],[5,"1"],[5,"0"]]]]]]]],[13,"xYZ",[6,"dotProdGrid",["pos",[6,"add",["minJunction",[6,[7,"d","vec3f"],[[5,"0"],[5,"1"],[5,"1"]]]]]]]],[13,"Xyz",[6,"dotProdGrid",["pos",[6,"add",["minJunction",[6,[7,"d","vec3f"],[[5,"1"],[5,"0"],[5,"0"]]]]]]]],[13,"XyZ",[6,"dotProdGrid",["pos",[6,"add",["minJunction",[6,[7,"d","vec3f"],[[5,"1"],[5,"0"],[5,"1"]]]]]]]],[13,"XYz",[6,"dotProdGrid",["pos",[6,"add",["minJunction",[6,[7,"d","vec3f"],[[5,"1"],[5,"1"],[5,"0"]]]]]]]],[13,"XYZ",[6,"dotProdGrid",["pos",[6,"add",["minJunction",[6,[7,"d","vec3f"],[[5,"1"],[5,"1"],[5,"1"]]]]]]]],[13,"partial",[6,"sub",["pos","minJunction"]]],[13,"smoothPartial",[6,"quinticInterpolation3",["partial"]]],[13,"xy",[6,"mix",["xyz","xyZ",[7,"smoothPartial","z"]]]],[13,"xY",[6,"mix",["xYz","xYZ",[7,"smoothPartial","z"]]]],[13,"Xy",[6,"mix",["Xyz","XyZ",[7,"smoothPartial","z"]]]],[13,"XY",[6,"mix",["XYz","XYZ",[7,"smoothPartial","z"]]]],[13,"x",[6,"mix",["xy","xY",[7,"smoothPartial","y"]]]],[13,"X",[6,"mix",["Xy","XY",[7,"smoothPartial","y"]]]],[10,[6,"mix",["x","X",[7,"smoothPartial","x"]]]]]],externalNames:["floor","dotProdGrid","add","d","sub","quinticInterpolation3","mix"]},get externals(){return{floor:Or,dotProdGrid:Wn,add:ue,d:ve,sub:K,quinticInterpolation3:Du,mix:rn}}})&&e.f)({})),"sample");Yn(O);Yn(O);const Fu={seed:Px,seed2:eo,seed3:to,seed4:Ux,sample:Ax,sampleExclusive:pr,normal:Es,exponential:Gx,cauchy:Dx,bernoulli:Rx,inUnitCircle:kx,onUnitCircle:no,inUnitCube:Ix,onUnitCube:Bx,inHemisphere:Ox,onHemisphere:Vx,inUnitSphere:ro,onUnitSphere:qs},Lx=O(0,2.5,.5),Ti=12,xa=10,lr=.001,Lu=O(1),ju=O(.2),Yu=O(.6),Cu=.6,qu=10,Wu=.6,va=1.42,Xu=1,ba=3,_i=.1,Ta=.5,Ju=lr*5,ls=O(.4,.4,.4),jx={mass:1,stiffness:1e3,damping:10},Yx={mass:1,stiffness:900,damping:12},Cx={mass:1,stiffness:1e3,damping:20},qx=(globalThis.__TYPEGPU_AUTONAME__??(e=>e))(qn({direction:O,color:O}),"DirectionalLight"),Ds={SLIDER:1,BACKGROUND:2},Zu=(globalThis.__TYPEGPU_AUTONAME__??(e=>e))(qn({distance:$,objectType:Ue}),"HitInfo"),Hu=(globalThis.__TYPEGPU_AUTONAME__??(e=>e))(qn({hit:ke,tMin:$,tMax:$}),"BoxIntersection"),Qu=(globalThis.__TYPEGPU_AUTONAME__??(e=>e))(qn({origin:O,direction:O}),"Ray"),Ku=(globalThis.__TYPEGPU_AUTONAME__??(e=>e))(qn({min:O,max:O}),"BoundingBox"),Wx=(globalThis.__TYPEGPU_AUTONAME__??(e=>e))(qn({posX:$,posY:$,posZ:$,baseCenterX:$,baseCenterY:$,baseCenterZ:$,squashX:$,squashZ:$,wiggleX:$}),"SwitchState"),op=(globalThis.__TYPEGPU_AUTONAME__??(e=>e))(H.bindGroupLayout({backgroundTexture:{texture:hs($)}}),"rayMarchLayout"),Er=(globalThis.__TYPEGPU_AUTONAME__??(e=>e))(H.bindGroupLayout({currentTexture:{texture:hs()},historyTexture:{texture:hs()},outputTexture:{storageTexture:ni("rgba8unorm","write-only")}}),"taaResolveLayout"),so=(globalThis.__TYPEGPU_AUTONAME__??(e=>e))(H.bindGroupLayout({currentTexture:{texture:hs()}}),"sampleLayout");class _a{value;target;properties;velocity;constructor(t){this.target=0,this.value=this.target,this.properties={...t},this.velocity=0}update(t){const n=-this.properties.stiffness*(this.value-this.target),r=-this.properties.damping*this.velocity,s=(n+r)/this.properties.mass;this.velocity=this.velocity+s*t,this.value=this.value+this.velocity*t}}class Xx{#e;stateUniform;pressed=!1;dragging=!1;basePosition={x:.05,y:.2,z:0};dragStart={x:0,y:0};dragOffset={x:0,y:0};#t;#n;#r;#s;#i;constructor(t){this.#e=t,this.#t=0,this.#n=0,this.#r=new _a(jx),this.#s=new _a(Yx),this.#i=new _a(Cx),this.stateUniform=this.#e.createUniform(Wx)}async init(){window.addEventListener("devicemotion",t=>{t.accelerationIncludingGravity})}startDrag(t,n){this.dragging=!0,this.dragStart={x:t,y:n},this.dragOffset={x:0,y:0}}updateDrag(t,n){if(!this.dragging)return;const r=t-this.dragStart.x,s=n-this.dragStart.y;this.dragOffset={x:r*.005,y:-s*.005}}endDrag(){this.dragging&&(this.basePosition.x+=this.dragOffset.x,this.basePosition.y+=this.dragOffset.y,this.basePosition.x=Math.max(-1.5,Math.min(1.5,this.basePosition.x)),this.basePosition.y=Math.max(-1.5,Math.min(1.5,this.basePosition.y)),this.dragging=!1,this.dragOffset={x:0,y:0},this.dragStart={x:0,y:0})}getCurrentBaseCenter(){return O(this.basePosition.x+this.dragOffset.x,this.basePosition.y+this.dragOffset.y,this.basePosition.z)}update(t){if(t<=0)return;const n=this.pressed?0:1,r=100;this.#t<n?this.#n+=r*t:this.#t>n&&(this.#n-=r*t),this.pressed&&this.#t<.1&&(this.#r.velocity=5,this.#s.velocity=5,this.#i.velocity=Math.random()*2-1),this.#t=this.#t+this.#n*t,Math.abs(this.#n)>.1&&(this.#i.velocity=this.#n*-.1),this.#t>1&&(this.#t=1,this.#n=0,this.#r.velocity=5,this.#s.velocity=5,this.#i.velocity=5),this.#t<0&&(this.#t=0,this.#n=0,this.#r.velocity=5,this.#s.velocity=5,this.#i.velocity=8),this.#t=jt(this.#t),this.#n*=.95,this.#r.update(t),this.#s.update(t),this.#i.update(t),this.#a()}#a(){const t=this.basePosition.x+this.dragOffset.x,n=this.basePosition.y+this.dragOffset.y;this.stateUniform.write({posX:1-this.#t/-3,posY:1-this.#t,posZ:1-this.#t/-3,baseCenterX:t,baseCenterY:n,baseCenterZ:this.basePosition.z,squashX:0,squashZ:0,wiggleX:0})}}function Jx(e,t){return class extends e{constructor(...n){super(...n),t(this)}}}const Zx=Jx(Array,e=>e.fill(0));let de=1e-6;function Hx(e){function t(T=0,M=0){const z=new e(2);return T!==void 0&&(z[0]=T,M!==void 0&&(z[1]=M)),z}const n=t;function r(T,M,z){const a=z??new e(2);return a[0]=T,a[1]=M,a}function s(T,M){const z=M??new e(2);return z[0]=Math.ceil(T[0]),z[1]=Math.ceil(T[1]),z}function i(T,M){const z=M??new e(2);return z[0]=Math.floor(T[0]),z[1]=Math.floor(T[1]),z}function p(T,M){const z=M??new e(2);return z[0]=Math.round(T[0]),z[1]=Math.round(T[1]),z}function y(T,M=0,z=1,a){const m=a??new e(2);return m[0]=Math.min(z,Math.max(M,T[0])),m[1]=Math.min(z,Math.max(M,T[1])),m}function v(T,M,z){const a=z??new e(2);return a[0]=T[0]+M[0],a[1]=T[1]+M[1],a}function _(T,M,z,a){const m=a??new e(2);return m[0]=T[0]+M[0]*z,m[1]=T[1]+M[1]*z,m}function P(T,M){const z=T[0],a=T[1],m=M[0],l=M[1],h=Math.sqrt(z*z+a*a),u=Math.sqrt(m*m+l*l),d=h*u,b=d&&ht(T,M)/d;return Math.acos(b)}function U(T,M,z){const a=z??new e(2);return a[0]=T[0]-M[0],a[1]=T[1]-M[1],a}const R=U;function j(T,M){return Math.abs(T[0]-M[0])<de&&Math.abs(T[1]-M[1])<de}function L(T,M){return T[0]===M[0]&&T[1]===M[1]}function Z(T,M,z,a){const m=a??new e(2);return m[0]=T[0]+z*(M[0]-T[0]),m[1]=T[1]+z*(M[1]-T[1]),m}function Q(T,M,z,a){const m=a??new e(2);return m[0]=T[0]+z[0]*(M[0]-T[0]),m[1]=T[1]+z[1]*(M[1]-T[1]),m}function re(T,M,z){const a=z??new e(2);return a[0]=Math.max(T[0],M[0]),a[1]=Math.max(T[1],M[1]),a}function Me(T,M,z){const a=z??new e(2);return a[0]=Math.min(T[0],M[0]),a[1]=Math.min(T[1],M[1]),a}function oe(T,M,z){const a=z??new e(2);return a[0]=T[0]*M,a[1]=T[1]*M,a}const be=oe;function ze(T,M,z){const a=z??new e(2);return a[0]=T[0]/M,a[1]=T[1]/M,a}function Se(T,M){const z=M??new e(2);return z[0]=1/T[0],z[1]=1/T[1],z}const Pe=Se;function yt(T,M,z){const a=z??new e(3),m=T[0]*M[1]-T[1]*M[0];return a[0]=0,a[1]=0,a[2]=m,a}function ht(T,M){return T[0]*M[0]+T[1]*M[1]}function it(T){const M=T[0],z=T[1];return Math.sqrt(M*M+z*z)}const Ct=it;function _t(T){const M=T[0],z=T[1];return M*M+z*z}const Ht=_t;function gt(T,M){const z=T[0]-M[0],a=T[1]-M[1];return Math.sqrt(z*z+a*a)}const Ee=gt;function Te(T,M){const z=T[0]-M[0],a=T[1]-M[1];return z*z+a*a}const ge=Te;function $t(T,M){const z=M??new e(2),a=T[0],m=T[1],l=Math.sqrt(a*a+m*m);return l>1e-5?(z[0]=a/l,z[1]=m/l):(z[0]=0,z[1]=0),z}function Qt(T,M){const z=M??new e(2);return z[0]=-T[0],z[1]=-T[1],z}function Le(T,M){const z=M??new e(2);return z[0]=T[0],z[1]=T[1],z}const bn=Le;function qt(T,M,z){const a=z??new e(2);return a[0]=T[0]*M[0],a[1]=T[1]*M[1],a}const Tn=qt;function Wt(T,M,z){const a=z??new e(2);return a[0]=T[0]/M[0],a[1]=T[1]/M[1],a}const ln=Wt;function cn(T=1,M){const z=M??new e(2),a=Math.random()*2*Math.PI;return z[0]=Math.cos(a)*T,z[1]=Math.sin(a)*T,z}function A(T){const M=T??new e(2);return M[0]=0,M[1]=0,M}function N(T,M,z){const a=z??new e(2),m=T[0],l=T[1];return a[0]=m*M[0]+l*M[4]+M[12],a[1]=m*M[1]+l*M[5]+M[13],a}function x(T,M,z){const a=z??new e(2),m=T[0],l=T[1];return a[0]=M[0]*m+M[4]*l+M[8],a[1]=M[1]*m+M[5]*l+M[9],a}function o(T,M,z,a){const m=a??new e(2),l=T[0]-M[0],h=T[1]-M[1],u=Math.sin(z),d=Math.cos(z);return m[0]=l*d-h*u+M[0],m[1]=l*u+h*d+M[1],m}function f(T,M,z){const a=z??new e(2);return $t(T,a),oe(a,M,a)}function c(T,M,z){const a=z??new e(2);return it(T)>M?f(T,M,a):Le(T,a)}function g(T,M,z){const a=z??new e(2);return Z(T,M,.5,a)}return{create:t,fromValues:n,set:r,ceil:s,floor:i,round:p,clamp:y,add:v,addScaled:_,angle:P,subtract:U,sub:R,equalsApproximately:j,equals:L,lerp:Z,lerpV:Q,max:re,min:Me,mulScalar:oe,scale:be,divScalar:ze,inverse:Se,invert:Pe,cross:yt,dot:ht,length:it,len:Ct,lengthSq:_t,lenSq:Ht,distance:gt,dist:Ee,distanceSq:Te,distSq:ge,normalize:$t,negate:Qt,copy:Le,clone:bn,multiply:qt,mul:Tn,divide:Wt,div:ln,random:cn,zero:A,transformMat4:N,transformMat3:x,rotate:o,setLength:f,truncate:c,midpoint:g}}const el=new Map;function up(e){let t=el.get(e);return t||(t=Hx(e),el.set(e,t)),t}function Qx(e){function t(u,d,b){const w=new e(3);return u!==void 0&&(w[0]=u,d!==void 0&&(w[1]=d,b!==void 0&&(w[2]=b))),w}const n=t;function r(u,d,b,w){const I=w??new e(3);return I[0]=u,I[1]=d,I[2]=b,I}function s(u,d){const b=d??new e(3);return b[0]=Math.ceil(u[0]),b[1]=Math.ceil(u[1]),b[2]=Math.ceil(u[2]),b}function i(u,d){const b=d??new e(3);return b[0]=Math.floor(u[0]),b[1]=Math.floor(u[1]),b[2]=Math.floor(u[2]),b}function p(u,d){const b=d??new e(3);return b[0]=Math.round(u[0]),b[1]=Math.round(u[1]),b[2]=Math.round(u[2]),b}function y(u,d=0,b=1,w){const I=w??new e(3);return I[0]=Math.min(b,Math.max(d,u[0])),I[1]=Math.min(b,Math.max(d,u[1])),I[2]=Math.min(b,Math.max(d,u[2])),I}function v(u,d,b){const w=b??new e(3);return w[0]=u[0]+d[0],w[1]=u[1]+d[1],w[2]=u[2]+d[2],w}function _(u,d,b,w){const I=w??new e(3);return I[0]=u[0]+d[0]*b,I[1]=u[1]+d[1]*b,I[2]=u[2]+d[2]*b,I}function P(u,d){const b=u[0],w=u[1],I=u[2],V=d[0],D=d[1],X=d[2],Y=Math.sqrt(b*b+w*w+I*I),C=Math.sqrt(V*V+D*D+X*X),te=Y*C,le=te&&ht(u,d)/te;return Math.acos(le)}function U(u,d,b){const w=b??new e(3);return w[0]=u[0]-d[0],w[1]=u[1]-d[1],w[2]=u[2]-d[2],w}const R=U;function j(u,d){return Math.abs(u[0]-d[0])<de&&Math.abs(u[1]-d[1])<de&&Math.abs(u[2]-d[2])<de}function L(u,d){return u[0]===d[0]&&u[1]===d[1]&&u[2]===d[2]}function Z(u,d,b,w){const I=w??new e(3);return I[0]=u[0]+b*(d[0]-u[0]),I[1]=u[1]+b*(d[1]-u[1]),I[2]=u[2]+b*(d[2]-u[2]),I}function Q(u,d,b,w){const I=w??new e(3);return I[0]=u[0]+b[0]*(d[0]-u[0]),I[1]=u[1]+b[1]*(d[1]-u[1]),I[2]=u[2]+b[2]*(d[2]-u[2]),I}function re(u,d,b){const w=b??new e(3);return w[0]=Math.max(u[0],d[0]),w[1]=Math.max(u[1],d[1]),w[2]=Math.max(u[2],d[2]),w}function Me(u,d,b){const w=b??new e(3);return w[0]=Math.min(u[0],d[0]),w[1]=Math.min(u[1],d[1]),w[2]=Math.min(u[2],d[2]),w}function oe(u,d,b){const w=b??new e(3);return w[0]=u[0]*d,w[1]=u[1]*d,w[2]=u[2]*d,w}const be=oe;function ze(u,d,b){const w=b??new e(3);return w[0]=u[0]/d,w[1]=u[1]/d,w[2]=u[2]/d,w}function Se(u,d){const b=d??new e(3);return b[0]=1/u[0],b[1]=1/u[1],b[2]=1/u[2],b}const Pe=Se;function yt(u,d,b){const w=b??new e(3),I=u[2]*d[0]-u[0]*d[2],V=u[0]*d[1]-u[1]*d[0];return w[0]=u[1]*d[2]-u[2]*d[1],w[1]=I,w[2]=V,w}function ht(u,d){return u[0]*d[0]+u[1]*d[1]+u[2]*d[2]}function it(u){const d=u[0],b=u[1],w=u[2];return Math.sqrt(d*d+b*b+w*w)}const Ct=it;function _t(u){const d=u[0],b=u[1],w=u[2];return d*d+b*b+w*w}const Ht=_t;function gt(u,d){const b=u[0]-d[0],w=u[1]-d[1],I=u[2]-d[2];return Math.sqrt(b*b+w*w+I*I)}const Ee=gt;function Te(u,d){const b=u[0]-d[0],w=u[1]-d[1],I=u[2]-d[2];return b*b+w*w+I*I}const ge=Te;function $t(u,d){const b=d??new e(3),w=u[0],I=u[1],V=u[2],D=Math.sqrt(w*w+I*I+V*V);return D>1e-5?(b[0]=w/D,b[1]=I/D,b[2]=V/D):(b[0]=0,b[1]=0,b[2]=0),b}function Qt(u,d){const b=d??new e(3);return b[0]=-u[0],b[1]=-u[1],b[2]=-u[2],b}function Le(u,d){const b=d??new e(3);return b[0]=u[0],b[1]=u[1],b[2]=u[2],b}const bn=Le;function qt(u,d,b){const w=b??new e(3);return w[0]=u[0]*d[0],w[1]=u[1]*d[1],w[2]=u[2]*d[2],w}const Tn=qt;function Wt(u,d,b){const w=b??new e(3);return w[0]=u[0]/d[0],w[1]=u[1]/d[1],w[2]=u[2]/d[2],w}const ln=Wt;function cn(u=1,d){const b=d??new e(3),w=Math.random()*2*Math.PI,I=Math.random()*2-1,V=Math.sqrt(1-I*I)*u;return b[0]=Math.cos(w)*V,b[1]=Math.sin(w)*V,b[2]=I*u,b}function A(u){const d=u??new e(3);return d[0]=0,d[1]=0,d[2]=0,d}function N(u,d,b){const w=b??new e(3),I=u[0],V=u[1],D=u[2],X=d[3]*I+d[7]*V+d[11]*D+d[15]||1;return w[0]=(d[0]*I+d[4]*V+d[8]*D+d[12])/X,w[1]=(d[1]*I+d[5]*V+d[9]*D+d[13])/X,w[2]=(d[2]*I+d[6]*V+d[10]*D+d[14])/X,w}function x(u,d,b){const w=b??new e(3),I=u[0],V=u[1],D=u[2];return w[0]=I*d[0]+V*d[4]+D*d[8],w[1]=I*d[1]+V*d[5]+D*d[9],w[2]=I*d[2]+V*d[6]+D*d[10],w}function o(u,d,b){const w=b??new e(3),I=u[0],V=u[1],D=u[2];return w[0]=I*d[0]+V*d[4]+D*d[8],w[1]=I*d[1]+V*d[5]+D*d[9],w[2]=I*d[2]+V*d[6]+D*d[10],w}function f(u,d,b){const w=b??new e(3),I=d[0],V=d[1],D=d[2],X=d[3]*2,Y=u[0],C=u[1],te=u[2],le=V*te-D*C,ne=D*Y-I*te,se=I*C-V*Y;return w[0]=Y+le*X+(V*se-D*ne)*2,w[1]=C+ne*X+(D*le-I*se)*2,w[2]=te+se*X+(I*ne-V*le)*2,w}function c(u,d){const b=d??new e(3);return b[0]=u[12],b[1]=u[13],b[2]=u[14],b}function g(u,d,b){const w=b??new e(3),I=d*4;return w[0]=u[I+0],w[1]=u[I+1],w[2]=u[I+2],w}function T(u,d){const b=d??new e(3),w=u[0],I=u[1],V=u[2],D=u[4],X=u[5],Y=u[6],C=u[8],te=u[9],le=u[10];return b[0]=Math.sqrt(w*w+I*I+V*V),b[1]=Math.sqrt(D*D+X*X+Y*Y),b[2]=Math.sqrt(C*C+te*te+le*le),b}function M(u,d,b,w){const I=w??new e(3),V=[],D=[];return V[0]=u[0]-d[0],V[1]=u[1]-d[1],V[2]=u[2]-d[2],D[0]=V[0],D[1]=V[1]*Math.cos(b)-V[2]*Math.sin(b),D[2]=V[1]*Math.sin(b)+V[2]*Math.cos(b),I[0]=D[0]+d[0],I[1]=D[1]+d[1],I[2]=D[2]+d[2],I}function z(u,d,b,w){const I=w??new e(3),V=[],D=[];return V[0]=u[0]-d[0],V[1]=u[1]-d[1],V[2]=u[2]-d[2],D[0]=V[2]*Math.sin(b)+V[0]*Math.cos(b),D[1]=V[1],D[2]=V[2]*Math.cos(b)-V[0]*Math.sin(b),I[0]=D[0]+d[0],I[1]=D[1]+d[1],I[2]=D[2]+d[2],I}function a(u,d,b,w){const I=w??new e(3),V=[],D=[];return V[0]=u[0]-d[0],V[1]=u[1]-d[1],V[2]=u[2]-d[2],D[0]=V[0]*Math.cos(b)-V[1]*Math.sin(b),D[1]=V[0]*Math.sin(b)+V[1]*Math.cos(b),D[2]=V[2],I[0]=D[0]+d[0],I[1]=D[1]+d[1],I[2]=D[2]+d[2],I}function m(u,d,b){const w=b??new e(3);return $t(u,w),oe(w,d,w)}function l(u,d,b){const w=b??new e(3);return it(u)>d?m(u,d,w):Le(u,w)}function h(u,d,b){const w=b??new e(3);return Z(u,d,.5,w)}return{create:t,fromValues:n,set:r,ceil:s,floor:i,round:p,clamp:y,add:v,addScaled:_,angle:P,subtract:U,sub:R,equalsApproximately:j,equals:L,lerp:Z,lerpV:Q,max:re,min:Me,mulScalar:oe,scale:be,divScalar:ze,inverse:Se,invert:Pe,cross:yt,dot:ht,length:it,len:Ct,lengthSq:_t,lenSq:Ht,distance:gt,dist:Ee,distanceSq:Te,distSq:ge,normalize:$t,negate:Qt,copy:Le,clone:bn,multiply:qt,mul:Tn,divide:Wt,div:ln,random:cn,zero:A,transformMat4:N,transformMat4Upper3x3:x,transformMat3:o,transformQuat:f,getTranslation:c,getAxis:g,getScaling:T,rotateX:M,rotateY:z,rotateZ:a,setLength:m,truncate:l,midpoint:h}}const tl=new Map;function pa(e){let t=tl.get(e);return t||(t=Qx(e),tl.set(e,t)),t}function Kx(e){const t=up(e),n=pa(e);function r(o,f,c,g,T,M,z,a,m){const l=new e(12);return l[3]=0,l[7]=0,l[11]=0,o!==void 0&&(l[0]=o,f!==void 0&&(l[1]=f,c!==void 0&&(l[2]=c,g!==void 0&&(l[4]=g,T!==void 0&&(l[5]=T,M!==void 0&&(l[6]=M,z!==void 0&&(l[8]=z,a!==void 0&&(l[9]=a,m!==void 0&&(l[10]=m))))))))),l}function s(o,f,c,g,T,M,z,a,m,l){const h=l??new e(12);return h[0]=o,h[1]=f,h[2]=c,h[3]=0,h[4]=g,h[5]=T,h[6]=M,h[7]=0,h[8]=z,h[9]=a,h[10]=m,h[11]=0,h}function i(o,f){const c=f??new e(12);return c[0]=o[0],c[1]=o[1],c[2]=o[2],c[3]=0,c[4]=o[4],c[5]=o[5],c[6]=o[6],c[7]=0,c[8]=o[8],c[9]=o[9],c[10]=o[10],c[11]=0,c}function p(o,f){const c=f??new e(12),g=o[0],T=o[1],M=o[2],z=o[3],a=g+g,m=T+T,l=M+M,h=g*a,u=T*a,d=T*m,b=M*a,w=M*m,I=M*l,V=z*a,D=z*m,X=z*l;return c[0]=1-d-I,c[1]=u+X,c[2]=b-D,c[3]=0,c[4]=u-X,c[5]=1-h-I,c[6]=w+V,c[7]=0,c[8]=b+D,c[9]=w-V,c[10]=1-h-d,c[11]=0,c}function y(o,f){const c=f??new e(12);return c[0]=-o[0],c[1]=-o[1],c[2]=-o[2],c[4]=-o[4],c[5]=-o[5],c[6]=-o[6],c[8]=-o[8],c[9]=-o[9],c[10]=-o[10],c}function v(o,f,c){const g=c??new e(12);return g[0]=o[0]*f,g[1]=o[1]*f,g[2]=o[2]*f,g[4]=o[4]*f,g[5]=o[5]*f,g[6]=o[6]*f,g[8]=o[8]*f,g[9]=o[9]*f,g[10]=o[10]*f,g}const _=v;function P(o,f,c){const g=c??new e(12);return g[0]=o[0]+f[0],g[1]=o[1]+f[1],g[2]=o[2]+f[2],g[4]=o[4]+f[4],g[5]=o[5]+f[5],g[6]=o[6]+f[6],g[8]=o[8]+f[8],g[9]=o[9]+f[9],g[10]=o[10]+f[10],g}function U(o,f){const c=f??new e(12);return c[0]=o[0],c[1]=o[1],c[2]=o[2],c[4]=o[4],c[5]=o[5],c[6]=o[6],c[8]=o[8],c[9]=o[9],c[10]=o[10],c}const R=U;function j(o,f){return Math.abs(o[0]-f[0])<de&&Math.abs(o[1]-f[1])<de&&Math.abs(o[2]-f[2])<de&&Math.abs(o[4]-f[4])<de&&Math.abs(o[5]-f[5])<de&&Math.abs(o[6]-f[6])<de&&Math.abs(o[8]-f[8])<de&&Math.abs(o[9]-f[9])<de&&Math.abs(o[10]-f[10])<de}function L(o,f){return o[0]===f[0]&&o[1]===f[1]&&o[2]===f[2]&&o[4]===f[4]&&o[5]===f[5]&&o[6]===f[6]&&o[8]===f[8]&&o[9]===f[9]&&o[10]===f[10]}function Z(o){const f=o??new e(12);return f[0]=1,f[1]=0,f[2]=0,f[4]=0,f[5]=1,f[6]=0,f[8]=0,f[9]=0,f[10]=1,f}function Q(o,f){const c=f??new e(12);if(c===o){let d;return d=o[1],o[1]=o[4],o[4]=d,d=o[2],o[2]=o[8],o[8]=d,d=o[6],o[6]=o[9],o[9]=d,c}const g=o[0],T=o[1],M=o[2],z=o[4],a=o[5],m=o[6],l=o[8],h=o[9],u=o[10];return c[0]=g,c[1]=z,c[2]=l,c[4]=T,c[5]=a,c[6]=h,c[8]=M,c[9]=m,c[10]=u,c}function re(o,f){const c=f??new e(12),g=o[0],T=o[1],M=o[2],z=o[4],a=o[5],m=o[6],l=o[8],h=o[9],u=o[10],d=u*a-m*h,b=-u*z+m*l,w=h*z-a*l,I=1/(g*d+T*b+M*w);return c[0]=d*I,c[1]=(-u*T+M*h)*I,c[2]=(m*T-M*a)*I,c[4]=b*I,c[5]=(u*g-M*l)*I,c[6]=(-m*g+M*z)*I,c[8]=w*I,c[9]=(-h*g+T*l)*I,c[10]=(a*g-T*z)*I,c}function Me(o){const f=o[0],c=o[1],g=o[2],T=o[4],M=o[5],z=o[6],a=o[8],m=o[9],l=o[10];return f*(M*l-m*z)-T*(c*l-m*g)+a*(c*z-M*g)}const oe=re;function be(o,f,c){const g=c??new e(12),T=o[0],M=o[1],z=o[2],a=o[4],m=o[5],l=o[6],h=o[8],u=o[9],d=o[10],b=f[0],w=f[1],I=f[2],V=f[4],D=f[5],X=f[6],Y=f[8],C=f[9],te=f[10];return g[0]=T*b+a*w+h*I,g[1]=M*b+m*w+u*I,g[2]=z*b+l*w+d*I,g[4]=T*V+a*D+h*X,g[5]=M*V+m*D+u*X,g[6]=z*V+l*D+d*X,g[8]=T*Y+a*C+h*te,g[9]=M*Y+m*C+u*te,g[10]=z*Y+l*C+d*te,g}const ze=be;function Se(o,f,c){const g=c??Z();return o!==g&&(g[0]=o[0],g[1]=o[1],g[2]=o[2],g[4]=o[4],g[5]=o[5],g[6]=o[6]),g[8]=f[0],g[9]=f[1],g[10]=1,g}function Pe(o,f){const c=f??t.create();return c[0]=o[8],c[1]=o[9],c}function yt(o,f,c){const g=c??t.create(),T=f*4;return g[0]=o[T+0],g[1]=o[T+1],g}function ht(o,f,c,g){const T=g===o?o:U(o,g),M=c*4;return T[M+0]=f[0],T[M+1]=f[1],T}function it(o,f){const c=f??t.create(),g=o[0],T=o[1],M=o[4],z=o[5];return c[0]=Math.sqrt(g*g+T*T),c[1]=Math.sqrt(M*M+z*z),c}function Ct(o,f){const c=f??n.create(),g=o[0],T=o[1],M=o[2],z=o[4],a=o[5],m=o[6],l=o[8],h=o[9],u=o[10];return c[0]=Math.sqrt(g*g+T*T+M*M),c[1]=Math.sqrt(z*z+a*a+m*m),c[2]=Math.sqrt(l*l+h*h+u*u),c}function _t(o,f){const c=f??new e(12);return c[0]=1,c[1]=0,c[2]=0,c[4]=0,c[5]=1,c[6]=0,c[8]=o[0],c[9]=o[1],c[10]=1,c}function Ht(o,f,c){const g=c??new e(12),T=f[0],M=f[1],z=o[0],a=o[1],m=o[2],l=o[4],h=o[5],u=o[6],d=o[8],b=o[9],w=o[10];return o!==g&&(g[0]=z,g[1]=a,g[2]=m,g[4]=l,g[5]=h,g[6]=u),g[8]=z*T+l*M+d,g[9]=a*T+h*M+b,g[10]=m*T+u*M+w,g}function gt(o,f){const c=f??new e(12),g=Math.cos(o),T=Math.sin(o);return c[0]=g,c[1]=T,c[2]=0,c[4]=-T,c[5]=g,c[6]=0,c[8]=0,c[9]=0,c[10]=1,c}function Ee(o,f,c){const g=c??new e(12),T=o[0],M=o[1],z=o[2],a=o[4],m=o[5],l=o[6],h=Math.cos(f),u=Math.sin(f);return g[0]=h*T+u*a,g[1]=h*M+u*m,g[2]=h*z+u*l,g[4]=h*a-u*T,g[5]=h*m-u*M,g[6]=h*l-u*z,o!==g&&(g[8]=o[8],g[9]=o[9],g[10]=o[10]),g}function Te(o,f){const c=f??new e(12),g=Math.cos(o),T=Math.sin(o);return c[0]=1,c[1]=0,c[2]=0,c[4]=0,c[5]=g,c[6]=T,c[8]=0,c[9]=-T,c[10]=g,c}function ge(o,f,c){const g=c??new e(12),T=o[4],M=o[5],z=o[6],a=o[8],m=o[9],l=o[10],h=Math.cos(f),u=Math.sin(f);return g[4]=h*T+u*a,g[5]=h*M+u*m,g[6]=h*z+u*l,g[8]=h*a-u*T,g[9]=h*m-u*M,g[10]=h*l-u*z,o!==g&&(g[0]=o[0],g[1]=o[1],g[2]=o[2]),g}function $t(o,f){const c=f??new e(12),g=Math.cos(o),T=Math.sin(o);return c[0]=g,c[1]=0,c[2]=-T,c[4]=0,c[5]=1,c[6]=0,c[8]=T,c[9]=0,c[10]=g,c}function Qt(o,f,c){const g=c??new e(12),T=o[0],M=o[1],z=o[2],a=o[8],m=o[9],l=o[10],h=Math.cos(f),u=Math.sin(f);return g[0]=h*T-u*a,g[1]=h*M-u*m,g[2]=h*z-u*l,g[8]=h*a+u*T,g[9]=h*m+u*M,g[10]=h*l+u*z,o!==g&&(g[4]=o[4],g[5]=o[5],g[6]=o[6]),g}const Le=gt,bn=Ee;function qt(o,f){const c=f??new e(12);return c[0]=o[0],c[1]=0,c[2]=0,c[4]=0,c[5]=o[1],c[6]=0,c[8]=0,c[9]=0,c[10]=1,c}function Tn(o,f,c){const g=c??new e(12),T=f[0],M=f[1];return g[0]=T*o[0],g[1]=T*o[1],g[2]=T*o[2],g[4]=M*o[4],g[5]=M*o[5],g[6]=M*o[6],o!==g&&(g[8]=o[8],g[9]=o[9],g[10]=o[10]),g}function Wt(o,f){const c=f??new e(12);return c[0]=o[0],c[1]=0,c[2]=0,c[4]=0,c[5]=o[1],c[6]=0,c[8]=0,c[9]=0,c[10]=o[2],c}function ln(o,f,c){const g=c??new e(12),T=f[0],M=f[1],z=f[2];return g[0]=T*o[0],g[1]=T*o[1],g[2]=T*o[2],g[4]=M*o[4],g[5]=M*o[5],g[6]=M*o[6],g[8]=z*o[8],g[9]=z*o[9],g[10]=z*o[10],g}function cn(o,f){const c=f??new e(12);return c[0]=o,c[1]=0,c[2]=0,c[4]=0,c[5]=o,c[6]=0,c[8]=0,c[9]=0,c[10]=1,c}function A(o,f,c){const g=c??new e(12);return g[0]=f*o[0],g[1]=f*o[1],g[2]=f*o[2],g[4]=f*o[4],g[5]=f*o[5],g[6]=f*o[6],o!==g&&(g[8]=o[8],g[9]=o[9],g[10]=o[10]),g}function N(o,f){const c=f??new e(12);return c[0]=o,c[1]=0,c[2]=0,c[4]=0,c[5]=o,c[6]=0,c[8]=0,c[9]=0,c[10]=o,c}function x(o,f,c){const g=c??new e(12);return g[0]=f*o[0],g[1]=f*o[1],g[2]=f*o[2],g[4]=f*o[4],g[5]=f*o[5],g[6]=f*o[6],g[8]=f*o[8],g[9]=f*o[9],g[10]=f*o[10],g}return{add:P,clone:R,copy:U,create:r,determinant:Me,equals:L,equalsApproximately:j,fromMat4:i,fromQuat:p,get3DScaling:Ct,getAxis:yt,getScaling:it,getTranslation:Pe,identity:Z,inverse:re,invert:oe,mul:ze,mulScalar:_,multiply:be,multiplyScalar:v,negate:y,rotate:Ee,rotateX:ge,rotateY:Qt,rotateZ:bn,rotation:gt,rotationX:Te,rotationY:$t,rotationZ:Le,scale:Tn,scale3D:ln,scaling:qt,scaling3D:Wt,set:s,setAxis:ht,setTranslation:Se,translate:Ht,translation:_t,transpose:Q,uniformScale:A,uniformScale3D:x,uniformScaling:cn,uniformScaling3D:N}}const nl=new Map;function e2(e){let t=nl.get(e);return t||(t=Kx(e),nl.set(e,t)),t}function t2(e){const t=pa(e);function n(a,m,l,h,u,d,b,w,I,V,D,X,Y,C,te,le){const ne=new e(16);return a!==void 0&&(ne[0]=a,m!==void 0&&(ne[1]=m,l!==void 0&&(ne[2]=l,h!==void 0&&(ne[3]=h,u!==void 0&&(ne[4]=u,d!==void 0&&(ne[5]=d,b!==void 0&&(ne[6]=b,w!==void 0&&(ne[7]=w,I!==void 0&&(ne[8]=I,V!==void 0&&(ne[9]=V,D!==void 0&&(ne[10]=D,X!==void 0&&(ne[11]=X,Y!==void 0&&(ne[12]=Y,C!==void 0&&(ne[13]=C,te!==void 0&&(ne[14]=te,le!==void 0&&(ne[15]=le)))))))))))))))),ne}function r(a,m,l,h,u,d,b,w,I,V,D,X,Y,C,te,le,ne){const se=ne??new e(16);return se[0]=a,se[1]=m,se[2]=l,se[3]=h,se[4]=u,se[5]=d,se[6]=b,se[7]=w,se[8]=I,se[9]=V,se[10]=D,se[11]=X,se[12]=Y,se[13]=C,se[14]=te,se[15]=le,se}function s(a,m){const l=m??new e(16);return l[0]=a[0],l[1]=a[1],l[2]=a[2],l[3]=0,l[4]=a[4],l[5]=a[5],l[6]=a[6],l[7]=0,l[8]=a[8],l[9]=a[9],l[10]=a[10],l[11]=0,l[12]=0,l[13]=0,l[14]=0,l[15]=1,l}function i(a,m){const l=m??new e(16),h=a[0],u=a[1],d=a[2],b=a[3],w=h+h,I=u+u,V=d+d,D=h*w,X=u*w,Y=u*I,C=d*w,te=d*I,le=d*V,ne=b*w,se=b*I,De=b*V;return l[0]=1-Y-le,l[1]=X+De,l[2]=C-se,l[3]=0,l[4]=X-De,l[5]=1-D-le,l[6]=te+ne,l[7]=0,l[8]=C+se,l[9]=te-ne,l[10]=1-D-Y,l[11]=0,l[12]=0,l[13]=0,l[14]=0,l[15]=1,l}function p(a,m){const l=m??new e(16);return l[0]=-a[0],l[1]=-a[1],l[2]=-a[2],l[3]=-a[3],l[4]=-a[4],l[5]=-a[5],l[6]=-a[6],l[7]=-a[7],l[8]=-a[8],l[9]=-a[9],l[10]=-a[10],l[11]=-a[11],l[12]=-a[12],l[13]=-a[13],l[14]=-a[14],l[15]=-a[15],l}function y(a,m,l){const h=l??new e(16);return h[0]=a[0]+m[0],h[1]=a[1]+m[1],h[2]=a[2]+m[2],h[3]=a[3]+m[3],h[4]=a[4]+m[4],h[5]=a[5]+m[5],h[6]=a[6]+m[6],h[7]=a[7]+m[7],h[8]=a[8]+m[8],h[9]=a[9]+m[9],h[10]=a[10]+m[10],h[11]=a[11]+m[11],h[12]=a[12]+m[12],h[13]=a[13]+m[13],h[14]=a[14]+m[14],h[15]=a[15]+m[15],h}function v(a,m,l){const h=l??new e(16);return h[0]=a[0]*m,h[1]=a[1]*m,h[2]=a[2]*m,h[3]=a[3]*m,h[4]=a[4]*m,h[5]=a[5]*m,h[6]=a[6]*m,h[7]=a[7]*m,h[8]=a[8]*m,h[9]=a[9]*m,h[10]=a[10]*m,h[11]=a[11]*m,h[12]=a[12]*m,h[13]=a[13]*m,h[14]=a[14]*m,h[15]=a[15]*m,h}const _=v;function P(a,m){const l=m??new e(16);return l[0]=a[0],l[1]=a[1],l[2]=a[2],l[3]=a[3],l[4]=a[4],l[5]=a[5],l[6]=a[6],l[7]=a[7],l[8]=a[8],l[9]=a[9],l[10]=a[10],l[11]=a[11],l[12]=a[12],l[13]=a[13],l[14]=a[14],l[15]=a[15],l}const U=P;function R(a,m){return Math.abs(a[0]-m[0])<de&&Math.abs(a[1]-m[1])<de&&Math.abs(a[2]-m[2])<de&&Math.abs(a[3]-m[3])<de&&Math.abs(a[4]-m[4])<de&&Math.abs(a[5]-m[5])<de&&Math.abs(a[6]-m[6])<de&&Math.abs(a[7]-m[7])<de&&Math.abs(a[8]-m[8])<de&&Math.abs(a[9]-m[9])<de&&Math.abs(a[10]-m[10])<de&&Math.abs(a[11]-m[11])<de&&Math.abs(a[12]-m[12])<de&&Math.abs(a[13]-m[13])<de&&Math.abs(a[14]-m[14])<de&&Math.abs(a[15]-m[15])<de}function j(a,m){return a[0]===m[0]&&a[1]===m[1]&&a[2]===m[2]&&a[3]===m[3]&&a[4]===m[4]&&a[5]===m[5]&&a[6]===m[6]&&a[7]===m[7]&&a[8]===m[8]&&a[9]===m[9]&&a[10]===m[10]&&a[11]===m[11]&&a[12]===m[12]&&a[13]===m[13]&&a[14]===m[14]&&a[15]===m[15]}function L(a){const m=a??new e(16);return m[0]=1,m[1]=0,m[2]=0,m[3]=0,m[4]=0,m[5]=1,m[6]=0,m[7]=0,m[8]=0,m[9]=0,m[10]=1,m[11]=0,m[12]=0,m[13]=0,m[14]=0,m[15]=1,m}function Z(a,m){const l=m??new e(16);if(l===a){let Ae;return Ae=a[1],a[1]=a[4],a[4]=Ae,Ae=a[2],a[2]=a[8],a[8]=Ae,Ae=a[3],a[3]=a[12],a[12]=Ae,Ae=a[6],a[6]=a[9],a[9]=Ae,Ae=a[7],a[7]=a[13],a[13]=Ae,Ae=a[11],a[11]=a[14],a[14]=Ae,l}const h=a[0],u=a[1],d=a[2],b=a[3],w=a[4],I=a[5],V=a[6],D=a[7],X=a[8],Y=a[9],C=a[10],te=a[11],le=a[12],ne=a[13],se=a[14],De=a[15];return l[0]=h,l[1]=w,l[2]=X,l[3]=le,l[4]=u,l[5]=I,l[6]=Y,l[7]=ne,l[8]=d,l[9]=V,l[10]=C,l[11]=se,l[12]=b,l[13]=D,l[14]=te,l[15]=De,l}function Q(a,m){const l=m??new e(16),h=a[0],u=a[1],d=a[2],b=a[3],w=a[4],I=a[5],V=a[6],D=a[7],X=a[8],Y=a[9],C=a[10],te=a[11],le=a[12],ne=a[13],se=a[14],De=a[15],Ae=C*De,pt=se*te,dt=V*De,ft=se*D,Mt=V*te,St=C*D,Pt=d*De,Ut=se*b,At=d*te,It=C*b,Vt=d*D,Gt=V*b,Dt=X*ne,Rt=le*Y,Kt=w*ne,en=le*I,tn=w*Y,ai=X*I,oi=h*ne,ui=le*u,li=h*Y,ci=X*u,hi=h*I,pi=w*u,Ho=Ae*I+ft*Y+Mt*ne-(pt*I+dt*Y+St*ne),Qo=pt*u+Pt*Y+It*ne-(Ae*u+Ut*Y+At*ne),Ko=dt*u+Ut*I+Vt*ne-(ft*u+Pt*I+Gt*ne),eu=St*u+At*I+Gt*Y-(Mt*u+It*I+Vt*Y),Bt=1/(h*Ho+w*Qo+X*Ko+le*eu);return l[0]=Bt*Ho,l[1]=Bt*Qo,l[2]=Bt*Ko,l[3]=Bt*eu,l[4]=Bt*(pt*w+dt*X+St*le-(Ae*w+ft*X+Mt*le)),l[5]=Bt*(Ae*h+Ut*X+At*le-(pt*h+Pt*X+It*le)),l[6]=Bt*(ft*h+Pt*w+Gt*le-(dt*h+Ut*w+Vt*le)),l[7]=Bt*(Mt*h+It*w+Vt*X-(St*h+At*w+Gt*X)),l[8]=Bt*(Dt*D+en*te+tn*De-(Rt*D+Kt*te+ai*De)),l[9]=Bt*(Rt*b+oi*te+ci*De-(Dt*b+ui*te+li*De)),l[10]=Bt*(Kt*b+ui*D+hi*De-(en*b+oi*D+pi*De)),l[11]=Bt*(ai*b+li*D+pi*te-(tn*b+ci*D+hi*te)),l[12]=Bt*(Kt*C+ai*se+Rt*V-(tn*se+Dt*V+en*C)),l[13]=Bt*(li*se+Dt*d+ui*C-(oi*C+ci*se+Rt*d)),l[14]=Bt*(oi*V+pi*se+en*d-(hi*se+Kt*d+ui*V)),l[15]=Bt*(hi*C+tn*d+ci*V-(li*V+pi*C+ai*d)),l}function re(a){const m=a[0],l=a[1],h=a[2],u=a[3],d=a[4],b=a[5],w=a[6],I=a[7],V=a[8],D=a[9],X=a[10],Y=a[11],C=a[12],te=a[13],le=a[14],ne=a[15],se=X*ne,De=le*Y,Ae=w*ne,pt=le*I,dt=w*Y,ft=X*I,Mt=h*ne,St=le*u,Pt=h*Y,Ut=X*u,At=h*I,It=w*u,Vt=se*b+pt*D+dt*te-(De*b+Ae*D+ft*te),Gt=De*l+Mt*D+Ut*te-(se*l+St*D+Pt*te),Dt=Ae*l+St*b+At*te-(pt*l+Mt*b+It*te),Rt=ft*l+Pt*b+It*D-(dt*l+Ut*b+At*D);return m*Vt+d*Gt+V*Dt+C*Rt}const Me=Q;function oe(a,m,l){const h=l??new e(16),u=a[0],d=a[1],b=a[2],w=a[3],I=a[4],V=a[5],D=a[6],X=a[7],Y=a[8],C=a[9],te=a[10],le=a[11],ne=a[12],se=a[13],De=a[14],Ae=a[15],pt=m[0],dt=m[1],ft=m[2],Mt=m[3],St=m[4],Pt=m[5],Ut=m[6],At=m[7],It=m[8],Vt=m[9],Gt=m[10],Dt=m[11],Rt=m[12],Kt=m[13],en=m[14],tn=m[15];return h[0]=u*pt+I*dt+Y*ft+ne*Mt,h[1]=d*pt+V*dt+C*ft+se*Mt,h[2]=b*pt+D*dt+te*ft+De*Mt,h[3]=w*pt+X*dt+le*ft+Ae*Mt,h[4]=u*St+I*Pt+Y*Ut+ne*At,h[5]=d*St+V*Pt+C*Ut+se*At,h[6]=b*St+D*Pt+te*Ut+De*At,h[7]=w*St+X*Pt+le*Ut+Ae*At,h[8]=u*It+I*Vt+Y*Gt+ne*Dt,h[9]=d*It+V*Vt+C*Gt+se*Dt,h[10]=b*It+D*Vt+te*Gt+De*Dt,h[11]=w*It+X*Vt+le*Gt+Ae*Dt,h[12]=u*Rt+I*Kt+Y*en+ne*tn,h[13]=d*Rt+V*Kt+C*en+se*tn,h[14]=b*Rt+D*Kt+te*en+De*tn,h[15]=w*Rt+X*Kt+le*en+Ae*tn,h}const be=oe;function ze(a,m,l){const h=l??L();return a!==h&&(h[0]=a[0],h[1]=a[1],h[2]=a[2],h[3]=a[3],h[4]=a[4],h[5]=a[5],h[6]=a[6],h[7]=a[7],h[8]=a[8],h[9]=a[9],h[10]=a[10],h[11]=a[11]),h[12]=m[0],h[13]=m[1],h[14]=m[2],h[15]=1,h}function Se(a,m){const l=m??t.create();return l[0]=a[12],l[1]=a[13],l[2]=a[14],l}function Pe(a,m,l){const h=l??t.create(),u=m*4;return h[0]=a[u+0],h[1]=a[u+1],h[2]=a[u+2],h}function yt(a,m,l,h){const u=h===a?h:P(a,h),d=l*4;return u[d+0]=m[0],u[d+1]=m[1],u[d+2]=m[2],u}function ht(a,m){const l=m??t.create(),h=a[0],u=a[1],d=a[2],b=a[4],w=a[5],I=a[6],V=a[8],D=a[9],X=a[10];return l[0]=Math.sqrt(h*h+u*u+d*d),l[1]=Math.sqrt(b*b+w*w+I*I),l[2]=Math.sqrt(V*V+D*D+X*X),l}function it(a,m,l,h,u){const d=u??new e(16),b=Math.tan(Math.PI*.5-.5*a);if(d[0]=b/m,d[1]=0,d[2]=0,d[3]=0,d[4]=0,d[5]=b,d[6]=0,d[7]=0,d[8]=0,d[9]=0,d[11]=-1,d[12]=0,d[13]=0,d[15]=0,Number.isFinite(h)){const w=1/(l-h);d[10]=h*w,d[14]=h*l*w}else d[10]=-1,d[14]=-l;return d}function Ct(a,m,l,h=1/0,u){const d=u??new e(16),b=1/Math.tan(a*.5);if(d[0]=b/m,d[1]=0,d[2]=0,d[3]=0,d[4]=0,d[5]=b,d[6]=0,d[7]=0,d[8]=0,d[9]=0,d[11]=-1,d[12]=0,d[13]=0,d[15]=0,h===1/0)d[10]=0,d[14]=l;else{const w=1/(h-l);d[10]=l*w,d[14]=h*l*w}return d}function _t(a,m,l,h,u,d,b){const w=b??new e(16);return w[0]=2/(m-a),w[1]=0,w[2]=0,w[3]=0,w[4]=0,w[5]=2/(h-l),w[6]=0,w[7]=0,w[8]=0,w[9]=0,w[10]=1/(u-d),w[11]=0,w[12]=(m+a)/(a-m),w[13]=(h+l)/(l-h),w[14]=u/(u-d),w[15]=1,w}function Ht(a,m,l,h,u,d,b){const w=b??new e(16),I=m-a,V=h-l,D=u-d;return w[0]=2*u/I,w[1]=0,w[2]=0,w[3]=0,w[4]=0,w[5]=2*u/V,w[6]=0,w[7]=0,w[8]=(a+m)/I,w[9]=(h+l)/V,w[10]=d/D,w[11]=-1,w[12]=0,w[13]=0,w[14]=u*d/D,w[15]=0,w}function gt(a,m,l,h,u,d=1/0,b){const w=b??new e(16),I=m-a,V=h-l;if(w[0]=2*u/I,w[1]=0,w[2]=0,w[3]=0,w[4]=0,w[5]=2*u/V,w[6]=0,w[7]=0,w[8]=(a+m)/I,w[9]=(h+l)/V,w[11]=-1,w[12]=0,w[13]=0,w[15]=0,d===1/0)w[10]=0,w[14]=u;else{const D=1/(d-u);w[10]=u*D,w[14]=d*u*D}return w}const Ee=t.create(),Te=t.create(),ge=t.create();function $t(a,m,l,h){const u=h??new e(16);return t.normalize(t.subtract(m,a,ge),ge),t.normalize(t.cross(l,ge,Ee),Ee),t.normalize(t.cross(ge,Ee,Te),Te),u[0]=Ee[0],u[1]=Ee[1],u[2]=Ee[2],u[3]=0,u[4]=Te[0],u[5]=Te[1],u[6]=Te[2],u[7]=0,u[8]=ge[0],u[9]=ge[1],u[10]=ge[2],u[11]=0,u[12]=a[0],u[13]=a[1],u[14]=a[2],u[15]=1,u}function Qt(a,m,l,h){const u=h??new e(16);return t.normalize(t.subtract(a,m,ge),ge),t.normalize(t.cross(l,ge,Ee),Ee),t.normalize(t.cross(ge,Ee,Te),Te),u[0]=Ee[0],u[1]=Ee[1],u[2]=Ee[2],u[3]=0,u[4]=Te[0],u[5]=Te[1],u[6]=Te[2],u[7]=0,u[8]=ge[0],u[9]=ge[1],u[10]=ge[2],u[11]=0,u[12]=a[0],u[13]=a[1],u[14]=a[2],u[15]=1,u}function Le(a,m,l,h){const u=h??new e(16);return t.normalize(t.subtract(a,m,ge),ge),t.normalize(t.cross(l,ge,Ee),Ee),t.normalize(t.cross(ge,Ee,Te),Te),u[0]=Ee[0],u[1]=Te[0],u[2]=ge[0],u[3]=0,u[4]=Ee[1],u[5]=Te[1],u[6]=ge[1],u[7]=0,u[8]=Ee[2],u[9]=Te[2],u[10]=ge[2],u[11]=0,u[12]=-(Ee[0]*a[0]+Ee[1]*a[1]+Ee[2]*a[2]),u[13]=-(Te[0]*a[0]+Te[1]*a[1]+Te[2]*a[2]),u[14]=-(ge[0]*a[0]+ge[1]*a[1]+ge[2]*a[2]),u[15]=1,u}function bn(a,m){const l=m??new e(16);return l[0]=1,l[1]=0,l[2]=0,l[3]=0,l[4]=0,l[5]=1,l[6]=0,l[7]=0,l[8]=0,l[9]=0,l[10]=1,l[11]=0,l[12]=a[0],l[13]=a[1],l[14]=a[2],l[15]=1,l}function qt(a,m,l){const h=l??new e(16),u=m[0],d=m[1],b=m[2],w=a[0],I=a[1],V=a[2],D=a[3],X=a[4],Y=a[5],C=a[6],te=a[7],le=a[8],ne=a[9],se=a[10],De=a[11],Ae=a[12],pt=a[13],dt=a[14],ft=a[15];return a!==h&&(h[0]=w,h[1]=I,h[2]=V,h[3]=D,h[4]=X,h[5]=Y,h[6]=C,h[7]=te,h[8]=le,h[9]=ne,h[10]=se,h[11]=De),h[12]=w*u+X*d+le*b+Ae,h[13]=I*u+Y*d+ne*b+pt,h[14]=V*u+C*d+se*b+dt,h[15]=D*u+te*d+De*b+ft,h}function Tn(a,m){const l=m??new e(16),h=Math.cos(a),u=Math.sin(a);return l[0]=1,l[1]=0,l[2]=0,l[3]=0,l[4]=0,l[5]=h,l[6]=u,l[7]=0,l[8]=0,l[9]=-u,l[10]=h,l[11]=0,l[12]=0,l[13]=0,l[14]=0,l[15]=1,l}function Wt(a,m,l){const h=l??new e(16),u=a[4],d=a[5],b=a[6],w=a[7],I=a[8],V=a[9],D=a[10],X=a[11],Y=Math.cos(m),C=Math.sin(m);return h[4]=Y*u+C*I,h[5]=Y*d+C*V,h[6]=Y*b+C*D,h[7]=Y*w+C*X,h[8]=Y*I-C*u,h[9]=Y*V-C*d,h[10]=Y*D-C*b,h[11]=Y*X-C*w,a!==h&&(h[0]=a[0],h[1]=a[1],h[2]=a[2],h[3]=a[3],h[12]=a[12],h[13]=a[13],h[14]=a[14],h[15]=a[15]),h}function ln(a,m){const l=m??new e(16),h=Math.cos(a),u=Math.sin(a);return l[0]=h,l[1]=0,l[2]=-u,l[3]=0,l[4]=0,l[5]=1,l[6]=0,l[7]=0,l[8]=u,l[9]=0,l[10]=h,l[11]=0,l[12]=0,l[13]=0,l[14]=0,l[15]=1,l}function cn(a,m,l){const h=l??new e(16),u=a[0],d=a[1],b=a[2],w=a[3],I=a[8],V=a[9],D=a[10],X=a[11],Y=Math.cos(m),C=Math.sin(m);return h[0]=Y*u-C*I,h[1]=Y*d-C*V,h[2]=Y*b-C*D,h[3]=Y*w-C*X,h[8]=Y*I+C*u,h[9]=Y*V+C*d,h[10]=Y*D+C*b,h[11]=Y*X+C*w,a!==h&&(h[4]=a[4],h[5]=a[5],h[6]=a[6],h[7]=a[7],h[12]=a[12],h[13]=a[13],h[14]=a[14],h[15]=a[15]),h}function A(a,m){const l=m??new e(16),h=Math.cos(a),u=Math.sin(a);return l[0]=h,l[1]=u,l[2]=0,l[3]=0,l[4]=-u,l[5]=h,l[6]=0,l[7]=0,l[8]=0,l[9]=0,l[10]=1,l[11]=0,l[12]=0,l[13]=0,l[14]=0,l[15]=1,l}function N(a,m,l){const h=l??new e(16),u=a[0],d=a[1],b=a[2],w=a[3],I=a[4],V=a[5],D=a[6],X=a[7],Y=Math.cos(m),C=Math.sin(m);return h[0]=Y*u+C*I,h[1]=Y*d+C*V,h[2]=Y*b+C*D,h[3]=Y*w+C*X,h[4]=Y*I-C*u,h[5]=Y*V-C*d,h[6]=Y*D-C*b,h[7]=Y*X-C*w,a!==h&&(h[8]=a[8],h[9]=a[9],h[10]=a[10],h[11]=a[11],h[12]=a[12],h[13]=a[13],h[14]=a[14],h[15]=a[15]),h}function x(a,m,l){const h=l??new e(16);let u=a[0],d=a[1],b=a[2];const w=Math.sqrt(u*u+d*d+b*b);u/=w,d/=w,b/=w;const I=u*u,V=d*d,D=b*b,X=Math.cos(m),Y=Math.sin(m),C=1-X;return h[0]=I+(1-I)*X,h[1]=u*d*C+b*Y,h[2]=u*b*C-d*Y,h[3]=0,h[4]=u*d*C-b*Y,h[5]=V+(1-V)*X,h[6]=d*b*C+u*Y,h[7]=0,h[8]=u*b*C+d*Y,h[9]=d*b*C-u*Y,h[10]=D+(1-D)*X,h[11]=0,h[12]=0,h[13]=0,h[14]=0,h[15]=1,h}const o=x;function f(a,m,l,h){const u=h??new e(16);let d=m[0],b=m[1],w=m[2];const I=Math.sqrt(d*d+b*b+w*w);d/=I,b/=I,w/=I;const V=d*d,D=b*b,X=w*w,Y=Math.cos(l),C=Math.sin(l),te=1-Y,le=V+(1-V)*Y,ne=d*b*te+w*C,se=d*w*te-b*C,De=d*b*te-w*C,Ae=D+(1-D)*Y,pt=b*w*te+d*C,dt=d*w*te+b*C,ft=b*w*te-d*C,Mt=X+(1-X)*Y,St=a[0],Pt=a[1],Ut=a[2],At=a[3],It=a[4],Vt=a[5],Gt=a[6],Dt=a[7],Rt=a[8],Kt=a[9],en=a[10],tn=a[11];return u[0]=le*St+ne*It+se*Rt,u[1]=le*Pt+ne*Vt+se*Kt,u[2]=le*Ut+ne*Gt+se*en,u[3]=le*At+ne*Dt+se*tn,u[4]=De*St+Ae*It+pt*Rt,u[5]=De*Pt+Ae*Vt+pt*Kt,u[6]=De*Ut+Ae*Gt+pt*en,u[7]=De*At+Ae*Dt+pt*tn,u[8]=dt*St+ft*It+Mt*Rt,u[9]=dt*Pt+ft*Vt+Mt*Kt,u[10]=dt*Ut+ft*Gt+Mt*en,u[11]=dt*At+ft*Dt+Mt*tn,a!==u&&(u[12]=a[12],u[13]=a[13],u[14]=a[14],u[15]=a[15]),u}const c=f;function g(a,m){const l=m??new e(16);return l[0]=a[0],l[1]=0,l[2]=0,l[3]=0,l[4]=0,l[5]=a[1],l[6]=0,l[7]=0,l[8]=0,l[9]=0,l[10]=a[2],l[11]=0,l[12]=0,l[13]=0,l[14]=0,l[15]=1,l}function T(a,m,l){const h=l??new e(16),u=m[0],d=m[1],b=m[2];return h[0]=u*a[0],h[1]=u*a[1],h[2]=u*a[2],h[3]=u*a[3],h[4]=d*a[4],h[5]=d*a[5],h[6]=d*a[6],h[7]=d*a[7],h[8]=b*a[8],h[9]=b*a[9],h[10]=b*a[10],h[11]=b*a[11],a!==h&&(h[12]=a[12],h[13]=a[13],h[14]=a[14],h[15]=a[15]),h}function M(a,m){const l=m??new e(16);return l[0]=a,l[1]=0,l[2]=0,l[3]=0,l[4]=0,l[5]=a,l[6]=0,l[7]=0,l[8]=0,l[9]=0,l[10]=a,l[11]=0,l[12]=0,l[13]=0,l[14]=0,l[15]=1,l}function z(a,m,l){const h=l??new e(16);return h[0]=m*a[0],h[1]=m*a[1],h[2]=m*a[2],h[3]=m*a[3],h[4]=m*a[4],h[5]=m*a[5],h[6]=m*a[6],h[7]=m*a[7],h[8]=m*a[8],h[9]=m*a[9],h[10]=m*a[10],h[11]=m*a[11],a!==h&&(h[12]=a[12],h[13]=a[13],h[14]=a[14],h[15]=a[15]),h}return{add:y,aim:$t,axisRotate:f,axisRotation:x,cameraAim:Qt,clone:U,copy:P,create:n,determinant:re,equals:j,equalsApproximately:R,fromMat3:s,fromQuat:i,frustum:Ht,frustumReverseZ:gt,getAxis:Pe,getScaling:ht,getTranslation:Se,identity:L,inverse:Q,invert:Me,lookAt:Le,mul:be,mulScalar:_,multiply:oe,multiplyScalar:v,negate:p,ortho:_t,perspective:it,perspectiveReverseZ:Ct,rotate:c,rotateX:Wt,rotateY:cn,rotateZ:N,rotation:o,rotationX:Tn,rotationY:ln,rotationZ:A,scale:T,scaling:g,set:r,setAxis:yt,setTranslation:ze,translate:qt,translation:bn,transpose:Z,uniformScale:z,uniformScaling:M}}const rl=new Map;function n2(e){let t=rl.get(e);return t||(t=t2(e),rl.set(e,t)),t}function r2(e){const t=pa(e);function n(A,N,x,o){const f=new e(4);return A!==void 0&&(f[0]=A,N!==void 0&&(f[1]=N,x!==void 0&&(f[2]=x,o!==void 0&&(f[3]=o)))),f}const r=n;function s(A,N,x,o,f){const c=f??new e(4);return c[0]=A,c[1]=N,c[2]=x,c[3]=o,c}function i(A,N,x){const o=x??new e(4),f=N*.5,c=Math.sin(f);return o[0]=c*A[0],o[1]=c*A[1],o[2]=c*A[2],o[3]=Math.cos(f),o}function p(A,N){const x=N??t.create(3),o=Math.acos(A[3])*2,f=Math.sin(o*.5);return f>de?(x[0]=A[0]/f,x[1]=A[1]/f,x[2]=A[2]/f):(x[0]=1,x[1]=0,x[2]=0),{angle:o,axis:x}}function y(A,N){const x=it(A,N);return Math.acos(2*x*x-1)}function v(A,N,x){const o=x??new e(4),f=A[0],c=A[1],g=A[2],T=A[3],M=N[0],z=N[1],a=N[2],m=N[3];return o[0]=f*m+T*M+c*a-g*z,o[1]=c*m+T*z+g*M-f*a,o[2]=g*m+T*a+f*z-c*M,o[3]=T*m-f*M-c*z-g*a,o}const _=v;function P(A,N,x){const o=x??new e(4),f=N*.5,c=A[0],g=A[1],T=A[2],M=A[3],z=Math.sin(f),a=Math.cos(f);return o[0]=c*a+M*z,o[1]=g*a+T*z,o[2]=T*a-g*z,o[3]=M*a-c*z,o}function U(A,N,x){const o=x??new e(4),f=N*.5,c=A[0],g=A[1],T=A[2],M=A[3],z=Math.sin(f),a=Math.cos(f);return o[0]=c*a-T*z,o[1]=g*a+M*z,o[2]=T*a+c*z,o[3]=M*a-g*z,o}function R(A,N,x){const o=x??new e(4),f=N*.5,c=A[0],g=A[1],T=A[2],M=A[3],z=Math.sin(f),a=Math.cos(f);return o[0]=c*a+g*z,o[1]=g*a-c*z,o[2]=T*a+M*z,o[3]=M*a-T*z,o}function j(A,N,x,o){const f=o??new e(4),c=A[0],g=A[1],T=A[2],M=A[3];let z=N[0],a=N[1],m=N[2],l=N[3],h=c*z+g*a+T*m+M*l;h<0&&(h=-h,z=-z,a=-a,m=-m,l=-l);let u,d;if(1-h>de){const b=Math.acos(h),w=Math.sin(b);u=Math.sin((1-x)*b)/w,d=Math.sin(x*b)/w}else u=1-x,d=x;return f[0]=u*c+d*z,f[1]=u*g+d*a,f[2]=u*T+d*m,f[3]=u*M+d*l,f}function L(A,N){const x=N??new e(4),o=A[0],f=A[1],c=A[2],g=A[3],T=o*o+f*f+c*c+g*g,M=T?1/T:0;return x[0]=-o*M,x[1]=-f*M,x[2]=-c*M,x[3]=g*M,x}function Z(A,N){const x=N??new e(4);return x[0]=-A[0],x[1]=-A[1],x[2]=-A[2],x[3]=A[3],x}function Q(A,N){const x=N??new e(4),o=A[0]+A[5]+A[10];if(o>0){const f=Math.sqrt(o+1);x[3]=.5*f;const c=.5/f;x[0]=(A[6]-A[9])*c,x[1]=(A[8]-A[2])*c,x[2]=(A[1]-A[4])*c}else{let f=0;A[5]>A[0]&&(f=1),A[10]>A[f*4+f]&&(f=2);const c=(f+1)%3,g=(f+2)%3,T=Math.sqrt(A[f*4+f]-A[c*4+c]-A[g*4+g]+1);x[f]=.5*T;const M=.5/T;x[3]=(A[c*4+g]-A[g*4+c])*M,x[c]=(A[c*4+f]+A[f*4+c])*M,x[g]=(A[g*4+f]+A[f*4+g])*M}return x}function re(A,N,x,o,f){const c=f??new e(4),g=A*.5,T=N*.5,M=x*.5,z=Math.sin(g),a=Math.cos(g),m=Math.sin(T),l=Math.cos(T),h=Math.sin(M),u=Math.cos(M);switch(o){case"xyz":c[0]=z*l*u+a*m*h,c[1]=a*m*u-z*l*h,c[2]=a*l*h+z*m*u,c[3]=a*l*u-z*m*h;break;case"xzy":c[0]=z*l*u-a*m*h,c[1]=a*m*u-z*l*h,c[2]=a*l*h+z*m*u,c[3]=a*l*u+z*m*h;break;case"yxz":c[0]=z*l*u+a*m*h,c[1]=a*m*u-z*l*h,c[2]=a*l*h-z*m*u,c[3]=a*l*u+z*m*h;break;case"yzx":c[0]=z*l*u+a*m*h,c[1]=a*m*u+z*l*h,c[2]=a*l*h-z*m*u,c[3]=a*l*u-z*m*h;break;case"zxy":c[0]=z*l*u-a*m*h,c[1]=a*m*u+z*l*h,c[2]=a*l*h+z*m*u,c[3]=a*l*u-z*m*h;break;case"zyx":c[0]=z*l*u-a*m*h,c[1]=a*m*u+z*l*h,c[2]=a*l*h-z*m*u,c[3]=a*l*u+z*m*h;break;default:throw new Error(`Unknown rotation order: ${o}`)}return c}function Me(A,N){const x=N??new e(4);return x[0]=A[0],x[1]=A[1],x[2]=A[2],x[3]=A[3],x}const oe=Me;function be(A,N,x){const o=x??new e(4);return o[0]=A[0]+N[0],o[1]=A[1]+N[1],o[2]=A[2]+N[2],o[3]=A[3]+N[3],o}function ze(A,N,x){const o=x??new e(4);return o[0]=A[0]-N[0],o[1]=A[1]-N[1],o[2]=A[2]-N[2],o[3]=A[3]-N[3],o}const Se=ze;function Pe(A,N,x){const o=x??new e(4);return o[0]=A[0]*N,o[1]=A[1]*N,o[2]=A[2]*N,o[3]=A[3]*N,o}const yt=Pe;function ht(A,N,x){const o=x??new e(4);return o[0]=A[0]/N,o[1]=A[1]/N,o[2]=A[2]/N,o[3]=A[3]/N,o}function it(A,N){return A[0]*N[0]+A[1]*N[1]+A[2]*N[2]+A[3]*N[3]}function Ct(A,N,x,o){const f=o??new e(4);return f[0]=A[0]+x*(N[0]-A[0]),f[1]=A[1]+x*(N[1]-A[1]),f[2]=A[2]+x*(N[2]-A[2]),f[3]=A[3]+x*(N[3]-A[3]),f}function _t(A){const N=A[0],x=A[1],o=A[2],f=A[3];return Math.sqrt(N*N+x*x+o*o+f*f)}const Ht=_t;function gt(A){const N=A[0],x=A[1],o=A[2],f=A[3];return N*N+x*x+o*o+f*f}const Ee=gt;function Te(A,N){const x=N??new e(4),o=A[0],f=A[1],c=A[2],g=A[3],T=Math.sqrt(o*o+f*f+c*c+g*g);return T>1e-5?(x[0]=o/T,x[1]=f/T,x[2]=c/T,x[3]=g/T):(x[0]=0,x[1]=0,x[2]=0,x[3]=1),x}function ge(A,N){return Math.abs(A[0]-N[0])<de&&Math.abs(A[1]-N[1])<de&&Math.abs(A[2]-N[2])<de&&Math.abs(A[3]-N[3])<de}function $t(A,N){return A[0]===N[0]&&A[1]===N[1]&&A[2]===N[2]&&A[3]===N[3]}function Qt(A){const N=A??new e(4);return N[0]=0,N[1]=0,N[2]=0,N[3]=1,N}const Le=t.create(),bn=t.create(),qt=t.create();function Tn(A,N,x){const o=x??new e(4),f=t.dot(A,N);return f<-.999999?(t.cross(bn,A,Le),t.len(Le)<1e-6&&t.cross(qt,A,Le),t.normalize(Le,Le),i(Le,Math.PI,o),o):f>.999999?(o[0]=0,o[1]=0,o[2]=0,o[3]=1,o):(t.cross(A,N,Le),o[0]=Le[0],o[1]=Le[1],o[2]=Le[2],o[3]=1+f,Te(o,o))}const Wt=new e(4),ln=new e(4);function cn(A,N,x,o,f,c){const g=c??new e(4);return j(A,o,f,Wt),j(N,x,f,ln),j(Wt,ln,2*f*(1-f),g),g}return{create:n,fromValues:r,set:s,fromAxisAngle:i,toAxisAngle:p,angle:y,multiply:v,mul:_,rotateX:P,rotateY:U,rotateZ:R,slerp:j,inverse:L,conjugate:Z,fromMat:Q,fromEuler:re,copy:Me,clone:oe,add:be,subtract:ze,sub:Se,mulScalar:Pe,scale:yt,divScalar:ht,dot:it,lerp:Ct,length:_t,len:Ht,lengthSq:gt,lenSq:Ee,normalize:Te,equalsApproximately:ge,equals:$t,identity:Qt,rotationTo:Tn,sqlerp:cn}}const sl=new Map;function s2(e){let t=sl.get(e);return t||(t=r2(e),sl.set(e,t)),t}function i2(e){function t(x,o,f,c){const g=new e(4);return x!==void 0&&(g[0]=x,o!==void 0&&(g[1]=o,f!==void 0&&(g[2]=f,c!==void 0&&(g[3]=c)))),g}const n=t;function r(x,o,f,c,g){const T=g??new e(4);return T[0]=x,T[1]=o,T[2]=f,T[3]=c,T}function s(x,o){const f=o??new e(4);return f[0]=Math.ceil(x[0]),f[1]=Math.ceil(x[1]),f[2]=Math.ceil(x[2]),f[3]=Math.ceil(x[3]),f}function i(x,o){const f=o??new e(4);return f[0]=Math.floor(x[0]),f[1]=Math.floor(x[1]),f[2]=Math.floor(x[2]),f[3]=Math.floor(x[3]),f}function p(x,o){const f=o??new e(4);return f[0]=Math.round(x[0]),f[1]=Math.round(x[1]),f[2]=Math.round(x[2]),f[3]=Math.round(x[3]),f}function y(x,o=0,f=1,c){const g=c??new e(4);return g[0]=Math.min(f,Math.max(o,x[0])),g[1]=Math.min(f,Math.max(o,x[1])),g[2]=Math.min(f,Math.max(o,x[2])),g[3]=Math.min(f,Math.max(o,x[3])),g}function v(x,o,f){const c=f??new e(4);return c[0]=x[0]+o[0],c[1]=x[1]+o[1],c[2]=x[2]+o[2],c[3]=x[3]+o[3],c}function _(x,o,f,c){const g=c??new e(4);return g[0]=x[0]+o[0]*f,g[1]=x[1]+o[1]*f,g[2]=x[2]+o[2]*f,g[3]=x[3]+o[3]*f,g}function P(x,o,f){const c=f??new e(4);return c[0]=x[0]-o[0],c[1]=x[1]-o[1],c[2]=x[2]-o[2],c[3]=x[3]-o[3],c}const U=P;function R(x,o){return Math.abs(x[0]-o[0])<de&&Math.abs(x[1]-o[1])<de&&Math.abs(x[2]-o[2])<de&&Math.abs(x[3]-o[3])<de}function j(x,o){return x[0]===o[0]&&x[1]===o[1]&&x[2]===o[2]&&x[3]===o[3]}function L(x,o,f,c){const g=c??new e(4);return g[0]=x[0]+f*(o[0]-x[0]),g[1]=x[1]+f*(o[1]-x[1]),g[2]=x[2]+f*(o[2]-x[2]),g[3]=x[3]+f*(o[3]-x[3]),g}function Z(x,o,f,c){const g=c??new e(4);return g[0]=x[0]+f[0]*(o[0]-x[0]),g[1]=x[1]+f[1]*(o[1]-x[1]),g[2]=x[2]+f[2]*(o[2]-x[2]),g[3]=x[3]+f[3]*(o[3]-x[3]),g}function Q(x,o,f){const c=f??new e(4);return c[0]=Math.max(x[0],o[0]),c[1]=Math.max(x[1],o[1]),c[2]=Math.max(x[2],o[2]),c[3]=Math.max(x[3],o[3]),c}function re(x,o,f){const c=f??new e(4);return c[0]=Math.min(x[0],o[0]),c[1]=Math.min(x[1],o[1]),c[2]=Math.min(x[2],o[2]),c[3]=Math.min(x[3],o[3]),c}function Me(x,o,f){const c=f??new e(4);return c[0]=x[0]*o,c[1]=x[1]*o,c[2]=x[2]*o,c[3]=x[3]*o,c}const oe=Me;function be(x,o,f){const c=f??new e(4);return c[0]=x[0]/o,c[1]=x[1]/o,c[2]=x[2]/o,c[3]=x[3]/o,c}function ze(x,o){const f=o??new e(4);return f[0]=1/x[0],f[1]=1/x[1],f[2]=1/x[2],f[3]=1/x[3],f}const Se=ze;function Pe(x,o){return x[0]*o[0]+x[1]*o[1]+x[2]*o[2]+x[3]*o[3]}function yt(x){const o=x[0],f=x[1],c=x[2],g=x[3];return Math.sqrt(o*o+f*f+c*c+g*g)}const ht=yt;function it(x){const o=x[0],f=x[1],c=x[2],g=x[3];return o*o+f*f+c*c+g*g}const Ct=it;function _t(x,o){const f=x[0]-o[0],c=x[1]-o[1],g=x[2]-o[2],T=x[3]-o[3];return Math.sqrt(f*f+c*c+g*g+T*T)}const Ht=_t;function gt(x,o){const f=x[0]-o[0],c=x[1]-o[1],g=x[2]-o[2],T=x[3]-o[3];return f*f+c*c+g*g+T*T}const Ee=gt;function Te(x,o){const f=o??new e(4),c=x[0],g=x[1],T=x[2],M=x[3],z=Math.sqrt(c*c+g*g+T*T+M*M);return z>1e-5?(f[0]=c/z,f[1]=g/z,f[2]=T/z,f[3]=M/z):(f[0]=0,f[1]=0,f[2]=0,f[3]=0),f}function ge(x,o){const f=o??new e(4);return f[0]=-x[0],f[1]=-x[1],f[2]=-x[2],f[3]=-x[3],f}function $t(x,o){const f=o??new e(4);return f[0]=x[0],f[1]=x[1],f[2]=x[2],f[3]=x[3],f}const Qt=$t;function Le(x,o,f){const c=f??new e(4);return c[0]=x[0]*o[0],c[1]=x[1]*o[1],c[2]=x[2]*o[2],c[3]=x[3]*o[3],c}const bn=Le;function qt(x,o,f){const c=f??new e(4);return c[0]=x[0]/o[0],c[1]=x[1]/o[1],c[2]=x[2]/o[2],c[3]=x[3]/o[3],c}const Tn=qt;function Wt(x){const o=x??new e(4);return o[0]=0,o[1]=0,o[2]=0,o[3]=0,o}function ln(x,o,f){const c=f??new e(4),g=x[0],T=x[1],M=x[2],z=x[3];return c[0]=o[0]*g+o[4]*T+o[8]*M+o[12]*z,c[1]=o[1]*g+o[5]*T+o[9]*M+o[13]*z,c[2]=o[2]*g+o[6]*T+o[10]*M+o[14]*z,c[3]=o[3]*g+o[7]*T+o[11]*M+o[15]*z,c}function cn(x,o,f){const c=f??new e(4);return Te(x,c),Me(c,o,c)}function A(x,o,f){const c=f??new e(4);return yt(x)>o?cn(x,o,c):$t(x,c)}function N(x,o,f){const c=f??new e(4);return L(x,o,.5,c)}return{create:t,fromValues:n,set:r,ceil:s,floor:i,round:p,clamp:y,add:v,addScaled:_,subtract:P,sub:U,equalsApproximately:R,equals:j,lerp:L,lerpV:Z,max:Q,min:re,mulScalar:Me,scale:oe,divScalar:be,inverse:ze,invert:Se,dot:Pe,length:yt,len:ht,lengthSq:it,lenSq:Ct,distance:_t,dist:Ht,distanceSq:gt,distSq:Ee,normalize:Te,negate:ge,copy:$t,clone:Qt,multiply:Le,mul:bn,divide:qt,div:Tn,zero:Wt,transformMat4:ln,setLength:cn,truncate:A,midpoint:N}}const il=new Map;function a2(e){let t=il.get(e);return t||(t=i2(e),il.set(e,t)),t}function Wo(e,t,n,r,s,i){return{mat3:e2(e),mat4:n2(t),quat:s2(n),vec2:up(r),vec3:pa(s),vec4:a2(i)}}const{mat4:_n}=Wo(Float32Array,Float32Array,Float32Array,Float32Array,Float32Array,Float32Array);Wo(Float64Array,Float64Array,Float64Array,Float64Array,Float64Array,Float64Array);Wo(Zx,Array,Array,Array,Array,Array);const o2=(globalThis.__TYPEGPU_AUTONAME__??(e=>e))(qn({view:we,proj:we,viewInv:we,projInv:we}),"Camera");function u2(e,t){let n=0,r=1/t,s=e;for(;s>0;)n+=r*(s%t),s=Math.floor(s/t),r=r/t;return n}function*al(e){let t=1;for(;;)yield u2(t,e),t++}class l2{#e;#t;#n;#r;#s;#i;#a;#u;#o;#l;#c;constructor(t,n,r,s,i,p,y,v=.1,_=10){this.#l=p,this.#c=y,this.#t=_n.lookAt(n,r,s,we()),this.#i=_n.perspective(i,p/y,v,_,we()),this.#n=this.#i,this.#r=_n.invert(this.#t,we()),this.#a=_n.invert(this.#i,we()),this.#s=this.#a,this.#e=t.createUniform(o2,{view:this.#t,proj:this.#n,viewInv:this.#r,projInv:this.#s}),this.#u=al(2),this.#o=al(3)}jitter(){const[t,n]=[this.#u.next().value,this.#o.next().value],r=(t-.5)*2/this.#l,s=(n-.5)*2/this.#c,i=_n.identity(we());i[12]=r,i[13]=s;const p=_n.mul(i,this.#i,we()),y=_n.invert(p,we());this.#e.writePartial({proj:p,projInv:y})}updateView(t,n,r){this.#t=_n.lookAt(t,n,r,we()),this.#r=_n.invert(this.#t,we()),this.#e.writePartial({view:this.#t,viewInv:this.#r})}updateProjection(t,n,r,s=.1,i=100){this.#l=n,this.#c=r,this.#i=_n.perspective(t,n/r,s,i,we()),this.#a=_n.invert(this.#i,we()),this.#e.writePartial({proj:this.#i,projInv:this.#a})}get cameraUniform(){return this.#e}}const ol=(e=>(globalThis.__TYPEGPU_META__??=new WeakMap).set(e.f=((t,n,r)=>{"use gpu";const s=gr((n-r)/(n+r),2);return s+(1-s)*gr(1-t,5)}),{v:1,name:"fresnelSchlick",ast:{params:[{type:"i",name:"cosTheta"},{type:"i",name:"ior1"},{type:"i",name:"ior2"}],body:[0,[[13,"r0",[6,[7,"std","pow"],[[1,[1,"ior1","-","ior2"],"/",[1,"ior1","+","ior2"]],[5,"2"]]]],[10,[1,"r0","+",[1,[1,[5,"1"],"-","r0"],"*",[6,[7,"std","pow"],[[1,[5,"1"],"-","cosTheta"],[5,"5"]]]]]]]],externalNames:["std"]},get externals(){return{std:We}}})&&e.f)({}),ul=(e=>(globalThis.__TYPEGPU_META__??=new WeakMap).set(e.f=((t,n)=>{"use gpu";return Oc(xe(t,-n))}),{v:1,name:"beerLambert",ast:{params:[{type:"i",name:"sigma"},{type:"i",name:"dist"}],body:[0,[[10,[6,[7,"std","exp"],[[6,[7,"std","mul"],["sigma",[4,"-","dist"]]]]]]]],externalNames:["std"]},get externals(){return{std:We}}})&&e.f)({}),ll=(e=>(globalThis.__TYPEGPU_META__??=new WeakMap).set(e.f=((t,n,r)=>{"use gpu";const s=O(1).div(n),i=K(r.min,t).mul(s),p=K(r.max,t).mul(s),y=Ie(i,p),v=ie(i,p),_=ie(ie(y.x,y.y),y.z),P=Ie(Ie(v.x,v.y),v.z),U=Hu();return U.hit=P>=_&&P>=0,U.tMin=_,U.tMax=P,U}),{v:1,name:"intersectBox",ast:{params:[{type:"i",name:"rayOrigin"},{type:"i",name:"rayDirection"},{type:"i",name:"box"}],body:[0,[[13,"invDir",[6,[7,[6,[7,"d","vec3f"],[[5,"1"]]],"div"],["rayDirection"]]],[13,"t1",[6,[7,[6,[7,"std","sub"],[[7,"box","min"],"rayOrigin"]],"mul"],["invDir"]]],[13,"t2",[6,[7,[6,[7,"std","sub"],[[7,"box","max"],"rayOrigin"]],"mul"],["invDir"]]],[13,"tMinVec",[6,[7,"std","min"],["t1","t2"]]],[13,"tMaxVec",[6,[7,"std","max"],["t1","t2"]]],[13,"tMin",[6,[7,"std","max"],[[6,[7,"std","max"],[[7,"tMinVec","x"],[7,"tMinVec","y"]]],[7,"tMinVec","z"]]]],[13,"tMax",[6,[7,"std","min"],[[6,[7,"std","min"],[[7,"tMaxVec","x"],[7,"tMaxVec","y"]]],[7,"tMaxVec","z"]]]],[13,"result",[6,"BoxIntersection",[]]],[2,[7,"result","hit"],"=",[3,[1,"tMax",">=","tMin"],"&&",[1,"tMax",">=",[5,"0"]]]],[2,[7,"result","tMin"],"=","tMin"],[2,[7,"result","tMax"],"=","tMax"],[10,"result"]]],externalNames:["d","std","BoxIntersection"]},get externals(){return{d:ve,std:We,BoxIntersection:Hu}}})&&e.f)({});function lp(e,t,n){return[0,1].map(()=>{const r=(globalThis.__TYPEGPU_AUTONAME__??(s=>s))(e["~unstable"].createTexture({size:[t,n],format:"rgba8unorm"}).$usage("storage","sampled","render"),"texture");return{write:r.createView(ni("rgba8unorm")),sampled:r.createView()}})}function cp(e,t,n){return{sampled:(globalThis.__TYPEGPU_AUTONAME__??(s=>s))(e["~unstable"].createTexture({size:[t,n],format:"rgba16float"}).$usage("sampled","render"),"texture").createView()}}const c2=(globalThis.__TYPEGPU_AUTONAME__??(e=>e))(H["~unstable"].computeFn({workgroupSize:[16,16],in:{gid:Ns.globalInvocationId}})((e=>(globalThis.__TYPEGPU_META__??=new WeakMap).set(e.f=(({gid:t})=>{const n=Ai(Er.$.currentTexture,xt(t.xy),0),r=Ai(Er.$.historyTexture,xt(t.xy),0);let s=O(9999),i=O(-9999);const p=Qh(Er.$.currentTexture);for(let P=-1;P<=1;P++)for(let U=-1;U<=1;U++){const R=Be(t.xy).add(Be(P,U)),j=kr(R,Be(0,0),Be(p.xy).sub(Be(1))),L=Ai(Er.$.currentTexture,j,0);s=Ie(s,L.xyz),i=ie(i,L.xyz)}const y=kr(r.xyz,s,i),v=$(.9),_=k(rn(n.xyz,y,v),1);Hh(Er.$.outputTexture,xt(t.x,t.y),_)}),{v:1,name:void 0,ast:{params:[{type:"d",props:[{name:"gid",alias:"gid"}]}],body:[0,[[13,"currentColor",[6,[7,"std","textureLoad"],[[7,[7,"taaResolveLayout","$"],"currentTexture"],[6,[7,"d","vec2u"],[[7,"gid","xy"]]],[5,"0"]]]],[13,"historyColor",[6,[7,"std","textureLoad"],[[7,[7,"taaResolveLayout","$"],"historyTexture"],[6,[7,"d","vec2u"],[[7,"gid","xy"]]],[5,"0"]]]],[12,"minColor",[6,[7,"d","vec3f"],[[5,"9999"]]]],[12,"maxColor",[6,[7,"d","vec3f"],[[4,"-",[5,"9999"]]]]],[13,"dimensions",[6,[7,"std","textureDimensions"],[[7,[7,"taaResolveLayout","$"],"currentTexture"]]]],[14,[12,"x",[4,"-",[5,"1"]]],[1,"x","<=",[5,"1"]],[102,"++","x"],[0,[[14,[12,"y",[4,"-",[5,"1"]]],[1,"y","<=",[5,"1"]],[102,"++","y"],[0,[[13,"sampleCoord",[6,[7,[6,[7,"d","vec2i"],[[7,"gid","xy"]]],"add"],[[6,[7,"d","vec2i"],["x","y"]]]]],[13,"clampedCoord",[6,[7,"std","clamp"],["sampleCoord",[6,[7,"d","vec2i"],[[5,"0"],[5,"0"]]],[6,[7,[6,[7,"d","vec2i"],[[7,"dimensions","xy"]]],"sub"],[[6,[7,"d","vec2i"],[[5,"1"]]]]]]]],[13,"neighborColor",[6,[7,"std","textureLoad"],[[7,[7,"taaResolveLayout","$"],"currentTexture"],"clampedCoord",[5,"0"]]]],[2,"minColor","=",[6,[7,"std","min"],["minColor",[7,"neighborColor","xyz"]]]],[2,"maxColor","=",[6,[7,"std","max"],["maxColor",[7,"neighborColor","xyz"]]]]]]]]]],[13,"historyColorClamped",[6,[7,"std","clamp"],[[7,"historyColor","xyz"],"minColor","maxColor"]]],[13,"blendFactor",[6,[7,"d","f32"],[[5,"0.9"]]]],[13,"resolvedColor",[6,[7,"d","vec4f"],[[6,[7,"std","mix"],[[7,"currentColor","xyz"],"historyColorClamped","blendFactor"]],[5,"1"]]]],[6,[7,"std","textureStore"],[[7,[7,"taaResolveLayout","$"],"outputTexture"],[6,[7,"d","vec2u"],[[7,"gid","x"],[7,"gid","y"]]],"resolvedColor"]]]],externalNames:["std","taaResolveLayout","d"]},get externals(){return{std:We,taaResolveLayout:Er,d:ve}}})&&e.f)({})),"taaResolveFn");function cl(e,t,n){return[0,1].map(()=>{const r=(globalThis.__TYPEGPU_AUTONAME__??(s=>s))(e["~unstable"].createTexture({size:[t,n],format:"rgba8unorm"}).$usage("storage","sampled"),"texture");return{write:r.createView(ni("rgba8unorm")),sampled:r.createView()}})}class h2{#e;#t;#n;#r;#s;constructor(t,n,r){this.#n=t,this.#r=n,this.#s=r,this.#e=t["~unstable"].withCompute(c2).createPipeline(),this.#t=cl(t,n,r)}resolve(t,n,r){const s=1-r;return this.#e.with(this.#n.createBindGroup(Er,{currentTexture:t,historyTexture:n===1?t:this.#t[s].sampled,outputTexture:this.#t[r].write})).dispatchWorkgroups(Math.ceil(this.#r/16),Math.ceil(this.#s/16)),this.#t[r].sampled}resize(t,n){this.#r=t,this.#s=n,this.#t=cl(this.#n,t,n)}getResolvedTexture(t){return this.#t[t].sampled}}const hp=navigator.gpu.getPreferredCanvasFormat(),Zt=document.querySelector("canvas"),pp=Zt.getContext("webgpu"),Ze=await H.init({device:{optionalFeatures:["timestamp-query"]}}),p2=Ze.enabledFeatures.has("timestamp-query");pp.configure({device:Ze.device,format:hp,alphaMode:"premultiplied"});const bt=new Xx(Ze);await bt.init();let ps=.5,[Hn,Qn]=[Zt.width*ps,Zt.height*ps],io=lp(Ze,Hn,Qn),Xo=cp(Ze,Hn,Qn);const hl=(globalThis.__TYPEGPU_AUTONAME__??(e=>e))(Ze["~unstable"].createSampler({magFilter:"linear",minFilter:"linear"}),"filteringSampler"),Jo=new l2(Ze,Lx,O(0,0,0),O(0,1,0),Math.PI/4,Hn,Qn),$a=Jo.cameraUniform,Ar=(globalThis.__TYPEGPU_AUTONAME__??(e=>e))(Ze.createUniform(qx,{direction:an(O(.19,-.24,.75)),color:O(1,1,1)}),"lightUniform"),Ws=(globalThis.__TYPEGPU_AUTONAME__??(e=>e))(Ze.createUniform(k,k(1,.45,.075,1)),"jellyColorUniform"),Xs=(globalThis.__TYPEGPU_AUTONAME__??(e=>e))(Ze.createUniform(J),"darkModeUniform"),ao=(globalThis.__TYPEGPU_AUTONAME__??(e=>e))(Ze.createUniform(F),"randomUniform"),pl=(e=>(globalThis.__TYPEGPU_META__??=new WeakMap).set(e.f=(t=>{"use gpu";const n=k(t.x,t.y,-1,1),r=$a.$.viewInv,i=$a.$.projInv.mul(n),p=k(i.xyz.div(i.w),1),y=r.mul(p),v=r.columns[3].xyz,_=an(y.xyz.sub(v));return Qu({origin:v,direction:_})}),{v:1,name:"getRay",ast:{params:[{type:"i",name:"ndc"}],body:[0,[[13,"clipPos",[6,[7,"d","vec4f"],[[7,"ndc","x"],[7,"ndc","y"],[4,"-",[5,"1"]],[5,"1"]]]],[13,"invView",[7,[7,"cameraUniform","$"],"viewInv"]],[13,"invProj",[7,[7,"cameraUniform","$"],"projInv"]],[13,"viewPos",[6,[7,"invProj","mul"],["clipPos"]]],[13,"viewPosNormalized",[6,[7,"d","vec4f"],[[6,[7,[7,"viewPos","xyz"],"div"],[[7,"viewPos","w"]]],[5,"1"]]]],[13,"worldPos",[6,[7,"invView","mul"],["viewPosNormalized"]]],[13,"rayOrigin",[7,[8,[7,"invView","columns"],[5,"3"]],"xyz"]],[13,"rayDir",[6,[7,"std","normalize"],[[6,[7,[7,"worldPos","xyz"],"sub"],["rayOrigin"]]]]],[10,[6,"Ray",[[104,{origin:"rayOrigin",direction:"rayDir"}]]]]]],externalNames:["d","cameraUniform","std","Ray"]},get externals(){return{d:ve,cameraUniform:$a,std:We,Ray:Qu}}})&&e.f)({}),dl=(e=>(globalThis.__TYPEGPU_META__??=new WeakMap).set(e.f=(()=>{"use gpu";return Ku({min:O(-1,-1,-1),max:O(.5,1,1)})}),{v:1,name:"getJellyBounds",ast:{params:[],body:[0,[[10,[6,"BoundingBox",[[104,{min:[6,[7,"d","vec3f"],[[4,"-",[5,"1"]],[4,"-",[5,"1"]],[4,"-",[5,"1"]]]],max:[6,[7,"d","vec3f"],[[5,"0.5"],[5,"1"],[5,"1"]]]}]]]]]],externalNames:["BoundingBox","d"]},get externals(){return{BoundingBox:Ku,d:ve}}})&&e.f)({}),dr={groundThickness:.03,groundRadius:.3,groundRoundness:.02},Wi=(e=>(globalThis.__TYPEGPU_META__??=new WeakMap).set(e.f=(t=>{"use gpu";const n=dr.groundRoundness,r=dr.groundRadius;return $e(t)-(r+n)}),{v:1,name:"circleCutoutDist",ast:{params:[{type:"i",name:"position"}],body:[0,[[13,"groundRoundness",[7,"GroundParams","groundRoundness"]],[13,"groundRadius",[7,"GroundParams","groundRadius"]],[10,[1,[6,[7,"std","length"],["position"]],"-",[1,"groundRadius","+","groundRoundness"]]]]],externalNames:["GroundParams","std"]},get externals(){return{GroundParams:dr,std:We}}})&&e.f)({}),xr=(e=>(globalThis.__TYPEGPU_META__??=new WeakMap).set(e.f=(t=>{"use gpu";const n=dr.groundThickness,r=dr.groundRoundness;return ep(np(t,O(0,1,0),.06),Kh(t,-Wi(t.xz),n-r)-r)}),{v:1,name:"getMainSceneDist",ast:{params:[{type:"i",name:"position"}],body:[0,[[13,"groundThickness",[7,"GroundParams","groundThickness"]],[13,"groundRoundness",[7,"GroundParams","groundRoundness"]],[10,[6,[7,"sdf","opUnion"],[[6,[7,"sdf","sdPlane"],["position",[6,[7,"d","vec3f"],[[5,"0"],[5,"1"],[5,"0"]]],[5,"0.06"]]],[1,[6,[7,"sdf","opExtrudeY"],["position",[4,"-",[6,"circleCutoutDist",[[7,"position","xz"]]]],[1,"groundThickness","-","groundRoundness"]]],"-","groundRoundness"]]]]]],externalNames:["GroundParams","sdf","d","circleCutoutDist"]},get externals(){return{GroundParams:dr,sdf:rp,d:ve,circleCutoutDist:Wi}}})&&e.f)({}),fl=(e=>(globalThis.__TYPEGPU_META__??=new WeakMap).set(e.f=((t,n)=>{"use gpu";const r=Ft(n*t.x),s=un(n*t.x),i=xn(r,-s,s,r);return O(i.mul(t.xy),t.z)}),{v:1,name:"opCheapBend",ast:{params:[{type:"i",name:"p"},{type:"i",name:"k"}],body:[0,[[13,"c",[6,[7,"std","cos"],[[1,"k","*",[7,"p","x"]]]]],[13,"s",[6,[7,"std","sin"],[[1,"k","*",[7,"p","x"]]]]],[13,"m",[6,[7,"d","mat2x2f"],["c",[4,"-","s"],"s","c"]]],[10,[6,[7,"d","vec3f"],[[6,[7,"m","mul"],[[7,"p","xy"]]],[7,"p","z"]]]]]],externalNames:["std","d"]},get externals(){return{std:We,d:ve}}})&&e.f)({}),ml=(e=>(globalThis.__TYPEGPU_META__??=new WeakMap).set(e.f=((t,n,r)=>{"use gpu";return ue(rn(n.mul(ae(t,n)),t,Ft(r)),kc(t,n).mul(un(r)))}),{v:1,name:"opRotateAxisAngle",ast:{params:[{type:"i",name:"p"},{type:"i",name:"axis"},{type:"i",name:"angle"}],body:[0,[[10,[6,[7,"std","add"],[[6,[7,"std","mix"],[[6,[7,"axis","mul"],[[6,[7,"std","dot"],["p","axis"]]]],"p",[6,[7,"std","cos"],["angle"]]]],[6,[7,[6,[7,"std","cross"],["p","axis"]],"mul"],[[6,[7,"std","sin"],["angle"]]]]]]]]],externalNames:["std"]},get externals(){return{std:We}}})&&e.f)({}),Xi=(e=>(globalThis.__TYPEGPU_META__??=new WeakMap).set(e.f=(t=>{"use gpu";const n=bt.stateUniform.$,r=O(n.baseCenterX,.7,-n.baseCenterY),s=t.sub(r),i=jt((s.y+ls.y)/(ls.y*2)),p=O(n.posX*i/15,n.posY*i/-18,n.posZ*i/15),y=s.sub(p),v=O(1,1,1/(1-n.squashZ*.5+.001)),_=y.mul(v),P=ml(_,O(0,0,1),n.wiggleX);return tp(fl(P,.2),ls.sub(.1),.1)}),{v:1,name:"getJellyDist",ast:{params:[{type:"i",name:"position"}],body:[0,[[13,"state",[7,[7,"buttonBehavior","stateUniform"],"$"]],[13,"baseCenter",[6,[7,"d","vec3f"],[[7,"state","baseCenterX"],[5,"0.7"],[4,"-",[7,"state","baseCenterY"]]]]],[13,"localToBase",[6,[7,"position","sub"],["baseCenter"]]],[13,"heightFactor",[6,[7,"std","saturate"],[[1,[1,[7,"localToBase","y"],"+",[7,"JELLY_HALFSIZE","y"]],"/",[1,[7,"JELLY_HALFSIZE","y"],"*",[5,"2"]]]]]],[13,"displacement",[6,[7,"d","vec3f"],[[1,[1,[7,"state","posX"],"*","heightFactor"],"/",[5,"15"]],[1,[1,[7,"state","posY"],"*","heightFactor"],"/",[4,"-",[5,"18"]]],[1,[1,[7,"state","posZ"],"*","heightFactor"],"/",[5,"15"]]]]],[13,"displacedPos",[6,[7,"localToBase","sub"],["displacement"]]],[13,"jellyInvScale",[6,[7,"d","vec3f"],[[5,"1"],[5,"1"],[1,[5,"1"],"/",[1,[1,[5,"1"],"-",[1,[7,"state","squashZ"],"*",[5,"0.5"]]],"+",[5,"0.001"]]]]]],[13,"scaledPos",[6,[7,"displacedPos","mul"],["jellyInvScale"]]],[13,"localPos",[6,"opRotateAxisAngle",["scaledPos",[6,[7,"d","vec3f"],[[5,"0"],[5,"0"],[5,"1"]]],[7,"state","wiggleX"]]]],[10,[6,[7,"sdf","sdRoundedBox3d"],[[6,"opCheapBend",["localPos",[5,"0.2"]]],[6,[7,"JELLY_HALFSIZE","sub"],[[5,"0.1"]]],[5,"0.1"]]]]]],externalNames:["buttonBehavior","d","std","JELLY_HALFSIZE","opRotateAxisAngle","sdf","opCheapBend"]},get externals(){return{buttonBehavior:bt,d:ve,std:We,JELLY_HALFSIZE:ls,opRotateAxisAngle:ml,sdf:rp,opCheapBend:fl}}})&&e.f)({}),Pr=(e=>(globalThis.__TYPEGPU_META__??=new WeakMap).set(e.f=(t=>{"use gpu";const n=xr(t),r=Xi(t),s=Zu();return r<n?(s.distance=r,s.objectType=Ds.SLIDER):(s.distance=n,s.objectType=Ds.BACKGROUND),s}),{v:1,name:"getSceneDist",ast:{params:[{type:"i",name:"position"}],body:[0,[[13,"mainScene",[6,"getMainSceneDist",["position"]]],[13,"jelly",[6,"getJellyDist",["position"]]],[13,"hitInfo",[6,"HitInfo",[]]],[11,[1,"jelly","<","mainScene"],[0,[[2,[7,"hitInfo","distance"],"=","jelly"],[2,[7,"hitInfo","objectType"],"=",[7,"ObjectType","SLIDER"]]]],[0,[[2,[7,"hitInfo","distance"],"=","mainScene"],[2,[7,"hitInfo","objectType"],"=",[7,"ObjectType","BACKGROUND"]]]]],[10,"hitInfo"]]],externalNames:["getMainSceneDist","getJellyDist","HitInfo","ObjectType"]},get externals(){return{getMainSceneDist:xr,getJellyDist:Xi,HitInfo:Zu,ObjectType:Ds}}})&&e.f)({}),yl=(e=>(globalThis.__TYPEGPU_META__??=new WeakMap).set(e.f=(t=>{"use gpu";const n=xr(t),r=Xi(t);return Ie(n,r)}),{v:1,name:"getSceneDistForAO",ast:{params:[{type:"i",name:"position"}],body:[0,[[13,"mainScene",[6,"getMainSceneDist",["position"]]],[13,"jelly",[6,"getJellyDist",["position"]]],[10,[6,[7,"std","min"],["mainScene","jelly"]]]]],externalNames:["getMainSceneDist","getJellyDist","std"]},get externals(){return{getMainSceneDist:xr,getJellyDist:Xi,std:We}}})&&e.f)({}),gl=(e=>(globalThis.__TYPEGPU_META__??=new WeakMap).set(e.f=((t,n)=>{"use gpu";const r=Pr(t).distance,s=O(Pr(ue(t,O(n,0,0))).distance-r,Pr(ue(t,O(0,n,0))).distance-r,Pr(ue(t,O(0,0,n))).distance-r);return an(s)}),{v:1,name:"getApproxNormal",ast:{params:[{type:"i",name:"p"},{type:"i",name:"e"}],body:[0,[[13,"dist",[7,[6,"getSceneDist",["p"]],"distance"]],[13,"n",[6,[7,"d","vec3f"],[[1,[7,[6,"getSceneDist",[[6,[7,"std","add"],["p",[6,[7,"d","vec3f"],["e",[5,"0"],[5,"0"]]]]]]],"distance"],"-","dist"],[1,[7,[6,"getSceneDist",[[6,[7,"std","add"],["p",[6,[7,"d","vec3f"],[[5,"0"],"e",[5,"0"]]]]]]],"distance"],"-","dist"],[1,[7,[6,"getSceneDist",[[6,[7,"std","add"],["p",[6,[7,"d","vec3f"],[[5,"0"],[5,"0"],"e"]]]]]],"distance"],"-","dist"]]]],[10,[6,[7,"std","normalize"],["n"]]]]],externalNames:["getSceneDist","d","std"]},get externals(){return{getSceneDist:Pr,d:ve,std:We}}})&&e.f)({}),Ji=(e=>(globalThis.__TYPEGPU_META__??=new WeakMap).set(e.f=(t=>{"use gpu";return He(t.z)>.5||He(t.x)>.6?O(0,1,0):gl(t,1e-4)}),{v:1,name:"getNormal",ast:{params:[{type:"i",name:"position"}],body:[0,[[11,[3,[1,[6,[7,"std","abs"],[[7,"position","z"]]],">",[5,"0.5"]],"||",[1,[6,[7,"std","abs"],[[7,"position","x"]]],">",[5,"0.6"]]],[0,[[10,[6,[7,"d","vec3f"],[[5,"0"],[5,"1"],[5,"0"]]]]]]],[10,[6,"getApproxNormal",["position",[5,"0.0001"]]]]]],externalNames:["std","d","getApproxNormal"]},get externals(){return{std:We,d:ve,getApproxNormal:gl}}})&&e.f)({}),wl=(e=>(globalThis.__TYPEGPU_META__??=new WeakMap).set(e.f=(t=>{"use gpu";return ae(t,t)}),{v:1,name:"sqLength",ast:{params:[{type:"i",name:"a"}],body:[0,[[10,[6,[7,"std","dot"],["a","a"]]]]],externalNames:["std"]},get externals(){return{std:We}}})&&e.f)({}),xl=(e=>(globalThis.__TYPEGPU_META__??=new WeakMap).set(e.f=((t,n)=>{"use gpu";if(t.y<-dr.groundThickness){const i=Wi(t.xz)+.02,p=jt(1-i*30),y=jt(-t.z*4*n.z+1);return O(1).mul(p).mul(y*.5)}return O(1)}),{v:1,name:"getFakeShadow",ast:{params:[{type:"i",name:"position"},{type:"i",name:"lightDir"}],body:[0,[[11,[1,[7,"position","y"],"<",[4,"-",[7,"GroundParams","groundThickness"]]],[0,[[13,"fadeSharpness",[5,"30"]],[13,"inset",[5,"0.02"]],[13,"cutout",[1,[6,"circleCutoutDist",[[7,"position","xz"]]],"+","inset"]],[13,"edgeDarkening",[6,[7,"std","saturate"],[[1,[5,"1"],"-",[1,"cutout","*","fadeSharpness"]]]]],[13,"lightGradient",[6,[7,"std","saturate"],[[1,[1,[1,[4,"-",[7,"position","z"]],"*",[5,"4"]],"*",[7,"lightDir","z"]],"+",[5,"1"]]]]],[10,[6,[7,[6,[7,[6,[7,"d","vec3f"],[[5,"1"]]],"mul"],["edgeDarkening"]],"mul"],[[1,"lightGradient","*",[5,"0.5"]]]]]]]],[10,[6,[7,"d","vec3f"],[[5,"1"]]]]]],externalNames:["GroundParams","circleCutoutDist","std","d"]},get externals(){return{GroundParams:dr,circleCutoutDist:Wi,std:We,d:ve}}})&&e.f)({}),vl=(e=>(globalThis.__TYPEGPU_META__??=new WeakMap).set(e.f=((t,n)=>{"use gpu";let r=$(0),s=$(1);const i=_i/ba;for(let y=1;y<=ba;y++){const v=i*$(y),_=t.add(n.mul(v)),P=yl(_)-Ju,U=ie(0,v-P);if(r+=U*s,s*=.5,r>_i/Ta)break}const p=1-Ta*r/_i;return jt(p)}),{v:1,name:"calculateAO",ast:{params:[{type:"i",name:"position"},{type:"i",name:"normal"}],body:[0,[[12,"totalOcclusion",[6,[7,"d","f32"],[[5,"0"]]]],[12,"sampleWeight",[6,[7,"d","f32"],[[5,"1"]]]],[13,"stepDistance",[1,"AO_RADIUS","/","AO_STEPS"]],[14,[12,"i",[5,"1"]],[1,"i","<=","AO_STEPS"],[102,"++","i"],[0,[[13,"sampleHeight",[1,"stepDistance","*",[6,[7,"d","f32"],["i"]]]],[13,"samplePosition",[6,[7,"position","add"],[[6,[7,"normal","mul"],["sampleHeight"]]]]],[13,"distanceToSurface",[1,[6,"getSceneDistForAO",["samplePosition"]],"-","AO_BIAS"]],[13,"occlusionContribution",[6,[7,"std","max"],[[5,"0"],[1,"sampleHeight","-","distanceToSurface"]]]],[2,"totalOcclusion","+=",[1,"occlusionContribution","*","sampleWeight"]],[2,"sampleWeight","*=",[5,"0.5"]],[11,[1,"totalOcclusion",">",[1,"AO_RADIUS","/","AO_INTENSITY"]],[0,[[17]]]]]]],[13,"rawAO",[1,[5,"1"],"-",[1,[1,"AO_INTENSITY","*","totalOcclusion"],"/","AO_RADIUS"]]],[10,[6,[7,"std","saturate"],["rawAO"]]]]],externalNames:["d","AO_RADIUS","AO_STEPS","getSceneDistForAO","AO_BIAS","std","AO_INTENSITY"]},get externals(){return{d:ve,AO_RADIUS:_i,AO_STEPS:ba,getSceneDistForAO:yl,AO_BIAS:Ju,std:We,AO_INTENSITY:Ta}}})&&e.f)({}),bl=(e=>(globalThis.__TYPEGPU_META__??=new WeakMap).set(e.f=((t,n,r)=>{"use gpu";const s=Ls(Ar.$.direction),i=xl(t,s),p=ie(ae(n,s),0),y=an(r.sub(t)),v=Vc(Ls(s),n),_=ie(ae(y,v),0)**qu,P=Ar.$.color.mul(_*Wu),U=O(.9),R=U.mul(Ar.$.color).mul(p).mul(i),j=U.mul(Yu).mul(Cu),L=P.mul(i);return jt(R.add(j).add(L))}),{v:1,name:"calculateLighting",ast:{params:[{type:"i",name:"hitPosition"},{type:"i",name:"normal"},{type:"i",name:"rayOrigin"}],body:[0,[[13,"lightDir",[6,[7,"std","neg"],[[7,[7,"lightUniform","$"],"direction"]]]],[13,"fakeShadow",[6,"getFakeShadow",["hitPosition","lightDir"]]],[13,"diffuse",[6,[7,"std","max"],[[6,[7,"std","dot"],["normal","lightDir"]],[5,"0"]]]],[13,"viewDir",[6,[7,"std","normalize"],[[6,[7,"rayOrigin","sub"],["hitPosition"]]]]],[13,"reflectDir",[6,[7,"std","reflect"],[[6,[7,"std","neg"],["lightDir"]],"normal"]]],[13,"specularFactor",[1,[6,[7,"std","max"],[[6,[7,"std","dot"],["viewDir","reflectDir"]],[5,"0"]]],"**","SPECULAR_POWER"]],[13,"specular",[6,[7,[7,[7,"lightUniform","$"],"color"],"mul"],[[1,"specularFactor","*","SPECULAR_INTENSITY"]]]],[13,"baseColor",[6,[7,"d","vec3f"],[[5,"0.9"]]]],[13,"directionalLight",[6,[7,[6,[7,[6,[7,"baseColor","mul"],[[7,[7,"lightUniform","$"],"color"]]],"mul"],["diffuse"]],"mul"],["fakeShadow"]]],[13,"ambientLight",[6,[7,[6,[7,"baseColor","mul"],["AMBIENT_COLOR"]],"mul"],["AMBIENT_INTENSITY"]]],[13,"finalSpecular",[6,[7,"specular","mul"],["fakeShadow"]]],[10,[6,[7,"std","saturate"],[[6,[7,[6,[7,"directionalLight","add"],["ambientLight"]],"add"],["finalSpecular"]]]]]]],externalNames:["std","lightUniform","getFakeShadow","SPECULAR_POWER","SPECULAR_INTENSITY","d","AMBIENT_COLOR","AMBIENT_INTENSITY"]},get externals(){return{std:We,lightUniform:Ar,getFakeShadow:xl,SPECULAR_POWER:qu,SPECULAR_INTENSITY:Wu,d:ve,AMBIENT_COLOR:Yu,AMBIENT_INTENSITY:Cu}}})&&e.f)({}),Tl=(e=>(globalThis.__TYPEGPU_META__??=new WeakMap).set(e.f=((t,n,r)=>{"use gpu";const s=vl(n,r),i=t.mul(s);return k(i,1)}),{v:1,name:"applyAO",ast:{params:[{type:"i",name:"litColor"},{type:"i",name:"hitPosition"},{type:"i",name:"normal"}],body:[0,[[13,"ao",[6,"calculateAO",["hitPosition","normal"]]],[13,"finalColor",[6,[7,"litColor","mul"],["ao"]]],[10,[6,[7,"d","vec4f"],["finalColor",[5,"1"]]]]]],externalNames:["calculateAO","d"]},get externals(){return{calculateAO:vl,d:ve}}})&&e.f)({}),_l=(e=>(globalThis.__TYPEGPU_META__??=new WeakMap).set(e.f=((t,n)=>{"use gpu";let r=$(),s=$();for(let i=0;i<6;i++){const p=t.add(n.mul(r));if(s=xr(p),r+=s,r>xa||s<lr*10)break}return r<xa?Zi(t,n,r).xyz:O()}),{v:1,name:"rayMarchNoJelly",ast:{params:[{type:"i",name:"rayOrigin"},{type:"i",name:"rayDirection"}],body:[0,[[12,"distanceFromOrigin",[6,[7,"d","f32"],[]]],[12,"hit",[6,[7,"d","f32"],[]]],[14,[12,"i",[5,"0"]],[1,"i","<",[5,"6"]],[102,"++","i"],[0,[[13,"p",[6,[7,"rayOrigin","add"],[[6,[7,"rayDirection","mul"],["distanceFromOrigin"]]]]],[2,"hit","=",[6,"getMainSceneDist",["p"]]],[2,"distanceFromOrigin","+=","hit"],[11,[3,[1,"distanceFromOrigin",">","MAX_DIST"],"||",[1,"hit","<",[1,"SURF_DIST","*",[5,"10"]]]],[0,[[17]]]]]]],[11,[1,"distanceFromOrigin","<","MAX_DIST"],[0,[[10,[7,[6,"renderBackground",["rayOrigin","rayDirection","distanceFromOrigin"]],"xyz"]]]]],[10,[6,[7,"d","vec3f"],[]]]]],externalNames:["d","getMainSceneDist","MAX_DIST","SURF_DIST","renderBackground"]},get externals(){return{d:ve,getMainSceneDist:xr,MAX_DIST:xa,SURF_DIST:lr,renderBackground:Zi}}})&&e.f)({}),Zi=(e=>(globalThis.__TYPEGPU_META__??=new WeakMap).set(e.f=((t,n,r)=>{"use gpu";const s=bt.stateUniform.$,i=t.add(n.mul(r)),p=Ji(i),y=Ws.$,v=wl(i.sub(O(0,0,0))),_=y.xyz.mul(1/(v*15+1)*.4),P=y.xyz.mul(1/(v*40+1)*.3).mul(He(p.z)),U=Gc(.7,1,s.posY)*2+.7,R=bl(i,p,t),j=Tl(Ys(Lu,ju,Xs.$===1).mul(R),i,p).add(k(_.mul(U),0)).add(k(P.mul(U),0));return k(j.xyz,1)}),{v:1,name:"renderBackground",ast:{params:[{type:"i",name:"rayOrigin"},{type:"i",name:"rayDirection"},{type:"i",name:"backgroundHitDist"}],body:[0,[[13,"state",[7,[7,"buttonBehavior","stateUniform"],"$"]],[13,"hitPosition",[6,[7,"rayOrigin","add"],[[6,[7,"rayDirection","mul"],["backgroundHitDist"]]]]],[13,"newNormal",[6,"getNormal",["hitPosition"]]],[13,"jellyColor",[7,"jellyColorUniform","$"]],[13,"sqDist",[6,"sqLength",[[6,[7,"hitPosition","sub"],[[6,[7,"d","vec3f"],[[5,"0"],[5,"0"],[5,"0"]]]]]]]],[13,"bounceLight",[6,[7,[7,"jellyColor","xyz"],"mul"],[[1,[1,[5,"1"],"/",[1,[1,"sqDist","*",[5,"15"]],"+",[5,"1"]]],"*",[5,"0.4"]]]]],[13,"sideBounceLight",[6,[7,[6,[7,[7,"jellyColor","xyz"],"mul"],[[1,[1,[5,"1"],"/",[1,[1,"sqDist","*",[5,"40"]],"+",[5,"1"]]],"*",[5,"0.3"]]]],"mul"],[[6,[7,"std","abs"],[[7,"newNormal","z"]]]]]],[13,"emission",[1,[1,[6,[7,"std","smoothstep"],[[5,"0.7"],[5,"1"],[7,"state","posY"]]],"*",[5,"2"]],"+",[5,"0.7"]]],[13,"litColor",[6,"calculateLighting",["hitPosition","newNormal","rayOrigin"]]],[13,"backgroundColor",[6,[7,[6,[7,[6,"applyAO",[[6,[7,[6,[7,"std","select"],["LIGHT_GROUND_ALBEDO","DARK_GROUND_ALBEDO",[1,[7,"darkModeUniform","$"],"==",[5,"1"]]]],"mul"],["litColor"]],"hitPosition","newNormal"]],"add"],[[6,[7,"d","vec4f"],[[6,[7,"bounceLight","mul"],["emission"]],[5,"0"]]]]],"add"],[[6,[7,"d","vec4f"],[[6,[7,"sideBounceLight","mul"],["emission"]],[5,"0"]]]]]],[10,[6,[7,"d","vec4f"],[[7,"backgroundColor","xyz"],[5,"1"]]]]]],externalNames:["buttonBehavior","getNormal","jellyColorUniform","sqLength","d","std","calculateLighting","applyAO","LIGHT_GROUND_ALBEDO","DARK_GROUND_ALBEDO","darkModeUniform"]},get externals(){return{buttonBehavior:bt,getNormal:Ji,jellyColorUniform:Ws,sqLength:wl,d:ve,std:We,calculateLighting:bl,applyAO:Tl,LIGHT_GROUND_ALBEDO:Lu,DARK_GROUND_ALBEDO:ju,darkModeUniform:Xs}}})&&e.f)({}),$l=(e=>(globalThis.__TYPEGPU_META__??=new WeakMap).set(e.f=((t,n,r)=>{"use gpu";let s=J(),i=$();for(let P=0;P<Ti;P++){const U=t.add(n.mul(i)),R=xr(U);if(i+=R,R<lr)break}const p=Zi(t,n,i),y=dl(),v=ll(t,n,y);if(!v.hit)return p;let _=ie($(0),v.tMin);for(let P=0;P<Ti&&!(s>=Ti);P++){const U=t.add(n.mul(_)),R=Pr(U);if(_+=R.distance,s++,R.distance<lr){const j=t.add(n.mul(_));if(R.objectType!==Ds.SLIDER)break;const L=Ji(j),Z=n,Q=Ie(1,ie(0,ae(Ls(Z),L))),re=ol(Q,$(1),$(va)),Me=jt(O(j.y+.2)),oe=1/va,be=1-oe*oe*(1-Q*Q);let ze=O();if(be>0){const Pe=an(ue(Z.mul(oe),L.mul(oe*Q-gn(be)))),ht=j.add(Pe.mul(lr*2)).add(Pe.mul(lr*2)),it=_l(ht,Pe),Ct=Ws.$,_t=Ct.xyz.mul(1.5),Ht=$(20),gt=O(1).sub(Ct.xyz).mul(Ht),Ee=bt.stateUniform.$,Te=jt(rn(1,.6,j.y*(1/(ls.y*2))+.25))*(1-Ee.posY*.5),ge=ul(gt.mul(Te**2),.08),$t=Ls(Ar.$.direction),Qt=ie(0,ae($t,Pe)),Le=_t.mul(Xu*Qt*Te**3);ze=it.mul(ge).add(Le)}const Se=ue(Me.mul(re),ze.mul(1-re));return k(Se,1)}if(_>i)break}return p}),{v:1,name:"rayMarch",ast:{params:[{type:"i",name:"rayOrigin"},{type:"i",name:"rayDirection"},{type:"i",name:"_uv"}],body:[0,[[12,"totalSteps",[6,[7,"d","u32"],[]]],[12,"backgroundDist",[6,[7,"d","f32"],[]]],[14,[12,"i",[5,"0"]],[1,"i","<","MAX_STEPS"],[102,"++","i"],[0,[[13,"p",[6,[7,"rayOrigin","add"],[[6,[7,"rayDirection","mul"],["backgroundDist"]]]]],[13,"hit",[6,"getMainSceneDist",["p"]]],[2,"backgroundDist","+=","hit"],[11,[1,"hit","<","SURF_DIST"],[0,[[17]]]]]]],[13,"background",[6,"renderBackground",["rayOrigin","rayDirection","backgroundDist"]]],[13,"bbox",[6,"getJellyBounds",[]]],[13,"intersection",[6,"intersectBox",["rayOrigin","rayDirection","bbox"]]],[11,[4,"!",[7,"intersection","hit"]],[0,[[10,"background"]]]],[12,"distanceFromOrigin",[6,[7,"std","max"],[[6,[7,"d","f32"],[[5,"0"]]],[7,"intersection","tMin"]]]],[14,[12,"i",[5,"0"]],[1,"i","<","MAX_STEPS"],[102,"++","i"],[0,[[11,[1,"totalSteps",">=","MAX_STEPS"],[0,[[17]]]],[13,"currentPosition",[6,[7,"rayOrigin","add"],[[6,[7,"rayDirection","mul"],["distanceFromOrigin"]]]]],[13,"hitInfo",[6,"getSceneDist",["currentPosition"]]],[2,"distanceFromOrigin","+=",[7,"hitInfo","distance"]],[102,"++","totalSteps"],[11,[1,[7,"hitInfo","distance"],"<","SURF_DIST"],[0,[[13,"hitPosition",[6,[7,"rayOrigin","add"],[[6,[7,"rayDirection","mul"],["distanceFromOrigin"]]]]],[11,[4,"!",[1,[7,"hitInfo","objectType"],"==",[7,"ObjectType","SLIDER"]]],[0,[[17]]]],[13,"N",[6,"getNormal",["hitPosition"]]],[13,"I","rayDirection"],[13,"cosi",[6,[7,"std","min"],[[5,"1"],[6,[7,"std","max"],[[5,"0"],[6,[7,"std","dot"],[[6,[7,"std","neg"],["I"]],"N"]]]]]]],[13,"F",[6,"fresnelSchlick",["cosi",[6,[7,"d","f32"],[[5,"1"]]],[6,[7,"d","f32"],["JELLY_IOR"]]]]],[13,"reflection",[6,[7,"std","saturate"],[[6,[7,"d","vec3f"],[[1,[7,"hitPosition","y"],"+",[5,"0.2"]]]]]]],[13,"eta",[1,[5,"1"],"/","JELLY_IOR"]],[13,"k",[1,[5,"1"],"-",[1,[1,"eta","*","eta"],"*",[1,[5,"1"],"-",[1,"cosi","*","cosi"]]]]],[12,"refractedColor",[6,[7,"d","vec3f"],[]]],[11,[1,"k",">",[5,"0"]],[0,[[13,"refrDir",[6,[7,"std","normalize"],[[6,[7,"std","add"],[[6,[7,"I","mul"],["eta"]],[6,[7,"N","mul"],[[1,[1,"eta","*","cosi"],"-",[6,[7,"std","sqrt"],["k"]]]]]]]]]],[13,"p",[6,[7,"hitPosition","add"],[[6,[7,"refrDir","mul"],[[1,"SURF_DIST","*",[5,"2"]]]]]]],[13,"exitPos",[6,[7,"p","add"],[[6,[7,"refrDir","mul"],[[1,"SURF_DIST","*",[5,"2"]]]]]]],[13,"env",[6,"rayMarchNoJelly",["exitPos","refrDir"]]],[13,"jellyColor",[7,"jellyColorUniform","$"]],[13,"scatterTint",[6,[7,[7,"jellyColor","xyz"],"mul"],[[5,"1.5"]]]],[13,"density",[6,[7,"d","f32"],[[5,"20"]]]],[13,"absorb",[6,[7,[6,[7,[6,[7,"d","vec3f"],[[5,"1"]]],"sub"],[[7,"jellyColor","xyz"]]],"mul"],["density"]]],[13,"state",[7,[7,"buttonBehavior","stateUniform"],"$"]],[13,"progress",[1,[6,[7,"std","saturate"],[[6,[7,"std","mix"],[[5,"1"],[5,"0.6"],[1,[1,[7,"hitPosition","y"],"*",[1,[5,"1"],"/",[1,[7,"JELLY_HALFSIZE","y"],"*",[5,"2"]]]],"+",[5,"0.25"]]]]]],"*",[1,[5,"1"],"-",[1,[7,"state","posY"],"*",[5,"0.5"]]]]],[13,"T",[6,"beerLambert",[[6,[7,"absorb","mul"],[[1,"progress","**",[5,"2"]]]],[5,"0.08"]]]],[13,"lightDir",[6,[7,"std","neg"],[[7,[7,"lightUniform","$"],"direction"]]]],[13,"forward",[6,[7,"std","max"],[[5,"0"],[6,[7,"std","dot"],["lightDir","refrDir"]]]]],[13,"scatter",[6,[7,"scatterTint","mul"],[[1,[1,"JELLY_SCATTER_STRENGTH","*","forward"],"*",[1,"progress","**",[5,"3"]]]]]],[2,"refractedColor","=",[6,[7,[6,[7,"env","mul"],["T"]],"add"],["scatter"]]]]]],[13,"jelly",[6,[7,"std","add"],[[6,[7,"reflection","mul"],["F"]],[6,[7,"refractedColor","mul"],[[1,[5,"1"],"-","F"]]]]]],[10,[6,[7,"d","vec4f"],["jelly",[5,"1"]]]]]]],[11,[1,"distanceFromOrigin",">","backgroundDist"],[0,[[17]]]]]]],[10,"background"]]],externalNames:["d","MAX_STEPS","getMainSceneDist","SURF_DIST","renderBackground","getJellyBounds","intersectBox","std","getSceneDist","ObjectType","getNormal","fresnelSchlick","JELLY_IOR","rayMarchNoJelly","jellyColorUniform","buttonBehavior","JELLY_HALFSIZE","beerLambert","lightUniform","JELLY_SCATTER_STRENGTH"]},get externals(){return{d:ve,MAX_STEPS:Ti,getMainSceneDist:xr,SURF_DIST:lr,renderBackground:Zi,getJellyBounds:dl,intersectBox:ll,std:We,getSceneDist:Pr,ObjectType:Ds,getNormal:Ji,fresnelSchlick:ol,JELLY_IOR:va,rayMarchNoJelly:_l,jellyColorUniform:Ws,buttonBehavior:bt,JELLY_HALFSIZE:ls,beerLambert:ul,lightUniform:Ar,JELLY_SCATTER_STRENGTH:Xu}}})&&e.f)({}),d2=(globalThis.__TYPEGPU_AUTONAME__??(e=>e))(H["~unstable"].fragmentFn({in:{uv:F},out:k})((e=>(globalThis.__TYPEGPU_META__??=new WeakMap).set(e.f=(({uv:t})=>{Fu.seed2(ao.$.mul(t));const n=F(t.x*2-1,-(t.y*2-1)),r=pl(n),s=$l(r.origin,r.direction,t),i=Ys(1.5,2,Xs.$===1);return k(Dc(s.xyz.mul(i)),1)}),{v:1,name:void 0,ast:{params:[{type:"d",props:[{name:"uv",alias:"uv"}]}],body:[0,[[6,[7,"randf","seed2"],[[6,[7,[7,"randomUniform","$"],"mul"],["uv"]]]],[13,"ndc",[6,[7,"d","vec2f"],[[1,[1,[7,"uv","x"],"*",[5,"2"]],"-",[5,"1"]],[4,"-",[1,[1,[7,"uv","y"],"*",[5,"2"]],"-",[5,"1"]]]]]],[13,"ray",[6,"getRay",["ndc"]]],[13,"color",[6,"rayMarch",[[7,"ray","origin"],[7,"ray","direction"],"uv"]]],[13,"exposure",[6,[7,"std","select"],[[5,"1.5"],[5,"2"],[1,[7,"darkModeUniform","$"],"==",[5,"1"]]]]],[10,[6,[7,"d","vec4f"],[[6,[7,"std","tanh"],[[6,[7,[7,"color","xyz"],"mul"],["exposure"]]]],[5,"1"]]]]]],externalNames:["randf","randomUniform","d","getRay","rayMarch","std","darkModeUniform"]},get externals(){return{randf:Fu,randomUniform:ao,d:ve,getRay:pl,rayMarch:$l,std:We,darkModeUniform:Xs}}})&&e.f)({})),"raymarchFn"),f2=(globalThis.__TYPEGPU_AUTONAME__??(e=>e))(H["~unstable"].fragmentFn({in:{uv:F},out:k})((e=>(globalThis.__TYPEGPU_META__??=new WeakMap).set(e.f=(t=>Zh(so.$.currentTexture,hl.$,t.uv)),{v:1,name:void 0,ast:{params:[{type:"i",name:"input"}],body:[0,[[10,[6,[7,"std","textureSample"],[[7,[7,"sampleLayout","$"],"currentTexture"],[7,"filteringSampler","$"],[7,"input","uv"]]]]]],externalNames:["std","sampleLayout","filteringSampler"]},get externals(){return{std:We,sampleLayout:so,filteringSampler:hl}}})&&e.f)({})),"fragmentMain"),dp=(globalThis.__TYPEGPU_AUTONAME__??(e=>e))(Ze["~unstable"].withVertex(sp,{}).withFragment(d2,{format:"rgba8unorm"}).createPipeline(),"rayMarchPipeline"),m2=(globalThis.__TYPEGPU_AUTONAME__??(e=>e))(Ze["~unstable"].withVertex(sp,{}).withFragment(f2,{format:hp}).createPipeline(),"renderPipeline");let Ml=performance.now(),Ii=0;const Zo=new h2(Ze,Hn,Qn);function fp(){return{rayMarch:Ze.createBindGroup(op,{backgroundTexture:Xo.sampled}),render:[0,1].map(e=>Ze.createBindGroup(so,{currentTexture:Zo.getResolvedTexture(e)}))}}let mp=fp();function yp(e){Ii++,Jo.jitter();const t=Math.min((e-Ml)*.001,.1);Ml=e,ao.write(F((Math.random()-.5)*2,(Math.random()-.5)*2)),bt.update(t);const n=Ii%2;dp.withColorAttachment({view:Ze.unwrap(io[n].sampled),loadOp:"clear",storeOp:"store"}).draw(3),Zo.resolve(io[n].sampled,Ii,n),m2.withColorAttachment({view:pp.getCurrentTexture().createView(),loadOp:"clear",storeOp:"store"}).with(mp.render[n]).draw(3),requestAnimationFrame(yp)}function oo(){[Hn,Qn]=[Zt.width*ps,Zt.height*ps],Jo.updateProjection(Math.PI/4,Hn,Qn),io=lp(Ze,Hn,Qn),Xo=cp(Ze,Hn,Qn),Zo.resize(Hn,Qn),Ii=0,mp=fp()}const gp=new ResizeObserver(()=>{oo()});gp.observe(Zt);requestAnimationFrame(yp);let Cn=!1;Zt.addEventListener("touchstart",e=>{const t=e.touches[0];bt.startDrag(t.clientX,t.clientY),Cn=!0,e.preventDefault()});Zt.addEventListener("touchmove",e=>{if(Cn){const t=e.touches[0];bt.updateDrag(t.clientX,t.clientY),e.preventDefault()}});Zt.addEventListener("touchend",e=>{Cn&&(bt.endDrag(),Cn=!1),bt.pressed=!1});Zt.addEventListener("mousedown",e=>{bt.startDrag(e.clientX,e.clientY),Cn=!0,e.preventDefault()});Zt.addEventListener("mousemove",e=>{Cn&&bt.updateDrag(e.clientX,e.clientY)});Zt.addEventListener("mouseup",e=>{Cn&&(bt.endDrag(),Cn=!1),bt.pressed=!1,e.stopPropagation()});window.addEventListener("mouseup",()=>{Cn&&(bt.endDrag(),Cn=!1),bt.pressed=!1});async function y2(){if(!p2)return .5;const e=5,t=2;let n=.3,r=0;const s=dp.withPerformanceCallback((i,p)=>{r=Number(p-i)/1e6});for(let i=0;i<8;i++){const p=(globalThis.__TYPEGPU_AUTONAME__??(v=>v))(Ze["~unstable"].createTexture({size:[Zt.width*n,Zt.height*n],format:"rgba8unorm"}).$usage("render"),"testTexture");if(s.withColorAttachment({view:Ze.unwrap(p).createView(),loadOp:"clear",storeOp:"store"}).with(Ze.createBindGroup(op,{backgroundTexture:Xo.sampled})).draw(3),await Ze.device.queue.onSubmittedWorkDone(),p.destroy(),Math.abs(r-e)<t)break;const y=r>e?-.1:.1;n=Math.max(.3,Math.min(1,n+y))}return console.log(`Auto-selected quality scale: ${n.toFixed(2)}`),n}const pv={Quality:{initial:"Auto",options:["Auto","Very Low","Low","Medium","High","Ultra"],onSelectChange:e=>{if(e==="Auto"){y2().then(n=>{ps=n,oo()});return}ps={"Very Low":.3,Low:.5,Medium:.7,High:.85,Ultra:1}[e]||.5,oo()}},"Light dir":{initial:0,min:0,max:1,step:.01,onSliderChange:e=>{const t=an(O(.18,-.3,.64)),n=an(O(-.5,-.14,-.8)),r=an(rn(t,n,e));Ar.writePartial({direction:r})}},"Jelly Color":{initial:[.08,.5,1],onColorChange:e=>{Ws.write(k(...e,1))}},"Dark Mode":{initial:!1,onToggleChange:e=>{Xs.write(J(e))}}};function dv(){gp.disconnect(),Ze.destroy()}export{pv as controls,dv as onCleanup};
